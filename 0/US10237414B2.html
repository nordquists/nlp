
    <html>
        <body>
            <search-app>
                <article class="result" itemscope="" itemtype="http://schema.org/ScholarlyArticle">
    <h1 itemprop="pageTitle">US10237414B2 - Methods, systems, and products for voice-over internet protocol calls 
        - Google Patents</h1><section itemprop="abstract" itemscope="">
<h2>Abstract</h2>
<div html="" itemprop="content"><abstract lang="EN" load-source="docdb" mxw-id="PA289764804" source="national office">
<div class="abstract">Network resources for a call are allocated. The network resources for the call are reserved based on a reservation. The network resources are reserved before any one network resource is committed. If the call is confirmed, then the network resources are committed.</div>
</abstract>
</div>
</section><section itemprop="description" itemscope="">
<h2>Description</h2>
<div html="" itemprop="content"><div class="description" lang="EN" load-source="patent-office" mxw-id="PDES187088518">
<heading id="h-0001">CROSS-REFERENCE TO RELATED APPLICATIONS</heading>
<div class="description-paragraph" id="p-0002" num="0001">This application is a continuation of U.S. patent application Ser. No. 15/668,788 filed Aug. 4, 2017 and since issued as U.S. Pat. No. 9,942,411, which is a continuation of U.S. patent application Ser. No. 15/042,434 filed Feb. 12, 2016 and since issued as U.S. Pat. No. 9,762,739, which is a continuation of U.S. patent application Ser. No. 14/521,501 filed Oct. 23, 2014 and since issued as U.S. Pat. No. 9,277,058, which was a continuation of U.S. patent application Ser. No. 13/494,078 filed Jun. 12, 2012 and now issued as U.S. Pat. No. 8,873,547, which was a continuation of U.S. patent application Ser. No. 12/806,502 filed on Aug. 13, 2010 and since issued as U.S. Pat. No. 8,249,059, which was a continuation of U.S. patent application Ser. No. 11/888,196 filed on Jul. 31, 2007 and since issued as U.S. Pat. No. 7,778,240, which was a continuation of U.S. patent application Ser. No. 10/852,775 filed on May 25, 2004 and since issued as U.S. Pat. No. 7,245,610 which was a continuation of U.S. patent application Ser. No. 09/366,208 filed on Aug. 4, 1999 and since issued as U.S. Pat. No. 6,757,290, which claimed the benefit of U.S. Provisional Application No. 60/104,878 filed on Oct. 20, 1998 and the benefit of U.S. Provisional Application No. 60/095,288 filed Aug. 4, 1998, with all these applications incorporated herein by reference in their entireties.</div>
<heading id="h-0002">BACKGROUND OF THE INVENTION</heading>
<div class="description-paragraph" id="p-0003" num="0002">The present invention generally relates to allocating network resources. More specifically, the present invention relates to reserving and committing network resources based on an authorized quality of service.</div>
<div class="description-paragraph" id="p-0004" num="0003">The known signaling architecture H.323 is an International Telecommunications Union (ITU) defined standard that describes how multimedia communications occur between terminals, network equipment and services on local area networks (LANs) and wide area networks (WANs) that do not provide a guaranteed quality of service (such as Internet Protocol (IP) networks). Quality of service is a measure of communication service quality during a call, and can include, for example, the bandwidth, delay and latency associated with the call. In networks using connectionless “best effort” delivery models, the quality of service typically is not guaranteed; the H.323 is a signaling architecture for such a network.</div>
<div class="description-paragraph" id="p-0005" num="0004">The H.323 provides a range of implementation options including gatekeeper-routed signaling. In the H.323 standard, gatekeepers map LAN address aliases to IP addresses and provide address lookups when needed. Gatekeepers also exercise call-control functions to limit the number of H.323 connections and the total bandwidth used by these connections in an H.323 “zone.” Although the gatekeeper is not necessary within the H.323 standard, when a gatekeeper is present in a network, network terminals must make use of its services. In other words, gatekeepers maintain state information for each individual call and all call signaling must pass through the gatekeepers.</div>
<div class="description-paragraph" id="p-0006" num="0005">The gatekeeper implementation of the H.323 standard, however, suffers several shortcomings. First, the equipment associated with gatekeepers needs to be extremely reliable so that the gatekeeper is available throughout the course of the call. If the gatekeeper-related equipment fails during a call, the call fails because the state information for the call maintained solely at the gatekeeper is lost. Second, the gatekeeper-related equipment likely cannot scale in a cost effective manner because maintaining the state information and performing the messaging associated with H.323 is complex and processor intensive. Finally, theft of service is possible by bypassing the gatekeepers to place unauthorized and unmonitored calls.</div>
<heading id="h-0003">SUMMARY OF THE INVENTION</heading>
<div class="description-paragraph" id="p-0007" num="0006">Gates for a call between a calling party and a called party are coordinated. A timer associated with a first gate opened at an originating network edge device is initiated. A first gate open message is sent from the originating network edge device to the terminating network edge device. The first gate at the originating network edge device is released if the timer expires before at least one from the group of: (1) an acknowledgment based on the sent first gate open message is received from the terminating network edge device, and (2) a second gate open message is received at the originating network edge device from the terminating network edge device after the terminating network edge device has opened a second gate associated with the called party.</div>
<description-of-drawings>
<heading id="h-0004">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<div class="description-paragraph" id="p-0008" num="0007"> <figref idrefs="DRAWINGS">FIG. 1</figref> illustrates a network, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0009" num="0008"> <figref idrefs="DRAWINGS">FIG. 2</figref> illustrates a flow chart to reserve network resources for a call, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0010" num="0009"> <figref idrefs="DRAWINGS">FIG. 3</figref> illustrates a flow chart for performing two-phase signaling in call connection, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0011" num="0010"> <figref idrefs="DRAWINGS">FIG. 4</figref> illustrates a flow chart for disconnecting a call, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0012" num="0011"> <figref idrefs="DRAWINGS">FIG. 5</figref> illustrates a flow chart for translating a network address, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0013" num="0012"> <figref idrefs="DRAWINGS">FIG. 6</figref> shows the call flow for a normal call setup, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0014" num="0013"> <figref idrefs="DRAWINGS">FIG. 7</figref> shows an example signaling call flow for reservation of resources in the segment of the network between the edge routers for a voice call, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0015" num="0014"> <figref idrefs="DRAWINGS">FIG. 8</figref> shows the call flow for a normal call termination, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0016" num="0015"> <figref idrefs="DRAWINGS">FIG. 9</figref> shows the call flow for a call originating from a BTI but terminating in the PSTN, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0017" num="0016"> <figref idrefs="DRAWINGS">FIG. 10</figref> shows the call flow for a call originating in the PSTN, but terminating in the IP telephony network, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0018" num="0017"> <figref idrefs="DRAWINGS">FIG. 11</figref> shows the call flow for a normal release to the PSTN, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0019" num="0018"> <figref idrefs="DRAWINGS">FIG. 12</figref> shows the call flow for a call released from the PSTN, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0020" num="0019"> <figref idrefs="DRAWINGS">FIG. 13</figref> shows a call flow where the BTI connects to a terminating announcement server, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0021" num="0020"> <figref idrefs="DRAWINGS">FIG. 14</figref> shows the call flow for Call Trace, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0022" num="0021"> <figref idrefs="DRAWINGS">FIG. 15</figref> shows the call flow for changing the established call parameters, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0023" num="0022"> <figref idrefs="DRAWINGS">FIG. 16</figref> shows the call flow for activating a per-use Call Forwarding service, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0024" num="0023"> <figref idrefs="DRAWINGS">FIG. 17</figref> shows the call flow for Call Forwarding—All Calls when the BTI is available, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0025" num="0024"> <figref idrefs="DRAWINGS">FIG. 18</figref> shows the call flow for Call Forwarding—All Calls when the Terminating BTI is not available, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0026" num="0025"> <figref idrefs="DRAWINGS">FIG. 19</figref> shows the call flow for Call Forwarding—Busy when BTI<sub>T </sub>is available, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0027" num="0026"> <figref idrefs="DRAWINGS">FIG. 20</figref> shows the call flow for Call Forwarding—Busy when the BTI is unavailable, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0028" num="0027"> <figref idrefs="DRAWINGS">FIG. 21</figref> shows the call flow for Call Forwarding—No Answer when BTI<sub>T </sub>is available, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0029" num="0028"> <figref idrefs="DRAWINGS">FIG. 22</figref> shows the call flow for Call Forwarding—No Answer when the BTI is unavailable, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0030" num="0029"> <figref idrefs="DRAWINGS">FIG. 23</figref> shows the call flow for Caller ID/Calling Name Delivery Call Flow, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0031" num="0030"> <figref idrefs="DRAWINGS">FIG. 24</figref> shows a call flow for Call Waiting, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0032" num="0031"> <figref idrefs="DRAWINGS">FIG. 25</figref> shows the call flow for the simple Three-Way Calling alternative with bridging in BTI<sub>O</sub>, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0033" num="0032"> <figref idrefs="DRAWINGS">FIG. 26</figref> illustrates the first steps of a three-way call, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0034" num="0033"> <figref idrefs="DRAWINGS">FIG. 27</figref> shows the sequence of signaling messages exchanged in the conversion of two separate calls into one three-way call, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0035" num="0034"> <figref idrefs="DRAWINGS">FIG. 28</figref> shows the call flow for Three-way Calling Bridge in Network Call Flow—Hangup of Host, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0036" num="0035"> <figref idrefs="DRAWINGS">FIG. 29</figref> shows the call flow for Three-way Calling Bridge in Network Call Flow—Hangup of Participant, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0037" num="0036"> <figref idrefs="DRAWINGS">FIG. 30</figref> shows the call flow for Call Transfer With Consultation service when the host disconnects, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0038" num="0037"> <figref idrefs="DRAWINGS">FIG. 31</figref> shows the call flow for Call Transfer Without Consultation service, according to an embodiment of the present invention.</div>
<div class="description-paragraph" id="p-0039" num="0038"> <figref idrefs="DRAWINGS">FIG. 32</figref> shows the call flow for Return Call, according to an embodiment of the present invention.</div>
</description-of-drawings>
<heading id="h-0005">DETAILED DESCRIPTION</heading>
<div class="description-paragraph" id="p-0040" num="0039">Embodiments of the present invention relate to a communications system having a combination of different types of networks, such as a data network(s) (based on, for example, packet switching), a telephone network(s) (such as the Plain Old Telephone Network (PSTN)), and/or a cable network(s). Such a communications system can include intelligent end-terminals that allow a service provider to provide various types of services involving the different types of networks and to exploit the capabilities of the end-terminals. For example, packet telephony can be implemented in embodiments of the present invention where voice can be received and transmitted by a telephone or a communication device (such as a personal computer) connected to the data network via a cable network.</div>
<div class="description-paragraph" id="p-0041" num="0040">Embodiments of the present invention relate to call authorization, call signaling, network resource management and end-to-end signaling between communication devices (e.g., telephones, personal computers, etc.). Existing telephone services with a service quality consistent with current standards can be supported while a broader range of packet-enabled communications services can also be supported. Embodiments of the present invention allow pricing and billing of communications services to differ based on the differences in service quality (e.g., bandwidth, delay and/or latency) for the various calls.</div>
<div class="description-paragraph" id="p-0042" num="0041">Embodiments of the present invention also allow the intelligent end-points to participate in supporting features of the provided services. These intelligent end-points can be, for example, telephony-capable computers and gateways that interface conventional telephones to the data network. By exploiting the intelligence of these end-points in supporting the features of provided services, functionality (e.g., tasks associated with signaling) historically maintained solely by the network can be efficiently divided among the communication network entities and the intelligent end-points connected to the communication network.</div>
<div class="description-paragraph" id="p-0043" num="0042">In addition, embodiments of the present invention protect against theft of service, and minimize the cost and complexity associated with providing reliable service. Unlike known telephone networks, embodiments of the present invention do not require high-availability network servers that maintain the state of each individual call. Rather, embodiments of the present invention can maintain state information only in the edge routers and the end-points that are directly involved in a particular call.</div>
<div class="description-paragraph" id="p-0044" num="0043">The following discussion is separated into sections for clarity. First, a system overview of a communication network, according to an embodiment of the present invention, is discussed in Section 1 entitled “System Overview”. Then, separate aspects of embodiments of the present invention are considered: Section 2 entitled “Two-Phase Resource Reservation”, Section 3 entitled “Two-Phase Signaling”, Section 4 “Gate Coordination on a Per-Call Basis”, Section 5 entitled “Network Address Translation”, Section 6 entitled “Simulating Destination Ring Back”. Finally, Section 7 entitled “Protocol Description” details the protocols for the signaling messages and Section 8 entitled “Signaling Architecture Call Flows” describes the call flows for the signaling architecture both of which are applicable to the various aspects of embodiments of the present invention.</div>
<div class="description-paragraph" id="h-0006" num="0000">1. System Overview</div>
<div class="description-paragraph" id="p-0045" num="0044"> <figref idrefs="DRAWINGS">FIG. 1</figref> illustrates a network according to an embodiment of the present invention. Network <b>10</b> includes communication network <b>100</b> which is connected to gate controller <b>110</b> and gate controller <b>111</b>, network edge devices <b>120</b> and <b>121</b>, and telephone network gateway <b>130</b>. Gate controllers <b>110</b> and <b>111</b> are connected to database storage <b>140</b> and <b>141</b>, respectively. Network edge devices <b>120</b> and <b>121</b> are connected to access networks <b>150</b> and <b>151</b>, respectively. Access networks <b>150</b> and <b>151</b> are connected to network interface units <b>160</b> and <b>161</b>, respectively. Network interface units <b>160</b> and <b>161</b> are connected to telephone interface units (TIUs) <b>170</b> and <b>171</b>, respectively, and communication devices <b>180</b> and <b>181</b>, respectively. TIUs <b>170</b> and <b>171</b> are connected to telephones <b>190</b> and <b>191</b>, respectively. Telephone network gateway <b>130</b> is connected to telephone network <b>135</b> which, in turn, is connected to telephone <b>192</b>.</div>
<div class="description-paragraph" id="p-0046" num="0045">Communication network <b>100</b> can be a network that supports, for example, Internet Protocol (IP) signaling, IP media transport, and/or asynchronous transfer mode (ATM) media transport. Access networks <b>150</b> and <b>151</b> can be networks of wires or fibers capable of carrying voice and/or data transmissions. The telephone network <b>135</b> can be, for example, the Plain Old Telephone System (PSTN).</div>
<div class="description-paragraph" id="p-0047" num="0046">Network interface units <b>160</b> and <b>161</b> can be, for example, cable modems designed for use on a television coaxial cable circuit. Network interface units <b>160</b> and <b>161</b> allow communication devices <b>180</b> and <b>181</b>, respectively, to connect to access networks <b>150</b> and <b>151</b>, respectively. Network interface units <b>160</b> and <b>161</b> also allow TIUs <b>170</b> and <b>171</b>, respectively (and in turn telephones <b>190</b> and <b>191</b>, respectively), to connect to access networks <b>150</b> and <b>151</b>, respectively.</div>
<div class="description-paragraph" id="p-0048" num="0047">Network edge devices (NEDs) <b>120</b> and <b>121</b> are devices located at the edge of the communication network <b>100</b> that connects the communication network <b>100</b> to the access networks <b>120</b> and <b>121</b>, respectively. The network edge devices can be, for example, routers or bridges or similar equipment that can connect communication network <b>100</b> to access networks <b>150</b> and <b>151</b>. Because NEDs <b>120</b> and <b>121</b> can be specifically implemented as, for example, routers at the network edge, these units are also referred to herein as edge routers (ERs).</div>
<div class="description-paragraph" id="p-0049" num="0048">Network edge devices <b>120</b> and <b>121</b> can implement resource management and admission control mechanisms that allow the communication network <b>100</b> to provide assurances of bounded per-packet loss and delay required to assure an authorized quality of service for a call. In other words, network edge devices (e.g., network edge devices <b>120</b> or <b>121</b>) can obtain authorization from an associated gate controller (e.g., gate controller <b>110</b> or <b>111</b>, respectively) on a call-by-call basis before providing access to, for example, enhanced quality of service across the communication network. Said another way, the network edge devices can ensure that enhanced quality of service for a call of a particular party has been authorized and for which usage accounting is being done. Network edge devices can generate accounting records for calls because these devices track the resource usage within the communication network <b>100</b> for the calls. Network edge devices can also implement Network Address Translation to support address privacy for called paries and/or calling parties, as described more fully below.</div>
<div class="description-paragraph" id="p-0050" num="0049">TIUs <b>170</b> and <b>171</b> are gateways between telephones and packet-carrying networks, such as access networks <b>150</b> and <b>151</b> and communication network <b>100</b>. TIUs <b>170</b> and <b>171</b> can digitize, compress and packetize voice signals from telephone <b>190</b> and <b>191</b>, respectively, to convert analog voice into data packets for transport over the communication network <b>100</b>, and vice versa. TIUs <b>170</b> and <b>171</b> can be, for example, a simple stand-alone telephony device that incorporates the broadband interface, a high-speed data cable modem that incorporates the interface unit (i.e., TIUs and their associated network interface units can be combined into a single device), or an advanced digital set-top box that incorporates the broadband interface. TIUs <b>170</b> and <b>171</b> can be for example broadband interfaces for telephones; consequently, these units are also referred to herein as broadband telephony interfaces (BTIs).</div>
<div class="description-paragraph" id="p-0051" num="0050">TIUs contain sufficient processing and memory to perform signaling and call control functions. More specifically, TIUs <b>170</b> and <b>171</b> each include a processor and is capable of detecting changes in state information (e.g., hook state detection), collecting dialed digits (e.g., dual-tone multifrequency (DTMF) signals), and participating in the implementation of telephone features for telephones <b>190</b> and <b>191</b>, respectively. TIUs <b>170</b> and <b>171</b> can also participate in end-to-end capability negotiation as described below.</div>
<div class="description-paragraph" id="p-0052" num="0051">Note that the term “end-to-end” refers the association between two end points for a call. For example, where a call involves a calling party and a called party using telephones, the end-to-end association for the call can be between the two telephony interface units. Thus, end-to-end messages for example would include messages originating at one telephone interface unit and terminating at the other telephony interface unit where the messages are opaque to other network entities that merely forward the messages (possibly after performing network address translation as described below). For example, end-to-end messages can be routed between telephone interface units with messages being forwarded by the network edge devices and without the message being routed through the gate controllers. Alternatively, for example, where a call involves a calling party using a telephone and a called party using a communication device (such as a personal computer), the end-to-end association for the call can be between the calling party telephony interface unit and the called party network interface unit.</div>
<div class="description-paragraph" id="p-0053" num="0052">TIUs can maintain information for calls while in progress, thereby implementing certain service features locally. For example, call waiting can be implemented locally, by detecting hook flash and controlling the active call. Similarly, return call can be implemented locally by retaining state information in the TIUs about the most recent calls.</div>
<div class="description-paragraph" id="p-0054" num="0053">Note that TIUs <b>170</b> and <b>171</b> are considered to be “untrusted” devices in the sense that the TIUs can operate locally-stored software and are not necessarily under the direct control of the service provider (e.g., the entity operating the communication network <b>100</b>). Because the TIUs are untrusted devices, information passed to the TIUs can be first encrypted before it is given to the TIUs to guarantee privacy. For example, state information can be passed from the gate controllers <b>110</b> and/or <b>111</b> to the TIUs which store the state information for their later use (thereby avoiding the need to maintain state information for a call at the gate controllers) by first encrypting the state information; the state information retrieved from the TIUs can be verified subsequently via known encryption techniques.</div>
<div class="description-paragraph" id="p-0055" num="0054">In addition to encrypting the state information for the TIUs to maintain, a cryptographic hash function can be applied to the state information to detect the integrity of the state information (i.e., detect whether the state information has been altered by an untrusted entity). By applying a cryptographic hash value to the state information, a hash value is produced which can be sent to and maintained by the TIUs. As a result, when the state information is retrieved from a TIU, the cryptographic hash function can be applied to this retrieved state information; if the same hash value is produced, then the retrieved state information has not been altered at, for example, the TIU. The cryptographic hash functions can be, for example, a modification detect codes (MDCs) or message authentication codes (MACs).</div>
<div class="description-paragraph" id="p-0056" num="0055">Gate controllers <b>110</b> and <b>111</b> are adjunct platforms that have access to authentication databases and customer profile information on database storage <b>140</b> and <b>141</b>, respectively. Gate controllers <b>110</b> and <b>111</b> implement a set of service-specific control functions to support communication services, such as authentication and authorization, number translation and call routing, service-specific admission control, and signaling and service feature support.</div>
<div class="description-paragraph" id="p-0057" num="0056">The gate controllers can authenticate signaling messages and authorize requests for service so that communication services and certain service features are only provided to authorized subscribers. In other words, upon receiving a setup request message from a calling party, the gate controller can authenticate the identity of the calling party and authorize the service sought by the calling party.</div>
<div class="description-paragraph" id="p-0058" num="0057">The gate controllers can translate dialed telephone numbers to communication network addresses (such as, for example, IP addresses) based on call routing logic. For example, an originating gate controller (e.g., gate controller <b>110</b>) can translate a dialed telephone number to a communication network address associated with the terminating gate controller (e.g., gate controller <b>111</b>). The terminating gate controller can subsequently translate the communication network address to the terminating end-point (e.g., BTI <b>171</b>) to which the call should be routed. In an alternative embodiment, a single dial telephone number can be mapped to multiple communication network addresses, for example, to allow the signaling and media end-points associated with a call to be distinct.</div>
<div class="description-paragraph" id="p-0059" num="0058">The gate controllers can implement a broad range of service-specific admission control policies for the communication services. For example, the gate controllers can provide precedence for particular call (e.g., 911 emergency calls). The gate controllers can perform admission control to implement overload control mechanisms similar to those used in the convention telephone network (e.g., telephone network <b>135</b>), for example, to restrict the number of calls to a particular location or to restrict the frequency of call setup to avoid signaling overload. These mechanisms can be invoked either dynamically or under administrative control.</div>
<div class="description-paragraph" id="p-0060" num="0059">The gate controllers can perform signaling and service feature support where the service features cannot be supported solely by the TIUs. For example, certain service features such as call transfer require changing the end-points participating the calls; in such a case, the gate controllers change the gate parameters because call transfer requires reauthorization by the gate controllers. Service features that depend on the privacy of the calling information, such as caller-ID blocking, are implemented by the gate controllers. In addition, service features that require users to receive a consistent view of feature operation even when a TIU is inoperative are implemented by the gate controllers. For example, the gate controllers can control call forwarding when a TIU for a call is inoperative.</div>
<div class="description-paragraph" id="p-0061" num="0060">Gate controllers can be organized in domains where each gate controller is associated with a set of TIUs and the network edge devices that serve those TIUs. Although the TIUs are not trusted entities, a trust relationship exists between an network edge device and its associated gate controller because the gate controller acts as a policy server controlling when the network edge device can provide enhanced quality of service. A trust relationship can also exist between gate controllers.</div>
<div class="description-paragraph" id="p-0062" num="0061">A gate controller can act as a simple transaction server so that a failure of a gate controller does not affect associated calls that are in process. In one embodiment, a gate controller domain can include a primary and a secondary gate controller. If the primary gate controller fails, only calls in a transient state are affected (i.e., calls that are being established including, for example, where network resources are being allocated). The TIUs associated with those affected calls in a transient state will try to be established on the secondary gate controller after a time-out period has elapsed. All active calls (i.e., calls in progress) are unaffected by the failure of a primary gate controller because the gate controller does not retain state information for these stable, active calls. As a result, gate controllers easily and efficiently scale as more gate controllers for the communication network are required.</div>
<div class="description-paragraph" id="p-0063" num="0062">Telephone network gateway <b>130</b> can include a combination of a trunking gateway (not shown) and a signaling gateway (not shown). The trunking gateway can convert between a data format used on the data network <b>100</b> and the pulse code modulation (PCM) format typically used for transmission over the telephone network <b>135</b>. The signaling gateway can provide signaling internetworking between signaling protocols of embodiments of present invention described below and conventional telephony signaling protocols such as ISUP/SS7 (i.e., Integrated Services Digital Network User Part/Signaling System 7). In an alternative embodiment, a media gateway control protocol can be used to control the operation of a media gateway separate from a signaling gateway.</div>
<div class="description-paragraph" id="p-0064" num="0063">Although not shown in <figref idrefs="DRAWINGS">FIG. 1</figref>, additional network entities (not shown) can be included in the network <b>10</b>. For example, the gate controllers can use other servers to implement the authorization or the translation functions. Similarly, three way calling can be supported using audio bridges in the network <b>10</b>.</div>
<div class="description-paragraph" id="p-0065" num="0064">Note that although a limited number of network entities are shown in <figref idrefs="DRAWINGS">FIG. 1</figref> for simplicity of presentation, other network entities can be included in network <b>10</b>. For example, although only a sole network interface unit (e.g., a cable modem) is shown connected to a sole network interface unit, multiple network interface units are likely connected to each access network. Similarly, although only a few network edge devices, a few gate controllers and a sole telephone network gateway are shown connected to the communication network <b>100</b>, many such devices can be connected to the communication network <b>100</b>. Many other variations to the network <b>10</b> shown in <figref idrefs="DRAWINGS">FIG. 1</figref> are possible.</div>
<div class="description-paragraph" id="h-0007" num="0000">2. Two-phase Network Resource Reservation</div>
<div class="description-paragraph" id="p-0066" num="0065">In embodiments of the present invention, network resources for a call between a calling party and a called party are allocated. The network resources for the call are reserved based on a reservation request. The network resources are reserved before any one network resource from the reserved network resources is committed. The reserved network resources for the call are committed when a called party indicates acceptance for the call.</div>
<div class="description-paragraph" id="p-0067" num="0066">The term “network resources” is used herein as the facilities of a communications network required for a call and any auxiliary services associated with that call. Network resources can include, for example, the capabilities or capacities of equipment within the communications network needed to establish and maintain a call at an appropriate quality of service. The equipment within the communications network can include, for example, routers, bridges and gateways within the communications network.</div>
<div class="description-paragraph" id="p-0068" num="0067">The called party “indicates acceptance” for the call in a number of ways. For example, where the called party is using a telephone <b>190</b>, the called party can indicate acceptance for the call by picking up the telephone hand set thereby causing an off-hook condition. Where the called party is using a communication device <b>181</b> (e.g., a personal computer), the called party can indicate acceptance by making an appropriate selection with the communication device <b>181</b> that initiates handshake signaling (i.e., a personal computer equivalent for an off-hook condition). Where the called party has an answering machine, the answering machine timer can expire to connect the call.</div>
<div class="description-paragraph" id="p-0069" num="0068">Network resources are “reserved” in the sense that the network resources required for a particular call can be identified before the called party is actually connected to the calling party. These network resources can be reserved through the appropriate signal messages collectively referred to herein as a “reservation request”. After the appropriate network resources have been reserved based on the reservation request, these network resources are committed when the called party indicates acceptance for the call. By committing the network resources only when the called party indicates acceptance for the call, the accounting for the call can, for example, accurately track the time of the actual call while excluding the time of the call setup.</div>
<div class="description-paragraph" id="p-0070" num="0069">Network resources are “committed” in the sense that an available network resource operates such that the voice information between the calling party and the called party is transported. Before the network resources are committed, the network resources are allocated for the call but are not configured to actually carry the voice information for the call. By committing the reserved network resources once the called party indicates acceptance for the call, the network resources are not wastefully configured before they are actually needed. This can be particularly relevant for portions of the communication network where resources are limited, such as, for example, the upstream resources within the cable network.</div>
<div class="description-paragraph" id="p-0071" num="0070">The term “quality of service” is used herein to include, but not limited to, the measure of telecommunication service quality provided during a call. The quality of service can be specified by a calling party, a called party or the service provider of the communications network, or any combination thereof. In other words, the quality of service is “authorized” in the sense that the calling party and/or the called party specify a quality of service for the call and the service provider can verify the specified quality of service for the call. For example, a calling party transferring data (e.g., rather than transferring solely voice) may subscribe for a service with a quality of service having a large bandwidth and small latency; in such an example, a service provider can verify the service subscription for the particular quality of service associated with the call for that particular calling party.</div>
<div class="description-paragraph" id="p-0072" num="0071"> <figref idrefs="DRAWINGS">FIG. 2</figref> illustrates a flow chart to reserve network resources for a call, according to an embodiment of the present invention. <figref idrefs="DRAWINGS">FIG. 2</figref> is a simplified view of the connection process to better illustrate the two-phase allocation of network resources. This process is in two phases in the sense that network resources are first reserved and then committed in separate and distinct phases. In other words, network resources are reserved first; once the reservation process is complete, then the reserved network resources can be committed. Other aspects of the overall process will be described in further detail in other sections below.</div>
<div class="description-paragraph" id="p-0073" num="0072">Note that components of the communications networks shown in <figref idrefs="DRAWINGS">FIG. 1</figref> are referred to in <figref idrefs="DRAWINGS">FIG. 2</figref> for convenience with the shorthand notation: originating TIU <b>170</b> (TIU<sub>O</sub>), originating network edge device <b>120</b> (NED<sub>O</sub>), originating gate controller <b>110</b> (GC<sub>O</sub>), terminating gate controller <b>111</b> (GC<sub>T</sub>), terminating network edge device <b>121</b> (NED<sub>T</sub>), and terminating TIU <b>171</b> (TIU<sub>T</sub>).</div>
<div class="description-paragraph" id="p-0074" num="0073">At step <b>210</b>, a setup message for a call between a calling party and a called party is sent from the originating TIU <b>170</b> to the originating gate controller <b>110</b> and the terminating gate controller <b>111</b>. For example, upon receiving the setup message at the originating gate controller <b>110</b>, the setup message (possibly modified with additional information) can be forwarded to the terminating gate controller <b>111</b> through communication network <b>100</b>. In one embodiment, the setup message can be, for example, in the form of the SETUP message described below in Section 7 entitled “Protocol Description”.</div>
<div class="description-paragraph" id="p-0075" num="0074">At step <b>220</b>, a gate for the call is established at the terminating network edge device <b>121</b> upon receiving the setup message from terminating gate controller <b>111</b>. A “gate” is a call-admission control mechanism that uses, for example, known packet filters at the edge routers. At step <b>230</b>, another gate for the call is established at the originating network edge device <b>120</b>. In one embodiment, the gates can have associated time limits on the gate duration; such a features can allow the calls to be limited where, for example, the calls are established with a pre-paid calling card that has a limited amount of calling time that is pre-paid.</div>
<div class="description-paragraph" id="p-0076" num="0075">Note that by establishing the gates at the originating and terminating network edge devices rather than at the corresponding gate controllers, the state information for the call is maintained at a network entity through which the call is routed. In other words, state information for a call can be maintained without maintaining the state information at a gate controller. Consequently, if a gate controller fails after the gates have been established for a call, the call can be maintained. The establishment of gates for a call are discussed more fully below in the Section 4 entitled “Gate Coordination on a Per-Call Basis”.</div>
<div class="description-paragraph" id="p-0077" num="0076">At step <b>240</b>, a reserve message is sent from the originating TIU <b>170</b> to the originating NED <b>120</b>. At step <b>250</b>, a reserve message is sent from the terminating TIU <b>171</b> to the terminating NED <b>121</b>. The reserve messages sent by the originating TIU <b>170</b> and terminating TIU <b>171</b> are a part of the reservation process where an allocation of network resources is requested but the network resource need not yet be assigned or committed. Allocating the network resources includes the verifying that the quality of service desired by a TIU is no greater than the quality of service authorized by the corresponding gate controller; the gate controller authorizes a quality of service for a call using the authentication databases and customer profile information on the associated database storage (e.g., database storage <b>140</b> and <b>141</b>).</div>
<div class="description-paragraph" id="p-0078" num="0077">To provide telephone-grade service over network <b>10</b>, the network <b>10</b> can provide bounded per-packet loss and delay for the voice packets of a call by performing active resource management both in the access network <b>150</b> and <b>151</b>, and communication network <b>100</b>. Because the network edge devices (e.g., NEDs <b>120</b> and <b>121</b>) within the connection path for a call may have capacity constrained links, reservation requests for a call (and any associated messages) are forwarded end to end, thereby ensuring that network resources are available end to end. In one embodiment, because the access networks <b>150</b> and <b>151</b> may be capacity constrained (at least in the upstream direction), resource management is performed on a per-call basis for the access networks <b>150</b> and <b>151</b>.</div>
<div class="description-paragraph" id="p-0079" num="0078">Resource management in the communication network <b>100</b>, however, can be performed on a per-call basis or on a coarse-grained resource basis (i.e., resources within the communication network <b>100</b> can be reserved for multiple calls at a given time). Resource management within portions of the communication network <b>100</b> may be performed on a per-call basis because some network edge devices with the communications network <b>100</b> may not have sufficient processing capacity to process a large number of reservation messages typical for high volume call traffic. Alternatively, resource management within portions of the communication network <b>100</b> may be performed on a multiple-call basis if these portions of the communication network <b>100</b> are adequately provisioned (i.e., sufficient capacity has been reserved by a multiple-call reservation); in such cases, network edge devices within these portions of communication network <b>100</b> need not perform per-call admission control. Consequently, in an embodiment of the present invention, some network edge devices do per-flow admission control to interpret reservation requests while other network edge devices that are in capacity-rich regions of the data network <b>100</b> are provisioned to simply forward these messages without interpretation.</div>
<div class="description-paragraph" id="p-0080" num="0079">Embodiments of the present invention can perform resource reservation in the communication network <b>100</b> in a uni-directional manner which thereby compensates for routing asymmetries. Thus, when the originating TIU <b>170</b> sends a reservation request to the originating NED <b>120</b> and when the originating TIU <b>170</b> receives back an acknowledgment for the reservation request, two aspects are of the connection are confirmed. First, adequate bandwidth for the call is available in both directions over the access networks <b>150</b> and <b>151</b>. Second, adequate bandwidth for the call is available over the communication network <b>100</b>.</div>
<div class="description-paragraph" id="p-0081" num="0080">Steps <b>210</b> through <b>240</b> describe the process of reserving the network resources. At this point, the network resources to be used for the call are reserved, but none of these network resources are yet committed.</div>
<div class="description-paragraph" id="p-0082" num="0081">At step <b>250</b>, end-to-end messages are exchanged between the originating TIU <b>170</b> and the terminating TIU <b>171</b>. As previously discussed above, the term “end-to-end” refers the associated between two end points associated with a call. So, where a call involves a calling party and a called party using telephones, the end-to-end association for the call can be between the two telephony interface units; thus, end-to-end messages would include messages originating at one telephone interface unit and terminating at the other telephony interface unit.</div>
<div class="description-paragraph" id="p-0083" num="0082">The end-to-end messages can include, for example, a ring message from the originating TIU <b>170</b> to the terminating TIU <b>171</b>, a ring back message from the terminating TIU <b>171</b> to the originating TIU <b>170</b>, and a connect message from the terminating TIU <b>171</b> to the originating TIU <b>170</b>. The ring message can signal the terminating telephone <b>191</b> to ring thereby indicating an incoming call. The ring back message can signal the originating TIU <b>170</b> that the terminating telephone <b>190</b> is ringing. The connect message can signal to the originating TIU <b>170</b> that the called party has indicated acceptance for the call by, for example, going off-hook. Note that these end-to-end messages can be routed between the originating TIU <b>170</b> and the terminating TIU <b>171</b> without being routed through the originating gate controller <b>110</b> or terminating gate controller <b>111</b>.</div>
<div class="description-paragraph" id="p-0084" num="0083">At step <b>270</b>, upon the calling party and the called party being connected (e.g., upon an off-hook condition by the called party and a connect message being sent), a commit message is sent from the originating TIU <b>170</b> to the originating NED <b>120</b> and from the terminating TIU <b>171</b> to the terminating NED <b>121</b>.</div>
<div class="description-paragraph" id="p-0085" num="0084">At step <b>280</b>, upon receiving the commit message at the originating NED <b>120</b>, the gate established at the originating NED <b>120</b> in step <b>230</b> is opened. Similarly, at step <b>290</b>, upon receiving the commit message at the terminating NED <b>121</b>, the gate established at the terminating NED <b>120</b> in step <b>220</b> is opened. At this point when the gates are opened at the originating NED <b>120</b> and the terminating NED <b>121</b>, the reserved network resources are committed. The commit process can include a verification by the NED that the actual quality of service sought by the associated TIU is no greater than the quality of service reserved during the reservation process.</div>
<div class="description-paragraph" id="p-0086" num="0085">The gate at the originating edge router and the gate at the terminating edge router for each call are opened almost simultaneously (e.g., within a few hundred milliseconds of each other) because, under normal operating conditions, the calling party and the called party send respective Commit message to their respective network edge devices substantially simultaneously. Similarly, under normal operating conditions, the calling party and the called party end the call and send respective release messages to their respective network edge devices substantially simultaneously. Gate coordination prevents billing for incomplete calls and prevents theft of service by two colluding BTIs.</div>
<div class="description-paragraph" id="p-0087" num="0086">By separating the reservation process from the commit process, embodiments of the present invention advantageously ensure that network resources are available before actually ringing the far-end telephone (e.g., the telephone of the called party). This, of course, advantageously ensures that usage recording is not initiated until the far-end telephone goes off hook. Consequently, call billing excludes calls that are not completed (e.g., where the called party does not answer) and excludes the portion of calls that occur before the called party answers.</div>
<div class="description-paragraph" id="p-0088" num="0087">Although <figref idrefs="DRAWINGS">FIG. 2</figref> describes an embodiment for reserving network resources where the calling party and the called party were using telephones <b>190</b> and <b>191</b>, respectively, through TIUs <b>170</b> and <b>171</b>, respectively, the process can be analogized for a calling party and/or called party using a communication device <b>180</b> and/or <b>181</b>, respectively.</div>
<div class="description-paragraph" id="p-0089" num="0088">Note that the state information for a call can be maintained without maintaining the state information at a gate controller. From the perspective of the originating gate controller, a gate setup message for a call (e.g., a GATESETUP message described in Section 7 below) is received through a network edge device connecting a trusted network to an untrusted network. The state information for the call (e.g., contained within a GATEALLOC message described in Section 7 below) is formatted at the gate controllers based on the setup message for the call. The state information for the call is sent to the originating network edge device without maintaining the state information at the originating gate controller and at the terminating network edge device without maintaining the state information at the terminating gate controller.</div>
<div class="description-paragraph" id="p-0090" num="0089">Note that the term “maintained” as used herein in reference to the state information is intended to include storing and using the state information while the call is being establishing, the call is in progress and the is being released. Although the state information may be temporarily stored at the gate controllers, the state information is not maintained at the gate controller because the gate controllers do not do not use the state information (e.g., for call processing) while the call is being establishing, the call is in progress and the call is being released. In fact, the gate controllers need not stored the state information after the state information has been provided to the network edge routers because the state information for the call is accessed at the gate controllers, not the gate controllers.</div>
<div class="description-paragraph" id="h-0008" num="0000">3. Two-Phase Signaling</div>
<div class="description-paragraph" id="p-0091" num="0090">In embodiments of the present invention, signaling messages are exchanged for a call between a calling party to a called party in two phases. The signaling messages are exchanged in two phases in the sense that the messages for setting up the call are exchanged in one phase and the messages for connecting the call are exchanged in a separate and distinct second phase. By separating the messages for setting up the call from the messages for connecting the call, the later messages can be exchanged end to end without being routed through the gate controllers that set up the call.</div>
<div class="description-paragraph" id="p-0092" num="0091">Note this concept of two-phase signaling is distinct from the concept of two-phase network resource reservation in the sense that the two-phase signaling can be performed in combination with or independent of the two-phase network resource reservation. In other words, when done in combination, the messaging for the two-phase signaling can be interleaved with the messaging for the two-phase network resource reservation; when done independently, the messages for each can be distinct. The two-phase network resource reservation relates to reserving network resources without committing them, then committing those reserved resources. The two-phase signaling relates to performing signaling to set up the call, then once the call is setup (e.g., thereby confirming the authoried quality of service), exchanging end-to-end messaging.</div>
<div class="description-paragraph" id="p-0093" num="0092">A setup message having a destination address is forwarded from the calling party to the called party. A setup acknowledgment message is received at, for example, a gate controller from the called party if the destination address corresponds to the called party. The received setup acknowledgment message is sent to the calling party. The calling party and the called party exchange end-to-end messages if the calling party received the forwarded setup acknowledgment message and if at least one from the group of the called party and the calling party sent a reserve message to an associated network edge device.</div>
<div class="description-paragraph" id="p-0094" num="0093"> <figref idrefs="DRAWINGS">FIG. 3</figref> illustrates a flow chart for performing two-phase signaling in call connection, according to an embodiment of the present invention. At step <b>310</b>, the calling party goes off-hook and dials a telephone number of the called party. For convenience, <figref idrefs="DRAWINGS">FIG. 3</figref> will be discussed where the calling party is using telephone <b>190</b> and the called party is using telephone <b>191</b>. Of course, any number of arrangements are possible, such as the calling party using communication device <b>180</b>. At step <b>320</b>, the originating TIU <b>170</b> collects the dialed digits.</div>
<div class="description-paragraph" id="p-0095" num="0094">At step <b>330</b>, the originating TIU <b>170</b> sends a setup message to the originating gate controller <b>110</b>. The setup message can be sent through network interface unit <b>160</b>, access network <b>150</b>, NED <b>120</b> and communication network <b>100</b>. In one embodiment, the setup message can be, for example, in the form of the SETUP message described below in Section 7 entitled “Protocol Description”.</div>
<div class="description-paragraph" id="p-0096" num="0095">At step <b>340</b>, the setup message is forwarded from the originating gate controller <b>110</b> to the terminating gate controller <b>111</b>. At step <b>350</b>, the setup message is forwarded from the terminating gate controller <b>111</b> to the terminating TIU <b>171</b>. (After receiving the setup message, the originating gate controller <b>110</b> and the terminating gate controller <b>111</b>, can establishe a gate at the originating NED <b>120</b> and a gate at the terminating NED <b>121</b> as described in Section 2 above.)</div>
<div class="description-paragraph" id="p-0097" num="0096">At step <b>360</b>, if the destination address of setup message corresponds to the terminating TIU <b>171</b>, a setup acknowledgment message is sent to the TIU <b>170</b>. The setup acknowledgment message can be sent, for example, through terminating gate controller <b>111</b> and originating gate controller <b>110</b>. In one embodiment, the setup acknowledgment message can be, for example, in the form of the SETUPACK message described below in Section 7 entitled “Protocol Description”.</div>
<div class="description-paragraph" id="p-0098" num="0097">At step <b>370</b>, the network resources for the call are reserved. As described above in Section 2 entitled Two-Phase Network Resource Reservation, a reserve message is sent from the originating TIU <b>170</b> to the originating NED <b>120</b> and from the terminating TIU <b>170</b> to the terminating NED <b>121</b> when an allocation of network resources is requested but the network resource need not yet be assigned or committed.</div>
<div class="description-paragraph" id="p-0099" num="0098">At steps <b>380</b> through <b>395</b>, end-to-end messages are exchanged between the originating TIU <b>170</b> and the terminating TIU <b>171</b> if the calling party received the setup acknowledgment message sent to the originating TIU <b>170</b> in step <b>360</b> and if the calling party or the called party sent a reserve message to its NED. In other words, end-to-end messages relating to the connection of the call are exchanged only after the reservation messages have been exchanged and the reservation process is complete. This ensures that service is only provided to calling and called parties that have been authorized and authenticated for the call. This also ensures that the call is established for a specifically authorized quality of service and that the call is billed appropriately.</div>
<div class="description-paragraph" id="p-0100" num="0099">At step <b>380</b>, a ring message is sent from the originating TIU <b>170</b> to the terminating TIU <b>171</b>. The ring message can signal the terminating telephone <b>191</b> to ring thereby indicating an incoming call.</div>
<div class="description-paragraph" id="p-0101" num="0100">At step <b>390</b>, a ring back message is sent from the terminating TIU <b>171</b> to the originating TIU <b>170</b>. The ring back message can signal the originating TIU <b>170</b> that the terminating telephone <b>190</b> is ringing.</div>
<div class="description-paragraph" id="p-0102" num="0101">At step <b>395</b>, a connect message is sent from the terminating TIU <b>171</b> to the originating TIU <b>170</b>. The connect message can signal to the originating TIU <b>170</b> that the called party has indicated acceptance for the call by, for example, going off-hook.</div>
<div class="description-paragraph" id="p-0103" num="0102">These end-to-end messages can be routed between the originating TIU <b>170</b> and the terminating TIU <b>171</b> without being routed through the originating gate controller <b>110</b> or terminating gate controller <b>111</b> because state information for the call can be maintained without maintaining it at the gate controllers <b>110</b> and <b>111</b>. In addition, these end-to-end message can be routed through NEDs <b>120</b> and <b>121</b> opaquely.</div>
<div class="description-paragraph" id="p-0104" num="0103">Note that by separating the signaling for a call relating the reservation process and relating to connect process, the concept of the traditional dedicated phone line for a telephone user can be replaced with a process that authenticates the calling party and called party, and authorizes a desired quality of service on a per-call basis. In other words, only authenticated users reserved network resources for an authorized quality of service before these network resources are connected. Consequently, calls having varying qualities of service can be provided and appropriately billed on a call-by-call basis.</div>
<div class="description-paragraph" id="p-0105" num="0104">Furthermore, by separating the signaling for a call into signals relating to the reservation process and signals relating to the connect process, the gate controllers are involved in the signaling process where only needed: during the reservation process. After the reservation process is complete, the originating and terminating gate controllers pass the state information for the call to, for example, the originating and terminating TIUs without maintaining the state information at the gate controllers. The gate controllers no longer need be involved in the call and messaging related to the connection process can be sent end-to-end without being routed through the gate controllers. In other words, the gate controllers are involved only during the initial start of the call but not during the call duration. This results in a reduction of the message load by, for example, approximately a factor of three. Consequently, the amount of memory need in the gate controllers is greatly reduced. Moreover, the gate controllers can be constructed without the typically stringent requirements for reliability.</div>
<div class="description-paragraph" id="h-0009" num="0000">4. Gate Coordination on a Per-Call Basis</div>
<div class="description-paragraph" id="p-0106" num="0105">As discussed in the preceding section, reserved network resources can be committed upon the originating and terminating network edge devices receiving commit messages indicating that the call has been connected. At this point, gates associated with a call between a calling party and a called party can be opened in a coordinated fashion. A timer associated with a first gate opened at an originating network edge device is initiated. A first gate open message is sent from the originating network edge device to the terminating network edge device. The first gate at the originating network edge device is released if the timer expires before at least one from the group of: (1) an acknowledgment based on the sent first gate open message is received from the terminating network edge device, and (2) a second gate open message is received at the originating network edge device from the terminating network edge device after the terminating network edge device has opened a second gate associated with the called party.</div>
<div class="description-paragraph" id="p-0107" num="0106">At step <b>400</b>, a timer associated with a gate at the originating NED <b>120</b> is initiated upon receiving a commit message from the originating TIU <b>170</b>. At step <b>410</b>, a timer associated with a gate at the terminating NED <b>121</b> is initiated upon receiving a commit message from the terminating TIU <b>171</b>. As described above in Section 2 entitled “Two-Phase Network Resource Reservation”, the commit message is sent from a TIU to the associated NED upon the called party indicating an acceptance for the call (e.g., by a connect message being sent from the terminating TIU to the originating TIU). The order steps <b>400</b> and <b>410</b> depends on the order in which the NEDs receive the commit messages from their associated TIUs.</div>
<div class="description-paragraph" id="p-0108" num="0107">At step <b>420</b>, a gate open message is sent from the originating NED <b>120</b> to the terminating NED <b>121</b>. At step <b>430</b>, a gate open message is sent from the terminating NED <b>121</b> to the originating NED <b>120</b>. In one embodiment, the setup acknowledgment message can be, for example, in the form of the GATEOPEN message described below in Section 7 entitled “Protocol Description”. The order in which steps <b>420</b> and <b>430</b> are performed depends on the order in which steps <b>400</b> and <b>410</b> are performed. A gate open message is sent from one NED to the other NED to notify that other NED when a gate for the call has been opened.</div>
<div class="description-paragraph" id="p-0109" num="0108">At step <b>440</b>, a gate open acknowledgment message is sent from originating NED <b>120</b> to terminating NED <b>121</b> upon the originating NED <b>121</b> receiving the gate open message sent during step <b>430</b> by terminating NED <b>120</b>. At step <b>450</b>, a gate open acknowledgment message is sent from terminating NED <b>121</b> to originating NED <b>120</b> upon the terminating NED <b>120</b> receiving the gate open message sent during step <b>420</b> by originating NED <b>120</b>. In one embodiment, the setup acknowledgment message can be, for example, in the form of the GATEOPENACK message described below in Section 7 entitled “Protocol Description”. The order in which steps <b>440</b> and <b>450</b> are performed depends on the order in which the gate open acknowledgment message are received.</div>
<div class="description-paragraph" id="p-0110" num="0109">At conditional step <b>470</b>, a determination is made as to whether the timer for the gate at the originating NED <b>120</b> expired before (1) the originating NED <b>120</b> received the gate open acknowledgment message from the terminating NED <b>121</b>, or (2) the originating NED <b>120</b> received the gate open message from the terminating NED <b>121</b>. If the timer expired before either condition is satisfied, then the process proceeds to step <b>475</b> where the gate at the originating NED <b>120</b> is closed and released. If the timer did not expire before either condition is satisfied, then the process proceeds to step <b>477</b> where the gate at the originating NED <b>120</b> is allowed to remained open.</div>
<div class="description-paragraph" id="p-0111" num="0110">At conditional step <b>480</b>, a determination is made as to whether the timer for the gate at the terminating NED <b>121</b> expired before (1) the terminating NED <b>121</b> received the gate open acknowledgment message from the originating NED <b>120</b>, or (2) the terminating NED <b>121</b> received the gate open message from the originating NED <b>120</b>. If the timer expired before either condition is satisfied, then the process proceeds to step <b>485</b> where the gate at the terminating NED <b>121</b> is closed and released. If the timer did not expire before either condition is satisfied, then the process proceeds to step <b>487</b> where the gate at the terminating NED <b>121</b> is allowed to remained open.</div>
<div class="description-paragraph" id="p-0112" num="0111">A gate is “closed” in the sense that the call is no longer active although the gate for the call remains established for possible later use. For example, in a call having a call waiting feature, a first party can be connected to two other parties and two gates (one per call) will be established at the network edge device associated with the first party. In such a case, as the first party switches between the calls the temporarily inactive call will have an associated gate that is closed; this closed gate can be reopened upon the call being reactivated.</div>
<div class="description-paragraph" id="p-0113" num="0112">A gate is “released” in the sense that the call is no longer active and the gate for the call is deleted from the associated network edge device. In such a case, for a call to be started, the entire network resource reservation process and commit process (see, e.g., the discussed relating to <figref idrefs="DRAWINGS">FIG. 2</figref>) have to be repeated.</div>
<div class="description-paragraph" id="p-0114" num="0113">The timer at a gate ensures that the other gate related to the call is also opened within the timer period so that billing for the call is accurate and so that theft of service can be prevented. Without such gate coordination, either a service provider could bill a party for a call where only one gate was opened (even if the calling party was not connected to the called party) or a service provider could be susceptible to theft of service for a call where only one gate was opened. Considering the latter, theft of service could occur without gate coordination, for example, by two colluding TIUs: where the originating TIU can initiate a call and only the terminating TIU sends a local commit message, the single gate would not be released for up to several minutes because the far-end telephone could be ringing; the originating BTI could then steal service during this time. By sending the gate open message from the network edge device with an open gate to the network edge device without a corresponding peer gate, the second gate for the call is sure to be established even if a commit message is not received from the associated TIU (as could be the case if a theft of service was attempted).</div>
<div class="description-paragraph" id="p-0115" num="0114">Gate coordination can also be performed at the end of a call. Just as a gate open message and a gate open acknowledgment message is sent to the network edge device where the peer gate is established, a gate close message and a gate close acknowledgment message can be sent upon a gate closing to the network edge device where the peer gate is open. In other words, when a call is ended by either the calling party or the called party, the party ending the call has its gate closed and the peer gate is informed of the closure so that the peer gate is also closed. An example of the message exchange for a gate closing is shown in <figref idrefs="DRAWINGS">FIG. 8</figref> and the associated discussion in Section 8 entitled “Signaling Architecture Call Flows”.</div>
<div class="description-paragraph" id="p-0116" num="0115">By coordinating the gate closings, again theft of service by a malfunctioning or malicious TIU can be prevented. Consider the case where the originating TIU <b>170</b> calls terminating TIU <b>171</b> and pays for the call. If either the calling party or the called party end the call, the gates at both the originating NED <b>120</b> and the terminating NED <b>121</b> need to be closed. Because the originating TIU <b>170</b> is being billed for the call, the calling party has an incentive to issue a release message to close the gate at the originating NED <b>120</b>. The terminating TIU <b>171</b>, however, cannot be trusted to send the release message to close the gate at the terminating NED <b>121</b>. A gate close message sent from the originating NED <b>120</b> can close the gate at the terminating NED <b>121</b> to prevent the terminating TIU <b>171</b> from placing another call and having that call billed to the party associated with TIU <b>170</b>.</div>
<div class="description-paragraph" id="h-0010" num="0000">5. Network Address Translation</div>
<div class="description-paragraph" id="p-0117" num="0116">Because the TIUs are untrusted entities, any information that a calling party or a called party desires to keep private, such as caller ID information or address information, should be accessible to the network <b>10</b> but not to other untrusted entities. This section describes the use of network address translations and encryption techniques that allow gate controllers to send state information to TIUs where it is maintained in a form that renders the private information opaque.</div>
<div class="description-paragraph" id="p-0118" num="0117">In one embodiment, a call between a calling party and a called party is connected. Information associated with the call is sent from the calling party to the called party without the called party receiving a source address that indicates at least one from the group of a logical identity of the calling party and a geographical identity of the calling party.</div>
<div class="description-paragraph" id="p-0119" num="0118">The term “logical identity” is used to herein to include, for example, any aspect of the source address or destination address that indicates the specific identity of a calling party or the called party. The term “geographic identity” is used to herein to include, for example, an aspect of the source address or destination address that indicates the particular geographic location of a calling party or called party. Even where a network address has been modified or altered to protect the logical identity of a calling party or called party, the remaining aspects of the network address can reveal the general geographic location of the party. In an embodiment of the present invention, information is sent from one party to another party without revealing either the logical identity nor the geographic identity of a party.</div>
<div class="description-paragraph" id="p-0120" num="0119"> <figref idrefs="DRAWINGS">FIG. 5</figref> illustrates a flow chart for translating a network address, according to an embodiment of the present invention. At step <b>500</b>, packets having the source address and the destination are sent from the originating TIU <b>170</b> through the originating network interface unit <b>160</b> towards the originating NED <b>120</b>. The source address and the destination address locally identify the calling party and the called party, respectively. These addresses are “local” in the sense that they are associated with particular portions of networks (also referred to herein as “address domains”), such as portions of the access network <b>150</b> and/or communication network <b>100</b> and/or other access networks (not shown in <figref idrefs="DRAWINGS">FIG. 1</figref>). These local addresses are not sent outside of their resepective address domains. To send packets outisde of the address domain, the destination needs to be identified by a global address, as described below. Table 1 illustrates an example of the source address (SA) and the destination address (DA) at this point.</div>
<div class="description-paragraph" id="p-0121" num="0120">
<tables id="TABLE-US-00001" num="00001">
<patent-tables colsep="0" frame="none" rowsep="0">
<table align="left" class="description-table" cols="3" colsep="0" rowsep="0" width="100%">
<thead>
<tr class="description-tr">
<td class="description-td"> </td>
<td class="description-td" colspan="3" nameend="2" namest="offset" rowsep="1">TABLE 1</td>
</tr>
<tr class="description-tr">
<td class="description-td"> </td>
<td align="center" class="description-td" colspan="3" nameend="2" namest="offset" rowsep="1"> </td>
</tr>
</thead>
<tbody><tr class="description-tr">
<td class="description-td"> </td>
<td class="description-td">SA</td>
<td class="description-td">10.10.1.5</td>
</tr>
<tr class="description-tr">
<td class="description-td"> </td>
<td class="description-td">DA</td>
<td class="description-td">10.10.1.27</td>
</tr>
<tr class="description-tr">
<td class="description-td"> </td>
<td align="center" class="description-td" colspan="3" nameend="2" namest="offset" rowsep="1"> </td>
</tr>
</tbody></table>
</patent-tables>
</tables>
</div>
<div class="description-paragraph" id="p-0122" num="0121">At step <b>510</b>, the packets received at NED <b>120</b> are translated from local addresses for the address domain within access network <b>150</b> to global addresses. Not only can the destination address be translated into a global address, but the source address can also be translated into a global address. Table 2 illustrates a translation table for the call used at NED <b>120</b>. Note that the global addresses used for the call can be assigned dynamically, for example, on a call-by-call basis so that when a call has ended, the global address can be reused for another, unrelated call.</div>
<div class="description-paragraph" id="p-0123" num="0122">
<tables id="TABLE-US-00002" num="00002">
<patent-tables colsep="0" frame="none" rowsep="0">
<table align="left" class="description-table" cols="3" colsep="0" rowsep="0" width="100%">
<thead>
<tr class="description-tr">
<td class="description-td"> </td>
<td class="description-td" colspan="3" nameend="2" namest="offset" rowsep="1">TABLE 2</td>
</tr>
<tr class="description-tr">
<td class="description-td"> </td>
<td align="center" class="description-td" colspan="3" nameend="2" namest="offset" rowsep="1"> </td>
</tr>
<tr class="description-tr">
<td class="description-td"> </td>
<td class="description-td">Local Address</td>
<td class="description-td">Global Address</td>
</tr>
<tr class="description-tr">
<td class="description-td"> </td>
<td align="center" class="description-td" colspan="3" nameend="2" namest="offset" rowsep="1"> </td>
</tr>
</thead>
<tbody><tr class="description-tr">
<td class="description-td"> </td>
</tr>
</tbody></table>
<table align="left" class="description-table" cols="4" colsep="0" rowsep="0" width="100%">
<tbody><tr class="description-tr">
<td class="description-td"> </td>
<td class="description-td">SA</td>
<td class="description-td">10.10.1.5</td>
<td class="description-td">135.4.1.7</td>
</tr>
<tr class="description-tr">
<td class="description-td"> </td>
<td class="description-td">DA</td>
<td class="description-td">10.10.1.27</td>
<td class="description-td">135.4.2.15</td>
</tr>
<tr class="description-tr">
<td class="description-td"> </td>
<td align="center" class="description-td" colspan="4" nameend="3" namest="offset" rowsep="1"> </td>
</tr>
</tbody></table>
</patent-tables>
</tables>
</div>
<div class="description-paragraph" id="p-0124" num="0123">At step <b>520</b>, the packets are forwarded from the originating NED <b>120</b> to the terminating NED <b>121</b>. At this point, the packets have the global address shown in Table 2.</div>
<div class="description-paragraph" id="p-0125" num="0124">At step <b>530</b>, the packets received at the terminating NED <b>121</b> are translated from global addresses to addresses that are local to the address domain for which the terminating access network <b>151</b> is included. Table 3 illustrates a translation table for the call used at NED <b>121</b> for translating the global addresses to local addresses.</div>
<div class="description-paragraph" id="p-0126" num="0125">
<tables id="TABLE-US-00003" num="00003">
<patent-tables colsep="0" frame="none" rowsep="0">
<table align="left" class="description-table" cols="3" colsep="0" rowsep="0" width="100%">
<thead>
<tr class="description-tr">
<td class="description-td"> </td>
<td class="description-td" colspan="3" nameend="2" namest="offset" rowsep="1">TABLE 3</td>
</tr>
<tr class="description-tr">
<td class="description-td"> </td>
<td align="center" class="description-td" colspan="3" nameend="2" namest="offset" rowsep="1"> </td>
</tr>
<tr class="description-tr">
<td class="description-td"> </td>
<td class="description-td">Global Address</td>
<td class="description-td">Local Address</td>
</tr>
<tr class="description-tr">
<td class="description-td"> </td>
<td align="center" class="description-td" colspan="3" nameend="2" namest="offset" rowsep="1"> </td>
</tr>
</thead>
<tbody><tr class="description-tr">
<td class="description-td"> </td>
</tr>
</tbody></table>
<table align="left" class="description-table" cols="4" colsep="0" rowsep="0" width="100%">
<tbody><tr class="description-tr">
<td class="description-td"> </td>
<td class="description-td">135.4.1.7</td>
<td class="description-td">10.10.100.19</td>
<td class="description-td">SA</td>
</tr>
<tr class="description-tr">
<td class="description-td"> </td>
<td class="description-td">135.4.2.15</td>
<td class="description-td">10.10.100.7</td>
<td class="description-td">DA</td>
</tr>
<tr class="description-tr">
<td class="description-td"> </td>
<td align="center" class="description-td" colspan="4" nameend="3" namest="offset" rowsep="1"> </td>
</tr>
</tbody></table>
</patent-tables>
</tables>
</div>
<div class="description-paragraph" id="p-0127" num="0126">At step <b>540</b>, the packets translated by the terminating NED <b>121</b> are sent through access network <b>151</b> to the terminating TIU <b>171</b>. Table 4 illustrates the source address and the destination address for the packets for the call as the packets are transmitted across terminating access network <b>151</b>, through terminating network interface unit <b>161</b> to the terminating TIU <b>171</b>.</div>
<div class="description-paragraph" id="p-0128" num="0127">
<tables id="TABLE-US-00004" num="00004">
<patent-tables colsep="0" frame="none" rowsep="0">
<table align="left" class="description-table" cols="3" colsep="0" rowsep="0" width="100%">
<thead>
<tr class="description-tr">
<td class="description-td"> </td>
<td class="description-td" colspan="3" nameend="2" namest="offset" rowsep="1">TABLE 4</td>
</tr>
<tr class="description-tr">
<td class="description-td"> </td>
<td align="center" class="description-td" colspan="3" nameend="2" namest="offset" rowsep="1"> </td>
</tr>
</thead>
<tbody><tr class="description-tr">
<td class="description-td"> </td>
<td class="description-td">SA</td>
<td class="description-td">10.10.100.19</td>
</tr>
<tr class="description-tr">
<td class="description-td"> </td>
<td class="description-td">DA</td>
<td class="description-td">10.10.100.7</td>
</tr>
<tr class="description-tr">
<td class="description-td"> </td>
<td align="center" class="description-td" colspan="3" nameend="2" namest="offset" rowsep="1"> </td>
</tr>
</tbody></table>
</patent-tables>
</tables>
</div>
<div class="description-paragraph" id="p-0129" num="0128">The translated packets are received at the terminating TIU <b>171</b> without revealing the logical identity and the geographic identity of calling party. Note that the called party only has access to the global source address and the global destination address which themselves are translations. Because the source address of calling party has been translated twice, once at the originating NED <b>120</b> and once at the terminating NED <b>121</b>, address information about the calling party has been altered beyond recognition to the calling party.</div>
<div class="description-paragraph" id="p-0130" num="0129">Once the call is completed, the translation tables at the originating NED <b>120</b> and the terminating NED <b>121</b> can be deleted, and the global addresses can be released for reuse in another call. For example, if the network address translation is incorporated into the funcitonality of the respective gates, the global addresses can be released when the gates are released. In another embodiment, the global addresses can be released after a time period of inactivity.</div>
<div class="description-paragraph" id="p-0131" num="0130"> <figref idrefs="DRAWINGS">FIG. 5</figref> illustrates the process by which packets are sent from the originating TIU <b>170</b> to the terminating TIU <b>171</b>. Similarly, packets sent from the terminating TIU <b>171</b> to the originating TIU <b>170</b> can be translated at the terminating NED <b>121</b> (reverse of the translation shown in Table 3) and again at the originating NED <b>120</b> (reverse of the translation shown in Table 2). Thus, the source address and the destination address of the packets can be sent from the terminating TIU <b>171</b> to the originating TIU <b>170</b> without revealing the logical identity and the geographic identity of called party.</div>
<div class="description-paragraph" id="p-0132" num="0131">The double translation of network addresses can be provided as a service to a subscriber by a service provider. In other words, a call can be connected where the calling party and/or the called party subscribe to the double translation service. <figref idrefs="DRAWINGS">FIG. 5</figref> illustrates the case where the privacy of both the calling party and the called party address information is maintained: both the source address and the destination address of packets for the call are translated as the packets are sent from the calling party to the called party and as packets for the call are sent from the called party to the calling party.</div>
<div class="description-paragraph" id="p-0133" num="0132">The double translation service can be provided to one party (i.e., only the calling party or the called party) without providing the service to the other party. In such a case, for example where only the calling party has subscribed to the double translation service, the first source address for packets sent from the originating TIU <b>170</b> are translated at the originating NED <b>120</b> into a global source address, and the global address for these packets are translated at the terminating NED <b>121</b> into a second local source address. As packets are sent from the terminating TIU <b>171</b>, the second local source address is translated at the terminating NED <b>121</b> into the global source address, and the global source address is translated into the first source address at the originating NED <b>120</b>.</div>
<div class="description-paragraph" id="p-0134" num="0133">In other words, where only one party has subscribed to the double translation service, the address associated with that party is translated twice. Consequently, the logical identity and the geographic identity of that party is maintained in privacy from the other party for the call.</div>
<div class="description-paragraph" id="p-0135" num="0134">The translation tables at the originating NED <b>120</b> and the terminating NED <b>121</b> can be set up for a specific call and then can be deleted at the end of the call. This further ensures the privacy of the calling party and/or called party because the global addresses are not repeated. Furthermore, by releasing the global addresses at the end of a call, the global addresses can be reused for another call having a different calling party and/or called party. Consequently, any potential shortage in the number of global addresses can be alleviated because the number of active calls at one time is much less than the number of total calling parties and called parties.</div>
<div class="description-paragraph" id="h-0011" num="0000">6. Simulated Destination Ring Back</div>
<div class="description-paragraph" id="p-0136" num="0135">In another embodiment of the present invention, a ringback for a call between a calling party and a called party can be simulated. A connection acknowledgment associated with the call is received where the calling party is located within a first network and the called party is located within a second network. A prestored ring back signal from a set of prestored ringback signals is selected where the selected prestored ring back signal is associated with the second network. The selected prestored ring back signal is sent to the calling party.</div>
<div class="description-paragraph" id="p-0137" num="0136">The prestored ringback signal can be, for example, a signal that is indicative of the network associated with the called party rather than a signal originated by that network. For example, a signal indicative of a foreign network (i.e., a network located in a foreign country) can be stored at a terminating TIU and provided within a ring back message sent to the origianting TIU. In such a case, the ring back signal can simulate the ring back signal for that foreign country rather than relying on the actual foreign-network-originated ring back signal.</div>
<div class="description-paragraph" id="h-0012" num="0000">7. Protocol Description</div>
<div class="description-paragraph" id="p-0138" num="0137">This section contains details of the various protocols associated with embodiments of the present invention. This section is substantially identical to the corresponding sections of the U.S. patent applications to which cross-reference is made hereinabove in the CROSS-REFERENCE TO RELATED APPLICATIONS, all of which applications are hereby incorporated by reference. These protocols encompass communication between BTI and Gate Controller, between the BTI and Edge Router, between a BTI and other BTIs, between the Gate Controller and Edge Router, between Edge Router and Edge Router, and between Gate Controller and Gate Controller.</div>
<div class="description-paragraph" id="p-0139" num="0138">All messages are given here in a text-based format, using a type/value structure. This is particularly easy for prototype implementations, and for describing the interactions between network elements. However, if any system components exist where memory is a serious limitation, it is possible that a binary format could be used to conserve buffer space requirements.</div>
<div class="description-paragraph" id="p-0140" num="0139">A sample message is:</div>
<div class="description-paragraph" id="p-0141" num="0140">SETUP 0S55072 v1.0; DEST E164 8766; CALLER 8718 Bill Marshall; AUTHID 3312120; CRV 21; CODING 53B,6 ms G.711</div>
<div class="description-paragraph" id="p-0142" num="0141">Messages consist of a sequence of type/value pairs. Each element of the sequence is separated by a semicolon; a semicolon at the end of the message is optional. The type and value are ascii character strings, separated by white space (e.g. spaces or tabs). Generally every element contains at least two items, the type name and the parameter value, but may contain several white-space separated parameter values.</div>
<div class="description-paragraph" id="p-0143" num="0142">The first element of every message is in a standard format. The type of the first element is the message name, the first parameter is the transaction identifier, and the second parameter is the version number (v1.0 here).</div>
<div class="description-paragraph" id="p-0144" num="0143">Embodiments of the present invention can use an application-layer retransmission scheme to achieve reliable transport of messages. This is done independent of any lower layer reliable transmission protocol, since the signaling system must also recover from component failures and restart transactions when a component has failed. This often happens after the component has received, acknowledged receipt, and has started working on a request; it is up to the application layer to realize that no response is coming and to re-initiate the transaction.</div>
<div class="description-paragraph" id="p-0145" num="0144">We therefore specify the behavior of the network elements as if the underlying transport is merely UDP/IP, and provides no buffering, flow control, nor error recovery.</div>
<div class="description-paragraph" id="p-0146" num="0145">All basic message exchanges are transaction-based. All start with a request message issued by a client, and sent to a server. The client must provide a unique transaction identifier for each separate request, and provide that transaction identifier in the standard place in all messages. The client must insure that the transaction identifier is not reused for any subsequent messages for a period of at least some specified interval. (approximately 30 seconds, exact value TBD).</div>
<div class="description-paragraph" id="p-0147" num="0146">A sample exchange begins with a client forming a request message and sending it to the server:</div>
<div class="description-paragraph" id="p-0148" num="0147">SETUP 1X64193 v1.0; &lt;other stuff&gt;</div>
<div class="description-paragraph" id="p-0149" num="0148">The message type is SETUP, the transaction identifier is 1X64193, and the message is using version 1.0. When the server has completed the work requested by this transaction, it sends one of two possible responses:</div>
<div class="description-paragraph" id="p-0150" num="0149">SETUPACK 1X64193 v1.0; &lt;other stuff&gt;</div>
<div class="description-paragraph" id="p-0151" num="0150">or</div>
<div class="description-paragraph" id="p-0152" num="0151">SETUPNAK 1X64193 v1.0; &lt;other stuff&gt;.</div>
<div class="description-paragraph" id="p-0153" num="0152">The server must store all requests it receives for some period of time (30 seconds). The server must also store its responses for some period of time (30 seconds) in case they were lost in transmission and need to be resent.</div>
<div class="description-paragraph" id="p-0154" num="0153">If a client sends a request but does not receive a response within a reasonable time (which may vary based on message type), it resends the original request, without any modification.</div>
<div class="description-paragraph" id="p-0155" num="0154">If a server receives a request message that it recognizes as a duplicate (same source, same transaction identifier, same message type, not necessary to compare message content), it either resends its response, if the response has been completed, or sends a pseudo-response:</div>
<div class="description-paragraph" id="p-0156" num="0155">WORKING 1X64193 v1.0;</div>
<div class="description-paragraph" id="p-0157" num="0156">The receipt of a WORKING message at the client indicates that the server has received the message, and the response has not yet been sent. It is reasonable for the client to use a longer timer before resending the request again.</div>
<div class="description-paragraph" id="p-0158" num="0157">In some situations, e.g. the SETUP message, it is possible that the normal processing time may exceed the timeout period of the client. In that case the server can immediately send the WORKING pseudo-response upon receipt of a request.</div>
<div class="description-paragraph" id="p-0159" num="0158">Typical timeouts that seem reasonable to use are:</div>
<div class="description-paragraph" id="p-0160" num="0159">BTI to Edge Router: 0.5 seconds initially,1 second after WORKING response</div>
<div class="description-paragraph" id="p-0161" num="0160">BTI to Gate Controller: 1 second, 2 seconds after WORKING response</div>
<div class="description-paragraph" id="p-0162" num="0161">Gate Controller to GC: 1 second, 2 seconds after WORKING response</div>
<div class="description-paragraph" id="h-0013" num="0000">7.1 BTI to Gate Controller</div>
<div class="description-paragraph" id="p-0163" num="0162">The BTI initiates transactions with the Gate Controller to request a new connection to a remote named endpoint, or to request some enhanced service to be performed on an existing connection. In addition to basic connections, this protocol enables all the custom calling features to be implemented, and provides conference control capability.</div>
<div class="description-paragraph" id="p-0164" num="0163">This protocol is designed to utilize significant intelligence in the BTI, allowing it to completely handle the user interface and to implement new custom services that build on the primitives that exist in the signaling system of embodiments of the present invention.</div>
<div class="description-paragraph" id="p-0165" num="0164">Messages initiated by the BTI include SETUP, REDIRECT, SPLICE, TRACE, and PROFILE. SETUP is used to initiate a new connection. REDIRECT takes an existing connection and sends it to some other destination. SPLICE takes two existing connections and connects them together. TRACE generates a law-enforcement report of an abusive or harassing call. PROFILE enables the BTI to specify custom call handling services for times when the BTI cannot be contacted (e.g. power failure).</div>
<div class="description-paragraph" id="h-0014" num="0000">7.2 SETUP</div>
<div class="description-paragraph" id="p-0166" num="0165">SETUP is the basic message sent by a BTI to initiate a connection to another endpoint; an example message is:
</div> <ul> <li id="ul0001-0001" num="0000"> <ul> <li id="ul0002-0001" num="0166">SETUP 0S55072 v1.0; DEST E164 8766; CALLER 8718; AUTHID 3312120; CRV 21;
        <ul> <li id="ul0003-0001" num="0167">SIGADDR wtm-bti:7685; DATAADDR wtm-bti:7000 2 2;</li> <li id="ul0003-0002" num="0168">CODING 53B,6 ms,G.711</li> </ul>
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0167" num="0169">DEST specifies the destination of this call. The first parameter in this field gives an address space name to search; valid address spaces are E164 (standard telephone numbers), CINFO (source string from a previous call), and SERVICE (generic network service by name). The second parameter gives the actual telephone number/source string/service name. Further parameters, if given, are passed through and given to the receiving endpoint. Examples of various usages of the DEST element are:</div>
<div class="description-paragraph" id="p-0168" num="0170">DEST E164 8766 places a new call to a phone number. Second parameter is the number in the customer's dialing plan (e.g. centrex, nanp, etc.)</div>
<div class="description-paragraph" id="p-0169" num="0171">DEST CINFO &lt;string&gt; places a return call to a previous caller, for example, *69 return call. Second parameter is the string given in a SETUP, SETUPACK, or TRANSFER.</div>
<div class="description-paragraph" id="p-0170" num="0172">DEST SERVICE bridge 3 places a call to a network service, in this example a bridge service for 3 parties. The second parameter is the name of the network service (e.g. bridge, announcement, etc.) and further parameters are given to that service for further interpretation.</div>
<div class="description-paragraph" id="p-0171" num="0173">CALLER gives the caller-id value for the line that is originating this call. The Gate Controller must verify that this caller-id is valid based on the AUTHID. Since the BTI is outside out control, we cannot be sure that the call is really coming from the line it claims; however we can ensure that the caller-id specified is one of the possible ones from this BTI.</div>
<div class="description-paragraph" id="p-0172" num="0174">AUTHID is the authorization code given to this particular BTI from the OAMP system. It is changed periodically, e.g. every ten minutes.</div>
<div class="description-paragraph" id="p-0173" num="0175">CRV is the Call Reference Value assigned for the BTI's end of this new call. The CRV appears in all messages sent to the BTI, enabling the BTI to correctly assign the message to the proper call, and to properly ignore messages that refer to previous call attempts. Note that multiple race conditions exist if a customer partially completes a call, hangs up, then places another call. The BTI needs some mechanism to ignore stale messages without the need to synchronize with all possible parties prior to processing a new customer request (e.g. give the customer another dialtone).</div>
<div class="description-paragraph" id="p-0174" num="0176">SIGADDR is the IP system name and port number that the called endpoint should use as a destination for all BTI-BTI messages. This may be the same address and port as is used by the Gate Controller to signal an incoming call, or it may be a separate port for the current call only. If it is the same port, then it is necessary to structure the messages such that the BTI can distinguish GC-BTI messages from BTI-BTI messages, which this v1.0 design does.</div>
<div class="description-paragraph" id="p-0175" num="0177">DATAADDR is the IP system name and port specification that the called endpoint should use as a destination for all voice data packets. The first parameter is a system-name:port-number, where the port number is the lowest port number in a set of consecutive ports. The second parameter gives the size of the set of consecutive ports. The third parameter, if present, gives any alignment requirements of the port numbers if it is necessary to translate them in a PAT server. A typical voice-only telephone call will use two ports, the first for RTP and the second for RTCP, and will require that the first port be even.</div>
<div class="description-paragraph" id="p-0176" num="0178">CODING specifies a list of possible encapsulations and coding methods that the originator will perform. Each parameter is at least three items separated by commas, where the first item specifies a message size, the second item gives the interval between packets, the third item gives the coding algorithm, and fourth and later items (optional) give additional parameters specific to the coder.</div>
<div class="description-paragraph" id="h-0015" num="0000">7.2.1.1 SETUP Acknowledgment</div>
<div class="description-paragraph" id="p-0177" num="0179">The response to a SETUP message is SETUPACK or SETUPNAK. A sample SETUPACK message is:</div>
<div class="description-paragraph" id="p-0178" num="0180">SETUPACK 0S55072 v1.0; CRV 3712;</div>
<div class="description-paragraph" id="p-0179" num="0181">SIGADDR 10.0.0.1:5134; DATAADDR 10.0.0.1:5136 2;</div>
<div class="description-paragraph" id="p-0180" num="0182">CODING 53B,6 ms,G.711; GATEIP 135.207.31.1:7682; GATEID 17S63224; CINFO &lt;string&gt;</div>
<div class="description-paragraph" id="p-0181" num="0183">CRV gives the Call Reference Value assigned by the remote endpoint to identify all messages associated with the conversation. It must be included in all BTI-BTI messages.</div>
<div class="description-paragraph" id="p-0182" num="0184">SIGADDR gives the address and port to use as a destination for all BTI-BTI signaling messages.</div>
<div class="description-paragraph" id="p-0183" num="0185">DATAADDR gives the address and ports to use as a destination for all voice data packets. The second parameter gives the number of consecutive ports allocated for this purpose.</div>
<div class="description-paragraph" id="p-0184" num="0186">CODING gives the single encapsulation and coding method, of the choices presented in the SETUP message, that is acceptable to the destination BTI. Format of the parameter is identical to that given above.</div>
<div class="description-paragraph" id="p-0185" num="0187">GATEIP gives the IP address and port number of the Edge Router that contains the gate controlling access service for this connection. This is the destination address to use for all BTI-ER messages.</div>
<div class="description-paragraph" id="p-0186" num="0188">GATEID gives the identification and authorization token assigned by the Edge Router for the gate allocated for this connection.</div>
<div class="description-paragraph" id="p-0187" num="0189">CINFO is an encrypted string of information from the Gate Controller, containing a number of items of state information needed by the Gate Controller to properly handle any future requests for advanced features for this call, e.g. 3-way calling, return call, transfer, etc. It must be stored unaltered by the BTI and returned to the Gate Controller unaltered for any of these features.</div>
<div class="description-paragraph" id="h-0016" num="0000">7.2.1.2 SETUP Error</div>
<div class="description-paragraph" id="p-0188" num="0190">If the SETUP fails, the Gate Controller will return an error indication to the BTI. A sample SETUPNAK message is:</div>
<div class="description-paragraph" id="p-0189" num="0191">SETUPNAK 0S55072 v1.0; ERROR Authorization failed</div>
<div class="description-paragraph" id="p-0190" num="0192">ERROR gives an error message string, which could be displayed if the BTI has some method to do so. Otherwise it provides some useful debugging information.</div>
<div class="description-paragraph" id="p-0191" num="0193">Other elements in the SETUPNAK message are TBD.</div>
<div class="description-paragraph" id="h-0017" num="0000">7.2.2 REDIRECT</div>
<div class="description-paragraph" id="p-0192" num="0194">The BTI sends a REDIRECT message to its Gate Controller when it wants a current call to be directed to some other destination. A sample REDIRECT message is:</div>
<div class="description-paragraph" id="p-0193" num="0195">REDIRECT 0S42115 v1.0; DEST E164 8720; CALLER 8766; AUTHID 6929022;</div>
<div class="description-paragraph" id="p-0194" num="0196">CINFO 135.207.31.2:7650/135.207.31.1:7682/17S63224/10.0.12.221:7685/10.0.12.221:7000-2-2/9733608718/21/10.0.12.221:7685</div>
<div class="description-paragraph" id="p-0195" num="0197">DEST gives the new desired destination of this call. It may be either an E164 number, a service name, or a CINFO string, just as in the SETUP message.</div>
<div class="description-paragraph" id="p-0196" num="0198">CALLER gives the caller-id value for the line that is making the request. The Gate Controller must verify that this caller-id is valid based on the AUTHID. Since the BTI is outside our control, we cannot be sure that the call is really coming from the line it claims; however we can ensure that the caller-id specified is one of the possible ones from this BTI.</div>
<div class="description-paragraph" id="p-0197" num="0199">AUTHID is the authorization code given to this particular BTI from the OAMP system. It is changed periodically, e.g. every ten minutes.</div>
<div class="description-paragraph" id="p-0198" num="0200">CINFO is the encrypted string previously supplied by the Gate Controller, which tells the Gate Controller various pieces of information about the current call.</div>
<div class="description-paragraph" id="h-0018" num="0000">7.2.2.1 REDIRECT Acknowledgment</div>
<div class="description-paragraph" id="p-0199" num="0201">If the Gate Controller is successful in directing the call to the new destination, it will respond with a REDIRECTACK message. A sample is:</div>
<div class="description-paragraph" id="p-0200" num="0202">REDIRECTACK 0S42115 v1.0;</div>
<div class="description-paragraph" id="h-0019" num="0000">7.2.2.2 REDIRECT Error</div>
<div class="description-paragraph" id="p-0201" num="0203">If the REDIRECT fails, the Gate Controller will return an error indication to the BTI. A sample REDIRECTNAK message is:</div>
<div class="description-paragraph" id="p-0202" num="0204">REDIRECTNAK 0S55072 v1.0; ERROR Authorization failed</div>
<div class="description-paragraph" id="p-0203" num="0205">ERROR gives an error message string, which could be displayed if the BTI has some method to do so. Otherwise it provides some useful debugging information.</div>
<div class="description-paragraph" id="p-0204" num="0206">Other elements in the REDIRECTNAK message are TBD.</div>
<div class="description-paragraph" id="h-0020" num="0000">7.2.3 SPLICE</div>
<div class="description-paragraph" id="p-0205" num="0207">The BTI sends a SPLICE message to its Gate Controller when it wants two current calls to be connected together. A sample SPLICE message is:
</div> <ul> <li id="ul0004-0001" num="0208">SPLICE 0S42161 v1.0; CALLER 8766; AUTHID 6929022;</li> <li id="ul0004-0002" num="0209">CINFO1 135.207.31.2:7650/135.207.31.1:7682/17S63224/10.0.12.221:7685/10.0.12.221:7000-2-2/9733608718/21/10.0.12.221:7685;</li> <li id="ul0004-0003" num="0210">CINFO2 135.207.31.2:7650/135.207.22.1:7682/5571731/10.3.7.150:7685/10.3.7.150:7000-2-2/9733608720/8839/10.3.7.150:7685</li> </ul>
<div class="description-paragraph" id="p-0206" num="0211">CALLER gives the caller-id value for the line that is making the request. The Gate Controller must verify that this caller-id is valid based on the AUTHID. Since the BTI is outside our control, we cannot be sure that the call is really coming from the line it claims; however we can ensure that the caller-id specified is one of the possible ones from this BTI.</div>
<div class="description-paragraph" id="p-0207" num="0212">AUTHID is the authorization code given to this particular BTI from the OAMP system. It is changed periodically, e.g. every ten minutes.</div>
<div class="description-paragraph" id="p-0208" num="0213">CINFO1 is the encrypted string previously supplied by the Gate Controller, which tells the Gate Controller various pieces of information about the first call.</div>
<div class="description-paragraph" id="p-0209" num="0214">CINFO2 is the encrypted string previously supplied by the Gate Controller, which tells the Gate Controller various pieces of information about the second call.</div>
<div class="description-paragraph" id="h-0021" num="0000">7.2.3.1 SPLICE Acknowledgment</div>
<div class="description-paragraph" id="p-0210" num="0215">If the Gate Controller is successful in directing the two calls to each other, it will respond with a SPLICEACK message. A sample is:</div>
<div class="description-paragraph" id="p-0211" num="0216">SPLICEACK 0S42161 v1.0;</div>
<div class="description-paragraph" id="h-0022" num="0000">7.2.3.2 SPLICE Error</div>
<div class="description-paragraph" id="p-0212" num="0217">If the SPLICE fails, the Gate Controller will return an error indication to the BTI. A sample SPLICENAK message is:</div>
<div class="description-paragraph" id="p-0213" num="0218">SPLICENAK 0S55072 v1.0; ERROR Authorization failed</div>
<div class="description-paragraph" id="p-0214" num="0219">ERROR gives an error message string, which could be displayed if the BTI has some method to do so. Otherwise it provides some useful debugging information.</div>
<div class="description-paragraph" id="p-0215" num="0220">Other elements in the SPLICENAK message are TBD.</div>
<div class="description-paragraph" id="h-0023" num="0000">7.2.4 TRACE</div>
<div class="description-paragraph" id="p-0216" num="0221">The BTI sends a TRACE message to its Gate Controller when it to report an abusive or harassing phone call to law enforcement. A sample TRACE message is:
</div> <ul> <li id="ul0005-0001" num="0000"> <ul> <li id="ul0006-0001" num="0222">TRACE 0S42115 v1.0; CALLER 8766; AUTHID 6929022;
        <ul> <li id="ul0007-0001" num="0223">CINFO 135.207.31.2:7650/135.207.31.1:7682/17S63224/10.0.12.221:7685/10.0.12.221:7000-2-2/9733608718/21/10.0.12.221:7685</li> </ul>
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0217" num="0224">CALLER gives the caller-id value for the line that is making the request. The Gate Controller must verify that this caller-id is valid based on the AUTHID. Since the BTI is outside our control, we cannot be sure that the call is really coming from the line it claims; however we can ensure that the caller-id specified is one of the possible ones from this BTI.</div>
<div class="description-paragraph" id="p-0218" num="0225">AUTHID is the authorization code given to this particular BTI from the OAMP system. It is changed periodically, e.g. every ten minutes.</div>
<div class="description-paragraph" id="p-0219" num="0226">CINFO is the encrypted string previously supplied by the Gate Controller, which tells the Gate Controller various pieces of information about the call.</div>
<div class="description-paragraph" id="h-0024" num="0000">7.2.4.1 TRACE Acknowledgment</div>
<div class="description-paragraph" id="p-0220" num="0227">If the information in the TRACE message is valid, the Gate Controller will respond with a TRACEACK message. A sample message is:</div>
<div class="description-paragraph" id="p-0221" num="0228">TRACEACK 0S42115 v1.0;</div>
<div class="description-paragraph" id="h-0025" num="0000">7.2.4.2 TRACE Error</div>
<div class="description-paragraph" id="p-0222" num="0229">If the TRACE fails, the Gate Controller will return an error indication to the BTI. A sample TRACENAK message is:
</div> <ul> <li id="ul0008-0001" num="0000"> <ul> <li id="ul0009-0001" num="0230">TRACENAK 0S55072 v1.0; ERROR Authorization failed</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0223" num="0231">ERROR gives an error message string, which could be displayed if the BTI has some method to do so. Otherwise it provides some useful debugging information.</div>
<div class="description-paragraph" id="p-0224" num="0232">Other elements in the TRACENAK message are TBD.</div>
<div class="description-paragraph" id="h-0026" num="0000">7.2.5 PROFILE</div>
<div class="description-paragraph" id="p-0225" num="0233">To be provided.</div>
<div class="description-paragraph" id="h-0027" num="0000">7.2.5.1 PROFILE Acknowledgment</div>
<div class="description-paragraph" id="p-0226" num="0234">To be provided.</div>
<div class="description-paragraph" id="h-0028" num="0000">7.2.5.2 PROFILE Error</div>
<div class="description-paragraph" id="p-0227" num="0235">If the PROFILE fails, the Gate Controller will return an error indication to the BTI. A sample PROFILENAK message is:
</div> <ul> <li id="ul0010-0001" num="0000"> <ul> <li id="ul0011-0001" num="0236">PROFILENAK 0S55072 v1.0; ERROR Authorization failed</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0228" num="0237">ERROR gives an error message string, which could be displayed if the BTI has some method to do so. Otherwise it provides some useful debugging information.</div>
<div class="description-paragraph" id="p-0229" num="0238">Other elements in the PROFILENAK message are TBD.</div>
<div class="description-paragraph" id="h-0029" num="0000">7.3 Gate Controller to BTI</div>
<div class="description-paragraph" id="p-0230" num="0239">The Gate Controller initiates messages to the BTI to inform it of incoming calls, or to inform it of a change in the status of an existing call.</div>
<div class="description-paragraph" id="p-0231" num="0240">Messages initiated by the Gate Controller include SETUP, TRANSFER, and CALLHOLD. SETUP is used to inform the BTI of an incoming call, and to ask the BTI the proper handling of this new call request. TRANSFER informs the BTI that a current call has been redirected to a new destination. CALLHOLD informs the BTI that the call has been placed on hold and to temporarily release the resources used by this call.</div>
<div class="description-paragraph" id="h-0030" num="0000">7.3.1 SETUP</div>
<div class="description-paragraph" id="p-0232" num="0241">The Gate Controller informs a BTI of an incoming call request with a SETUP message. A sample message is:
</div> <ul> <li id="ul0012-0001" num="0000"> <ul> <li id="ul0013-0001" num="0242">SETUP 4T93182 v1.0; DEST 9733608766; CALLER 9733608718; CRV 21;
        <ul> <li id="ul0014-0001" num="0243">SIGADDR 10.0.0.1:4722; DATAADDR 10.0.0.1:4724 2 2;</li> <li id="ul0014-0002" num="0244">CODING 53B,6 ms,G.711; GATEIP 135.207.22.1:7682; GATEID 21S11018; CINFO &lt;string&gt;</li> </ul>
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0233" num="0245">DEST is the destination E164 address, as given by the originator and expanded to a global addressing plan by the Gate Controller.</div>
<div class="description-paragraph" id="p-0234" num="0246">CALLER (optional) is the caller-id information. This element is only present if the customer has subscribed to some variant of caller-id service. If the customer has subscribed to calling name service as well, the second parameter will contain the name of the caller. If the originator of the call has specified caller-id blocking, the first parameter will contain “anonymous.”</div>
<div class="description-paragraph" id="p-0235" num="0247">CRV is the Call Reference Value assigned by the destination for this call. It must be included in all BTI-BTI messages to properly identify the call.</div>
<div class="description-paragraph" id="p-0236" num="0248">SIGADDR gives the address and port number for the destination of all BTI-BTI signaling messages.</div>
<div class="description-paragraph" id="p-0237" num="0249">DATAADDR gives the address and port number for the destination of voice data packets. The second parameter (optional) gives the number of consecutive ports allocated. The third parameter (optional) gives the alignment information for the port numbers.</div>
<div class="description-paragraph" id="p-0238" num="0250">CODING specifies a list of possible encapsulations and coding methods that the originator will perform. Each parameter is at least three items separated by commas, where the first item specifies a message size, the second item gives the interval between packets, the third item gives the coding algorithm, and fourth and later items (optional) give additional parameters specific to the coder.</div>
<div class="description-paragraph" id="p-0239" num="0251">GATEIP gives the IP address and port number of the Edge Router that contains the gate controlling access service for this connection. This is the destination address to use for all BTI-ER messages.</div>
<div class="description-paragraph" id="p-0240" num="0252">GATEID gives the identification and authorization token assigned by the Edge Router for the gate allocated for this connection.</div>
<div class="description-paragraph" id="p-0241" num="0253">CINFO is an encrypted string containing internal state information of the Gate Controller, which is to be stored in the BTI and returned with any future enhanced service request related to this call, e.g. 3-way calling, call transfer, etc.</div>
<div class="description-paragraph" id="h-0031" num="0000">7.3.1.1 SETUP Acknowledgment</div>
<div class="description-paragraph" id="p-0242" num="0254">If the BTI is willing to accept the incoming call specified in the SETUP message, it responds with SETUPACK. A sample SETUPACK message is:
</div> <ul> <li id="ul0015-0001" num="0000"> <ul> <li id="ul0016-0001" num="0255">SETUPACK 4T93182 v1.0; CRV 2712; SIGADDR kkrama-bti:7685;
        <ul> <li id="ul0017-0001" num="0256">DATAADDR kkrama-bti:7000 2 2; CODING 53B,6 ms,G.711</li> </ul>
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0243" num="0257">CRV is the Call Reference Value assigned by the BTI for this call. It is the value that will appear in all BTI-BTI messages to identify the specific call instance.</div>
<div class="description-paragraph" id="p-0244" num="0258">SIGADDR is the address and port number where the BTI will listen for BTI-BTI signaling messages.</div>
<div class="description-paragraph" id="p-0245" num="0259">DATAADDR is the address and port numbers where the BTI will accept voice data packets. The second parameter indicates the number of consecutive ports, and the third parameter gives the alignment necessary if the part numbers are translated by a PAT server.</div>
<div class="description-paragraph" id="p-0246" num="0260">CODING is the encapsulation style and coding method chosen from those offered.</div>
<div class="description-paragraph" id="h-0032" num="0000">7.3.1.2 SETUP Error</div>
<div class="description-paragraph" id="p-0247" num="0261">If the BTI is not willing to accept the incoming call, it responds with SETUPNAK. A sample SETUPNAK message is:
</div> <ul> <li id="ul0018-0001" num="0000"> <ul> <li id="ul0019-0001" num="0262">SETUPNAK 4T93182 v1.0; ERROR Busy; FORWARD E164 8800</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0248" num="0263">ERROR gives an error message string, which could be displayed if the Gate Controller has some method to do so, and can be passed back to the originating BTI in a SETUPNAK message.</div>
<div class="description-paragraph" id="p-0249" num="0264">FORWARD gives the new destination that the call should be directed to, as a result of the call forwarding algorithm implemented within the BTI. The structure of this element is identical to that of the DEST element of the BTI-GC SETUP message.</div>
<div class="description-paragraph" id="p-0250" num="0265">Other elements in the message are TBD.</div>
<div class="description-paragraph" id="h-0033" num="0000">7.3.2 TRANSFER</div>
<div class="description-paragraph" id="p-0251" num="0266">The TRANSFER messages is used by the Gate Controller to inform the BTI of a change in destination of an existing call. The BTI must alter some destination parameters to communicate with this new destination. A sample TRANSFER message is:
</div> <ul> <li id="ul0020-0001" num="0000"> <ul> <li id="ul0021-0001" num="0267">TRANSFER 0T5087 v1.0; CRV 21; REMCRV 1025; SIGADDR 135.207.31.3:6026;
        <ul> <li id="ul0022-0001" num="0268">DATAADDR 135.207.31.3:6028 2; CODING 53B,6 ms,G.711; ROLE orig;</li> <li id="ul0022-0002" num="0269">CINFO &lt;string&gt;</li> </ul>
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0252" num="0270">CRV gives the Call Reference Value of the call that has been transferred. This parameter is intended to help the BTI determine the proper adjustments.</div>
<div class="description-paragraph" id="p-0253" num="0271">REMCRV is the Call Reference Value assigned by the party at the other end of the call. This value must be used in all BTI-BTI communication.</div>
<div class="description-paragraph" id="p-0254" num="0272">SIGADDR is the IP address and port for BTI-BTI signaling messages to the other endpoint.</div>
<div class="description-paragraph" id="p-0255" num="0273">DATAADDR is the IP address and UDP port specification for voice data packets. The second parameter, if present, gives the number of consecutive port numbers assigned for this connection. The third parameter, if present, tells any alignment necessary for the port numbers.</div>
<div class="description-paragraph" id="p-0256" num="0274">CODING tells the encapsulation scheme and coding method to use for this connection.</div>
<div class="description-paragraph" id="p-0257" num="0275">ROLE tells whether the BTI should consider itself the originator or terminator of this conversation.</div>
<div class="description-paragraph" id="p-0258" num="0276">CINFO is an encrypted string of information about the other end of the conversation, to be stored in the BTI, for use for future enhanced services that may be requested.</div>
<div class="description-paragraph" id="h-0034" num="0000">7.3.2.1 TRANSFER Acknowledgment</div>
<div class="description-paragraph" id="p-0259" num="0277">If the BTI is able to identify the call given in the TRANSFER message, adjust its internal state, and allocate resources to the new destination, it responds with TRANSFERACK. A sample TRANSFERACK message is:
</div> <ul> <li id="ul0023-0001" num="0000"> <ul> <li id="ul0024-0001" num="0278">TRANSFERACK 0T5087 v1.0;
<br/>
7.3.2.2 TRANSFER Error
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0260" num="0279">If the BTI is not willing to accept the transferred call, it responds with TRANSFERNAK. A sample TRANSFERNAK message is:
</div> <ul> <li id="ul0025-0001" num="0000"> <ul> <li id="ul0026-0001" num="0280">TRANSFERNAK 0T5087 v1.0; ERROR Resource reservation to new destination failed</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0261" num="0281">ERROR gives an error message string, which could be displayed if the Gate Controller has some method to do so, and can be passed back to the originating system in a NAK message.</div>
<div class="description-paragraph" id="p-0262" num="0282">Other elements in the message are TBD.</div>
<div class="description-paragraph" id="h-0035" num="0000">7.3.3 CALLHOLD</div>
<div class="description-paragraph" id="p-0263" num="0283">The BTI must be placed on hold while gate adjustments are performed. In most cases this is handled by the BTI-BTI HOLD message. In some situations, it must be done by the Gate Controller, and is performed by issuing the CALLHOLD message. A sample CALLHOLD message is:
</div> <ul> <li id="ul0027-0001" num="0000"> <ul> <li id="ul0028-0001" num="0284">CALLHOLD 2T10477 v1.0; CRV 21</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0264" num="0285">CRV is the Call Reference Value assigned by the BTI for this conversation.</div>
<div class="description-paragraph" id="h-0036" num="0000">7.3.3.1 CALLHOLD Acknowledgment</div>
<div class="description-paragraph" id="p-0265" num="0286">After the BTI has placed itself in a hold status, it responds with CALLHOLDACK. A sample CALLHOLDACK message is:
</div> <ul> <li id="ul0029-0001" num="0000"> <ul> <li id="ul0030-0001" num="0287">CALLHOLDACK 2T10477 v1.0;
<br/>
7.3.3.2 CALLHOLD Error
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0266" num="0288">If the BTI is not able to process the HOLD request, it responds with CALLHOLDNAK. A sample CALLHOLDNAK message is:
</div> <ul> <li id="ul0031-0001" num="0000"> <ul> <li id="ul0032-0001" num="0289">CALLHOLDNAK 2T10477 v1.0; ERROR Illegal Call Reference Value</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0267" num="0290">ERROR gives an error message string, which could be displayed if the Gate Controller has some method to do so, and can be passed back to the originating system in a NAK message.</div>
<div class="description-paragraph" id="h-0037" num="0000">7.4 BTI to Edge Router</div>
<div class="description-paragraph" id="p-0268" num="0291">Resource allocation messages are exchanged between the BTI and the Edge Router for reservation and release of network resources. These messages all have a reference to a “Gate,” which must have been initialized by a Gate Controller prior to the BTI's resource reservation request.</div>
<div class="description-paragraph" id="p-0269" num="0292">Messages initiated by the BTI include RESERVE, COMMIT, RERESERVE, RECOMMIT, RELEASE, HOLD, and KEEPALIVE. RESERVE is the normal first step in the reservation protocol, where it requests an allocation of resources but does not require them to be assigned. COMMIT requests the actual assignment of resources to this conversation. RERESERVE is used in cases where the BTI already has some resources either reserved or committed to it and is willing to use them to satisfy this new request. RECOMMIT serves a similar function when the resources are to be committed to this new connection. RELEASE is the indication from the BTI that a connection should be terminated. HOLD indicates to the Edge Router that the voice data stream is temporarily stopping, and to stop monitoring the data stream, but to maintain the resources as reserved. KEEPALIVE is sent periodically (interval TBD) in the held state to the Edge Router to maintain the resource reservation; a lack of keepalives indicates a (probably undesirable) call termination.</div>
<div class="description-paragraph" id="h-0038" num="0000">7.4.1 RESERVE</div>
<div class="description-paragraph" id="p-0270" num="0293">The RESERVE message is sent by the BTI in the first stage of resource allocation. A sample RESERVE message is:
</div> <ul> <li id="ul0033-0001" num="0000"> <ul> <li id="ul0034-0001" num="0294">RESERVE 0S55073 v1.0; GATEID 17S63224; BANDWIDTH 53B,6 ms</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0271" num="0295">GATEID is the identification of the gate, as assigned by the Edge Router. Included in this string is the security authorization that indicates the sender is allowed to perform operations on this gate. BANDWIDTH is the specification of the actual bandwidth desired at this time. It is specified as packet size, in bytes, and inter-packet interval. The details of the algorithm for comparing this to the specification given by the Gate Controller in the GATESETUP message is TBD.</div>
<div class="description-paragraph" id="h-0039" num="0000">7.4.1.1 RESERVE Acknowledgment</div>
<div class="description-paragraph" id="p-0272" num="0296">If the resource reservation is successful, meaning bandwidth is available both upstream and downstream in the access network, and bandwidth is available in the forward direction in the backbone network, the Edge Router responds with a RESERVACK message. A sample message is:
</div> <ul> <li id="ul0035-0001" num="0000"> <ul> <li id="ul0036-0001" num="0297">RESERVEACK 0S55073 v1.0;
<br/>
7.4.1.2 RESERVE Error
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0273" num="0298">If the resource reservation fails, the Edge Router responds with a RESERVENAK message. A sample message is:
</div> <ul> <li id="ul0037-0001" num="0000"> <ul> <li id="ul0038-0001" num="0299">RESERVENAK 0S55073 v1.0; ERROR No upstream capacity available</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0274" num="0300">ERROR gives an error message string, which could be displayed if the BTI has some method to do so, or can simply result in a fast busy signal.</div>
<div class="description-paragraph" id="p-0275" num="0301">Other elements in the message are TBD.</div>
<div class="description-paragraph" id="h-0040" num="0000">7.4.2 COMMIT</div>
<div class="description-paragraph" id="p-0276" num="0302">The COMMIT message is sent by the BTI in the second stage of resource allocation. On receipt of a COMMIT message, the Edge Router resets the gate timer to a smaller interval (approximately 2 seconds, exact value TBD). If that timer expires before the COMMITACK is sent, the gate is terminated. A sample COMMIT message is:
</div> <ul> <li id="ul0039-0001" num="0000"> <ul> <li id="ul0040-0001" num="0303">COMMIT 0S55074 v1.0; GATEID 17S63224; BANDWIDTH 53B,6 ms</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0277" num="0304">GATEID is the identification of the gate, as assigned by the Edge Router. Included in this string is the security authorization that indicates the sender is allowed to perform operations on this gate.</div>
<div class="description-paragraph" id="p-0278" num="0305">BANDWIDTH is the specification of the actual bandwidth desired at this time. It is specified as packet size, in bytes, and inter-packet interval. The details of the algorithm for comparing this to the specification given by the Gate Controller in the GATESETUP message is TBD. The value given in the COMMIT can be no greater than that from the RESERVE message; again the comparison method is TBD.</div>
<div class="description-paragraph" id="h-0041" num="0000">7.4.2.1 COMMIT Acknowledgment</div>
<div class="description-paragraph" id="p-0279" num="0306">If the resource allocation is successful, meaning bandwidth has been allocated in the access network (e.g. via unsolicited grants), and the Edge Router has successfully coordinated with its remote Edge Router at the other end of the call, the Edge Router responds with a COMMITACK message. A sample message is:
</div> <ul> <li id="ul0041-0001" num="0000"> <ul> <li id="ul0042-0001" num="0307">COMMITACK 0S55074 v1.0;
<br/>
7.4.2.2 COMMIT Error
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0280" num="0308">If the resource allocation fails, or the coordination with the remote gate does not complete within the allotted interval, the Edge Router responds with a COMMITNAK message. It is intended that this be a very infrequent event, since it results in the caller hearing first a ringback tone, then turning into a failure tone. Such call defects are limited by the service description to only a few per million completed calls, although deliberate cases of fraud causing this error are not counted. A sample message is:
</div> <ul> <li id="ul0043-0001" num="0000"> <ul> <li id="ul0044-0001" num="0309">COMMITNAK 0S55074 v1.0; ERROR Gate coordination failure</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0281" num="0310">ERROR gives an error message string, which could be displayed if the BTI has some method to do so, or can simply result in a fast busy signal.</div>
<div class="description-paragraph" id="p-0282" num="0311">Other elements in the message are TBD.</div>
<div class="description-paragraph" id="h-0042" num="0000">7.4.3 RERESERVE</div>
<div class="description-paragraph" id="p-0283" num="0312">The RERESERVE message is sent by the BTI in the first stage of resource allocation when the BTI has a current allocation that the new connection will be re-using. See Section xx.xx for information about the two stage resource allocation scheme. A sample RERESERVE message is:
</div> <ul> <li id="ul0045-0001" num="0000"> <ul> <li id="ul0046-0001" num="0313">RERESERVE 0S42110 v1.0; GATEID 5S71731; PREVGATEID 21S11018;
        <ul> <li id="ul0047-0001" num="0314">BANDWIDTH 53B,6 ms</li> </ul>
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0284" num="0315">GATEID is the identification of the gate, as assigned by the Edge Router. Included in this string is the security authorization that indicates the sender is allowed to perform operations on this gate.</div>
<div class="description-paragraph" id="p-0285" num="0316">PREVGATEID is the identification of an existing, committed gate, whose resources will be re-used in the current connection.</div>
<div class="description-paragraph" id="p-0286" num="0317">BANDWIDTH is the specification of the actual bandwidth desired at this time. It is specified as packet size, in bytes, and inter-packet interval. The details of the algorithm for comparing this to the specification given by the Gate Controller in the GATESETUP message is TBD.</div>
<div class="description-paragraph" id="h-0043" num="0000">7.4.3.1 RERESERVE Acknowledgment</div>
<div class="description-paragraph" id="p-0287" num="0318">If the resource re-reservation is successful, meaning bandwidth is available both upstream and downstream in the access network, and bandwidth is available in the forward direction in the backbone network, the Edge Router responds with a RERESERVACK message. A sample message is:
</div> <ul> <li id="ul0048-0001" num="0000"> <ul> <li id="ul0049-0001" num="0319">RESERVEACK 0S42110 v1.0;
<br/>
7.4.3.2 RERESERVE Error
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0288" num="0320">If the resource re-reservation fails, the Edge Router responds with a RERESERVENAK message. A sample message is:
</div> <ul> <li id="ul0050-0001" num="0000"> <ul> <li id="ul0051-0001" num="0321">RERESERVENAK 0S42110 v1.0; ERROR Illegal previous gate identifier</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0289" num="0322">ERROR gives an error message string, which could be displayed if the BTI has some method to do so, or can simply result in a fast busy signal.</div>
<div class="description-paragraph" id="p-0290" num="0323">Other elements in the message are TBD.</div>
<div class="description-paragraph" id="h-0044" num="0000">7.4.4 RECOMMIT</div>
<div class="description-paragraph" id="p-0291" num="0324">The RECOMMIT message is sent by the BTI in the second stage of resource allocation when a previous allocation is to be re-used. See Section xx.xx for information about the two stage resource allocation scheme. On receipt of a RECOMMIT message, the Edge Router resets the gate timer to a smaller interval (approximately 2 seconds, exact value TBD). If that timer expires before the RECOMMITACK is sent, the gate is terminated. A sample RECOMMIT message is:
</div> <ul> <li id="ul0052-0001" num="0000"> <ul> <li id="ul0053-0001" num="0325">RECOMMIT 0S42111 v1.0; GATEID 5S71731; PREVGATEID 21S11018;
        <ul> <li id="ul0054-0001" num="0326">BANDWIDTH 53B,6 ms</li> </ul>
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0292" num="0327">GATEID is the identification of the gate, as assigned by the Edge Router. Included in this string is the security authorization that indicates the sender is allowed to perform operations on this gate.</div>
<div class="description-paragraph" id="p-0293" num="0328">PREVGATEID is the identification of an existing, committed gate, whose resources may be re-used in the current connection.</div>
<div class="description-paragraph" id="p-0294" num="0329">BANDWIDTH is the specification of the actual bandwidth desired at this time. It is specified as packet size, in bytes, and inter-packet interval. The details of the algorithm for comparing this to the specification given by the Gate Controller in the GATESETUP message is TBD. The value given in the COMMIT can be no greater than that from the RESERVE message; again the comparison method is TBD.</div>
<div class="description-paragraph" id="h-0045" num="0000">7.4.4.1 RECOMMIT Acknowledgment</div>
<div class="description-paragraph" id="p-0295" num="0330">If the resource allocation is successful, meaning bandwidth has been allocated in the access network (e.g. via unsolicited grants), and the Edge Router has successfully coordinated with its remote Edge Router at the other end of the call, the Edge Router responds with a RECOMMITACK message. A sample message is:
</div> <ul> <li id="ul0055-0001" num="0000"> <ul> <li id="ul0056-0001" num="0331">RECOMMITACK 0S42111 v1.0;
<br/>
7.4.4.2 RECOMMIT Error
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0296" num="0332">If the resource allocation fails, or the coordination with the remote gate does not complete within the allotted interval, the Edge Router responds with a RECOMMITNAK message. It is intended that this be a very infrequent event, since it results in the caller hearing first a ringback tone, then turning into a failure tone. Such call defects are limited by the service description to only a few per million completed calls, although deliberate cases of fraud causing this error are not counted. A sample message is:
</div> <ul> <li id="ul0057-0001" num="0000"> <ul> <li id="ul0058-0001" num="0333">RECOMMITNAK 0S42111 v1.0; ERROR Gate coordination failure</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0297" num="0334">ERROR gives an error message string, which could be displayed if the BTI has some method to do so, or can simply result in a fast busy signal.</div>
<div class="description-paragraph" id="p-0298" num="0335">Other elements in the message are TBD.</div>
<div class="description-paragraph" id="h-0046" num="0000">7.4.5 RELEASE</div>
<div class="description-paragraph" id="p-0299" num="0336">The BTI sends the RELEASE message to the Edge Router when the call has completed, and the resources are to be released and billing is to stop. A sample message is:
</div> <ul> <li id="ul0059-0001" num="0000"> <ul> <li id="ul0060-0001" num="0337">RELEASE 0S55075 v1.0; GATEID 17S63224</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0300" num="0338">GATEID is the identification of the gate that was assigned for this conversation, and which is now to be released.</div>
<div class="description-paragraph" id="h-0047" num="0000">7.4.5.1 RELEASE Acknowledgment</div>
<div class="description-paragraph" id="p-0301" num="0339">The Edge Router always responds to a RELEASE message with RELEASEACK. If a gate existed with the indicated identification, then it is closed, its resources released, a billing event is generated, and a GATECLOSE message is sent to the corresponding Edge Router at the other end of the connection.</div>
<div class="description-paragraph" id="p-0302" num="0340">A sample message is:
</div> <ul> <li id="ul0061-0001" num="0000"> <ul> <li id="ul0062-0001" num="0341">RELEASEACK 0S55075 v1.0;
<br/>
7.4.5.2 RELEASE Error
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0303" num="0342">The Edge Router always responds to a RELEASE with a RELEASEACK. There are no error indications generated. If the gate identification does not exist, the Edge Router assumes the gate has already been closed by the remote end.</div>
<div class="description-paragraph" id="h-0048" num="0000">7.4.6 HOLD</div>
<div class="description-paragraph" id="p-0304" num="0343">If the BTI wants to place a current call on hold, it must inform the Edge Router that its upstream data stream will stop. Otherwise, the Edge Router will interpret the lack of data as a hangup indication and terminate the call. This is done by a HOLD message. A sample message is:
</div> <ul> <li id="ul0063-0001" num="0000"> <ul> <li id="ul0064-0001" num="0344">HOLD 0S55090 v1.0; GATEID 17S63224</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0305" num="0345">GATEID is the identification of the gate, as assigned by the Edge Router. Included in this string is the security authorization that indicates the sender is allowed to perform operations on this gate.</div>
<div class="description-paragraph" id="h-0049" num="0000">7.4.6.1 HOLD Acknowledgment</div>
<div class="description-paragraph" id="p-0306" num="0346">If the hold operation is successful, meaning bandwidth has been placed back in the pool of reserved but not yet committed, the Edge Router responds with a HOLDACK message. A sample message is:
</div> <ul> <li id="ul0065-0001" num="0000"> <ul> <li id="ul0066-0001" num="0347">HOLDACK 0S55090 v1.0;
<br/>
7.4.6.2 HOLD Error
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0307" num="0348">If the hold operation fails the Edge Router responds with a HOLDNAK message. A sample message is:
</div> <ul> <li id="ul0067-0001" num="0000"> <ul> <li id="ul0068-0001" num="0349">HOLDNAK 0S55090 v1.0; ERROR Gate not yet committed
<br/>
ERROR gives an error message string, which could be displayed if the BTI has some method to do so, or can simply result in a fast busy signal.
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0308" num="0350">Other elements in the message are TBD.</div>
<div class="description-paragraph" id="h-0050" num="0000">7.4.7 KEEPALIVE</div>
<div class="description-paragraph" id="p-0309" num="0351">While having a connection on hold, it is necessary for the BTI to periodically inform the Edge Router that it is still alive and healthy, and that the reservation should be maintained. Lack of any traffic from the BTI is taken as evidence that the BTI has failed, or that some access component has failed and that the BTI is unable to request a call termination. The safe strategy is to terminate the call, rather than possibly charge the customer for a length service outage. A sample KEEPALIVE message is:
</div> <ul> <li id="ul0069-0001" num="0000"> <ul> <li id="ul0070-0001" num="0352">KEEPALIVE 21C3972 v1.0; GATEID 17S63224</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0310" num="0353">GATEID is the identification of the gate, as assigned by the Edge Router. Included in this string is the security authorization that indicates the sender is allowed to perform operations on this gate. There is no error control or retransmission of KEEPALIVE messages. The interval between them is engineered to minimize the chances of false error detection.</div>
<div class="description-paragraph" id="h-0051" num="0000">7.5 Edge Router to BTI</div>
<div class="description-paragraph" id="p-0311" num="0354">No messages are initiated by the Edge Router.</div>
<div class="description-paragraph" id="h-0052" num="0000">7.6 BTI to BTI</div>
<div class="description-paragraph" id="p-0312" num="0355">There are various end-to-end messages that are exchanged in any signaling system, which are used to coordinate the state of the two endpoints in providing consistent service. In embodiments of the present invention these are implemented as BTI-BTI signaling messages, are sent directly between the two BTIs involved in the conversation. These are formatted such that they can be processed by the same subroutines as the other messages.</div>
<div class="description-paragraph" id="p-0313" num="0356">Messages exchanged between BTIs include RING, RINGBACK, CONNECT, HANGUP, HOLD, and RINGTIMEOUT. RING is sent from the originator to the destination to indicate that all appears ready and that the destination should ring the phone. RINGBACK is sent from the destination to the originator to indicate that the phone is ringing. CONNECT is sent from the destination to the originator when the called party answers the phone, or immediately after receipt of RING is the called party is ready. HOLD is sent from either BTI to the other to indicate the call will be placed on hold and to release any real-time resources currently held. HANGUP and RINGTIMEOUT are informational messages to indicate state information that the BTI will receive by other mechanisms as well.</div>
<div class="description-paragraph" id="h-0053" num="0000">7.6.1 RING</div>
<div class="description-paragraph" id="p-0314" num="0357">The RING message is sent by the originating BTI when it has received the acknowledgment from its Edge Router that resources are available for the call, and therefore it is time to alert the destination user. A sample message is:
</div> <ul> <li id="ul0071-0001" num="0000"> <ul> <li id="ul0072-0001" num="0358">RING 3712 v1.0; CRV 3712</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0315" num="0359">CRV (optional) is the Call Reference Value assigned by the destination BTI. It must appear in the message, but may appear either as the transaction identifier, or as a separate element.</div>
<div class="description-paragraph" id="p-0316" num="0360">The acknowledgment of RING is either RINGBACK or CONNECT, not a separate RINGACK message.</div>
<div class="description-paragraph" id="h-0054" num="0000">7.6.2 RINGBACK</div>
<div class="description-paragraph" id="p-0317" num="0361">When a terminating BTI has completed the resource reservation sequence, and has received a RING message from the originating BTI, its proper response is either RINGBACK or CONNECT. RINGBACK is sent if the destination is not yet ready to receive the call, and that the BTI is ringing the phone. CONNECT means the destination is ready now, and that no ringing is needed (e.g. a voice response system). A sample message is:
</div> <ul> <li id="ul0073-0001" num="0000"> <ul> <li id="ul0074-0001" num="0362">RINGBACK 21 v1.0; CRV 21; SOURCE local; TYPE callwaiting</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0318" num="0363">CRV (optional) is the Call Reference Value assigned by the originating BTI. It must appear in the message, but may appear either as the transaction identifier, or as a separate element.</div>
<div class="description-paragraph" id="p-0319" num="0364">SOURCE (optional) specifies whether the audible ringback tone is to be generated locally by the originating BTI, or whether the destination will generate the tone utilizing the data stream. Due to the resource reservation scheme, SOURCE specified as “remote” can only occur when the destination is a trusted network element that does not need a gate to control access to the network. If not specified, ringback tone is generated locally by the BTI.</div>
<div class="description-paragraph" id="p-0320" num="0365">TYPE (optional) specifies one of several possible ringback audio sequences. Parameter value “callwaiting” means the special tone sequence indicating the callwaiting alert signal has been given. If the parameter is not given, or not understood, it defaults to “normal”.</div>
<div class="description-paragraph" id="p-0321" num="0366">There is no explicit acknowledgment to RINGBACK. However, if the originating BTI does not receive either RINGBACK or CONNECT in response to its RING message, it will retransmit the RING until a response is received.</div>
<div class="description-paragraph" id="h-0055" num="0000">7.6.3 CONNECT</div>
<div class="description-paragraph" id="p-0322" num="0367">The CONNECT message is sent by the terminating BTI when the user has answered and the connection should be established. A sample message is:
</div> <ul> <li id="ul0075-0001" num="0000"> <ul> <li id="ul0076-0001" num="0368">CONNECT 21 v1.0; CRV 21</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0323" num="0369">CRV (optional) is the Call Reference Value assigned by the originating BTI. It must appear in the message, but may appear either as the transaction identifier, or as a separate element.</div>
<div class="description-paragraph" id="p-0324" num="0370">Acknowledgment of the CONNECT message occurs via the COMMIT/COMMITACK exchange with the Edge Router.</div>
<div class="description-paragraph" id="h-0056" num="0000">7.6.4 HANGUP</div>
<div class="description-paragraph" id="p-0325" num="0371">This is an information message that is sent by either BTI to the other one to indicate the user is terminating the connection. A sample message is:
</div> <ul> <li id="ul0077-0001" num="0000"> <ul> <li id="ul0078-0001" num="0372">HANGUP 3712 v1.0; CRV 3712</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0326" num="0373">CRV (optional) is the Call Reference Value assigned by the originating BTI. It must appear in the message, but may appear either as the transaction identifier, or as a separate element.</div>
<div class="description-paragraph" id="p-0327" num="0374">There is no acknowledgment of the HANGUP message. There are multiple independent mechanisms that determine that a call has completed and will terminate the billing; since the system must recover from access link failures, BTI hardware/software failures, and power failures, each of which may prevent the BTI from sending the HANGUP message. Therefore its use is not critical.</div>
<div class="description-paragraph" id="h-0057" num="0000">7.6.5 HOLD</div>
<div class="description-paragraph" id="p-0328" num="0375">If the BTI wants to place a current call on hold, it must inform the other endpoint that its incoming data stream will stop. Otherwise, the other endpoint will interpret the lack of data as a hangup indication and terminate the call. This is done by a HOLD message. A sample message is:
</div> <ul> <li id="ul0079-0001" num="0000"> <ul> <li id="ul0080-0001" num="0376">HOLD 21 v1.0; CRV 21</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0329" num="0377">CRV (optional) is the Call Reference Value assigned by the originating BTI. It must appear in the message, but may appear either as the transaction identifier, or as a separate element.</div>
<div class="description-paragraph" id="p-0330" num="0378">Note that before stopping the data stream, the BTI must also inform its Edge Router that the data stream will stop, else the Edge Router will terminate the call. This is done via a BTI-ER HOLD message.</div>
<div class="description-paragraph" id="h-0058" num="0000">7.6.5.1 HOLD Acknowledgment</div>
<div class="description-paragraph" id="p-0331" num="0379">When a BTI has received a HOLD message from the other endpoint, it adjusts its threshold for considering the connection dead, and responds with the acknowledgment. This message is:
</div> <ul> <li id="ul0081-0001" num="0000"> <ul> <li id="ul0082-0001" num="0380">HOLDACK 3712 v1.0; CRV 3712</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0332" num="0381">CRV (optional) is the Call Reference Value assigned by the originating BTI. It must appear in the message, but may appear either as the transaction identifier, or as a separate element.</div>
<div class="description-paragraph" id="h-0059" num="0000">7.6.6 RINGTIMEOUT</div>
<div class="description-paragraph" id="p-0333" num="0382">This is an information message that is sent by the terminating BTI to the originator to indicate the user has not answered within the interval they configured, and that the call will be forwarded. A sample message is:
</div> <ul> <li id="ul0083-0001" num="0000"> <ul> <li id="ul0084-0001" num="0383">RINGTIMEOUT 3712 v1.0; CRV 3712</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0334" num="0384">CRV (optional) is the Call Reference Value assigned by the originating BTI. It must appear in the message, but may appear either as the transaction identifier, or as a separate element.</div>
<div class="description-paragraph" id="p-0335" num="0385">There is no error recovery for this message. It is informational only, and serves to tell the originating BTI to stop the ringback tone, and that a transfer is imminent. Without this message the originating BTI will still receive a TRANSFER message from the Gate Controller and handle the call in the same way.</div>
<div class="description-paragraph" id="h-0060" num="0000">7.6.7 RESOURCECHANGE</div>
<div class="description-paragraph" id="p-0336" num="0386">TBD</div>
<div class="description-paragraph" id="h-0061" num="0000">7.6.8 KEEPALIVE</div>
<div class="description-paragraph" id="p-0337" num="0387">While having a connection on hold, it is necessary for the BTI to periodically inform its peer BTI that it is still alive and healthy, and that the connection should be maintained. Lack of any traffic from the BTI is taken as evidence that the BTI has failed, or that some access component has failed and that the BTI is unable to request a call termination. The safe strategy is to terminate the call, rather than possibly charge the customer for a length service outage. A sample KEEPALIVE message is:
</div> <ul> <li id="ul0085-0001" num="0000"> <ul> <li id="ul0086-0001" num="0388">KEEPALIVE 3712 v1.0; CRV 3712</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0338" num="0389">CRV (optional) is the Call Reference Value assigned by the other BTI. It must appear in the message, but may appear either as the transaction identifier, or as a separate element.</div>
<div class="description-paragraph" id="p-0339" num="0390">There is no error control or retransmission of KEEPALIVE messages. The interval between them is engineered to minimize the chances of false error detection.</div>
<div class="description-paragraph" id="h-0062" num="0000">7.7 Gate Controller to Edge Router</div>
<div class="description-paragraph" id="p-0340" num="0391">The protocol between the Gate Controller and Edge Router is for purposes of resource control and resource allocation policy. The Gate Controller implements all the allocation policies, and uses that information to manage the set of gates implemented in the Edge Routers. The Gate Controller initializes the gates with specific source, destination, and bandwidth restrictions; once initialized the BTI is able to request resource allocations within the limits imposed by the Gate Controller. Messages initiated by the Gate Controller include GATEALLOC, GATESETUP, GATEMODIFY, GATERELEASE, and GATEINFO. GATEALLOC allocates a new gate identifier. GATESETUP initializes all the policy and traffic parameters for the gate, and sets the billing information. GATEMODIFY is used to change any or all of the parameters of an existing gate. GATERELEASE signals the end of the connection, and that the gate and all its resources can be made available to any other requestor. GATEINFO is a mechanism by which the Gate Controller can find out all the current state and parameter settings of an existing gate.</div>
<div class="description-paragraph" id="h-0063" num="0000">7.7.1 GATEALLOC</div>
<div class="description-paragraph" id="p-0341" num="0392">A GATEALLOC message is sent by the Gate Controller to allocate a new gate, and establish a GateID, but without setting any of the specific parameters needed for gate operation. A GATESETUP must come later with the operation parameters. On receipt of a GATEALLOC, the Edge Router starts a timer (approximately 120 seconds, exact value TBD), and if the gate has not entered the “commit” state in that time it is released. A sample GATEALLOC message is:
</div> <ul> <li id="ul0087-0001" num="0000"> <ul> <li id="ul0088-0001" num="0393">GATEALLOC 4T93176 v1.0; OWNER wtm-bti:7685</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0342" num="0394">OWNER specifies the name of the customer this gate will serve.</div>
<div class="description-paragraph" id="h-0064" num="0000">7.7.1.1 GATEALLOC Acknowledgment</div>
<div class="description-paragraph" id="p-0343" num="0395">A sample GATEALLOC message is:
</div> <ul> <li id="ul0089-0001" num="0000"> <ul> <li id="ul0090-0001" num="0396">GATEALLOCACK 4T93176 v1.0; GATEID 17S63224; CUSTUSAGE 3</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0344" num="0397">GATEID is the string that identifies the gate that was allocated. It consists of at least two parts, with some (edge-router-specified) separator between them: the identity of the gate that was allocated, and a security code that must be given to the Edge Router in order to affect any change in the gate parameters.</div>
<div class="description-paragraph" id="p-0345" num="0398">CUSTUSAGE tells the Gate Controller the number of simultaneous gates the customer has currently. This is calculated by a scan of all current gates, comparing the OWNER parameter. If the number of gates assigned to a customer is inconsistent with the service subscribed, the Gate Controller can take appropriate action.</div>
<div class="description-paragraph" id="h-0065" num="0000">7.7.1.2 GATEALLOC Error</div>
<div class="description-paragraph" id="p-0346" num="0399">Errors in allocating gates are reported by a GATEALLOCNAK message. A sample is:
</div> <ul> <li id="ul0091-0001" num="0000"> <ul> <li id="ul0092-0001" num="0400">GATEALLOCNAK 4T93176 v1.0; ERROR No gates available</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0347" num="0401">ERROR gives an error message string, which could be displayed if the Gate Controller has some method to do so, and can be passed back to the BTI in a SETUPNAK message.</div>
<div class="description-paragraph" id="p-0348" num="0402">Other elements in the message are TBD.</div>
<div class="description-paragraph" id="h-0066" num="0000">7.7.2 GATESETUP</div>
<div class="description-paragraph" id="p-0349" num="0403">The GATESETUP message is sent by the Gate Controller to the Edge Router to initialize the operational parameters of the gate. A sample GATESETUP message is:
</div> <ul> <li id="ul0093-0001" num="0000"> <ul> <li id="ul0094-0001" num="0404">GATESETUP 4T93181 v1.0; OWNER kkrama-bti:7685;
        <ul> <li id="ul0095-0001" num="0405">SRCIP 10.3.7.151; DESTIP 10.0.0.1:4724; BANDWIDTH 53B,6 ms,G.711;</li> <li id="ul0095-0002" num="0406">ROLE term; REMGATEIP 135.207.31.1:7682; REMGATEID 17S63224;</li> <li id="ul0095-0003" num="0407">REFID 135.207.31.2:36123E5C:93178;</li> <li id="ul0095-0004" num="0408">BILLDATA 5123-0123-4567-8900/9733608718/9733608766</li> </ul>
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0350" num="0409">OWNER (optional) gives the name of the customer this gate will serve. If this parameter is not given, then GATEID is mandatory.</div>
<div class="description-paragraph" id="p-0351" num="0410">GATEID (optional) gives the string that identifies the gate, with security code. If this parameter is not given, then OWNER is mandatory, and a new gate will be allocated.</div>
<div class="description-paragraph" id="p-0352" num="0411">SRCIP identifies the source IP address that will appear in all the data packets that go through the gate. Note that the source port number is not specified, and is generally not known or always constant.</div>
<div class="description-paragraph" id="p-0353" num="0412">DESTIP is the destination IP address that will appear in the IP header, and the destination UDP port number that will appear in the UDP header. Only packets that match the SourceIP/DestinationIP/DestinationPort will obtain the higher Quality of Service provided by the gate.</div>
<div class="description-paragraph" id="p-0354" num="0413">BANDWIDTH specifies the maximum bandwidth that may be requested through this gate. Although the parameter includes the coding style, it is not used by the gate.</div>
<div class="description-paragraph" id="p-0355" num="0414">ROLE specifies whether the Edge Router is the originator or terminating side of this conversation. This has importance only if the backbone reservation is bi-directional, and only one of the Edge Routers need do the reservation.</div>
<div class="description-paragraph" id="p-0356" num="0415">REMGATEIP is the address of the Edge Router at the other end of this connection. All ER-ER gate coordination messages are to be sent to this address and port.</div>
<div class="description-paragraph" id="p-0357" num="0416">REMGATEID is the identity of the gate at the other end of the connection.</div>
<div class="description-paragraph" id="p-0358" num="0417">REFID is the unique string that is to appear in billing records for this conversation.</div>
<div class="description-paragraph" id="p-0359" num="0418">BILLDATA is the charging information that is to appear in billing records for this conversation.</div>
<div class="description-paragraph" id="h-0067" num="0000">7.7.2.1 GATESETUP Acknowledgment</div>
<div class="description-paragraph" id="p-0360" num="0419">A sample GATESETUPACK message is:
</div> <ul> <li id="ul0096-0001" num="0000"> <ul> <li id="ul0097-0001" num="0420">GATESETUPACK 4T93181 v1.0; GATEID 21S11018; CUSTUSAGE 1</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0361" num="0421">GATEID is the string that identifies the gate that was allocated. It consists of at least two parts, with some (edge-router-specified) separator between them: the identity of the gate that was allocated, and a security code that must be given to the Edge Router in order to affect any change in the gate parameters.</div>
<div class="description-paragraph" id="p-0362" num="0422">CUSTUSAGE tells the Gate Controller the number of simultaneous gates the customer has currently. This is calculated by a scan of all current gates, comparing the OWNER parameter. If the number of gates assigned to a customer is inconsistent with the service subscribed, the Gate Controller can take appropriate action.</div>
<div class="description-paragraph" id="h-0068" num="0000">7.7.2.2 GATESETUP Error</div>
<div class="description-paragraph" id="p-0363" num="0423">Errors in establishing gates are reported by a GATESETUPNAK message. A sample is:
</div> <ul> <li id="ul0098-0001" num="0000"> <ul> <li id="ul0099-0001" num="0424">GATESETUPNAK 4T93181 v1.0; ERROR No gates available</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0364" num="0425">ERROR gives an error message string, which could be displayed if the Gate Controller has some method to do so, and can be passed back to the BTI in a SETUPNAK message.</div>
<div class="description-paragraph" id="p-0365" num="0426">Other elements in the message are TBD.</div>
<div class="description-paragraph" id="h-0069" num="0000">7.7.3 GATEMODIFY</div>
<div class="description-paragraph" id="p-0366" num="0427">The GATEMODIFY message is sent by the Gate Controller to the Edge Router to modify the operational parameters of an existing gate. A sample GATEMODIFY message is:
</div> <ul> <li id="ul0100-0001" num="0000"> <ul> <li id="ul0101-0001" num="0428">GATEMODIFY 2T10486 v1.0; GATEID 17S63224; SRCIP 10.3.7.151; DESTIP 10.0.0.1:4724; BANDWIDTH 53B,6m s, G.711; ROLE term; REMGATEIP 135.207.31.1:7682; REMGATEID 17S63224; REFID 135.207.31.2:36123E5C:93178;
        <ul> <li id="ul0102-0001" num="0429">BILLDATA 5123-0123-4567-8900/9733608718/9733608766</li> </ul>
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0367" num="0430">GATEID gives the string that identifies the gate, with security code.</div>
<div class="description-paragraph" id="p-0368" num="0431">SRCIP identifies the source IP address that will appear in all the data packets that go through the gate. Note that the source port number is not specified, and is generally not known or always constant.</div>
<div class="description-paragraph" id="p-0369" num="0432">DESTIP is the destination IP address that will appear in the IP header, and the destination UDP port number that will appear in the UDP header. Only packets that match the SourceIP/DestinationIP/DestinationPort will obtain the higher Quality of Service provided by the gate.</div>
<div class="description-paragraph" id="p-0370" num="0433">BANDWIDTH specifies the maximum bandwidth that may be requested through this gate. Although the parameter includes the coding style, it is not used by the gate.</div>
<div class="description-paragraph" id="p-0371" num="0434">ROLE specifies whether the Edge Router is the originator or terminating side of this conversation. This has importance only if the backbone reservation is bi-directional, and only one of the Edge Routers need do the reservation.</div>
<div class="description-paragraph" id="p-0372" num="0435">REMGATEIP is the address of the Edge Router at the other end of this connection. All ER-ER gate coordination messages are to be sent to this address and port.</div>
<div class="description-paragraph" id="p-0373" num="0436">REMGATEID is the identity of the gate at the other end of the connection.</div>
<div class="description-paragraph" id="p-0374" num="0437">REFID is the unique string that is to appear in billing records for this conversation.</div>
<div class="description-paragraph" id="p-0375" num="0438">BILLDATA is the charging information that is to appear in billing records for this conversation.</div>
<div class="description-paragraph" id="h-0070" num="0000">7.7.3.1 GATEMODIFY Acknowledgment</div>
<div class="description-paragraph" id="p-0376" num="0439">A sample GATEMODIFYACK message is:
</div> <ul> <li id="ul0103-0001" num="0000"> <ul> <li id="ul0104-0001" num="0440">GATEMODIFYACK 2T10486 v1.0; GATEID 17S63224; CUSTUSAGE 1</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0377" num="0441">GATEID is the string that identifies the gate that was allocated. It consists of at least two parts, with some (edge-router-specified) separator between them: the identity of the gate that was allocated, and a security code that must be given to the Edge Router in order to affect any change in the gate parameters.</div>
<div class="description-paragraph" id="p-0378" num="0442">CUSTUSAGE tells the Gate Controller the number of simultaneous gates the customer has currently. This is calculated by a scan of all current gates, comparing the OWNER parameter. If the number of gates assigned to a customer is inconsistent with the service subscribed, the Gate Controller can take appropriate action.</div>
<div class="description-paragraph" id="h-0071" num="0000">7.7.3.2 GATEMODIFY Error</div>
<div class="description-paragraph" id="p-0379" num="0443">Errors in modifying gates are reported by a GATEMODIFYNAK message. A sample is:
</div> <ul> <li id="ul0105-0001" num="0000"> <ul> <li id="ul0106-0001" num="0444">GATEMODIFYNAK 4T93181 v1.0; ERROR Illegal Gate Identification</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0380" num="0445">ERROR gives an error message string, which could be displayed if the Gate Controller has some method to do so, and can be passed back to the BTI in a SETUPNAK message.</div>
<div class="description-paragraph" id="p-0381" num="0446">Other elements in the message are TBD.</div>
<div class="description-paragraph" id="h-0072" num="0000">7.7.4 GATERELEASE</div>
<div class="description-paragraph" id="p-0382" num="0447">When a Gate Controller has transferred a connection, it sends a GATERELEASE message to the Edge Router to release any resources held by the endpoint that is now not part of the call. While the behavior is similar to a RELEASE message from the BTI, it results in a different event recorded in the billing system, and it avoids the normal gate coordination (as the corresponding gate at the other end of the original connection has been redirected to another destination). A sample is:
</div> <ul> <li id="ul0107-0001" num="0000"> <ul> <li id="ul0108-0001" num="0448">GATERELEASE 4T93181 v1.0; GATEID 17S63224</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0383" num="0449">GATEID is the string that identifies the gate that was allocated. It consists of at least two parts, with some (edge-router-specified) separator between them: the identity of the gate that was allocated, and a security code that must be given to the Edge Router in order to affect any change in the gate parameters.</div>
<div class="description-paragraph" id="p-0384" num="0450">ERROR gives an error message string, which could be displayed if the Gate Controller has some method to do so, and can be passed back to the BTI in a SETUPNAK message.</div>
<div class="description-paragraph" id="p-0385" num="0451">Other elements in the message are TBD.</div>
<div class="description-paragraph" id="h-0073" num="0000">7.7.4.1 GATERELEASE Acknowledgment</div>
<div class="description-paragraph" id="p-0386" num="0452">A GATERELEASE message always gives a response of GATERELEASEACK. A sample is:
</div> <ul> <li id="ul0109-0001" num="0000"> <ul> <li id="ul0110-0001" num="0453">GATERELEASEACK 4T93181 v1.0;
<br/>
7.7.4.2 GATERELEASE Error
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0387" num="0454">A GATERELEASE message always results in a response of GATERELEASEACK. If the GATEID parameter specifies an invalid gate, the Edge Router assumes the gate has already been closed.</div>
<div class="description-paragraph" id="h-0074" num="0000">7.7.5 GATEINFO</div>
<div class="description-paragraph" id="p-0388" num="0455">When a Gate Controller wishes to find out the current parameter settings, or current state, of a gate, it sends to the Edge Router a GATEINFO message. A sample is:
</div> <ul> <li id="ul0111-0001" num="0000"> <ul> <li id="ul0112-0001" num="0456">GATEINFO 0T5082 v1.0; GATEID 17S63224</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0389" num="0457">GATEID is the string that identifies the gate that was allocated. It consists of at least two parts, with some (edge-router-specified) separator between them: the identity of the gate that was allocated, and a security code that must be given to the Edge Router in order to affect any change in the gate parameters.</div>
<div class="description-paragraph" id="h-0075" num="0000">7.7.5.1 GATEINFO Acknowledgment</div>
<div class="description-paragraph" id="p-0390" num="0458">The message is sent by the Gate Controller to the Edge Router to modify the operational parameters of an existing gate. A sample GATEINFOACK message is:
</div> <ul> <li id="ul0113-0001" num="0000"> <ul> <li id="ul0114-0001" num="0459">GATEINFOACK 0T5082 v1.0; GATEID 17S63224; STATE commit;
        <ul> <li id="ul0115-0001" num="0460">SRCIP 10.3.7.151; DESTIP 10.0.0.1:4724; BANDWIDTH 53B,6 ms,G.711;</li> <li id="ul0115-0002" num="0461">ROLE term; REMGATEIP 135.207.31.1:7682; REMGATEID 17S63224;</li> <li id="ul0115-0003" num="0462">REFID 135.207.31.2:36123E5C:93178;</li> <li id="ul0115-0004" num="0463">BILLDATA 5123-0123-4567-8900/9733608718/9733608766</li> </ul>
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0391" num="0464">GATEID gives the string that identifies the gate, with security code.</div>
<div class="description-paragraph" id="p-0392" num="0465">STATE gives the internal state of the gate, one of the following: setup, reserved, commit, or hold.</div>
<div class="description-paragraph" id="p-0393" num="0466">SRCIP identifies the source IP address that will appear in all the data packets that go through the gate. Note that the source port number is not specified, and is generally not known or always constant.</div>
<div class="description-paragraph" id="p-0394" num="0467">DESTIP is the destination IP address that will appear in the IP header, and the destination UDP port number that will appear in the UDP header. Only packets that match the SourceIP/DestinationIP/DestinationPort will obtain the higher Quality of Service provided by the gate.</div>
<div class="description-paragraph" id="p-0395" num="0468">BANDWIDTH specifies the maximum bandwidth that may be requested through this gate. Although the parameter includes the coding style, it is not used by the gate.</div>
<div class="description-paragraph" id="p-0396" num="0469">ROLE specifies whether the Edge Router is the originator or terminating side of this conversation. This has importance only if the backbone reservation is bi-directional, and only one of the Edge Routers need do the reservation.</div>
<div class="description-paragraph" id="p-0397" num="0470">REMGATEIP is the address of the Edge Router at the other end of this connection. All ER-ER gate coordination messages are to be sent to this address and port.</div>
<div class="description-paragraph" id="p-0398" num="0471">REMGATEID is the identity of the gate at the other end of the connection.</div>
<div class="description-paragraph" id="p-0399" num="0472">REFID is the unique string that is to appear in billing records for this conversation.</div>
<div class="description-paragraph" id="p-0400" num="0473">BILLDATA is the charging information that is to appear in billing records for this conversation.</div>
<div class="description-paragraph" id="h-0076" num="0000">7.7.5.2 GATEINFO Error</div>
<div class="description-paragraph" id="p-0401" num="0474">Errors in fetching gate information are reported by a GATEINFONAK message. A sample is:
</div> <ul> <li id="ul0116-0001" num="0000"> <ul> <li id="ul0117-0001" num="0475">GATEINFONAK 0T5082 v1.0; ERROR Illegal Gate Identification</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0402" num="0476">ERROR gives an error message string, which could be displayed if the Gate Controller has some method to do so, and can be passed back to the BTI in a SETUPNAK message.</div>
<div class="description-paragraph" id="p-0403" num="0477">Other elements in the message are TBD.</div>
<div class="description-paragraph" id="h-0077" num="0000">7.8 Edge Router to Gate Controller</div>
<div class="description-paragraph" id="p-0404" num="0478">No messages are initiated by the Edge Router.</div>
<div class="description-paragraph" id="h-0078" num="0000">7.9 Edge Router to Edge Router</div>
<div class="description-paragraph" id="p-0405" num="0479">In order to prevent some types of theft of service fraud, it is necessary for the Edge Routers to synchronize the gates at opposite ends of a connection. In particular, a gate that is “committed” at one end of a connection, but not at the other, can be used as a high quality data connection, or can be used to fraudulently charge an unsuspecting customer for a lengthy connection.</div>
<div class="description-paragraph" id="p-0406" num="0480">Messages exchanged between the Edge Routers include GATEOPEN, and GATECLOSE. GATEOPEN is exchanged with the gate has resources committed to it, and GATECLOSE is exchanged when those resources are released. Timers within the gate implementation impose strict controls on the length of time these exchanges may occupy.</div>
<div class="description-paragraph" id="h-0079" num="0000">7.9.1 GATEOPEN</div>
<div class="description-paragraph" id="p-0407" num="0481">The GATEOPEN message is sent by the Edge Router to its corresponding Edge Router at the other end of a connection on receipt of the COMMIT message from the BTI. A sample message is:
</div> <ul> <li id="ul0118-0001" num="0000"> <ul> <li id="ul0119-0001" num="0482">GATEOPEN 21T6572; GATEID 17S63224; BANDWIDTH 53B,6 ms</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0408" num="0483">GATEID is the identification string for the remote gate, including the security code required.</div>
<div class="description-paragraph" id="p-0409" num="0484">BANDWIDTH is the bandwidth request received in the COMMIT message.</div>
<div class="description-paragraph" id="h-0080" num="0000">7.9.1.1 GATEOPEN Acknowledgment</div>
<div class="description-paragraph" id="p-0410" num="0485">On receipt of a GATEOPEN message, the Edge Router responds with a GATEOPENACK. A sample message is:
</div> <ul> <li id="ul0120-0001" num="0000"> <ul> <li id="ul0121-0001" num="0486">GATEOPENACK 21T6572 v1.0;
<br/>
7.9.1.2 GATEOPEN Error
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0411" num="0487">If some error occurs in the processing of a GATEOPEN, the Edge Router responds with GATEOPENNAK. Such a situation can occur when the remote gate times out and releases the gate before the commit sequence completes. A sample message is:
</div> <ul> <li id="ul0122-0001" num="0000"> <ul> <li id="ul0123-0001" num="0488">GATEOPENNAK 21T6572 v1.0; ERROR Invalid gate identifier</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0412" num="0489">ERROR gives an error message string, which could be displayed if the Gate Controller has some method to do so, and can be passed back to the BTI in a SETUPNAK message.</div>
<div class="description-paragraph" id="p-0413" num="0490">Other elements in the message are TBD.</div>
<div class="description-paragraph" id="h-0081" num="0000">7.9.2 GATECLOSE</div>
<div class="description-paragraph" id="p-0414" num="0491">The GATECLOSE message is sent by the Edge Router to its corresponding Edge Router at the other end of a connection on receipt of the RELEASE message from the BTI. The Edge Router releases any resources held by that gate, stops any unsolicited grants offered on the upstream channel, and frees the gate. A sample message is:
</div> <ul> <li id="ul0124-0001" num="0000"> <ul> <li id="ul0125-0001" num="0492">GATECLOSE 21T6583; GATEID 17S63224;</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0415" num="0493">GATEID is the identification string for the remote gate, including the security code required.</div>
<div class="description-paragraph" id="h-0082" num="0000">7.9.2.1 GATECLOSE Acknowledgment</div>
<div class="description-paragraph" id="p-0416" num="0494">On receipt of a GATECLOSE message, the Edge Router responds with a GATECLOSEACK. A sample message is:
</div> <ul> <li id="ul0126-0001" num="0000"> <ul> <li id="ul0127-0001" num="0495">GATECLOSEACK 21T6583 v1.0;
<br/>
7.9.2.2 GATECLOSE Error
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0417" num="0496">A GATECLOSE message always results in a response of GATECLOSEACK. If the GATEID parameter specifies an invalid gate, the Edge Router assumes the gate has already been closed.</div>
<div class="description-paragraph" id="h-0083" num="0000">7.10 Gate Controller to Gate Controller</div>
<div class="description-paragraph" id="p-0418" num="0497">Messages exchanged between the Gate Controllers include GCSETUP, GCREDIRECT, and GCSPLICE. All occur in situations where the Gate Controller realizes that it cannot complete a request due to the destination being served by a different Gate Controller. These messages package up all the internal state, ask the remote Gate Controller to complete the desired function, then respond with the updated state information. In an implementation of the Gate Controller it is likely that these messages will exist in some internal form in order to share the implementation of call termination services.</div>
<div class="description-paragraph" id="h-0084" num="0000">7.10.1 GCSETUP</div>
<div class="description-paragraph" id="p-0419" num="0498">The GCSETUP message is exchanged between Gate Controllers when different Gate Controllers serve the originating and terminating endpoints of a call. It is basically formed by packaging all the partial state information the originating Gate Controller has assembled, and requesting the terminating Gate Controller to complete the work necessary to initiate the connection.</div>
<div class="description-paragraph" id="p-0420" num="0499">A sample GCSETUP message is:
</div> <ul> <li id="ul0128-0001" num="0000"> <ul> <li id="ul0129-0001" num="0500">GCSETUP 4T93177 v1.0; DEST E164 9733608766; CALLER 9733608718 Bill Marshall;
        <ul> <li id="ul0130-0001" num="0501">CRV 21; SIGADDR 135.207.31.1:6000; DATAADDR 135.207.31.1:6002 2 2;</li> <li id="ul0130-0002" num="0502">REMGATEIP 135.207.31.1:7682; REMGATEID 17S63224;</li> <li id="ul0130-0003" num="0503">CODING 53B,6 ms,G.711; REFID 135.207.31.2:36123E5C:93178;</li> <li id="ul0130-0004" num="0504">BILLDATA 5123-0123-4567-8900/9733608718/9733608766;</li> <li id="ul0130-0005" num="0505">CINFO 135.207.31.2:7650/135.207.31.1:7682/17S63224/10.0.12.221:7685/10.0.12.221:7000-2-2/9733608718/21/10.0.12.221:7685</li> </ul>
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0421" num="0506">DEST is the destination address for this connection. Its format is the same as in the SETUP message received from the BTI, except that the E164 number, if present, is expanded from the local numbering plan of the customer to the global numbering plan.</div>
<div class="description-paragraph" id="p-0422" num="0507">CALLER is the caller-id and calling name of the originator of the connection. From the SETUP message received from the BTI, the originating Gate Controller expanded the E164 number to a global numbering plan, and looked up the calling name.</div>
<div class="description-paragraph" id="p-0423" num="0508">CRV is the Call Reference Value assigned by the originating BTI. Copied from the SETUP message.</div>
<div class="description-paragraph" id="p-0424" num="0509">SIGADDR is the IP address and port number the destination should use for BTI-BTI signaling messages. This is a global version of the address given in the SETUP message from the BTI, with name to ip-address translation done, and with any NAT/PAT server translation included.</div>
<div class="description-paragraph" id="p-0425" num="0510">DATAADDR is the IP address and port number the destination should use for data packets. This is a global version of the address given in the SETUP message from the BTI, with name and ip-address translation done, and with any NAT/PAT server translation included. The second and third parameters (optional) in this element give the number of consecutive ports used, and the alignment information needed for the starting port number.</div>
<div class="description-paragraph" id="p-0426" num="0511">REMGATEIP is the IP address and port number of the Edge Router that contains the gate to be used for this conversation. This is the destination address for all ER-ER communication.</div>
<div class="description-paragraph" id="p-0427" num="0512">REMGATEID is the gate identifier and security code for the gate within that Edge Router.</div>
<div class="description-paragraph" id="p-0428" num="0513">CODING is the offered encapsulation methods and coding styles offered by the call originator.</div>
<div class="description-paragraph" id="p-0429" num="0514">REFID is a unique identifier assigned by the originating Gate Controller, which will appear in all the Billing Records. The REFID is intended to be unique within a period of several months.</div>
<div class="description-paragraph" id="p-0430" num="0515">BILLDATA is the billing/accounting data indicating the charging arrangement for this conversation.</div>
<div class="description-paragraph" id="p-0431" num="0516">CINFO is a string generated by the originating Gate Controller that contains all the information needed for future enhanced services that may involve the call originator. This will be encrypted and given to the destination BTI to store. The format is a list of many items separated by slashes, or which the first is the ip address and port of the Gate Controller that built the string. Subsequent items in this string include the address/port of the Edge Router, gate identifier, signaling endpoint address, data endpoint address, the originator's call reference value, and the originator's address for initial call signaling.</div>
<div class="description-paragraph" id="h-0085" num="0000">7.10.1.1 GCSETUP Acknowledgment</div>
<div class="description-paragraph" id="p-0432" num="0517">When the terminating Gate Controller has completed the call, it packages up all its assembled state information and passes it back to the originating Gate Controller in the GCSETUPACK message.</div>
<div class="description-paragraph" id="p-0433" num="0518">A sample GCSETUPACK message is:
</div> <ul> <li id="ul0131-0001" num="0000"> <ul> <li id="ul0132-0001" num="0519">GCSETUPACK 4T93177 v1.0; CRV 3712;
        <ul> <li id="ul0133-0001" num="0520">SIGADDR 135.207.22.1:6142; DATAADDR 135.207.22.1:6146 2 2;</li> <li id="ul0133-0002" num="0521">REMGATEIP 135.207.22.1:7682; REMGATEID 21S11018;</li> <li id="ul0133-0003" num="0522">CODING 53B,6 ms,G.711;</li> <li id="ul0133-0004" num="0523">CINFO 135.207.31.2:7650/135.207.22.1:7682/21S11018/10.3.7.151:7685/10.3.7.151:7000-2-2/9733608766/3712/10.3.7.151:7685</li> </ul>
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0434" num="0524">CRV is the Call Reference Value assigned by the destination BTI for this conversation. It is passed transparently from the SETUPACK message from the destination BTI.</div>
<div class="description-paragraph" id="p-0435" num="0525">SIGADDR is the IP address and port number the originator should use for BTI-BTI signaling messages. This is a global version of the address given in the SETUPACK message from the terminating BTI, with name to ip-address translation done, and with any NAT/PAT server translation included.</div>
<div class="description-paragraph" id="p-0436" num="0526">DATAADDR is the IP address and port number the originator should use for data packets. This is a global version of the address given in the SETUPACK message from the terminating BTI, with name and ip-address translation done, and with any NAT/PAT server translation included. The second and third parameters (optional) in this element give the number of consecutive ports used, and the alignment information needed for the starting port number.</div>
<div class="description-paragraph" id="p-0437" num="0527">REMGATEIP is the IP address and port number of the Edge Router that contains the gate to be used at the terminating end for this conversation. This is the destination address for all ER-ER communication.</div>
<div class="description-paragraph" id="p-0438" num="0528">REMGATEID is the gate identifier and security code for the gate within that Edge Router.</div>
<div class="description-paragraph" id="p-0439" num="0529">CODING is the encapsulation method and coding style accepted by the call destination.</div>
<div class="description-paragraph" id="p-0440" num="0530">REFID (optional) is a unique identifier assigned by the Gate Controller, which will appear in all the Billing Records. The REFID is intended to be unique within a period of several months. If this parameter appears, it will override the REFID assigned by the originating Gate Controller</div>
<div class="description-paragraph" id="p-0441" num="0531">BILLDATA (optional) is the billing/accounting data indicating the charging arrangement for this conversation. If this parameter appears, it will override the BILLDATA assigned by the originating Gate Controller.</div>
<div class="description-paragraph" id="p-0442" num="0532">CINFO is a string generated by the terminating Gate Controller that contains all the information needed for future enhanced services that may involve the terminating BTI. This will be encrypted and given to the originating BTI to store. The format is a list of many items separated by slashes, or which the first is the ip address and port of the Gate Controller that built the string. Subsequent items in this string include the address/port of the Edge Router, gate identifier, signaling endpoint address, data endpoint address, the destination's call reference value, and the destination's address for initial call signaling.</div>
<div class="description-paragraph" id="h-0086" num="0000">7.10.1.2 GCSETUP Error</div>
<div class="description-paragraph" id="p-0443" num="0533">If the terminating Gate Controller encounters an error while completing a connection request, it responds to the originating Gate Controller with a GCSETUPNAK message. A sample message is:
</div> <ul> <li id="ul0134-0001" num="0000"> <ul> <li id="ul0135-0001" num="0534">GCSETUPNAK 4T93177 v1.0; ERROR No gates available</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0444" num="0535">ERROR gives an error message string, which could be displayed if the Gate Controller has some method to do so, and can be passed back to the BTI in a SETUPNAK message.</div>
<div class="description-paragraph" id="p-0445" num="0536">Other elements in the message are TBD.</div>
<div class="description-paragraph" id="h-0087" num="0000">7.10.2 GCREDIRECT</div>
<div class="description-paragraph" id="p-0446" num="0537">The GCREDIRECT message is exchanged between Gate Controllers when different Gate Controllers serve the originating and terminating endpoints of a call. It is basically formed by packaging all the partial state information the first Gate Controller has assembled in its processing of a REDIRECT message, and requesting the terminating Gate Controller to complete the work necessary to redirect the connection.</div>
<div class="description-paragraph" id="p-0447" num="0538">A sample GCREDIRECT message is:
</div> <ul> <li id="ul0136-0001" num="0000"> <ul> <li id="ul0137-0001" num="0539">GCREDIRECT 0T5081 v1.0; DEST E164 9733608800;
        <ul> <li id="ul0138-0001" num="0540">BILLDATA 5123-0123-4567-8900/9733608718/9733608800;</li> <li id="ul0138-0002" num="0541">CINFO 135.207.31.2:7650/135.207.31.1:7682/17563224/10.0.12.221:7685/10.0.12.221:7000-2-2/9733608718/21/10.0.12.221:7685</li> </ul>
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0448" num="0542">DEST is the destination address for this new connection. Its format is the same as in the SETUP message received from the BTI, except that the E164 number, if present, is expanded from the local numbering plan of the customer to the global numbering plan.</div>
<div class="description-paragraph" id="p-0449" num="0543">BILLDATA is the billing/accounting data indicating the charging arrangement for the additional segment of this connection.</div>
<div class="description-paragraph" id="p-0450" num="0544">CINFO is a string generated by the originating Gate Controller that contains all the information needed for future enhanced services that may involve the call originator. This will be encrypted and given to the destination BTI to store. The format is a list of many items separated by slashes, or which the first is the ip address and port of the Gate Controller that built the string. Subsequent items in this string include the address/port of the Edge Router, gate identifier, signaling endpoint address, data endpoint address, the originator's call reference value, and the originator's address for initial call signaling.</div>
<div class="description-paragraph" id="h-0088" num="0000">7.10.2.1 GCREDIRECT Acknowledgment</div>
<div class="description-paragraph" id="p-0451" num="0545">If the terminating Gate Controller is able to successfully process a GCREDIRECT request, it responds with a GCREDIRECTACK message. A sample message is:
</div> <ul> <li id="ul0139-0001" num="0000"> <ul> <li id="ul0140-0001" num="0546">GCREDIRECTACK 0T5081 v1.0; REMGATEIP 135.207.22.1:7682; REMGATEID 21S11018</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0452" num="0547">REMGATEIP is the IP address and port number of the Edge Router that is holding a gate for the previous connection that has now been redirected.</div>
<div class="description-paragraph" id="p-0453" num="0548">REMGATEID is the identification string for the gate at that Edge Router for the previous connection.</div>
<div class="description-paragraph" id="h-0089" num="0000">7.10.2.2 GCREDIRECT Error</div>
<div class="description-paragraph" id="p-0454" num="0549">If the terminating Gate Controller encounters an error while completing a redirect request, it responds to the originating Gate Controller with a GCREDIRECTNAK message. A sample message is:
</div> <ul> <li id="ul0141-0001" num="0000"> <ul> <li id="ul0142-0001" num="0550">GCREDIRECTNAK 0T5081 v1.0; ERROR No gates available</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0455" num="0551">ERROR gives an error message string, which could be displayed if the Gate Controller has some method to do so, and can be passed back to the BTI in a NAK message.</div>
<div class="description-paragraph" id="p-0456" num="0552">Other elements in the message are TBD.</div>
<div class="description-paragraph" id="h-0090" num="0000">7.10.3 GCSPLICE</div>
<div class="description-paragraph" id="p-0457" num="0553">If the Gate Controller receiving a SPLICE request from a BTI is not the one that generated the CINFO1 string, it sends to that Gate Controller a GCSPLICE message. A sample message of this type is:
</div> <ul> <li id="ul0143-0001" num="0000"> <ul> <li id="ul0144-0001" num="0554">GCSPLICE 7T1019 v1.0;
        <ul> <li id="ul0145-0001" num="0555">CINFO1 135.207.31.2:7650/135.207.22.1:7682/9S1077/10.3 0.7.151:7685/10.3.7.151:7006-2-2/9733608766/3746/10.3 0.7.151:7685;</li> <li id="ul0145-0002" num="0556">CINFO2 135.207.31.2:7650/135.207.22.1:7682/5571731/10.3.7.150:7685/10.3.7.150:7000-2-2/9733608720/8839/10.3.7.150:7685</li> </ul>
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0458" num="0557">If the Gate Controller receiving the above GCSPLICE request is not the one that generated the CINFO2 string, it sends to that third Gate Controller another GCSPLICE message. A sample message of this second type is:
</div> <ul> <li id="ul0146-0001" num="0000"> <ul> <li id="ul0147-0001" num="0558">GCSPLICE 7T1021 v1.0;
        <ul> <li id="ul0148-0001" num="0559">CINFO2 135.207.31.2:7650/135.207.22.1:7682/5571731/10.3.7.150:7685/10.3.7.150:7000-2-2/9733608720/8839/10.3.7.150:7685;</li> <li id="ul0148-0002" num="0560">SIGADDR 135.207.22.1:6162; DATAADDR 135.207.22.1:6164 2 2; CRV 3746;</li> <li id="ul0148-0003" num="0561">REMGATEIP 135.207.22.1:7682; REMGATEID 9S1077;</li> <li id="ul0148-0004" num="0562">CODING 53B,6 ms,G.711; REFID 135.207.31.2:26124C90:7224;</li> <li id="ul0148-0005" num="0563">BILLDATA 6010-0203-0456-7890/9733608766/BRIDGE;</li> <li id="ul0148-0006" num="0564">CINFO 135.207.31.2:7650/135.207.22.1:7682/9S1077/10.3 0.7.151:7685/10.3.7.151:7006-2-2/9733608766/3746/10.3 0.7.151:7685</li> </ul>
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0459" num="0565">CINFO1 is the string previously supplied by a Gate Controller, which tells that Gate Controller various pieces of information about the first endpoint. This string was stored encrypted by the BTI that originated the SPLICE request. Either CINFO1 must be present in the message, or the set of fields that are determined from the Gate Controller unpacking CINFO1: SIGADDR, DATAADDR, CRV, REMGATEIP, REMGATEID, CODING, REFID, and BILLDATA. With these fields present, the CINFO1 string is attached as CINFO.</div>
<div class="description-paragraph" id="p-0460" num="0566">CINFO2 is the string previously supplied by a Gate Controller, which tells that Gate Controller various pieces of information about the second endpoint. This string was stored encrypted by the BTI that originated the SPLICE request.</div>
<div class="description-paragraph" id="p-0461" num="0567">SIGADDR is the IP address and port number the second endpoint should use for BTI-BTI signaling messages. This is a global version of the address given in the SETUP/SETUPACK message from the first endpoint BTI, with name to ip-address translation done, and with any NAT/PAT server translation included.</div>
<div class="description-paragraph" id="p-0462" num="0568">DATAADDR is the IP address and port number the second endpoint should use for data packets. This is a global version of the address given in the SETUP/SETUPACK message from the first endpoint BTI, with name and ip-address translation done, and with any NAT/PAT server translation included. The second and third parameters (optional) in this element give the number of consecutive ports used, and the alignment information needed for the starting port number.</div>
<div class="description-paragraph" id="p-0463" num="0569">REMGATEIP is the IP address and port number of the Edge Router that contains the gate to be used at the first BTI's end for this conversation. This is the destination address for all ER-ER communication.</div>
<div class="description-paragraph" id="p-0464" num="0570">REMGATEID is the gate identifier and security code for the gate within that Edge Router.</div>
<div class="description-paragraph" id="p-0465" num="0571">CODING is the encapsulation method and coding style accepted by the first BTI.</div>
<div class="description-paragraph" id="p-0466" num="0572">REFID is a unique identifier assigned by the Gate Controller, which will appear in all the Billing Records. The REFID is intended to be unique within a period of several months.</div>
<div class="description-paragraph" id="p-0467" num="0573">BILLDATA is the billing/accounting data indicating the charging arrangement for this conversation.</div>
<div class="description-paragraph" id="p-0468" num="0574">CINFO is a string generated by a Gate Controller that contains all the information needed for future enhanced services that may involve that BTI. This will be encrypted and given to the other BTI to store. The format is a list of many items separated by slashes, or which the first is the ip address and port of the Gate Controller that built the string. Subsequent items in this string include the address/port of the Edge Router, gate identifier, signaling endpoint address, data endpoint address, the destination's call reference value, and the destination's address for initial call signaling.</div>
<div class="description-paragraph" id="h-0091" num="0000">7.10.3.1 GCSPLICE Acknowledgment</div>
<div class="description-paragraph" id="p-0469" num="0575">If the terminating Gate Controller is able to successfully process a GCSPLICE request, it responds with a GCSPLICEACK message. If the GCSPLICE request was of the first type above, a sample acknowledgement message is:
</div> <ul> <li id="ul0149-0001" num="0000"> <ul> <li id="ul0150-0001" num="0576">GCSPLICEACK 7T1019 v1.0;</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0470" num="0577">If the GCSPLICE request was of the second type above, a sample acknowledgment message is:
</div> <ul> <li id="ul0151-0001" num="0000"> <ul> <li id="ul0152-0001" num="0578">GCSPLICEACK 7T1021 v1.0;
        <ul> <li id="ul0153-0001" num="0579">SIGADDR 135.207.22.1:6166; DATAADDR 135.207.22.1:6168 2 2;</li> <li id="ul0153-0002" num="0580">CODING 53B,6 ms,G.711;</li> <li id="ul0153-0003" num="0581">REMGATEIP 135.207.22.1:7682; REMGATEID 5S71731; CRV 8839;</li> <li id="ul0153-0004" num="0582">REFID 135.207.31.2:26124C90:7224;</li> <li id="ul0153-0005" num="0583">BILLDATA 6010-0203-0456-7890/9733608720/9733608766;</li> <li id="ul0153-0006" num="0584">CINFO 135.207.31.2:7650/135.207.22.1:7682/5S71731/10.3.7.150:7685/10.3.7.150:7000-2-2/9733608720/8839/10.3.7.150:7685</li> </ul>
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0471" num="0585">SIGADDR is the IP address and port number the first endpoint should use for BTI-BTI signaling messages. This is a global version of the address given in the SETUP/SETUPACK message from the second endpoint BTI, with name to ip-address translation done, and with any NAT/PAT server translation included.</div>
<div class="description-paragraph" id="p-0472" num="0586">DATAADDR is the IP address and port number the first endpoint should use for data packets. This is a global version of the address given in the SETUP/SETUPACK message from the second endpoint BTI, with name and ip-address translation done, and with any NAT/PAT server translation included. The second and third parameters (optional) in this element give the number of consecutive ports used, and the alignment information needed for the starting port number.</div>
<div class="description-paragraph" id="p-0473" num="0587">REMGATEIP is the IP address and port number of the Edge Router that contains the gate to be used at the second BTI's end for this conversation. This is the destination address for all ER-ER communication.</div>
<div class="description-paragraph" id="p-0474" num="0588">REMGATEID is the gate identifier and security code for the gate within that Edge Router.</div>
<div class="description-paragraph" id="p-0475" num="0589">CODING is the encapsulation method and coding style accepted by the second BTI.</div>
<div class="description-paragraph" id="p-0476" num="0590">REFID (optional) is a unique identifier assigned by the Gate Controller, which will appear in all the Billing Records. The REFID is intended to be unique within a period of several months. If this parameter appears, it will override the REFID assigned by the originating Gate Controller</div>
<div class="description-paragraph" id="p-0477" num="0591">BILLDATA (optional) is the billing/accounting data indicating the charging arrangement for this conversation. If this parameter appears, it will override the BILLDATA assigned by the originating Gate Controller.</div>
<div class="description-paragraph" id="p-0478" num="0592">CINFO is a string generated by a Gate Controller that contains all the information needed for future enhanced services that may involve that BTI. This will be encrypted and given to the other BTI to store. The format is a list of many items separated by slashes, or which the first is the ip address and port of the Gate Controller that built the string. Subsequent items in this string include the address/port of the Edge Router, gate identifier, signaling endpoint address, data endpoint address, the destination's call reference value, and the destination's address for initial call signaling.</div>
<div class="description-paragraph" id="h-0092" num="0000">7.10.3.2 GCSPLICE Error</div>
<div class="description-paragraph" id="p-0479" num="0593">If the terminating Gate Controller encounters an error while completing a splice request, it responds to the originating Gate Controller with a GCSPLICENAK message. A sample message is:
</div> <ul> <li id="ul0154-0001" num="0000"> <ul> <li id="ul0155-0001" num="0594">GCSPLICENAK 4T93177 v1.0; ERROR No gates available</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0480" num="0595">ERROR gives an error message string, which could be displayed if the Gate Controller has some method to do so, and can be passed back to the BTI in a NAK message.</div>
<div class="description-paragraph" id="p-0481" num="0596">Other elements in the message are TBD.</div>
<div class="description-paragraph" id="h-0093" num="0000">7.11 Edge Router to Billing Event Collector</div>
<div class="description-paragraph" id="p-0482" num="0597">Messages sent by the Edge Router include CALLSTART, CALLEND, and CALLPARTIALEND. These messages are sent over a reliable transport mechanism, such as TCP/IP, which performs all of the flow control and error control needed to ensure the reliable receipt of the messages at the Billing Event Collector. The format of the messages is slightly different than other messages, since they are not transaction based.</div>
<div class="description-paragraph" id="p-0483" num="0598">These messages must also include a timestamp. It is assumed here that the timestamp will be added by the Billing Event Collector, who will perform its function in real-time. If, however, the Edge Routers are expected to accumulate event records for some longer period of time and send them in a burst, then the Edge Router will need to record the time of each event and the messages must include that information as well.</div>
<div class="description-paragraph" id="h-0094" num="0000">7.11.1 CALLSTART</div>
<div class="description-paragraph" id="p-0484" num="0599">Whenever an Edge Router allocates resources for a gate, it issues a CALLSTART event record to the Billing Event Recorder. A sample message is:
</div> <ul> <li id="ul0156-0001" num="0000"> <ul> <li id="ul0157-0001" num="0600">CALLSTART 135.207.31.2:36123E5C:93178
        <ul> <li id="ul0158-0001" num="0601">5123-4567-8900/9733608718/8733608766</li> <li id="ul0158-0002" num="0602">53B,6 ms</li> </ul>
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0485" num="0603">The parameters to this message are:
</div> <ul> <li id="ul0159-0001" num="0000"> <ul> <li id="ul0160-0001" num="0604">1) The unique reference ID for this call, which will be common in all billing records related to the call</li> <li id="ul0160-0002" num="0605">2) The billing data for this call, which consists of multiple sets of three items:
        <ul> <li id="ul0161-0001" num="0606">a) the account number to be charged for the call</li> <li id="ul0161-0002" num="0607">b) the source E.164 number for the call</li> <li id="ul0161-0003" num="0608">c) the termination E.164 number for the call</li> <li id="ul0161-0004" num="0609">d) the above three fields repeated as needed for multiple call segment</li> </ul>
</li> <li id="ul0160-0003" num="0610">3) The bandwidth resources used by this call.</li> <li id="ul0160-0004" num="0611">4)
<br/>
7.11.2 CALLEND
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0486" num="0612">Whenever an Edge Router releases resources for a gate, it issues a CALLEND event record to the Billing Event Recorder. Note that this does not occur when a call is placed on HOLD, since the resources are still reserved for future use. A sample message is:
</div> <ul> <li id="ul0162-0001" num="0000"> <ul> <li id="ul0163-0001" num="0613">CALLEND 135.207.31.2:36123E5C:93178
        <ul> <li id="ul0164-0001" num="0614">5123-4567-8900/9733608718/8733608766</li> <li id="ul0164-0002" num="0615">53B,6 ms</li> </ul>
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0487" num="0616">The parameters to this message are:
</div> <ul> <li id="ul0165-0001" num="0000"> <ul> <li id="ul0166-0001" num="0617">1) The unique reference ID for this call, which will be common in all billing records related to the call</li> <li id="ul0166-0002" num="0618">2) The billing data for this call, which consists of multiple sets of three items:
        <ul> <li id="ul0167-0001" num="0619">a) the account number to be charged for the call</li> <li id="ul0167-0002" num="0620">b) the source E.164 number for the call</li> <li id="ul0167-0003" num="0621">c) the termination E.164 number for the call</li> <li id="ul0167-0004" num="0622">d) the above three fields repeated as needed for multiple call segment</li> </ul>
</li> <li id="ul0166-0003" num="0623">3) The bandwidth resources used by this call.
<br/>
7.11.3 CALLPARTIALEND
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0488" num="0624">Whenever an Edge Router is instructed by a Gate Controller to releases resources at one end of a conversation, but told not to coordinate with the remote gate and release all the resources at both ends, it issues a CALLPARTIALEND event record to the Billing Event Recorder. A sample message is:
</div> <ul> <li id="ul0168-0001" num="0000"> <ul> <li id="ul0169-0001" num="0625">CALLPARTIALEND 135.207.31.2:36123 E5C:93178
        <ul> <li id="ul0170-0001" num="0626">5123-4567-8900/9733608718/8733608766</li> <li id="ul0170-0002" num="0627">53B,6 ms</li> </ul>
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0489" num="0628">The parameters to this message are:
</div> <ul> <li id="ul0171-0001" num="0000"> <ul> <li id="ul0172-0001" num="0629">1) The unique reference ID for this call, which will be common in all billing records related to the call</li> <li id="ul0172-0002" num="0630">2) The billing data for this call, which consists of multiple sets of three items:
        <ul> <li id="ul0173-0001" num="0631">a) the account number to be charged for the call</li> <li id="ul0173-0002" num="0632">b) the source E.164 number for the call</li> <li id="ul0173-0003" num="0633">c) the termination E.164 number for the call</li> <li id="ul0173-0004" num="0634">d) the above three fields repeated as needed for multiple call segment</li> </ul>
</li> <li id="ul0172-0003" num="0635">3) The bandwidth resources used by this call.
<br/>
7.12 Gate Controller to NAT/PAT Server
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0490" num="0636">Messages sent by the Gate Controller include NATENQ, and NATSETUP.</div>
<div class="description-paragraph" id="p-0491" num="0637">Inquiry messages to the NAT/PAT server have a common structure for message element names. The first letter of the type name is either “L” or “G”, indicating a request about a local or global address. The last portion of the type name is a number, which is used by the sender to match up responses with the requests. For example, a request message with a parameter GADDR3 will give a response with a parameter LADDR3, and a request message with a parameter LADDR7 will give a response with a parameter GADDR7. There is no requirement that the digit sequences in parameter names by consecutive, but they must be unique within the message.</div>
<div class="description-paragraph" id="h-0095" num="0000">7.12.1 NATENQ</div>
<div class="description-paragraph" id="p-0492" num="0638">A NATENQ message is sent by the Gate Controller to the NAT server to inquire about a possible entry in the translation tables, but without creating an entry if none currently exists.</div>
<div class="description-paragraph" id="p-0493" num="0639">A sample message is:
</div> <ul> <li id="ul0174-0001" num="0000"> <ul> <li id="ul0175-0001" num="0640">NATENQ 4T93174 v1.0; LADDR1 10.0.12.221:7685</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0494" num="0641">LADDRx/GADDRx is the local/global address and port number that the Gate Controller is asking about.</div>
<div class="description-paragraph" id="h-0096" num="0000">7.12.1.1 NATENQ Acknowledgment</div>
<div class="description-paragraph" id="p-0495" num="0642">The response to a NATENQ message gives the translations found in the tables for the specified addresses. If no entry was found, its element is not present in the response message. A sample NATENQACK message is:
</div> <ul> <li id="ul0176-0001" num="0000"> <ul> <li id="ul0177-0001" num="0643">NATENQACK 4T93174 v1.0; GADDR1 135.207.31.1:6000</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0496" num="0644">GADDRx/GADDRx is the global/local address and port number that the Gate Controller is asking about.</div>
<div class="description-paragraph" id="h-0097" num="0000">7.12.1.2 NATENQ Error</div>
<div class="description-paragraph" id="p-0497" num="0645">The only anticipated error that can occur in a NATENQ message is that the server does not perform a NAT/PAT function, and therefore does not recognize the request. A sample error response is:
</div> <ul> <li id="ul0178-0001" num="0000"> <ul> <li id="ul0179-0001" num="0646">NATENQNAK 4T93174 v1.0; ERROR Unrecognized request</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0498" num="0647">ERROR gives an error message string, which could be displayed if the Gate Controller has some method to do so. Otherwise it provides some useful debugging information. It can also be passed back as part of the error indication from the Gate Controller request.</div>
<div class="description-paragraph" id="p-0499" num="0648">Other elements in the NATENQNAK message are TBD.</div>
<div class="description-paragraph" id="h-0098" num="0000">7.12.2 NATSETUP</div>
<div class="description-paragraph" id="p-0500" num="0649">A NATSETUP message is sent by the Gate Controller to the NAT server to create entries in the translation tables. A sample message is:
</div> <ul> <li id="ul0180-0001" num="0000"> <ul> <li id="ul0181-0001" num="0650">NATSETUP 4T93175 v1.0; LADDR1 10.0.12.221:7685; LADDR2 10.0.12.221:7000 2 2</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0501" num="0651">LADDRx/GADDRx is the local/global address and port number that the Gate Controller desires entries to be established in the translation table. The second parameter, if present, gives the number of consecutive ports requested. The third parameter, if present, gives any alignment restrictions on the port number assigned.</div>
<div class="description-paragraph" id="h-0099" num="0000">7.12.2.1 NATSETUP Acknowledgment</div>
<div class="description-paragraph" id="p-0502" num="0652">The response to a NATSETUP message gives the translation entries either found or established in the translation tables. A sample NATSETUPACK message is:
</div> <ul> <li id="ul0182-0001" num="0000"> <ul> <li id="ul0183-0001" num="0653">NATSETUPACK 4T93175 v1.0; GADDR1 135.207.31.1:6000; GADDR2 135.207.31.1:6002 2</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0503" num="0654">GADDRx/GADDRx is the global/local address and port number that the Gate Controller asked to be established. The second parameter (if present) indicates the number of consecutive ports assigned.</div>
<div class="description-paragraph" id="h-0100" num="0000">7.12.2.2 NATSETUP Error</div>
<div class="description-paragraph" id="p-0504" num="0655">Any error encountered while creating NAT/PAT entries will result in a NATSETUPNAK message. A sample error response is:
</div> <ul> <li id="ul0184-0001" num="0000"> <ul> <li id="ul0185-0001" num="0656">NATSETUPNAK 4T93175 v1.0; ERROR Translation table full</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0505" num="0657">ERROR gives an error message string, which could be displayed if the Gate Controller has some method to do so. Otherwise it provides some useful debugging information. It can also be passed back as part of the error indication from the Gate Controller request.</div>
<div class="description-paragraph" id="p-0506" num="0658">Other elements in the NATSETUPNAK message are TBD.</div>
<div class="description-paragraph" id="h-0101" num="0000">7.13 NAT/PAT Server to Gate Controller</div>
<div class="description-paragraph" id="p-0507" num="0659">No messages are initiated by the NAT/PAT server.</div>
<div class="description-paragraph" id="h-0102" num="0000">8 Signaling Architecture Call Flows</div>
<div class="description-paragraph" id="p-0508" num="0660">In this section call flows are presented to show the signaling exchange for both basic telephony services as well as many CLASS and Custom Calling features. This section is substantially identical to the corresponding section of the great-grandparent U.S. patent application Ser. No. 09/366,208 filed Aug. 4, 1999, the grandparent U.S. patent application Ser. No. 10/852,775 filed May 25, 2004, and the parent U.S. patent application Ser. No. 11/888,196 filed Jul. 31, 2007, which are hereby incorporated by reference.</div>
<div class="description-paragraph" id="h-0103" num="0000">8.1 Call Flow Terminology</div>
<div class="description-paragraph" id="p-0509" num="0661">The following terminology describes signaling call flows that can be used by embodiments of the present invention. Symbols are used to represent parties involved in the call flow (e.g. Gate Controllers) and information that is exchanged (e.g. Call Parameters). Each of these is often followed by a subscript indicating which one specifically is being referenced. Common subscripts are O for originating, T for terminating, F for forwarding, B for bridging, and TR for transferring. For example, in a simple telephone conversation, BTI<sub>O </sub>refers to the originating BTI, and BTI<sub>T </sub>to the terminating BTI, and similarly for E.164<sub>T</sub>, ER<sub>O</sub>, ER<sub>T</sub>, GC<sub>O</sub>, GC<sub>T</sub>, etc.</div>
<div class="description-paragraph" id="p-0510" num="0662">All the messages and parameters are described in detail in the next section.</div>
<div class="description-paragraph" id="h-0104" num="0000">Call Flow Symbols:</div>
<div class="description-paragraph" id="p-0511" num="0000">
</div> <ul>
<li id="ul0186-0001" num="0000">
<ul>
<li id="ul0187-0001" num="0663">BTI—Broadband Telephony Interface—or a telephony-equipped cable modem</li>
<li id="ul0187-0002" num="0664">ER—Edge Router: Cable modem termination system that serves the BTI</li>
<li id="ul0187-0003" num="0665">GID—Gate ID: Identification of the “gate” within the edge router assigned to this call.</li>
<li id="ul0187-0004" num="0666">GC—Gate Controller that serves the BTI</li>
<li id="ul0187-0005" num="0667">CI—Call Information: Information about the call through the network. This information includes the E.164 address, the IP address of the BTI, the IP address of the serving Gate Controller, the IP address of the serving ER, and the GID of the gate in the ER.</li>
<li id="ul0187-0006" num="0668">[CI](GC)—Encrypted information about the BTI that is given to others outside the network to store. It is signed and encrypted by the Gate Controller indicated.</li>
<li id="ul0187-0007" num="0669">BID—Billing ID: Identifier of the call for billing purposes; intended to be unique not only within the entire network, but to not be reused for a significant period of time. Both Edge routers involved in a call report this identifier in the call detail records.</li>
<li id="ul0187-0008" num="0670">TID—Transaction ID: Identifier of a message; indended to only be locally unique for the duration of a message/response transaction.</li>
<li id="ul0187-0009" num="0671">E.164—Telephone number</li>
<li id="ul0187-0010" num="0672">CN—Directory name of caller</li>
<li id="ul0187-0011" num="0673">LA—local IP address (set when BTI powers on)</li>
<li id="ul0187-0012" num="0674">GA—global IP address (set via NAT when BTI begins a session)</li>
<li id="ul0187-0013" num="0675">PN—Port number used by BTIs for a particular connection</li>
<li id="ul0187-0014" num="0676">AI—Authentication Information, single string per subscriber, common across all lines served by one BTI. This string is signed and encrypted by a network server, and is verified by Gate Controllers for every transaction.</li>
<li id="ul0187-0015" num="0677">$—call accounting information, such as customer account number, to be included in billing information for the current call. Given to ER as part of the permission to open gate. In some cases, e.g. call forwarding, two separate account numbers will be included to indicate a split charging arrangement for the call. In addition to charging information, accounting information includes parameters that place bounds on the call that is to be established. Some parameters may include maximum call duration and transmission priority.</li>
<li id="ul0187-0016" num="0678">CP—Call parameters (e.g. compression standard) for this call. CP<sub>O </sub>are the parameters offered by the call originator, CP<sub>T </sub>are those accepted by the terminating system.</li>
<li id="ul0187-0017" num="0679">o—indicates that network address translation is done in the ER</li>
<li id="ul0187-0018" num="0680">ANN-INFO—Announcement Information: Parameter indicating to an announcement server which announcement to play.</li>
<li id="ul0187-0019" num="0681">CF—Flag that indicates call forwarding on all calls or busy is active.</li>
<li id="ul0187-0020" num="0682">T—Flag that indicates call transfer is active.</li>
<li id="ul0187-0021" num="0683">CTOR—Cut Through On Release Flag: Indicates that the Edge Router should cut through the call in the receive direction when the BTI reserves the bandwidth.
<br/>
SGCP Parameters:
</li>
<li id="ul0187-0022" num="0684">S-R—SGCP parameter indicating a connection should be opened in both the send and receive directions.</li>
<li id="ul0187-0023" num="0685">S-NR—SGCP parameter indicating a connection should be opened only in the send (upstream) direction.</li>
<li id="ul0187-0024" num="0686">NS-R—SGCP parameter indicating a connection should be opened in only the receive (downstream) direction.
<br/>
SS7 Symbols:
</li>
<li id="ul0187-0025" num="0687">IAM—Initial Address Message</li>
<li id="ul0187-0026" num="0688">ACM—Address Complete Message</li>
<li id="ul0187-0027" num="0689">E-ACM—Early Address Complete Message</li>
<li id="ul0187-0028" num="0690">ANM—Answer Message</li>
<li id="ul0187-0029" num="0691">REL—Release Message</li>
<li id="ul0187-0030" num="0692">RLC—Release Complete Message</li>
<li id="ul0187-0031" num="0693">SUS—Suspend Message</li>
<li id="ul0187-0032" num="0694">RES—Resume Message
<br/>
8.2 Basic Call Flows
<br/>
8.2.1 Connect
</li>
</ul>
</li>
</ul>
<div class="description-paragraph" id="p-0512" num="0695"> <figref idrefs="DRAWINGS">FIG. 6</figref> shows the call flow for a normal call setup. Call setup involves establishing an IP signaling and bearer channel between BTIs across a packet network. The signaling channel uses “better than best effort” IP transmission across the network. Signaling reliability is ensured within the application. In the access portion of the network (between the edge router [ER] and the BTI), the bearer channel uses an “unsolicited grant” as defined by the MCNS v1.1 to maintain a constant bit rate channel. The ER “colors” the “high QoS” bearer channel packets to give them higher priority than “best-effort QoS” packets over the backbone portion of the network (between the ERs).</div>
<div class="description-paragraph" id="p-0513" num="0696">Some of the aspects of the basic Connect call flow are:
</div> <ul> <li id="ul0188-0001" num="0000"> <ul> <li id="ul0189-0001" num="0697">Digit Collection—The BTI<sub>O </sub>needs to recognize when a complete telephone number is dialed so it can package the number in a SETUP message and send it on to GC<sub>O </sub>for translation.</li> <li id="ul0189-0002" num="0698">Network Address Translation (NAT) for the Originating BTI—The ER does network address translation between local (Net10) addresses for each of the BTIs and global addresses. Each ER is assigned a set of global addresses. The ER assigns a global address to a BTI when the BTI attempts to communicate outside of its local area, or when a Gate Controller requests that a global address be assigned to a BTI.</li> <li id="ul0189-0003" num="0699">BTI Authentication—GC<sub>O </sub>authenticates the BTI upon receipt of a SETUP message. The Authentication Information (AI) needs to be provisioned in the BTI at BTI registration. GC<sub>O </sub>also performs service-specific admission control. For instance, if a Gate Controller knew that a specific destination area was overloaded with traffic, it could block a call setup.</li> <li id="ul0189-0004" num="0700">Gate Allocation—GC<sub>O </sub>requests a gate be allocated in ER<sub>O </sub>for this call. ER<sub>O </sub>replies with a Gate ID (GID<sub>O</sub>) to be used for the call. GC<sub>O </sub>adds this information to the Call Information (CI<sub>O</sub>) record for this call.</li> <li id="ul0189-0005" num="0701">Billing Identifier (BID)—While processing an initial call attempt, the Gate Controller assigns a globally unique Billing Identifier (BID) to the call. Such a unique identifier could be, for example, the IP address of the Gate Controller, followed by a timestamp, followed by a call sequence number. It is intended that this identifier be unique over several billing cycles, and enable the billing system to correctly match all records related to a single call.</li> <li id="ul0189-0006" num="0702">Number Translation—The E.164T address is translated by the Gate Controllers to the local IP address of the terminating BTI and the terminating ER. If GC<sub>O </sub>cannot translate the E.164T address on its own, it identifies a Gate Controller (GC<sub>T</sub>) that can do the translation. GC<sub>O </sub>sends the GCSETUP message, with additional information in it, on to GC<sub>T </sub>for processing. This simplifies the security of the ER, in that it only accepts commands from a small group of well-known Gate Controllers.</li> <li id="ul0189-0007" num="0703">Accounting Information ($)—In addition to charging information (e.g. account number), accounting information includes parameters that place bounds on the call that is to be established. Some parameters may include maximum call duration and transmission priority. In several situations involving call forwarding, the charging for the call will be split among two or more subscribers. Thus the “$” parameter in messages may contain several account codes with information as to the proper allocation of charges to each.</li> <li id="ul0189-0008" num="0704">“Opening The Gate”—The Gate Controller gives permission for an ER to allow a BTI to set up an “unsolicited grant”. The ER also “colors” the bearer-channel packets so they have “high-QoS” to a specific destination address. If an ER does not receive the permission to “open the gate” for high-priority packets, it does not allow the unsolicited grant or the high-priority packets. This permission is based on a specific source IP address and a specific destination IP address, and bounds on the resources the endpoints can use. The account information ($) in the gate setup message to the ER provides the bounds on these resources.</li> <li id="ul0189-0009" num="0705">Call Information (CI<sub>O </sub>and CI<sub>T</sub>)—information about a BTI, including its E.164 address, its Gate Controller's address, its ER's address, and the GID within the ER. Each endpoint of a call receives this information about the other endpoint, signed and encrypted by the local Gate Controller to prevent unauthorized disclosure or tampering by the BTI. This call information is used later for Call Trace (*57), Call Return (*69), and in setting up Three-Way Calling.</li> <li id="ul0189-0010" num="0706">Capability Negotiation—The BTIs have the ability to negotiate Call Parameters (CP) (e.g. encoding) in the SETUP message exchange. If additional negotiation is needed, it can be accomplished before resource commitment is made.</li> <li id="ul0189-0011" num="0707">Access Resource Reservation—An MCNS unsolicited grant protocol is used to reserve a constant bit rate channel in the access portion of the network. The access reservation comes in two parts, which is required for the telephony application. In first step, the “reservation” ensures the bandwidth will be available when needed, but does not actually assign the bandwidth nor does it “open the gate.” The reservation is obtained prior to ringing the destination telephone. Only when the destination user answers does the second step, the “commitment,” allocate the bandwidth and start the billing for the call. To protect resources, only a certain number of outstanding reservations are allowed per BTI.</li> <li id="ul0189-0012" num="0708">Backbone Resource Reservation—Embodiments of the present invention allow for the possibility of a different backbone resource reservation protocol than that used for the access portion of the network. It is the job of the ER to process the access reservation message and translate it into the proper message sequence for backbone resources. When the ER acknowledges the reservation with an ACK message, it means that the access resources are available for the call and whatever backbone resources this CMTS needed to reserve to support the flow has been reserved. At this point it is safe to begin the ring phase. An example of backbone resource reservation is shown in Section 6.2.2.</li> <li id="ul0189-0013" num="0709">Commit—This is the second step of the access reservation sequence. The commitment is made when an actual connection is to be made and billing is started. The ER and the network previously reserved the resources, and held them for this particular conversation. The ER emits a call-detail-record to the billing system at this time.</li> <li id="ul0189-0014" num="0710">Gate Coordination—In order to avoid certain theft of service scenarios, the opening and closing of gates within the network needs to be coordinated between ERs. GATEOPEN is an ER to ER message indicating that the gate has opened on the far end of the call. Far end Call Parameters are passed to the BTI for it to check whether it agrees with the parameters that are in the far end gate.
<br/>
8.2.2 Backbone Reservation
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0514" num="0711"> <figref idrefs="DRAWINGS">FIG. 7</figref> shows an example signaling flow for reservation of resources in the segment of the network between the edge routers for a voice call. This is one potential model of backbone reservation; however, different approaches may achieve the same result. One principle that we desire to achieve is to separate the mechanism for access reservation from the backbone reservation. This leaves the BTI interaction with the ER independent of the backbone network between ERs.</div>
<div class="description-paragraph" id="p-0515" num="0712">We assume a model in which the resource reservation is initiated by a sender and only reserves resources for packets being generated by that sender i.e. reservations are unidirectional. This matches the forwarding model used in IP networks in which paths can be asymmetric. However, the RESERVE message used over the access network has different semantics: reserve bi-directional capacity over the access network.</div>
<div class="description-paragraph" id="p-0516" num="0713">Since, the end to end route between two edge routers may change during the duration of a call, we also assume that RESERVE messages are periodically transmitted from either end to refresh the reservation—this is not shown in the figure. The IP source address in the RESERVE message contains the source address of ER<sub>O</sub>. The IP destination address in the RESERVE message is that of BTI<sub>T</sub>. The reservation message identifies: GA<sub>O </sub>(BTI<sub>O</sub>'s global IP address), PN<sub>O </sub>(BTI<sub>O</sub>'s port number for this call), GA<sub>T </sub>(BTI<sub>T</sub>'s global IP address), PN<sub>T </sub>(BTI<sub>O</sub>'s port number for this call) as the owner of the reservation. After setting up the bi-directional access reservation, the ER sends a BACKBONERESERVE message through intermediate backbone routers towards BTI<sub>T</sub>. Routers that are incapable of processing the BACKBONERESERVE message forward them without any processing.</div>
<div class="description-paragraph" id="p-0517" num="0714">In this example, the receipt of the RESERVEACK to a BTI indicates that resources have been reserved in both the send and receive directions in the access channel, and in the send direction in the backbone.</div>
<div class="description-paragraph" id="h-0105" num="0000">8.2.3 Disconnect</div>
<div class="description-paragraph" id="p-0518" num="0715"> <figref idrefs="DRAWINGS">FIG. 8</figref> shows the call flow for a normal call termination. When a BTI detects on-hook, it sends an end-to-end HANGUP message to the other BTI and a RELEASE message to the ER. In response to the RELEASE command, the ER closes the gate and emits a CALLEND to the billing system that indicates the call has completed and that billing should stop.</div>
<div class="description-paragraph" id="p-0519" num="0716">Note that there are a number of error conditions that will cause this disconnect sequence, such as BTI failures, power failures, cable plant failures, and backbone network failures. In all cases, it is desirable to stop the billing at the end of the useful connection, and to not charge the customer for a (possibly lengthy) service outage.</div>
<div class="description-paragraph" id="h-0106" num="0000">8.2.4 Calls Terminating in the PSTN</div>
<div class="description-paragraph" id="p-0520" num="0717"> <figref idrefs="DRAWINGS">FIG. 9</figref> shows the call flow for a call originating from a BTI but terminating in the PSTN. In the call flow, GC<sub>T </sub>recognizes that E.164T terminates outside of the IP network. GC<sub>T </sub>identifies the appropriate SGW<sub>T </sub>and TGW<sub>T</sub>. GC<sub>T </sub>initiates a GATESETUP to ER<sub>T </sub>with the Cut Through On Reserve (CTOR) flag set to indicate that a one-way voice path from the PSTN to BTI<sub>O </sub>should be established once the reserve is requested. GC<sub>T </sub>then sends the SETUP to SGW<sub>T</sub>. SGW<sub>T </sub>allocates a trunk identified by the IP port number PN<sub>T </sub>on TGW<sub>T </sub>for the call. SGW<sub>T </sub>also looks at CP<sub>O </sub>to determine the call parameters that will be used for this call (CP<sub>T</sub>).</div>
<div class="description-paragraph" id="p-0521" num="0718">Upon receiving the SETUPACK from SGW<sub>T</sub>, GC<sub>T </sub>replies to GC<sub>O</sub>, including the CTOR flag. GC<sub>O </sub>sets up the gate on the originating end of the call including the CTOR flag indicating that ER<sub>O</sub>, should open the voice path toward BTI<sub>O </sub>on reserve. GC<sub>O </sub>also includes the CTOR flag on the SETUPACK message to BTI<sub>O </sub>so BTI<sub>O </sub>does not generate its own ringback, but uses the ringback from the far end of the network. If additional capability negotiation is needed, it can be done at this point.</div>
<div class="description-paragraph" id="p-0522" num="0719">Once the call parameters are known, SGW<sub>T </sub>uses the SGCP message CREATECONNECTION to inform TGW<sub>T </sub>about the potential call. Included in this message are all the parameters that TGW<sub>T </sub>needs to reserve the necessary bandwidth and to translate between the IP packets and the TDM trunk. Also included in this message is an SGCP NOTIFICATIONREQUEST, requesting TGW<sub>T </sub>to notify SGW<sub>T </sub>when the reservation is acknowledged by ER<sub>T</sub>. TGW<sub>T </sub>sends a reserve message requesting the appropriate QoS in the network for the call. The trunking gateway needs to send this reserve message (versus the SGW) since the reservation needs to be along the path of the bearer channel. Upon a successful reservation, TGW<sub>T </sub>sends the SGCP NOTIFY to SGW<sub>T</sub>. Once SGW<sub>T </sub>receives both the RING message from BTI<sub>O </sub>and the NOTIFY from TGW<sub>T</sub>, SGW<sub>T </sub>sends the SS7 Initial Address Message (IAM) into the PSTN to set up the connection between TGW<sub>T </sub>and the ultimate destination. Upon receipt of the SS7 Address Complete Message (ACM), indicating that the destination phone is available and ringing, SGW<sub>T </sub>sends BTI<sub>O </sub>the RINGBACK message and BTI<sub>O </sub>plays ringback tone it is receiving from the network to the customer.</div>
<div class="description-paragraph" id="p-0523" num="0720">When the destination phone goes off-hook, an SS7 Answer Message (ANM) is received by SGW<sub>T</sub>. SGW<sub>T </sub>sends the CONNECT back to BTI<sub>O </sub>and uses the SGCP message MODIFYCONNECTION to indicate to TGW<sub>T </sub>that it needs to change the connection to a two-way connection, and send the COMMIT into the network to open the gate in both directions.</div>
<div class="description-paragraph" id="p-0524" num="0721">There are special cases when SS7 messages are received that cause the call flow to change. Some of these cases are described below:
</div> <ul> <li id="ul0190-0001" num="0000"> <ul> <li id="ul0191-0001" num="0722">Early Address Complete Message (E-ACM)—When an E-ACM message is received from the SS7 network instead of ACM, the voice connection needs to be established in both directions (send and receive). One example of how this is used by the PSTN is to indicate when an 800 call is being routed to an IVR system to determine where the call should be ultimately routed. After the call is routed and the far end answers, SGW<sub>O </sub>receives an ANM.</li> <li id="ul0191-0002" num="0723">Busy—If either the PSTN network or the called party is busy, the SS7 network returns a busy indication with a cause code in response to the IAM. SGW<sub>O </sub>needs to send a BUSY message with a cause code in place of RINGBACK to BTI<sub>O </sub>so BTI<sub>O </sub>will play fast busy or slow busy to the customer.
<br/>
8.2.5 Calls Originating from the PSTN
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0525" num="0724"> <figref idrefs="DRAWINGS">FIG. 10</figref> shows the call flow for a call originating in the PSTN, but terminating in the IP telephony network. The IAM message is the first indication that a call is destined from the PSTN to a BTI. The IAM message is received by SGW<sub>O </sub>which subsequently sends a SETUP message to GC<sub>O</sub>. setup proceeds as normal through the IP network. The CTOR flag is not needed since ringback or terminating announcements will not be generated from the IP network.</div>
<div class="description-paragraph" id="p-0526" num="0725">The signaling flow is similar to when a call is destined for the PSTN (see previous section). SGCP messages are used between SGW<sub>O </sub>and TGW<sub>O</sub>.</div>
<div class="description-paragraph" id="h-0107" num="0000">8.2.6 Call Release to the PSTN</div>
<div class="description-paragraph" id="p-0527" num="0726"> <figref idrefs="DRAWINGS">FIG. 11</figref> shows the call flow for a normal release to the PSTN. This call flow assumes that the BTI originated the call. If the call originated in the PSTN, SGW<sub>T </sub>would send an SS7 Suspend (SUS) message. This indicates to the PSTN that the phone at the BTI went on-hook, but the call is not released until a timer expires (usually 14 seconds). If the phone goes off-hook before the timer expires, an SS7 Resume (RES) message is sent.</div>
<div class="description-paragraph" id="h-0108" num="0000">8.2.7 Call Release from the PSTN</div>
<div class="description-paragraph" id="p-0528" num="0727"> <figref idrefs="DRAWINGS">FIG. 12</figref> shows the call flow for a call released from the PSTN. The call flow assumes that the call originated in the PSTN.</div>
<div class="description-paragraph" id="h-0109" num="0000">8.2.8 E911 Emergency Service</div>
<div class="description-paragraph" id="p-0529" num="0728">To support E911 emergency calls, GC<sub>O </sub>must route the call to the E911 call center associated with the calling number. The E911 call center may be reached via a gateway or may be an E911 call center that is supported on the packet network. The originating phone number and additional information can be obtained by having the E911 call center send a SETUPNACK message to GC<sub>T </sub>as in the call flows for caller ID/calling name delivery. Otherwise, the call flows for call setup are unchanged.</div>
<div class="description-paragraph" id="p-0530" num="0729">The BTI originating a 911 call must not disconnect the call when the user hangs up. This requires BTI<sub>O </sub>to detect that the dialed number is 911 and to alter its local hangup processing accordingly. A call to an operator for assistance may be transferred by the operator to an E911 center. In this case, the gateway or end-system that the operator is connected to must send an end-to-end message to BTI<sub>O </sub>instructing it to alter its hangup processing. This message must be authenticated by BTI<sub>O </sub>as being sent by a trusted network entity before BTI<sub>O </sub>alters its hangup processing. Authentication is required so that an arbitrary endpoint cannot instruct a BTI to alter its hangup processing.</div>
<div class="description-paragraph" id="h-0110" num="0000">8.2.9 Terminating Announcements</div>
<div class="description-paragraph" id="p-0531" num="0730">In some cases when a call cannot be completed, the customer hears a terminating announcement. Terminating announcement handling may be invoked when the dialed number has changed or cannot be translated, or as a result of a network resource limitation (e.g., “trunk busy”) or network problem.</div>
<div class="description-paragraph" id="p-0532" num="0731">Since the BTI contains processing and storage, common terminating announcements may be handled locally by the BTI in response to an error indication. For example, common messages such as “The number you have dialed is not in service. Please check the number and dial again” or the “trunk busy” signal may be stored locally in the BTI. In the first case, GC<sub>O </sub>returns an error message to BTI<sub>O </sub>indicating that the dialed number cannot be translated. In the second case, a router returns an error message to BTI<sub>O </sub>as a result of an admission control failure during the processing of a COMMIT message. The error messages indicate to BTI<sub>O </sub>which announcement should be played.</div>
<div class="description-paragraph" id="p-0533" num="0732">Some services require the announcement to be customized, perhaps based on the originating number, dialed number, time-of-day, or administrative controls. Thus, in general, announcements are a function of conditions known to the Gate Controller. In this case, there are two options for supporting terminating announcements. The Gate Controller may send the announcement to the BTI as a data message to be played out by the BTI. Alternatively, the BTI may connect to a terminating announcement server. These alternatives may also be used to support the common terminating announcements described above.</div>
<div class="description-paragraph" id="p-0534" num="0733"> <figref idrefs="DRAWINGS">FIG. 13</figref> shows a call flow where the BTI connects to a terminating announcement server. Terminating announcement handling may be invoked either by GC<sub>O </sub>or GC<sub>T </sub>in response to a SETUP message. The Gate Controller routes the call to a terminating announcement server and interacts with the server to control the announcement that it plays. The call accounting information (“$”) that is used for the call indicates that the call is not billed.</div>
<div class="description-paragraph" id="h-0111" num="0000">8.2.10 CALEA Wiretapping</div>
<div class="description-paragraph" id="p-0535" num="0734">CALEA requires the ability to intercept (wiretap) calls from a subscriber line and to provide additional information associated with these calls, such as the dialed number, and the time and duration of the call. Given that the BTI is not considered to be a trusted device, support for CALEA wiretapping must be implemented within the network, and must not be detectable by any party participating in the call. Our solution to the problem requires the ER to be able to multicast information flowing from each party in the call to both the other party or parties, and an additional end-system or gateway (a “wiretap server”) that can deliver the bearer channel information to the authorities. This multicast capability requires every packet that matches a filter function to be routed to the wiretap server, in addition to being routed normally. The filter function is discussed below.</div>
<div class="description-paragraph" id="p-0536" num="0735">One proposed approach to the problem does not rely on per-connection processing in the ER to wiretap a line. In this approach, when the authorities ask that a line be wiretapped, an administrative system sends a message to the originating ER instructing it to multicast the bearer channel to the wiretap server. The filter specifies the local IP address of the BTI associated with the line that is being tapped, the address of the wiretap server, and it might additionally specify the port number associated with the bearer channel. However, since the port numbers associated with the bearer (voice) channel may be dynamically assigned by the originating and terminating BTI's, the administrative server is unable to specify this information. If the filter function does not contain the port number information, it would cause all packets associated with the BTI to be intercepted, which may not be desirable since these packets may include data packets that cannot legally be intercepted. Thus, this approach is possible in our architecture, but it may be desirable to have an approach that only intercepts the bearer channel without intercepting additional channels.</div>
<div class="description-paragraph" id="p-0537" num="0736">The preferred approach is to rely on the Gate Controller to support wiretapping. When the authorities ask that a line be tapped, the database record associated with the line is modified to indicate that the line should be tapped. When a SETUP message arrives at the Gate Controller (it may be either an originating Gate Controller or a terminating Gate Controller), the Gate Controller looks up the database record and notes that the line should be tapped. The Gate Controller sends a message containing the address of the wiretap server to the ER. This information may be included as part of the “gate open” message. The Gate Controller also sends a message containing the dialed number to the wiretap server. The ER sends messages at the beginning and the end of the call to the wiretap server. These additional messages provide the additional information required by CALEA. In this solution, only new calls may be wiretapped. Calls that exist before the wiretapping information is provisioned in the GC will not be multicast to the wiretap server.</div>
<div class="description-paragraph" id="h-0112" num="0000">8.2.11 Call Trace</div>
<div class="description-paragraph" id="p-0538" num="0737"> <figref idrefs="DRAWINGS">FIG. 14</figref> shows the call flow for Call Trace. BTI<sub>T </sub>(the recipient of the call that needs to be traced) sends a single TRACE message to GC<sub>T</sub>, containing its own authentication information, and the connection information received from GC<sub>T </sub>for the most recent incoming call. GC<sub>T </sub>verifies the connection information (CI) by decrypting and checking the signature. If valid, the E.164 number contained within CI is reported to law enforcement, along with the identity of the customer making the report.</div>
<div class="description-paragraph" id="h-0113" num="0000">8.2.12 Operator Break-In</div>
<div class="description-paragraph" id="p-0539" num="0738">Operator Break-In is a combination of the CALEA wiretapping described in Section 8.2.10 and Three-Way Calling described in Section 8.3.4. Call flows for operator break-in will be provided in future versions of this document.</div>
<div class="description-paragraph" id="h-0114" num="0000">8.2.13 Operator Services</div>
<div class="description-paragraph" id="p-0540" num="0739">Operator services will initially be supported for IP phone customers by going through a PSTN Gateway. In the future, operator services may be on the IP network.</div>
<div class="description-paragraph" id="h-0115" num="0000">8.2.14 Mid-Call Resource Change</div>
<div class="description-paragraph" id="p-0541" num="0740">In some cases, a call in progress may need to change the established call parameters. For instance, if a call is set up using a low-bit-rate compression (e.g. 16 kbps G.728) and after the call is answered the BTI detects a modem tone, the BTI needs to change the bearer channel to a non-compressed 64 kbps G.711 channel. <figref idrefs="DRAWINGS">FIG. 15</figref> shows the call flow of how this can be accomplished. Gate Controllers do not need to be involved in a mid-call resource change as long as the account information the Gate Controller delivered to the ER during call set up is consistent with the resource change request. For example, if the BTI requests a channel with higher bandwidth or higher priority than the account information allows, the ER would deny the request. As with the normal call set up, there is a two step—Reserve then Commit—process for changing call parameters mid-call.</div>
<div class="description-paragraph" id="h-0116" num="0000">8.3 Feature Call Flows</div>
<div class="description-paragraph" id="h-0117" num="0000">8.3.1 Call Forwarding</div>
<div class="description-paragraph" id="p-0542" num="0741">Call Forwarding service allows a call destined for one E.164 address to be redirected to another E.164 address. The redirection may happen on all calls, only on busy, only on no answer, or on a combination of either busy or no-answer. Call Forwarding is a popular service, and is used by other services (e.g. voice mail) to redirect calls. If a BTI is unavailable and call forwarding is active, all calls destined for the BTI should be forwarded.</div>
<div class="description-paragraph" id="p-0543" num="0742">At least three parties are involved in all types of Call Forwarding service:
</div> <ul> <li id="ul0192-0001" num="0000"> <ul> <li id="ul0193-0001" num="0743">The Originating Location (BTI<sub>O</sub>)—the location that places the call to be forwarded.</li> <li id="ul0193-0002" num="0744">The Terminating Location (BTI<sub>T</sub>)—the location that has Call Forwarding active.</li> <li id="ul0193-0003" num="0745">The Forwarding Location (BTI<sub>F</sub>)—the location that the calls are being forwarded to.</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0544" num="0746">Regardless of the type of Call Forwarding (All Calls, Busy, No Answer), the forwarding number may be specified by the customer on a per-use basis, or be pre-provisioned (specified when the customer signs up for Call Forwarding service). If the forwarding number is pre-provisioned, the BTI and the Gate Controller serving that customer stores the forwarding number. If the forwarding number is specified on a per-use basis, the customer dials a code (e.g. *72) and the forwarding number to activate Call Forwarding.</div>
<div class="description-paragraph" id="p-0545" num="0747">In all cases, the Originating Location must not receive the forwarding number. In the case of Call Forwarding—No Answer, the Originating Location may know that the call is being forwarded. <figref idrefs="DRAWINGS">FIG. 16</figref> shows the call flow for activating a per-use Call Forwarding service. The BTI recognizes that the customer dialed the code to active Call Forwarding, and prompts the customer for the forwarding telephone number. This information is sent to the Gate Controller in a PROFILE message. The Gate Controller validates that the forwarding number maps to either a BTI that the Gate Controller knows or to another Gate Controller. The Gate Controller checks to make sure the customer subscribes to Call Forwarding service, and if so activates the service and stores the forwarding number for later use.</div>
<div class="description-paragraph" id="p-0546" num="0748">The following sections describe the call flows for each of the types of Call Forwarding service for both when the BTI is available and when the BTI is unavailable.</div>
<div class="description-paragraph" id="h-0118" num="0000">8.3.1.1 Call Forwarding—All Calls</div>
<div class="description-paragraph" id="p-0547" num="0749"> <figref idrefs="DRAWINGS">FIG. 17</figref> shows the call flow for Call Forwarding—All Calls when the BTI is available. The first part of the call flow is the same as shown in <figref idrefs="DRAWINGS">FIG. 6</figref>: Connect Call Flow. When the SETUP message is received by the Terminating BTI, it recognizes that Call Forwarding—All Calls is active. It sends a special SETUPACK to the Terminating Gate Controller indicating that Call Forwarding is active. The Gate Controller recognizes the Call Forwarding response, closes the gate at the ER that it opened for this call (using the GATERELEASE message), and sends the forwarding number on to GC<sub>O </sub>along with account information so that the forwarded leg of the call can be billed to BTI<sub>T</sub>. The Originating Gate Controller sets up the call to the forwarding number as normal, except that billing information may be kept for both legs of the call.</div>
<div class="description-paragraph" id="p-0548" num="0750"> <figref idrefs="DRAWINGS">FIG. 18</figref> shows the call flow for Call Forwarding—All Calls when the Terminating BTI is not available. In this case, GC<sub>T </sub>times out on the BTI<sub>T </sub>SETUP message. The GC<sub>T </sub>checks the customer profile and determines that Call Forwarding is active and proceeds as if it got a Call Forwarding response from BTI<sub>T</sub>.</div>
<div class="description-paragraph" id="h-0119" num="0000">8.3.1.2 Call Forwarding—Busy</div>
<div class="description-paragraph" id="p-0549" num="0751"> <figref idrefs="DRAWINGS">FIG. 19</figref> shows the call flow for Call Forwarding—Busy when BTI<sub>T </sub>is available. The first part of the call flow is the same as shown in <figref idrefs="DRAWINGS">FIG. 6</figref>: Connect Call Flow. When the SETUP message is received by BTI<sub>T</sub>, it recognizes that the designated line is currently off-hook and that Call Forwarding—Busy is active. It sends a special SETUPACK to GC<sub>T </sub>indicating that Call Forwarding is active. GC<sub>T </sub>recognizes the Call Forwarding response. The rest of the call flow is identical to <figref idrefs="DRAWINGS">FIG. 17</figref>: Call Forwarding—All Calls/BTI Available.</div>
<div class="description-paragraph" id="p-0550" num="0752"> <figref idrefs="DRAWINGS">FIG. 20</figref> shows the call flow for Call Forwarding—Busy when the BTI is unavailable. This flow is identical to <figref idrefs="DRAWINGS">FIG. 18</figref>: Call Forwarding—All Calls/BTI Unavailable Call Flow.</div>
<div class="description-paragraph" id="h-0120" num="0000">8.3.1.3 Call Forwarding—No Answer</div>
<div class="description-paragraph" id="p-0551" num="0753"> <figref idrefs="DRAWINGS">FIG. 21</figref> shows the call flow for Call Forwarding—No Answer when BTI<sub>T </sub>is available. The first part of the call flow is the same as shown in <figref idrefs="DRAWINGS">FIG. 6</figref>: Connect Call Flow. BTI<sub>T </sub>recognizes the Call Forward-No Answer feature is active and times out after the correct number of rings. A RINGTIMEOUT message is sent to the originator to stop the ringback, and a REDIRECT message is sent to the GC<sub>T </sub>to start the forwarding operation. The REDIRECT message contains the new E.164<sub>F </sub>address.</div>
<div class="description-paragraph" id="p-0552" num="0754">GC<sub>T </sub>decrypts the call information, and retrieves the billing information for this subscriber. If the call forwarding or transfer feature is subscribed it passes the GCREDIRECT message back to the GC<sub>O </sub>with the appropriate billing information.</div>
<div class="description-paragraph" id="p-0553" num="0755">The REDIRECT messages serves two purposes, this call forwarding function and also a blind transfer function (transfer without consultation). Since the Gate Controller does not know which application is active, it must assume a data transfer is in progress and inform BTI<sub>O </sub>that it will be interrupted. This is done via the CALLHOLD/CALLHOLDACK exchange. If BTI<sub>O </sub>was in a talking state, BTI<sub>O </sub>tells ER<sub>O </sub>to temporarily suspend its resource reservation; then acknowledges the CALLHOLD command of the GC<sub>O</sub>. GC<sub>T </sub>then acknowledges to BTI<sub>T </sub>that the REDIRECT was successful.</div>
<div class="description-paragraph" id="p-0554" num="0756">At this point the GC<sub>O </sub>treats this call identically to the initial call, by translating E.164<sub>F </sub>into a Gate Controller address and passing a GCSETUP message to GC<sub>F</sub>. The actions of GC<sub>F</sub>, ER<sub>F</sub>, and BTI<sub>F </sub>are identical to those shown in <figref idrefs="DRAWINGS">FIG. 6</figref> for GC<sub>T</sub>, ER<sub>T</sub>, and BTI<sub>T</sub>.</div>
<div class="description-paragraph" id="p-0555" num="0757">When GC<sub>O </sub>receives the acknowledgement to its GCSETUP message, instead of performing a GATESETUP it modifies the settings of the already allocated gate via a GATEMODIFY command. When complete, the new destination information is passed to the BTI<sub>O </sub>via a TRANSFER message. GATEMODIFY and TRANSFER are identical to the messages used for 3-way calling and for call transfer.</div>
<div class="description-paragraph" id="p-0556" num="0758">After resources are reserved for this call, BTI<sub>O </sub>sends a RING command, and the response is either RINGBACK (if the new destination is onhook and now ringing) or CONNECT (if the new destination is ready now). The latter would typically be the case within interactive voice response systems. After the CONNECT message, the resources are committed and the communication path is opened.</div>
<div class="description-paragraph" id="p-0557" num="0759"> <figref idrefs="DRAWINGS">FIG. 22</figref> shows the call flow for Call Forwarding—No Answer when the BTI is unavailable. This flow is identical to <figref idrefs="DRAWINGS">FIG. 18</figref>: Call Forwarding—All Calls/BTI Unavailable Call Flow.</div>
<div class="description-paragraph" id="h-0121" num="0000">8.3.2 Caller ID/Calling Name Delivery</div>
<div class="description-paragraph" id="p-0558" num="0760">The following describes two alternatives for implementing Caller ID/Calling Name Delivery with embodiments of the present invention.</div>
<div class="description-paragraph" id="p-0559" num="0761">The first is to have BTI<sub>T </sub>request caller ID information upon receipt of the SETUP from the GC<sub>T</sub>. This request is sent to GC<sub>T</sub>, which recognizes the Caller ID flag and checks if the customer line has subscribed for Caller ID/Calling Name services. GC<sub>T </sub>returns the phone number (E.164<sub>O</sub>) and the Calling Name (CN<sub>o</sub>) of the call originator. Subsequently, BTI<sub>T </sub>returns a SETUPACK as usual. If the subscriber at BTI<sub>T </sub>subscribes to services such as Anonymous Call Rejection or Call Screening, then the SETUPACK may not be returned by BTI<sub>T</sub>. Finally, when BTI<sub>T </sub>rings the phone (assuming it is a simple “black phone” with the traditional Caller ID box), then the Caller ID and</div>
<div class="description-paragraph" id="p-0560" num="0762">Calling Name are presented to the Caller ID box between the 1<sup>st </sup>and 2<sup>nd </sup>ring. If the user's telephone is more intelligent, this information may be presented as a message that is interpreted and displayed. <figref idrefs="DRAWINGS">FIG. 23</figref> shows the call flow for this alternative.
</div> <ul> <li id="ul0194-0001" num="0763">1. Another alternative for implementing Caller ID/Calling Name Delivery is to have GC<sub>T </sub>check if BTI<sub>T </sub>subscribes to the service on receipt of every call. If so, the caller's phone number (E.164<sub>o</sub>) and the Calling name (CN<sub>o</sub>) are sent in the SETUP message to BTI<sub>T </sub>on every incoming call. The BTI can either accept (SETUPACK) or reject (SETUPNACK) the call based upon E.164<sub>o </sub>and CN<sub>o</sub>. This alternative does not require additional messaging between GC<sub>T </sub>and BTI<sub>T </sub>for achieving Caller ID/Calling Name Delivery services.
<br/>
8.3.3 Call Waiting
</li> </ul>
<div class="description-paragraph" id="p-0561" num="0764"> <figref idrefs="DRAWINGS">FIG. 24</figref> shows a call flow for Call Waiting, according to an embodiment of the present invention. Initially, there is a call in progress between the BTI<sub>O1 </sub>and BTI<sub>T</sub>. A second call from BTI<sub>O2 </sub>to BTI<sub>T </sub>is established up to the point of reserving access and backbone bandwidth. BTI<sub>O2 </sub>reserves the channel as normal, but BTI<sub>T </sub>uses a RERESERVE message to indicate that it does not need a new access reservation, but just needs to associate the new gate (GID<sub>T2</sub>) in the ER with the existing access reservation for gate (GID<sub>T1</sub>). “RING” and “RINGBACK” messages are exchanged between the new BTI<sub>O2 </sub>and BTI<sub>T</sub>. BTI<sub>T </sub>now inserts a “call waiting tone” into the original call in progress to indicate to the user that there is a second incoming call. When the user does a “flash-hook”, then BTI<sub>T </sub>sends a HOLD message to BTI<sub>O1 </sub>and receives an acknowledgment for this message. Subsequently, BTI<sub>T </sub>completes the call to BTI<sub>O2 </sub>by sending a CONNECT message. Instead of having another allocation of resources for BTI<sub>T </sub>for this new call, we go through a reallocation of existing resources. The BTI<sub>T </sub>sends a RECOMMIT message with the Gate IDs of the two calls (GID<sub>T1 </sub>and GID<sub>T2</sub>) so that ER<sub>T </sub>may reallocate the resources from the first to the second call. In addition, a new CALLSTART event is sent to the billing server. When BTI<sub>O1 </sub>gets the HOLD message, it requests ER<sub>O1 </sub>to suspend allocation of its resources on the MCNS channel using the HOLD message until a future COMMIT message is sent from BTI<sub>O1</sub>. BTI<sub>O1 </sub>sends periodic KEEPALIVE message both to ER<sub>O1 </sub>and BTI<sub>T </sub>to ensure that the bandwidth is not reallocated to other calls.</div>
<div class="description-paragraph" id="h-0122" num="0000">8.3.4 Three-way Calling</div>
<div class="description-paragraph" id="h-0123" num="0000">8.3.4.1 Three-Way Calling—Bridging In BTI</div>
<div class="description-paragraph" id="p-0562" num="0765"> <figref idrefs="DRAWINGS">FIG. 25</figref> shows the call flow for the simple Three-Way Calling alternative with bridging in BTI<sub>O</sub>. In the flow, a second call is set up as a totally new call using separate resources in BTI<sub>O</sub>, the access network, and the backbone network. When the customer wants to complete the three-way call (indicated by the second flash-hook), BTI<sub>O </sub>bridges the calls together.</div>
<div class="description-paragraph" id="p-0563" num="0766">This section describes the use of a bridge located on a server inside the network. <figref idrefs="DRAWINGS">FIG. 26</figref> illustrates the first steps of a three-way call. The customer starts with an existing call, either one he or she placed or one that he or she received. By flashing the switchhook, that call is placed on hold. A HOLD message is sent to the destination indicating this change, and HOLDACK is sent in response. Both ends then inform their ERs that the isochronous transmission will be temporarily halted, but to keep the committed resources, via the HOLD message to the ER. Periodic KEEPALIVE messages are sent to each end and the ERs to accomplish this.</div>
<div class="description-paragraph" id="p-0564" num="0767">BTI<sub>O </sub>then plays the originator dialtone, and receives the full E.164 address of the additional party to call. This new call proceeds as shown in <figref idrefs="DRAWINGS">FIG. 6</figref> for normal call setup. At the point of the resource reservation exchange, ER<sub>O </sub>has allocated two gates (the original one with the parameters of the first call, and the new one with parameters for this call), upstream access resources are reserved for one call, and the backbone has reserved resources for both of the calls. When the third party answers, the second call is established using the resources reserved for GID<sub>O2</sub>. This state is identical to that of call-waiting, when one call is on hold and the subscriber is talking on a second call. However, since the subscriber initiated the second call, instead of receiving that call, the later hookflash commands a three-way call instead of a switch back to the first conversation. <figref idrefs="DRAWINGS">FIG. 27</figref> shows the sequence of signaling messages exchanged in the conversion of two separate calls into one three-way call. BTI<sub>O </sub>allocates a conference bridge by creating a third connection to a special network server. The bridge server will take an arbitrary number of input streams and generate an output stream for each; each output is the sum of all inputs except for the contribution from the corresponding input. When the number of inputs exceeds a small number (e.g. 3), the bridge does silence detection on each input to reduce the accumulated noise.</div>
<div class="description-paragraph" id="p-0565" num="0768">Once the host establishes the connection to the bridge, each of the participants of the three-way call need to be informed of the new destination, and need to have their gates modified appropriately. This function is identical to that done for Call Forwarding with No Answer, and involves BTI<sub>O </sub>sending a REDIRECT message for each existing connection.</div>
<div class="description-paragraph" id="p-0566" num="0769">The REDIRECT function involves two steps. First is a GATEMODIFY message to the ER modifying the parameters of the gate. This message includes the new destination address for data packets, as well as new billing information. Second is a TRANSFER message to the BTI, telling it to switch to a new destination for sending and receiving packets. Before acknowledging this message, the BTI performs a resource reservation exchange with the indicated endpoint (in this case, the bridge) to ensure network resources are available.</div>
<div class="description-paragraph" id="p-0567" num="0770">The GATEMODIFY message sent to the ER includes charging information ($). Calls from each endpoint to the bridge involve split-charging; the originator of the call pays only for the equivalent call to his/her dialed destination, and the party making the three-way call pays for the extra segment to the bridge. This is similar to that done for Call Forwarding.</div>
<div class="description-paragraph" id="p-0568" num="0771">The GATEMODIFY message sent to the ER also includes a Billing Identifier, BID. This unique identifier is given to all of the ERs involved in the three-way call, so that all billing records produced can be matched later. The BID used for the call is the unique ID assigned for the BTI<sub>O </sub>to Bridge connection.</div>
<div class="description-paragraph" id="p-0569" num="0772">The TRANSFER message sent to the BTI includes updated CI<sub>B </sub>information, encrypted by the local GC. This information replaces the previous CI information. CI<sub>B </sub>contains sufficient information to allow one of the participants in this 3-way call to add another party and allocate an additional bridge; use of this CI<sub>B </sub>for a return-call or for call-trace will result in errors.</div>
<div class="description-paragraph" id="p-0570" num="0773">It is possible for one of the participants in a 3-way call, who also subscribes to the 3-way calling service, to add another party. The call flow is identical to <figref idrefs="DRAWINGS">FIG. 27</figref>, except that one of the endpoints is not a BTI but rather the first Bridge. The Bridge handles TRANSFER messages in the same way as the BTI, allowing this service to cascade.</div>
<div class="description-paragraph" id="p-0571" num="0774">This sequence assumes the Bridge is located within the network, and does not need global address or gates to be allocated. GC<sub>O </sub>is identified as the Gate Controller serving the bridge, and there is no ER and no need for upstream scheduling of access lines. If the bridge were instead located outside of the network, then additional exchanges would be required to establish the gates and allocation of upstream bandwidth. These exchanges would be identical to those for normal call establishment.</div>
<div class="description-paragraph" id="p-0572" num="0775">There are two separate cases for hangup sequences. If the originator of the 3-way call hangs up, it sends the RELEASE message to its local ER and a HANGUP message to the bridge. The bridge, sends HANGUP messages to the other two legs of the call and also GATECLOSE messages to their ERs. This sequence is shown in <figref idrefs="DRAWINGS">FIG. 28</figref>.</div>
<div class="description-paragraph" id="p-0573" num="0776">If a participant in the 3-way call disconnects, it is desired that the bridge be released and the call revert back to a normal two-party call. <figref idrefs="DRAWINGS">FIG. 20</figref> shows the sequence of messages needed to perform this function. The Bridge receives a HANGUP message from a participant BTI, and sends a SPLICE message to its GC, giving the connection information (CI) for the two call legs to be spliced together.</div>
<div class="description-paragraph" id="p-0574" num="0777">The GCs inform the ERs, via a GATEMODIFY command, of the new destination of the data packets, and inform the BTIs, via a TRANSFER command, of the new destination. In case of errors, such as when the resource reservation exchange fails to allocate backbone bandwidth for the direct connection, the bridge can stay involved in the call with the two remaining parties.</div>
<div class="description-paragraph" id="h-0124" num="0000">8.3.5 Call Transfer</div>
<div class="description-paragraph" id="p-0575" num="0778">There are two different call transfer services. Call Transfer With Consultation is a service very similar to Three-Way Calling except that when the originator of the three-way call disconnects, the remaining two parties can still talk. Call Transfer Without Consultation is similar to Call Forwarding, except the forwarding can be done after a call is established.</div>
<div class="description-paragraph" id="h-0125" num="0000">8.3.5.1 Call Transfer With Consultation</div>
<div class="description-paragraph" id="p-0576" num="0779">Call Transfer With Consultation is very similar to Three-Way Calling except that when the customer (or host) hangs up the phone, the call between the two participants can continue. Also billing continues as if both legs of the call are still in place.</div>
<div class="description-paragraph" id="p-0577" num="0780">Most of the call flows for setting up a Call Transfer With Consultation are identical to those for Three-Way Calling (<figref idrefs="DRAWINGS">FIG. 26</figref>, <figref idrefs="DRAWINGS">FIG. 27</figref>, and <figref idrefs="DRAWINGS">FIG. 29</figref>). The only call flow that is different is when a host disconnects. <figref idrefs="DRAWINGS">FIG. 30</figref> shows the call flow for Call Transfer With Consultation service when the host disconnects. As with Three-Way Calling, the call reverts to a simple two-way call between the two participants. However, the billing for the call continues as if it is a three-way call.</div>
<div class="description-paragraph" id="p-0578" num="0781">For the Call Transfer With Consultation call flow, the following events have preceeded the hangup of the host:
</div> <ul> <li id="ul0195-0001" num="0000"> <ul> <li id="ul0196-0001" num="0782">1) BTI<sub>T1 </sub>has originated a call to BTI<sub>O </sub>and billing records (BID<sub>T1/O</sub>) for this leg of the call are being generated by ER<sub>T1</sub>.</li> <li id="ul0196-0002" num="0783">2) BTI<sub>O </sub>has put BTI<sub>T1 </sub>on hold and set up a new call to BTI<sub>T2</sub>. The billing records (BID<sub>O/T2</sub>) for this leg of the call are being generated by ER<sub>O</sub>.</li> <li id="ul0196-0003" num="0784">3) BTI<sub>O </sub>has joined the two legs of the call into a three-way call using a network bridge.</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0579" num="0785">At the point when the host hangs up, the gate at the host's edge router (ER<sub>O</sub>) is closed and billing associated with that gate (BID<sub>O/T2</sub>) is terminated. GC<sub>O </sub>retrieves the information associated with this billing record (including the globally unique BID) from ER<sub>O </sub>using the GATEINFO request and transfers the billing information to one of the participant's ERs. The participant ER that receives this information (ER<sub>T2 </sub>in the call flow), generates a new billing record for the leg associated with BID<sub>O/T2</sub>. During bill processing, the two billing records for BID<sub>O/T2 </sub>are associated using the unique BID so the call can be billed properly.</div>
<div class="description-paragraph" id="h-0126" num="0000">8.3.5.2 Call Transfer without Consultation</div>
<div class="description-paragraph" id="p-0580" num="0786">As shown in <figref idrefs="DRAWINGS">FIG. 31</figref>, Call Transfer Without Consultation is very similar to Call Forwarding—No Answer.</div>
<div class="description-paragraph" id="h-0127" num="0000">8.3.6 Return Call</div>
<div class="description-paragraph" id="p-0581" num="0787">It is possible for GC<sub>O </sub>to implement the return call service by storing the number of the most recent incoming call (caller id) in the Gate Controller, and then returning the call on a SETUP request. However, this requires the Gate Controller to retain state associated for every telephone. It would be desirable to allow the end-system (e.g., BTI) to retain this state, simplifying the Gate Controller. Unfortunately, if the incoming call was from a subscriber that has blocked caller id, it is important to keep the caller id information private, hence it cannot be made available to the end-system.</div>
<div class="description-paragraph" id="p-0582" num="0788">The solution is for the GC to send the caller id information to the BTI in a digitally signed and encrypted form, with every SETUP request. When a user dials the *69 code to activate the return call service, BTI<sub>O </sub>includes the encrypted information in the SETUP request to GC<sub>O</sub>. If GC<sub>O </sub>successfully decrypts and validates the information, and the customer subscribes to Return Call service, it returns the call as if processing a normal SETUP request to the number associated with the most recent incoming call.</div>
</div>
</div>
</section><section itemprop="claims" itemscope="">
<h2>Claims (<span itemprop="count">20</span>)</h2>
<div html="" itemprop="content"><div class="claims" lang="EN" load-source="patent-office" mxw-id="PCLM180873694">
<claim-statement>The invention claimed is:</claim-statement>
<div class="claim"> <div class="claim" id="CLM-00001" num="00001">
<div class="claim-text">1. A method, comprising:
<div class="claim-text">receiving, by a server, a request to reserve a network resource;</div>
<div class="claim-text">reserving, by the server, a gate associated with the network resource;</div>
<div class="claim-text">monitoring, by the server, for a receipt of an acknowledgment message that confirms a reservation associated with the gate; and</div>
<div class="claim-text">sending, by the server, a confirmation message in a response to the receipt of the acknowledgement message, the confirmation message confirming the gate associated with the network resource.</div>
</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00002" num="00002">
<div class="claim-text">2. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising authorizing a bandwidth associated with the network resource.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00003" num="00003">
<div class="claim-text">3. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising authorizing a latency associated with the network resource.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00004" num="00004">
<div class="claim-text">4. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising incrementing a timer associated with the reservation.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00005" num="00005">
<div class="claim-text">5. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising failing to receive the acknowledgment message.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00006" num="00006">
<div class="claim-text">6. The method of <claim-ref idref="CLM-00005">claim 5</claim-ref>, further comprising denying the request to reserve the network resource.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00007" num="00007">
<div class="claim-text">7. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising configuring the network resource.</div>
</div>
</div> <div class="claim"> <div class="claim" id="CLM-00008" num="00008">
<div class="claim-text">8. A system, comprising:
<div class="claim-text">a processor; and</div>
<div class="claim-text">a memory device, the memory device storing instructions, the instructions when executed causing the processor to perform operations, the operations comprising:</div>
<div class="claim-text">receiving a request to reserve a network resource;</div>
<div class="claim-text">reserving a gate associated with the network resource;</div>
<div class="claim-text">monitoring for a receipt of an acknowledgment message that confirms a reservation associated with the gate; and</div>
<div class="claim-text">sending a confirmation message in a response to the receipt of the acknowledgement message, the confirmation message confirming the gate associated with the network resource.</div>
</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00009" num="00009">
<div class="claim-text">9. The system of <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein the operations further comprise authorizing a bandwidth associated with the network resource.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00010" num="00010">
<div class="claim-text">10. The system of <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein the operations further comprise authorizing a latency associated with the network resource.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00011" num="00011">
<div class="claim-text">11. The system of <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein the operations further comprise incrementing a timer associated with the reservation.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00012" num="00012">
<div class="claim-text">12. The system of <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein the operations further comprise failing to receive the acknowledgment message.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00013" num="00013">
<div class="claim-text">13. The system of <claim-ref idref="CLM-00012">claim 12</claim-ref>, wherein the operations further comprise denying the request to reserve the network resource.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00014" num="00014">
<div class="claim-text">14. The system of <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein the operations further comprise configuring the network resource.</div>
</div>
</div> <div class="claim"> <div class="claim" id="CLM-00015" num="00015">
<div class="claim-text">15. A memory device storing instructions that when executed cause a hardware processor to perform operations, the operations comprising:
<div class="claim-text">receiving a request to reserve a network resource;</div>
<div class="claim-text">reserving a gate associated with the network resource;</div>
<div class="claim-text">monitoring for a receipt of an acknowledgment message that confirms a reservation associated with the gate; and</div>
<div class="claim-text">sending a confirmation message in response to the receipt of the acknowledgement message, the confirmation message confirming the gate associated with the network resource.</div>
</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00016" num="00016">
<div class="claim-text">16. The memory device of <claim-ref idref="CLM-00015">claim 15</claim-ref>, wherein the operations further comprise authorizing a bandwidth associated with the network resource.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00017" num="00017">
<div class="claim-text">17. The memory device of <claim-ref idref="CLM-00015">claim 15</claim-ref>, wherein the operations further comprise authorizing a latency associated with the network resource.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00018" num="00018">
<div class="claim-text">18. The memory device of <claim-ref idref="CLM-00015">claim 15</claim-ref>, wherein the operations further comprise incrementing a timer associated with the reservation.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00019" num="00019">
<div class="claim-text">19. The memory device of <claim-ref idref="CLM-00015">claim 15</claim-ref>, wherein the operations further comprise failing to receive the acknowledgment message.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00020" num="00020">
<div class="claim-text">20. The memory device of <claim-ref idref="CLM-00019">claim 19</claim-ref>, wherein the operations further comprise denying the request to reserve the network resource.</div>
</div>
</div> </div>
</div>
</section>
                </article>
            </search-app>
        </body>
    </html>
    