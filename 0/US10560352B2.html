
    <html>
        <body>
            <search-app>
                <article class="result" itemscope="" itemtype="http://schema.org/ScholarlyArticle">
    <h1 itemprop="pageTitle">US10560352B2 - Subscriber-aware TWAMP data monitoring in computer networks 
        - Google Patents</h1><section itemprop="abstract" itemscope="">
<h2>Abstract</h2>
<div html="" itemprop="content"><abstract lang="EN" load-source="docdb" mxw-id="PA369681899" source="national office">
<div class="abstract">Techniques are described for performing subscriber aware two-way active measurement protocol (TWAMP) data session provisioning between two endpoints in a computer network. For example, the disclosed techniques include extending TWAMP control messaging to include a communication mode for negotiating subscriber-aware TWAMP data monitoring. If the communication mode is supported by both endpoints, a subscriber identifier is specified when a TWAMP data session is provisioned (negotiated) over the control session. The disclosed techniques further include extending TWAMP data messaging to include the subscriber identifier in each test packet for the data session. In this way, each of the endpoints may identify a subscriber corresponding to one or more received TWAMP test packets based on the subscriber identifier included in the received TWAMP test packets.</div>
</abstract>
</div>
</section><section itemprop="description" itemscope="">
<h2>Description</h2>
<div html="" itemprop="content"><div class="description" lang="EN" load-source="patent-office" mxw-id="PDES240112451">
<div class="description-paragraph" id="p-0002" num="0001">This application is a continuation of U.S. application Ser. No. 15/376,617 filed Dec. 12, 2016, the entire contents of which are incorporated by reference herein.</div>
<heading id="h-0001">TECHNICAL FIELD</heading>
<div class="description-paragraph" id="p-0003" num="0002">The disclosure relates to computer networks.</div>
<heading id="h-0002">BACKGROUND</heading>
<div class="description-paragraph" id="p-0004" num="0003">Over the last few decades, the Internet has grown exponentially from a small network comprising of few nodes to a worldwide pervasive network that services more than a billion users. Today, individual subscribers are not limited to running a few network sessions with voice and/or data downloads over the network. Instead, the extent of services utilized by subscribers varies widely from multimedia gaming, audio and video streaming, web services, voice over IP (VoIP), and the like. With new technology penetration, such as increased utilization of Internet of Things (IoT) and M2M (machine to machine) communications, the network services and the software applications that a given subscriber may require also varies from a few sessions to multiple sessions having concurrent flows. This number is growing rapidly every day as subscribers increasingly run multiple applications, services, transactions simultaneously. The increased amount and variety of subscriber sessions and packet flows create challenges for network service providers with respect to network performance, such as latency, delay, and jitter.</div>
<heading id="h-0003">SUMMARY</heading>
<div class="description-paragraph" id="p-0005" num="0004">In general, this disclosure is directed to techniques for performing subscriber-aware data monitoring of network performance using a two-way active measurement protocol (TWAMP) in a computer network. For example, the disclosed techniques include extending TWAMP control messaging to include a communication mode for negotiating subscriber-aware TWAMP data monitoring. If the communication mode is supported by both endpoints, a subscriber identifier is specified when a TWAMP data session is provisioned (negotiated) over the control session. The disclosed techniques further include extending TWAMP data messaging to include the subscriber identifier in each test packet for the data session. In this way, each of the endpoints may identify a subscriber corresponding to one or more received TWAMP test packets based on the subscriber identifier included in the received TWAMP test packets.</div>
<div class="description-paragraph" id="p-0006" num="0005">The techniques described herein may provide certain technical advantages. For example, the technique may more efficiently and accurately allow service providers to monitor key performance indicators (KPIs), such as latency, delay, jitter, call setup time, throughput, bandwidth for individual subscribers and subscriber profiles. This, in turn, may allow the service provider networks to better improve and/or optimize their network architecture and allocation of network resources for their subscribers. In addition, the network service provider may improve delivery of subscriber-aware network services, such as traffic detection functions (TDFs), deep packet inspection (DPI), content delivery services and the like. In one example, the subscriber-specific traffic flows may be sourced by actual subscriber devices such that the techniques described herein may be used to measure KPIs for actual subscriber traffic in real-time or pseudo real-time. As a second example, the subscriber-traffic flows may be sourced by one or more test devices for measuring KPIs for simulated subscriber traffic.</div>
<div class="description-paragraph" id="p-0007" num="0006">In one example, this disclosure is directed to a method comprising establishing a control connection between a two-way active measurement protocol (TWAMP) control client and a TWAMP server and negotiating, by the TWAMP control client and the TWAMP server over the control connection, a data session between a TWAMP session sender executed on a first network device and a TWAMP session reflector executed on a second network device, wherein negotiating the data session includes specifying a subscriber identifier to an individual subscriber of a service provider network. The method further comprises exchanging one or more TWAMP test packets for the data session between the TWAMP session sender and the TWAMP session reflector, each of the one or more TWAMP test packets including the subscriber identifier of the subscriber.</div>
<div class="description-paragraph" id="p-0008" num="0007">In another example, this disclosure is directed to a network device comprising a memory, and one or more processors in communication with the memory. The one or more processors execute a TWAMP control client and a TWAMP session sender and are configured to establish a control connection between the TWAMP control client and the TWAMP server and negotiate a data session between the TWAMP session sender and a TWAMP session reflector executed on a second network device, wherein negotiating the data session includes specifying a subscriber identifier for an individual subscriber of a service provider network. The processor is further configured to send the one or more TWAMP test packets for the data session to the TWAMP session reflector, each of the one or more TWAMP test packets including the subscriber identifier, and receive the one or more TWAMP test packets back from the TWAMP session reflector, each of the one or more TWAMP test packets including the subscriber identifier and at least one metric for the data session used to measure network performance between the first network device and the second network device.</div>
<div class="description-paragraph" id="p-0009" num="0008">In an additional example, this disclosure is directed to a network device comprising a memory, and one or more processors in communication with the memory. The one or more processors execute a TWAMP server and a TWAMP session reflector and are configured to establish a control connection between the TWAMP server and a TWAMP control client and receive, with the TWAMP server and from the TWAMP control client, a TWAMP session request for a data session between the TWAMP session reflector and a TWAMP session sender executed on another network device, wherein the TWAMP session request specifies a subscriber identifier to an individual subscriber of a service provider network. The processor is further configured to receive one or more TWAMP test packets for the data session by the TWAMP session reflector from the TWAMP session sender, each of the one or more TWAMP test packets including the subscriber identifier associated with the data session and send, by the TWAMP session reflector, the one or more TWAMP test packets back to the TWAMP session sender, each of the one or more TWAMP test packets including the subscriber identifier associated with the data session and at least one metric for the data session used to measure network performance between the first network device and the second network device.</div>
<div class="description-paragraph" id="p-0010" num="0009">The details of one or more examples are set forth in the accompanying drawings and the description below. Other features, objects, and advantages will be apparent from the description and drawings, and from the claims.</div>
<description-of-drawings>
<heading id="h-0004">BRIEF DESCRIPTION OF DRAWINGS</heading>
<div class="description-paragraph" id="p-0011" num="0010"> <figref idrefs="DRAWINGS">FIG. 1</figref> is a block diagram illustrating an example network system that performs subscriber-aware data monitoring using two-way active measurement protocol (TWAMP) in accordance with the examples described herein.</div>
<div class="description-paragraph" id="p-0012" num="0011"> <figref idrefs="DRAWINGS">FIG. 2</figref> is a block diagram illustrating an example TWAMP architecture including network devices configured to perform subscriber-aware TWAMP data session provisioning, in accordance with the techniques of this disclosure.</div>
<div class="description-paragraph" id="p-0013" num="0012"> <figref idrefs="DRAWINGS">FIG. 3</figref> is a diagram illustrating an example message sequence between a TWAMP control client and a TWAMP server, in accordance with the techniques of this disclosure.</div>
<div class="description-paragraph" id="p-0014" num="0013"> <figref idrefs="DRAWINGS">FIG. 4</figref> is a block diagram illustrating an example router configured to execute one or more TWAMP logical roles, in accordance with the techniques of this disclosure.</div>
<div class="description-paragraph" id="p-0015" num="0014"> <figref idrefs="DRAWINGS">FIG. 5</figref> is a block diagram illustrating an example network device configured to execute one or more TWAMP logical roles, in accordance with the techniques of this disclosure.</div>
<div class="description-paragraph" id="p-0016" num="0015"> <figref idrefs="DRAWINGS">FIGS. 6-11</figref> are conceptual diagrams illustrating example formats of TWAMP control messages between a TWAMP control client and a TWAMP server, in accordance with the techniques of this disclosure.</div>
<div class="description-paragraph" id="p-0017" num="0016"> <figref idrefs="DRAWINGS">FIGS. 12-13</figref> are conceptual diagrams illustrating example formats of TWAMP test packets for a subscriber-aware TWAMP data session between a TWAMP session sender and a TWAMP session reflector, in accordance with the techniques of this disclosure.</div>
<div class="description-paragraph" id="p-0018" num="0017"> <figref idrefs="DRAWINGS">FIGS. 14-15</figref> illustrates example format of a TWAMP reply message in accordance with the techniques described herein.</div>
<div class="description-paragraph" id="p-0019" num="0018"> <figref idrefs="DRAWINGS">FIG. 16</figref> is a flowchart illustrating an example operation of negotiating a subscriber-aware TWAMP data session, in accordance with the techniques of this disclosure.</div>
<div class="description-paragraph" id="p-0020" num="0019"> <figref idrefs="DRAWINGS">FIG. 17</figref> is a flowchart illustrating an example operation of exchanging TWAMP test packets for a subscriber-aware TWAMP data session between a TWAMP session sender executed on a first network device and a TWAMP session reflector executed on a second network device, in accordance with the techniques of this disclosure.</div>
</description-of-drawings>
<heading id="h-0005">DETAILED DESCRIPTION</heading>
<div class="description-paragraph" id="p-0021" num="0020"> <figref idrefs="DRAWINGS">FIG. 1</figref> is a block diagram illustrating an example network system that performs subscriber-aware data monitoring using two-way active measurement protocol (TWAMP) in accordance with the examples described herein. The example network system of <figref idrefs="DRAWINGS">FIG. 1</figref> includes a service provider network <b>2</b> that operates as a private network to provide packet-based network services to subscriber devices <b>16</b>. That is, service provider network <b>2</b> provides authentication and establishment of network access for subscriber devices <b>16</b> such that a subscriber device may begin exchanging data packets with public network <b>12</b>, which may be an internal or external packet-based network such as the Internet.</div>
<div class="description-paragraph" id="p-0022" num="0021">In the example of <figref idrefs="DRAWINGS">FIG. 1</figref>, service provider network <b>2</b> comprises access network <b>6</b> that provides connectivity to public network <b>12</b> via service provider core network <b>7</b> (hereinafter, “core network <b>7</b>”) and router <b>8</b>. Core network <b>7</b> and public network <b>12</b> provide packet-based services that are available for request and use by subscriber devices <b>16</b>. As examples, core network <b>7</b> and/or public network <b>12</b> may provide bulk data delivery, voice over Internet protocol (VoIP), Internet Protocol television (IPTV), Short Messaging Service (SMS), Wireless Application Protocol (WAP) service, or customer-specific application services. Public network <b>12</b> may comprise, for instance, a local area network (LAN), a wide area network (WAN), the Internet, a virtual LAN (VLAN), an enterprise LAN, a layer 3 virtual private network (VPN), an Internet Protocol (IP) intranet operated by the service provider that operates access network <b>6</b>, an enterprise IP network, or some combination thereof. In various examples, public network <b>12</b> is connected to a public WAN, the Internet, or to other networks. Public network <b>12</b> executes one or more packet data protocols (PDPs), such as IP (IPv4 and/or IPv6), X.25 or Point-to-Point Protocol (PPP), to enable packet-based transport of public network <b>12</b> services.</div>
<div class="description-paragraph" id="p-0023" num="0022">In general, subscriber devices <b>16</b> connect to gateway router <b>8</b> via access network <b>6</b> to receive connectivity to subscriber services for applications hosted by subscriber devices <b>16</b>. A subscriber may represent, for instance, an enterprise, a residential subscriber, or a mobile subscriber. Subscriber devices <b>16</b> may be, for example, personal computers, laptop computers or other types of computing devices positioned behind customer equipment (CE) <b>11</b>, which may provide local routing and switching functions. Each of subscriber devices <b>16</b> may run a variety of software applications, such as word processing and other office support software, web browsing software, software to support voice calls, video games, video conferencing, and email, among others. For example, subscriber device <b>16</b> may be a variety of network-enabled devices, referred generally to as “Internet-of-Things” (IoT) devices, such as cameras, sensors (S), televisions, appliances, etc. In addition, subscriber devices <b>16</b> may comprise mobile devices that access the data services of service provider network <b>2</b> via a radio access network (RAN) <b>6</b>. Example mobile subscriber devices include mobile telephones, laptop or desktop computers having, e.g., a 3G wireless card, wireless-capable netbooks, video game devices, pagers, smart phones, personal data assistants (PDAs) or the like.</div>
<div class="description-paragraph" id="p-0024" num="0023">A network service provider operates, or in some cases leases, elements of access network <b>6</b> to provide packet transport between subscriber devices <b>16</b> and router <b>8</b>. Access network <b>6</b> represents a network that aggregates data traffic from one or more of subscriber devices <b>16</b> for transport to/from core network <b>7</b> of the service provider. Access network <b>6</b> includes network nodes that execute communication protocols to transport control and user data to facilitate communication between subscriber devices <b>16</b> and router <b>8</b>. Access network <b>6</b> may include a broadband access network, a wireless LAN, a public switched telephone network (PSTN), a customer premises equipment (CPE) network, or other type of access network, and may include or otherwise provide connectivity for cellular access networks, such as a radio access network (RAN) (not shown). Examples include networks conforming to a Universal Mobile Telecommunications System (UMTS) architecture, an evolution of UMTS referred to as Long Term Evolution (LTE), mobile IP standardized by the Internet Engineering Task Force (IETF), as well as other standards proposed by the 3<sup>rd </sup>Generation Partnership Project (3GPP), 3<sup>rd </sup>Generation Partnership Project 2 (3GPP/2) and the WiMAX forum.</div>
<div class="description-paragraph" id="p-0025" num="0024">Router <b>18</b> may be a customer edge (CE) router, a provider edge (PE) router, or other network device between access network <b>6</b> and core network <b>7</b>. Core network <b>7</b> offers packet-based connectivity to subscriber devices <b>16</b> attached to access network <b>6</b> for accessing public network <b>12</b> (e.g., the Internet). Core network <b>7</b> may represent a public network that is owned and operated by a service provider to interconnect a plurality of networks, which may include access network <b>6</b>. Core network <b>7</b> may implement Multi-Protocol Label Switching (MPLS) forwarding and in such instances may be referred to as an MPLS network or MPLS backbone. In some instances, core network <b>7</b> represents a plurality of interconnected autonomous systems, such as the Internet, that offers services from one or more service providers. Public network <b>12</b> may represent the Internet. Public network <b>12</b> may represent an edge network coupled to core network <b>7</b> via a transit network <b>22</b> and one or more network devices, e.g., a customer edge device such as customer edge switch or router. Public network <b>12</b> may include a data center. Router <b>8</b> may exchange packets with service nodes <b>10</b> via virtual network <b>20</b>, and router <b>8</b> may forward packets to public network <b>12</b> via transit network <b>22</b>.</div>
<div class="description-paragraph" id="p-0026" num="0025">In examples of network <b>2</b> that include a wireline/broadband access network, router <b>8</b> may represent a Broadband Network Gateway (BNG), Broadband Remote Access Server (BRAS), MPLS PE router, core router or gateway, or Cable Modern Termination System (CMTS). In examples of network <b>2</b> that include a cellular access network as access network <b>6</b>, router <b>8</b> may represent a mobile gateway, for example, a Gateway General Packet Radio Service (GPRS) Serving Node (GGSN), an Access Gateway (aGW), or a Packet Data Network (PDN) Gateway (PGW). In other examples, the functionality described with respect to router <b>8</b> may be implemented in a switch, service card or another network element or component. In some examples, router <b>8</b> may itself be a service node.</div>
<div class="description-paragraph" id="p-0027" num="0026">A network service provider that administers at least parts of network <b>2</b> typically offers services to subscribers associated with devices, e.g., subscriber devices <b>16</b>, that access service provider network <b>2</b>. Services offered may include, for example, traditional Internet access, VoIP, video and multimedia services, and security services. As described above with respect to access network <b>6</b>, core network <b>7</b> may support multiple types of access network infrastructures that connect to service provider network access gateways to provide access to the offered services. In some instances, the network system may include subscriber devices <b>16</b> that attach to multiple different access networks <b>6</b> having varying architectures.</div>
<div class="description-paragraph" id="p-0028" num="0027">In general, any one or more of subscriber devices <b>16</b> may request authorization and data services by sending a session request to a gateway device such as router <b>18</b> or router <b>8</b>. In turn, router <b>18</b> may access a central server (not shown) such as an Authentication, Authorization and Accounting (AAA) server to authenticate the one of subscriber devices <b>16</b> requesting network access. Once authenticated, any of subscriber devices <b>16</b> may send subscriber data traffic toward core network <b>7</b> to access and receive services provided by public network <b>12</b>, and such packets may traverse router <b>8</b> as part of at least one packet flow. In some examples, router <b>18</b> may forward all authenticated subscriber traffic to public network <b>12</b>, and router <b>8</b> may apply services <b>15</b> and/or steer particular subscriber traffic to a data center <b>9</b> if the subscriber traffic requires services on service nodes <b>10</b>. Applications (e.g., service applications) to be applied to the subscriber traffic may be hosted on service nodes <b>10</b>.</div>
<div class="description-paragraph" id="p-0029" num="0028">For example, when forwarding subscriber traffic, router <b>8</b> may direct individual subscriber packet flows through services <b>15</b> executing on one or more service cards installed within router <b>9</b>. In addition, or alternatively, service provider network <b>2</b> includes a data center <b>9</b> having a cluster of service nodes <b>10</b> that provide an execution environment for the mostly virtualized network services. In some examples, each of service nodes <b>10</b> represents a service instance. Each of service nodes <b>10</b> may apply one or more services to traffic flows. As such, router <b>8</b> may steer subscriber packet flows through defined sets of services provided by service nodes <b>10</b>. That is, in some examples, each subscriber packet flow may be forwarded through a particular ordered combination of services provided by service nodes <b>10</b>, each ordered set being referred to herein as a “service chain.” As examples, services <b>15</b> and/or service nodes <b>10</b> may apply stateful firewall (SFW) and security services, deep packet inspection (DPI), carrier grade network address translation (CGNAT), traffic destination function (TDF) services, media (voice/video) optimization, Internet Protocol security (IPSec)/virtual private network (VPN) services, hypertext transfer protocol (HTTP) filtering, counting, accounting, charging, and/or load balancing of packet flows, or other types of services applied to network traffic.</div>
<div class="description-paragraph" id="p-0030" num="0029">In the example of <figref idrefs="DRAWINGS">FIG. 1</figref>, subscriber packet flows may be directed along a service chain that includes any of services <b>15</b> and/or services applied by service nodes <b>10</b>. Once processed at a terminal node of the service chain, i.e., the last service to be applied to packets flowing along a particular service path, the traffic may be directed to public network <b>12</b>.</div>
<div class="description-paragraph" id="p-0031" num="0030">Whereas a “service chain” defines one or more services to be applied in a particular order to provide a composite service for application to packet flows bound to the service chain, a “service tunnel” or “service path” refers to a logical and/or physical path taken by packet flows processed by a service chain along with the forwarding state for forwarding packet flows according to the service chain ordering. Each service chain may be associated with a respective service tunnel, and packet flows associated with each subscriber device <b>16</b> flow along service tunnels in accordance with a service profile associated with the respective subscriber. For example, a given subscriber may be associated with a particular service profile, which in turn is mapped to a service tunnel associated with a particular service chain. Similarly, another subscriber may be associated with a different service profile, which in turn is mapped to a service tunnel associated with a different service chain. In some examples, after router <b>18</b> has authenticated and established access sessions for the subscribers, router <b>18</b> or router <b>8</b> may direct packet flows for the subscribers along the appropriate service tunnels, thereby causing data center <b>9</b> to apply the requisite ordered services for the given subscriber. In some examples, SDN controller <b>14</b> may also provide a forwarding rule set to router <b>18</b> or router <b>8</b> for managing the forwarding path. In some examples, SDN controller <b>14</b> manages the forwarding path through all elements in data center <b>9</b> starting at router <b>8</b>.</div>
<div class="description-paragraph" id="p-0032" num="0031">In some examples, service nodes <b>10</b> may implement service chains using internally configured forwarding state that directs packets of the packet flow along the service chains for processing according to the identified set of service nodes <b>10</b>. Such forwarding state may specify tunnel interfaces for tunneling between service nodes <b>10</b> using network tunnels such as IP or Generic Route Encapsulation (GRE) tunnels, Network Virtualization using GRE (NVGRE), or by using VLANs, Virtual Extensible LANs (VXLANs), MPLS techniques, and so forth. In some instances, real or virtual switches, routers or other network elements that interconnect service nodes <b>10</b> may be configured to direct the packet flow to the service nodes <b>10</b> according to service chains.</div>
<div class="description-paragraph" id="p-0033" num="0032">In the example of <figref idrefs="DRAWINGS">FIG. 1</figref>, service provider network <b>2</b> comprises a software defined network (SDN) and network functions virtualization (NFV) architecture. SDN controller device <b>14</b> may provide a high-level controller for configuring and managing the routing and switching infrastructure of service provider network <b>2</b>. NFV orchestrator device <b>13</b> may provide a high-level orchestrator for configuring and managing virtualization of network services into service nodes <b>10</b> of data center <b>9</b>. In some instances, SDN controller <b>14</b> manages deployment of virtual machines (VMs) within the operating environment of data center <b>9</b>. For example, SDN controller <b>14</b> may interact with provider edge (PE) router <b>8</b> to specify service chain information, described in more detail below. For example, the service chain information provided by SDN controller <b>14</b> may specify any combination and ordering of services provided by service nodes <b>10</b>, traffic engineering information for tunneling or otherwise transporting packet flows along service paths, rate limits, Type of Service (TOS) markings or packet classifiers that specify criteria for matching packet flows to a particular service chain. Further example details of an SDN controller are described in PCT International Patent Application PCT/US13/44378, filed Jun. 5, 2013, the entire content of which is incorporated herein by reference.</div>
<div class="description-paragraph" id="p-0034" num="0033">Although illustrated as part of data center <b>9</b>, service nodes <b>10</b> may be network devices coupled by one or more switches or virtual switches of core network <b>7</b>. In one example, each of service nodes <b>10</b> may run as VMs in a virtual compute environment. Moreover, the compute environment may comprise a scalable cluster of general computing devices, such as x86 processor-based servers. As another example, service nodes <b>10</b> may comprise a combination of general purpose computing devices and special purpose appliances. As virtualized network services, individual network services provided by service nodes <b>10</b> can scale just as in a modern data center through the allocation of virtualized memory, processor utilization, storage and network policies, as well as horizontally by adding additional load-balanced VMs. In other examples, service nodes <b>10</b> may be gateway devices or other routers. In further examples, the functionality described with respect to each of service nodes <b>10</b> may be implemented in a switch, service card, or another network element or component.</div>
<div class="description-paragraph" id="p-0035" num="0034">As described herein, elements within network system <b>2</b> perform subscriber-aware data monitoring using two-way active measurement protocol (TWAMP). That is, TWAMP may be used within service provider network <b>2</b> to measure both one-way and two-way or round trip metrics of network performance, such as path connectivity, path delay, packet jitter, packet loss, packet re-ordering, and the like, on a per-subscriber basis between network devices, also referred to as hosts or endpoints. In general, a TWAMP measurement architecture includes at least two network devices that each support TWAMP and perform specific roles to start data sessions and exchange test packets for the data sessions. In the example network architecture illustrated in <figref idrefs="DRAWINGS">FIG. 1</figref>, subscriber-aware TWAMP as described herein may be used to measure key performance indicators for subscriber-specific traffic flows. In one example, the subscriber-specific traffic flows may be sourced by subscriber devices <b>16</b> such that the techniques described herein may be used to measure KPIs for real-time or pseudo real-time subscriber traffic. As a second example, the subscriber-traffic flows may be sourced by one or more test devices <b>21</b> for measuring KPIs for simulated subscriber traffic. In this example, the logical roles of a TWAMP control client and a TWAMP session sender are both performed by subscriber devices <b>16</b> or TDs <b>21</b>, and the logical roles of a TWAMP server and a TWAMP session reflector are both performed by router <b>8</b> or service nodes <b>10</b>.</div>
<div class="description-paragraph" id="p-0036" num="0035">In alternative TWAMP architectures, each of the logical roles may be executed on a different host or endpoint. In still other example architectures, the TWAMP control client may be executed on SDN controller <b>14</b> that acts as a distributed control plane for the first and/or second endpoints, e.g., subscriber devices <b>16</b>, router <b>8</b> or service node <b>10</b>A. Although described herein with respect to measuring network performance for network services, the extended subscriber-aware TWAMP described herein may also be applied to measure network performance unrelated to network services between any two endpoints, e.g., router <b>18</b> and router <b>8</b>.</div>
<div class="description-paragraph" id="p-0037" num="0036">As further described herein, the TWAMP control clients executing on subscriber devices <b>16</b> or TDs <b>21</b> and the TWAMP server executed on router <b>8</b> or service nodes <b>10</b> establish a control connection and use TWAMP control messaging to initiate, start, and stop TWAMP data sessions <b>24</b>′, <b>24</b>″ (collectively “TWAMP data sessions <b>24</b>”). That is, the techniques described in this disclosure extend TWAMP such that one or more subscriber-aware TWAMP data sessions <b>24</b> may be provisioned between any given subscriber device <b>16</b> or TD <b>21</b> and a second network device, such as router <b>8</b> and/or service nodes <b>10</b>. In addition, according to the techniques, the TWAMP control client executing on subscriber device <b>16</b> or TD <b>21</b> may optionally utilize the extended TWAMP to identify a set of services available from router <b>8</b> and/or service nodes <b>10</b> and, based on the set of services, may establish a TWAMP data session <b>24</b> as a service-specific TWAMP data session designed to test and monitor performance metrics for the specific service(s) as applied to particular subscriber flows. As described, TWAMP is extended to allow the requesting subscriber device <b>16</b> or TD <b>21</b> to specify a subscriber identifier (SUB-ID) and, optionally, a service identifier (SERVICE-ID), where the SUB-ID uniquely identifies the subscriber, such as an IP address for a network-enabled device or an IMSE/IMEI for a mobile device, and the SERVICE-ID corresponds to a particular service or combination of services provided by router <b>8</b> and/or service nodes <b>10</b>.</div>
<div class="description-paragraph" id="p-0038" num="0037">Upon receiving the modified request, the TWAMP server executing on router <b>8</b> or a service node <b>10</b> configures internal forwarding information to allow the TWAMP client on the requesting subscriber device <b>16</b> or TD <b>21</b> to test and monitor performance for specific subscriber traffic using TWAMP data session <b>24</b>. For example, once a data session <b>24</b> is established, a TWAMP session sender executed on the particular subscriber device <b>16</b> or TD <b>21</b> and the TWAMP session reflector executed on router <b>8</b> or service node <b>10</b> use TWAMP data messaging to exchange test packets for data session <b>24</b> that carry one or more metrics used to measure network performance for subscriber traffic flows.</div>
<div class="description-paragraph" id="p-0039" num="0038">The TWAMP session reflector within router <b>8</b> or service node <b>10</b> may, for example, strip data packets encapsulated within the test packets and forward the data packets for application of one or more network services. After the services are applied, the resultant packets are directed back to the TWAMP session reflector, encapsulated as TWAMP test packets and sent back to the TWAMP client executing on the particular subscriber device <b>16</b> or TD <b>21</b>. The TWAMP client extracts timestamps embedded within the TWAMP packets, thus allowing latency measures to be calculated for individual subscribers and, optionally, specific services or combinations of services applied to traffic flow for the particular subscribers. In some examples, data sessions <b>24</b> may be associated with a different network performance metrics and/or different subscribers. In other examples, each of the multiple data sessions may be associated with a different network service or combination of services, i.e., service chain provided by services <b>15</b> of router <b>8</b> or any of service nodes <b>10</b>.</div>
<div class="description-paragraph" id="p-0040" num="0039">In some examples, the metrics carried by TWAMP test packets may include one or more of timestamps for sending or receiving a test packet, error estimates for sending or receiving the test packet, a sequence number for sending the test packet, a time-to-live (TTL) value for the test packet, a keepalive packet data unit (PDU), and/or a count of serviced packets, bytes, or subscribers. The one-way and two-way network performance measurements may include keepalive or path connectivity, round trip time (RTT), path delay, packet jitter, packet re-ordering, packet loss, service latency measurements, or service load measurements based on the received metrics.</div>
<div class="description-paragraph" id="p-0041" num="0040">TWAMP is described in more detail in RFC 5357 (Hedayat, et al., “A Two-Way Active Measurement Protocol (TWAMP),” Internet Engineering Task Force (IETF), Network Working Group, RFC 5357, October 2008), the entire content of which is incorporated herein by reference. TWAMP is based on one-way active measurement protocol (OWAMP), which may be used to measure one-way metrics of network performance between network devices. OWAMP is described in more detail in RFC 4656 (Shalunov, et al., “A One-Way Active Measurement Protocol (OWAMP),” Internet Engineering Task Force (IETF), Network Working Group, RFC 4656, September 2006), the entire content of which is incorporated herein by reference.</div>
<div class="description-paragraph" id="p-0042" num="0041">Extensions to TWAMP to operate within a SDN and NFV architecture, in which a TWAMP control client is executed on a SDN controller, are described in more detail in U.S. application Ser. No. 14/755,961, filed Jun. 30, 2015, the entire content of which is incorporated herein by reference. Extensions to TWAMP to support selection and measurement of service key performance indicators (KPIs) are described in more detail in U.S. application Ser. No. 14/755,986, filed Jun. 30, 2015, the entire content of which is incorporated herein by reference. Techniques for performing service latency measurements using TWAMP is described in more detail in U.S. application Ser. No. 14/573,167, filed Dec. 17, 2014, the entire content of which is incorporated herein by reference. Additional details of example techniques for performing session identifier (“SID”)-based two-way active measurement protocol (TWAMP) data session provisioning between two endpoints in a computer network are described in India Application No. 201641033262, entitled “SESSION-IDENTIFIER BASED TWAMP DATA SESSION PROVISIONING IN COMPUTER NETWORKS,” the entire contents of which are incorporated herein by reference.</div>
<div class="description-paragraph" id="p-0043" num="0042">The disclosed techniques include extending TWAMP control messaging to include a communication mode for the subscriber-aware TWAMP data session provisioning. In this way, support for subscriber-aware TWAMP data session provisioning may be negotiated by the TWAMP control client executed on any of subscriber devices <b>16</b> and the TWAMP server executed on router <b>8</b> or a service node <b>10</b> during establishment of the control connection. The disclosed techniques further include extending TWAMP data messaging to include the subscriber identifier (SUB-ID) in each test packet for the data session. In this way, the TWAMP session sender executed on a given subscriber device <b>16</b> and the TWAMP session reflector executed on router <b>8</b> or service node <b>10</b> may associate received test packets for a data session <b>24</b> with a particular subscriber and, optionally, a particular set of one or more services (e.g., service chain) based on the SUB-ID included in the received test packets.</div>
<div class="description-paragraph" id="p-0044" num="0043">The disclosed techniques may provide certain technical advantages. For example, the subscriber aware technique may more efficiently and accurately allow service providers to monitor key performance indicators (KPIs), such as latency, delay, jitter, call setup time, throughput, bandwidth per session, etc. for individual subscribers for specific services. This, in turn, may allow the service provider networks to better improve and/or optimize their network architecture and allocation of network resources. In addition, the network service provider may improve delivery of subscriber aware network services, such as traffic detection functions (TDFs), deep packet inspection (DPI), content delivery services and the like.</div>
<div class="description-paragraph" id="p-0045" num="0044"> <figref idrefs="DRAWINGS">FIG. 2</figref> is a block diagram illustrating an example TWAMP architecture <b>26</b> including network devices configured to perform subscriber-aware TWAMP data session provisioning, in accordance with the techniques of this disclosure, so as to enable monitoring of network services at the subscriber level. In this example, TWAMP architecture <b>26</b> includes a first network device <b>28</b> and a second network device <b>30</b>.</div>
<div class="description-paragraph" id="p-0046" num="0045">In general, first network device <b>28</b> may be any device that sources subscriber traffic (e.g., test device <b>21</b> or subscriber device <b>16</b>), such as a laptop, computer, tablet, mobile device, camera, computer-enabled sensor, television, appliance or IoT device. Second network device <b>30</b> may comprise any device that processes the subscriber traffic and, in some cases, applies network services to subscriber packet flows, such as a router, e.g., router <b>8</b> from <figref idrefs="DRAWINGS">FIG. 1</figref>, any of service nodes <b>10</b> within data center <b>9</b>, a firewall, IDP device or other security device, switch or the like.</div>
<div class="description-paragraph" id="p-0047" num="0046">In the illustrated example of <figref idrefs="DRAWINGS">FIG. 2</figref>, first network device <b>28</b> is configured to execute both a TWAMP control client <b>32</b> and a TWAMP session sender <b>34</b>, and second network device <b>30</b> is configured to execute a TWAMP server <b>38</b>, a TWAMP session-reflector <b>40</b> and, optionally, network services <b>52</b>. TWAMP control client <b>32</b> and TWAMP session sender <b>34</b> may be connected via a communication link <b>46</b>. In the illustrated example where TWAMP control client <b>32</b> and TWAMP session sender <b>34</b> are executed on the same host, communication link <b>46</b> may comprise an internal communication link, such as a memory or bus. In other examples, where TWAMP control client <b>32</b> and TWAMP session sender <b>34</b> are executed on different hosts, communication link <b>46</b> may comprise an external communication link. Similarly, TWAMP server <b>38</b> and TWAMP session reflector <b>40</b> may be connected via a communication link <b>48</b>. In some examples, the different TWAMP logical roles or entities may communicate over either of communication links <b>46</b>, <b>48</b> using an Extensible Messaging and Presence Protocol (XMPP) interface or any other communication protocol.</div>
<div class="description-paragraph" id="p-0048" num="0047">In accordance with the techniques of this disclosure, first network device <b>28</b> and second network device <b>30</b> may be configured to perform subscriber-aware TWAMP data session provisioning. In the example illustrated in <figref idrefs="DRAWINGS">FIG. 2</figref>, TWAMP control client <b>32</b> and TWAMP server <b>38</b> establish control connection <b>42</b>. Control connection <b>42</b> may comprise a Transmission Control Protocol (TCP) connection such that subsequent control messages transmitted over control connection <b>42</b> comprise TCP packets. TWAMP control client <b>32</b> and TWAMP server <b>38</b> exchange control message over control connection <b>42</b> to negotiate data session <b>50</b> between TWAMP session sender <b>34</b> and TWAMP session reflector <b>40</b> for monitoring monitor key performance indicators (KPIs) at the subscriber level with respect to application of services <b>52</b> to subscriber packet flows.</div>
<div class="description-paragraph" id="p-0049" num="0048">As part of the negotiation process for data session <b>50</b>, TWAMP control client <b>32</b> and TWAMP server <b>38</b> perform an exchange <b>44</b> of subscriber identifier (SUB-ID) that uniquely identifies a subscriber associated with first network device <b>28</b>. In addition, TWAMP control client <b>32</b> may specify a SERVICE-ID that corresponds to a particular one of services <b>52</b> or combination of services <b>52</b> provided by second network device <b>30</b>.</div>
<div class="description-paragraph" id="p-0050" num="0049">Once TWAMP control client <b>32</b> starts data session <b>50</b>, TWAMP session sender <b>34</b> sends TWAMP test packets for data session <b>50</b> that include the SUB-ID to TWAMP session reflector <b>40</b>. TWAMP session reflector <b>40</b> uses the SUB-ID included in the TWAMP test packets received from TWAMP session sender <b>34</b> to identify a particular subscriber corresponding to the TWAMP test packets. TWAMP session reflector <b>40</b> receives the test packets over data session <b>40</b>, strips the TWAMP header so as to extract data packets from the test packets and forwards the data packets <b>54</b> to services <b>52</b> that has been negotiated for this particular test subscriber for application of one or more network services. After the services are applied to the subscriber packet flow, the resultant packets <b>56</b> are directed back to TWAMP session reflector <b>40</b>, encapsulated as TWAMP test packets including the SUB-ID and one or more metrics, and sent back to TWAMP session sender <b>34</b> executing on first network device <b>28</b>.</div>
<div class="description-paragraph" id="p-0051" num="0050">Upon receipt, TWAMP session sender <b>34</b> associates the TWAMP test packets with the subscriber based on the SUB-ID included in the TWAMP test packets. TWAMP control client <b>32</b>, or some other module executed by first network device <b>28</b>, may use the received metrics to compute the network performance measurements between first network device <b>28</b> and second network device <b>30</b>. For example, TWAMP control client <b>32</b> may extracts timestamps that were embedded within the TWAMP packets during the round trip, thus allowing a set of latency measures to be calculated for individual subscribers and specific services or combinations of services.</div>
<div class="description-paragraph" id="p-0052" num="0051">In the example illustrated in <figref idrefs="DRAWINGS">FIG. 2</figref>, first network device <b>28</b> executes both TWAMP control client <b>32</b> and TWAMP session sender <b>34</b>, and second network device <b>30</b> executes both TWAMP server <b>38</b> and TWAMP session-reflector <b>40</b>. In other examples, each of a TWAMP control client, a TWAMP session sender, a TWAMP server, and a TWAMP session reflector may be executed on separate hosts. In this example, the TWAMP control client and the TWAMP server establish a control connection, and the TWAMP control client may instruct the TWAMP session sender to negotiate a data session with the TWAMP session reflector. Once the TWAMP control client starts the data session, the TWAMP session sender sends the TWAMP test packets including the SUB-ID to the TWAMP session reflector over the data session for application of specific network services, and receives the TWAMP test packets back from the TWAMP session reflector including the SUB-ID and one or more metrics for the data session. The TWAMP session sender may then send the received metrics to the TWAMP control client to compute the network performance measurements between the host of the TWAMP session sender and the host of the TWAMP session reflector.</div>
<div class="description-paragraph" id="p-0053" num="0052"> <figref idrefs="DRAWINGS">FIG. 3</figref> is a block diagram illustrating an example message sequence between a TWAMP control client <b>60</b> and TWAMP server <b>62</b>, in accordance with the techniques of this disclosure. In some scenarios, TWAMP control client <b>60</b> may operate substantially similar to TWAMP control client <b>32</b> executed on first network device <b>28</b> from <figref idrefs="DRAWINGS">FIG. 2</figref>, and TWAMP server <b>62</b> may operate substantially similar to TWAMP server <b>38</b> executed on second network device <b>30</b> from <figref idrefs="DRAWINGS">FIG. 2</figref>. The TWAMP extensions described in this disclosure include modifications to existing control messaging between TWAMP control client <b>60</b> and TWAMP server <b>62</b>, and modifications to existing data messaging between a TWAMP session sender associated with TWAMP control client <b>60</b> and a TWAMP session reflector associated with TWAMP server <b>62</b>. The modification to the TWAMP data messaging is described in more detail below.</div>
<div class="description-paragraph" id="p-0054" num="0053">As illustrated in <figref idrefs="DRAWINGS">FIG. 3</figref>, TWAMP control client <b>60</b> and TWAMP server <b>62</b> exchange a first set of control messages to establish a control connection. In the illustrated example, the first set of control messages includes a transmission control protocol (TCP) connection <b>64</b>, a server greeting message <b>65</b>, a set up response message <b>66</b>, a server start message <b>67</b>, a request for services supported message <b>68</b> and a service supported response message <b>69</b>. In other examples, the first set of control messages may include more or fewer control messages that may convey similar or different control information to establish the control connection.</div>
<div class="description-paragraph" id="p-0055" num="0054">According to the disclosed techniques, the first set of control messages may be modified to include a communication mode indicating whether subscriber-aware and service specific monitoring are supported. For example, TWAMP control client <b>60</b> on a first network device initiates TCP connection <b>64</b> with TWAMP server <b>62</b> on a second network device. In response, TWAMP server <b>62</b> sends server greeting message <b>65</b> to TWAMP control client <b>60</b> identifying a plurality of communication modes that are supported by TWAMP server <b>62</b>, including modes that indicates that subscriber-aware active service latency measurement TWAMP data sessions are supported by TWAMP server <b>62</b>. As such, server greeting message <b>65</b> may include a modes field used to indicate which communication modes are supported by TWAMP server <b>62</b>. For example, the modes field may be used to identify and select specific communication capabilities. In accordance with the disclosed techniques, at least one bit position within the modes field of server greeting message <b>66</b> may be used to indicate whether the TWAMP server supports subscriber-aware data sessions.</div>
<div class="description-paragraph" id="p-0056" num="0055">TWAMP control client <b>60</b> selects one or more of the communication modes identified in server greeting message <b>65</b> received from TWAMP server <b>62</b> and that are also supported by TWAMP control client <b>60</b>. TWAMP control client <b>60</b> then sends set up response message <b>66</b> to TWAMP server <b>62</b> identifying the selected communication modes, including the one mode that indicates that subscriber-aware TWAMP data sessions are supported by TWAMP control client <b>60</b>. Set up response message <b>66</b> may include a modes field used to indicate the selected communication modes that are supported by both TWAMP control client <b>60</b> and TWAMP server <b>62</b>. For example, the modes field may be used to identify and select specific communication capabilities. With the TWAMP extensions to support subscriber-aware data sessions, if TWAMP control client <b>60</b> wants to participate in subscriber-aware data session provisioning, the TWAMP control client may set the modes field as set forth in the above examples. TWAMP server responds with server start message <b>67</b> indicating whether the TCP connection has been accepted</div>
<div class="description-paragraph" id="p-0057" num="0056">Next, according to the techniques described herein, TWAMP control client <b>60</b> issues a ‘Request Service-Supported’ control message <b>68</b> that queries TWAMP server <b>62</b> as to the types of network services <b>52</b> supported for testing and monitoring as described herein. In response, TWAMP server <b>62</b> issues a ‘Response Service-Supported’ control message <b>69</b> that, as described herein, identifies the number of network services <b>52</b> available for subscriber-aware TWAMP monitoring and, for each of the services, provides a service identifier and a service description string.</div>
<div class="description-paragraph" id="p-0058" num="0057">Next, TWAMP control client <b>60</b> and TWAMP server <b>62</b> then exchange a second set of control messages to negotiate one or more data sessions. In some examples, each of the one or more data sessions may be associated with a corresponding subscriber and directed to a network service <b>52</b>, or combination of services <b>52</b>, supported at TWAMP server <b>62</b>. In the illustrated example, the second set of control messages includes a plurality of request session messages <b>70</b> and accept session messages <b>72</b>, one pair for each of the one or more data sessions. In other examples, the second set of control messages may include more or fewer control messages that may convey similar or different control information to negotiate data sessions.</div>
<div class="description-paragraph" id="p-0059" num="0058">According to the disclosed techniques, the request session message <b>70</b> may be modified to include a subscriber identifier (SUB-ID) that uniquely identifies a subscriber, which may be a real end user/customer or a test subscriber. As examples, the SUB-ID may be an international mobile subscriber identity (IMSI), an International Mobile Equipment Identity (IMEI), an accounting identifier, an IP address or a proprietary identifier. In addition, the request session message <b>70</b> may be modified to include a service identifier that uniquely identifies one of the network services <b>52</b> provided by second network device <b>30</b>. The TWAMP extensions for the second set of control messages between TWAMP control client <b>60</b> and TWAMP server <b>62</b> are described in more detail below.</div>
<div class="description-paragraph" id="p-0060" num="0059">TWAMP control client <b>60</b> and TWAMP server <b>62</b> may also exchange a third set of control messages to manage or control the one or more data sessions between the TWAMP session sender and the TWAMP session reflector. In the illustrated example, the third set of control messages includes a start sessions message <b>74</b>, a start acknowledgment (ACK) message <b>76</b>, and a stop sessions message <b>78</b>. In other examples, the third set of control messages may include more or fewer control messages that may convey similar or different control information to manage the data sessions.</div>
<div class="description-paragraph" id="p-0061" num="0060">In response to receiving one or more accept session messages <b>72</b> for the one or more data sessions, TWAMP control client <b>60</b> sends start sessions message <b>74</b> to TWAMP server <b>62</b> to initiate testing on the requested data sessions. TWAMP server <b>62</b> responds with ACK message <b>76</b>, which indicates the start of the one or more data sessions. The TWAMP session sender <b>34</b> and the TWAMP session reflector <b>40</b> then exchange test packets for each of the active data sessions.</div>
<div class="description-paragraph" id="p-0062" num="0061">According to the disclosed techniques, the test packets exchanged for a particular data session are modified to carry the SUB-ID in order to identify the particular subscriber associated with test packets. TWAMP session reflector <b>40</b> receives the test packets over data session <b>40</b>, strips the TWAMP header so as to extract data packets from the test packets and forwards the data packets <b>54</b> to services <b>52</b> that has been negotiated for this particular test subscriber for application of one or more network services. After the services are applied to the subscriber packet flow, the resultant packets <b>56</b> are directed back to TWAMP session reflector <b>40</b>, encapsulated as TWAMP test packets including the SUB-ID and one or more metrics, and sent back to TWAMP session sender <b>34</b> executing on first network device <b>28</b>. The TWAMP extensions to the test packets exchanged between the TWAMP session sender associated with TWAMP control client <b>60</b> and the TWAMP session reflector associated with TWAMP server <b>62</b> are described in more detail below. At some point, TWAMP control client <b>60</b> may send stop sessions message <b>78</b> to TWAMP server <b>62</b> to stop testing on the data sessions.</div>
<div class="description-paragraph" id="p-0063" num="0062"> <figref idrefs="DRAWINGS">FIG. 4</figref> is a block diagram illustrating an example router <b>80</b> configured to execute one or more TWAMP logical roles, in accordance with the techniques of this disclosure. Router <b>80</b> may be described herein within the context of service provider network <b>2</b> of <figref idrefs="DRAWINGS">FIG. 1</figref>, and may represent any of routers <b>8</b>, <b>18</b>, for example. Moreover, while described with respect to a particular network device, e.g., a router, the techniques may be implemented by any network device that may operate as a service endpoint, such as a client device, a Layer 3 (L3) or L2/L3 switch, or server.</div>
<div class="description-paragraph" id="p-0064" num="0063">In this example, router <b>80</b> is divided into three logical or physical “planes” to include a control plane <b>81</b> that performs control operations for the device, a data plane <b>85</b> for forwarding transit network traffic and a service plane <b>83</b> for application of one or more network services <b>87</b> to transit packet flows that are forwarded by the router. That is, router <b>81</b> implements three separate functionalities (e.g., the routing/control, forwarding data and network service functionalities), either logically, e.g., as separate software instances executing on the same set of hardware components, or physically, e.g., as separate physical dedicated hardware components that either statically implement the functionality in hardware or dynamically execute software or a computer program to implement the functionality. In this example, a high-speed internal switch fabric <b>105</b> couples control plane <b>81</b>, service plane <b>83</b>, and data plane <b>85</b> to deliver data units and control messages among the units. Switch fabric <b>105</b> may represent an internal switch fabric or cross-bar, bus, or link.</div>
<div class="description-paragraph" id="p-0065" num="0064">In the example of <figref idrefs="DRAWINGS">FIG. 4</figref>, control plane <b>81</b> includes control unit <b>82</b> having master microprocessor(s) <b>102</b>, which executes device management services, subscriber authentication and control plane routing functionality of router <b>80</b>. Microprocessor <b>102</b> may comprise one or more general- or special-purpose processors such as a digital signal processor (DSP), an ASIC, a field programmable gate array (FPGA), or any other equivalent logic device. Accordingly, the terms “processor” or “controller,” as used herein, may refer to any one or more of the foregoing structures or any other structure operable to perform techniques described herein.</div>
<div class="description-paragraph" id="p-0066" num="0065">In general, control unit <b>82</b> represents hardware or a combination of hardware and software of control that implements control plane protocols <b>89</b>A-<b>89</b>N (“routing protocols <b>89</b>”) to learn and maintain routing information within routing information base <b>104</b> (“RIB <b>104</b>”). RIB <b>104</b> may include information defining a topology of a network, such as service provider network of <figref idrefs="DRAWINGS">FIG. 1</figref>. Routing protocols <b>89</b> interact with kernel <b>100</b> (e.g., by way of API calls) executing on control unit <b>82</b> to update RIB <b>104</b> based on routing protocol messages received by router <b>80</b>. Kernel <b>100</b> may resolve the topology defined by routing information in RIB <b>104</b> to select or determine one or more routes through the network. For example, the kernel may generate forwarding information in the form of forwarding information bases <b>103</b>A-<b>103</b>N (“FIBs <b>103</b>”) based on the network topology represented in RIB <b>104</b>, i.e., perform route resolution. Typically, kernel <b>100</b> generates FIBs <b>103</b> in the form of radix or other lookup trees to map packet information (e.g., header information having destination information and/or a label stack) to next hops and ultimately to interface ports of IFCs <b>114</b> associated with respective forwarding units <b>112</b>. Each of FIBs <b>103</b> may associate, for example, network destinations with specific next hops and corresponding IFCs <b>114</b>. For MPLS-related traffic forwarding, FIBs <b>103</b> stores, for a given FEC, label information that includes an incoming label, an outgoing label, and a next hop for a packet. Control unit <b>82</b> may then program forwarding units <b>112</b> of data plane <b>85</b> with FIBs <b>103</b>, which installs the FIBs within lookup ASICs <b>106</b>.</div>
<div class="description-paragraph" id="p-0067" num="0066">Data plane <b>85</b>, in this example, is a decentralized data plane in that data plane functionality and packet forwarding functionality is distributed among a plurality of forwarding units <b>112</b>A-<b>112</b>N (“forwarding units <b>112</b>”). In the example of router <b>80</b>, data plane <b>85</b> includes forwarding units <b>112</b> that provide high-speed forwarding of network traffic received by interface cards <b>114</b>A-<b>114</b>N (“IFCs <b>44</b>”) via inbound links <b>116</b>A-<b>116</b>N to outbound links <b>118</b>A-<b>118</b>N. Forwarding units <b>112</b> may each comprise one or more packet forwarding engine (“PFE”) coupled to respective interface cards <b>114</b> and may represent, for example, a dense port concentrator (DPC), modular port concentrator (MPC), flexible physical interface card (PIC) concentrator (FPC), or another line card, for example, that is insertable within a chassis or combination of chassis of router <b>80</b>.</div>
<div class="description-paragraph" id="p-0068" num="0067">As shown in the example of <figref idrefs="DRAWINGS">FIG. 4</figref>, each of forwarding units <b>112</b> includes a respective one of lookup ASICs <b>106</b>A-<b>106</b>N (“lookup ASICs <b>106</b>”) that receives control and data session traffic via IFC cards <b>114</b>, performs route lookups and, based on routes installed to FIBs <b>103</b>, forwards the traffic either to control unit <b>82</b> (control traffic destined for router <b>80</b>) or to one of forwarding units <b>40</b> (transit data traffic) for output via an interface to one of output links <b>48</b>. In one example, lookup ASICs <b>106</b> are microcode-controlled chipsets programmably configured by a slave microprocessor (not shown) executing on each of forwarding units <b>112</b>. Specifically, in this example, each of ASICs <b>106</b> may be controllable by internal microcode programmed by a slave microprocessor. When forwarding packets, control logic within each lookup ASICs <b>106</b> traverses the respective FIB <b>103</b> and, upon reaching a FIB entry for the packet (e.g., a leaf node), the microcode-implemented control logic automatically selects one or more forwarding next hops (FNHs) for forwarding the packet. In this way, ASICs <b>106</b> of forwarding units <b>112</b> process packets by performing a series of operations on each packet over respective internal packet forwarding paths as the packets traverse the internal architecture of router <b>80</b>. Operations may be performed, for example, on each packet based on any of a corresponding ingress interface, an ingress PFE <b>114</b>, an egress PFE <b>114</b>, an egress interface or other components of router <b>80</b> to which the packet is directed prior to egress, such as one or more service cards. Forwarding units <b>112</b> each include forwarding structures that, when executed, examine the contents of each packet (or another packet property, e.g., incoming interface) and on that basis make forwarding decisions, apply filters, and/or perform accounting, management, traffic analysis, and load balancing, for example.</div>
<div class="description-paragraph" id="p-0069" num="0068">In one example, each of forwarding units <b>112</b> arranges forwarding structures as next hop data that can be chained together as a series of “hops” along an internal packet forwarding path for the network device. In many instances, the forwarding structures perform lookup operations within internal memory of ASICs <b>106</b>, where the lookup may be performed against a tree (or trie) search, a table (or index) search. Other example operations that may be specified with the next hops include filter determination and application, or a rate limiter determination and application. Lookup operations locate, within a lookup data structure (e.g., a lookup tree), an item that matches packet contents or another property of the packet or packet flow, such as the inbound interface of the packet. The result of packet processing in accordance with the operations defined by the next hop forwarding structure within ASICs <b>106</b> determines the manner in which a packet is forwarded or otherwise processed by forwarding units <b>112</b> from its input interface on one of IFCs <b>114</b> to its output interface on one of IFCs <b>114</b>.</div>
<div class="description-paragraph" id="p-0070" num="0069">Lookup ASICs <b>106</b> may be implemented using forwarding application specific integrated circuits (ASICs), field programmable gate arrays (FPGAs), or any other equivalent integrated or discrete logic circuitry, as well as any combinations of such components. Each of forwarding units <b>106</b> may include substantially similar components to perform substantially similar functionality.</div>
<div class="description-paragraph" id="p-0071" num="0070">Service plane <b>83</b> of router <b>80</b> includes a plurality of service units <b>113</b>A-<b>113</b>K (“service units <b>13</b>”) that may be, as examples, removable service cards, which are configured to apply network services to packets flowing through data plane <b>85</b>. That is, when forwarding packets, forwarding units <b>112</b> may steer packets to service plane <b>83</b> for application of one or more network services <b>131</b> by service units <b>113</b>. In this example, each of service units <b>113</b> includes a microprocessor <b>127</b> configured to execute hypervisor <b>129</b> to provide an operating environment for a plurality of network services <b>131</b>. As examples, service units <b>113</b> may apply firewall and security services, carrier grade network address translation (CG-NAT), media optimization (voice/video), IPSec/VPN services, deep packet inspection (DPI), HTTP filtering, counting, accounting, charging, and load balancing of packet flows or other types of services applied to network traffic. Each of services <b>131</b> may be implemented, for example, as virtual machines or containers executed by hypervisor <b>129</b> and microprocessor <b>127</b>.</div>
<div class="description-paragraph" id="p-0072" num="0071">In the example of <figref idrefs="DRAWINGS">FIG. 4</figref>, control unit <b>82</b> provides an operating environment for TWAMP <b>110</b>. For example, control unit <b>82</b> may use TWAMP <b>110</b> to execute one or more TWAMP logical roles, such as a TWAMP control client, a TWAMP server, a TWAMP sessions sender, and a TWAMP session reflector. According to the techniques described in this disclosure, TWAMP <b>110</b> may be extended to enable subscriber-aware TWAMP data session provisioning between two endpoints in a computer network. For purposes of illustration, router <b>80</b> is described herein as a second endpoint configured to execute a TWAMP server and/or an associated TWAMP session reflector based on communications from a TWAMP client, which may be a client device or testing device associated with the subscriber network.</div>
<div class="description-paragraph" id="p-0073" num="0072">The disclosed techniques include extending control messaging of TWAMP <b>110</b> to include a communication mode for the subscriber-aware TWAMP data session provisioning. In this way, when operating as the TWAMP control client, router <b>80</b> is configured to negotiate support for subscriber-aware data sessions during establishment of the control connection with a TWAMP client executed on another endpoint, e.g., client device <b>16</b> from <figref idrefs="DRAWINGS">FIG. 1</figref>.</div>
<div class="description-paragraph" id="p-0074" num="0073">During negotiation, TWAMP <b>110</b> of router <b>80</b>, operating as the TWAMP server, receives a subscriber identifier (SUB ID) of the particular data subscriber and, optionally, a selection of one or more of network services <b>131</b> to be applied to packet flows for that subscriber. Router <b>80</b> may then store the SUB ID of the particular subscriber along with any requested services <b>131</b> in SUB ID table <b>90</b>. SUB ID table <b>90</b> may include a plurality of SUB IDs corresponding to a plurality of different subscribers and, optionally, may map one or more of the SUB ID to a set of one or more of services <b>131</b> to applied to packet flows associated with respect subscriber. Moreover, each of the different requested TWAMP sessions may be associated with different network performance metric(s) to be measured.</div>
<div class="description-paragraph" id="p-0075" num="0074">Further, router <b>80</b> may execute a TWAMP session reflector <b>111</b> (“TWAMP S.R. <b>111</b>”) in each forwarding unit <b>112</b> of data plane <b>85</b>, and TWAMP <b>110</b> of control plane <b>81</b> may install and maintain SUB ID tables <b>91</b>, including the specified SUB IDs and any selected services <b>131</b>, within the forwarding units based on the negotiated TWAMP session. As further described below, the disclosed techniques further include extending data messaging of TWAMP to include a subscriber identifier (SUB ID) in each test packet for the TWAMP data session. Further, TWAMP session reflector <b>111</b> within forwarding units <b>112</b> are configured to associate received TWAMP test packets <b>117</b> with a particular subscriber based on the SUB ID included in each of the received TWAMP test packets and, optionally based on the associated subscriber, direct the subscriber packets encapsulated within the TWAMP test packets through any services <b>131</b> specified for that subscriber.</div>
<div class="description-paragraph" id="p-0076" num="0075">For example, the TWAMP session reflector <b>111</b> may compare the SUB ID included in an inbound TWAMP test packets <b>117</b> to SUB ID table <b>91</b> in order to identify the corresponding subscriber and any services <b>131</b> to be applied. TWAMP session reflector <b>111</b> may then strip headers from the TWAMP test packets <b>117</b> to extract subscriber data packets and forwards the subscriber data packets to the particular network services <b>131</b> for that subscriber. After the services are applied, the resultant packets are directed back to the TWAMP session reflector <b>111</b>, encapsulated as TWAMP test packets <b>121</b> and sent back to the TWAMP client executing on the particular subscriber device. The TWAMP client extracts timestamps embedded within the TWAMP packets <b>121</b>, thus allowing latency measures to be calculated for individual subscribers and specific services or combinations of services.</div>
<div class="description-paragraph" id="p-0077" num="0076">The architecture of router <b>80</b> illustrated in <figref idrefs="DRAWINGS">FIG. 4</figref> is shown for example purposes only. This disclosure is not limited to this architecture. In other examples, router <b>80</b> may be configured in a variety of ways. In one example, router <b>80</b> may be implemented solely in software, or hardware, or may be implemented as a combination of software, hardware, or firmware. For example, control unit <b>82</b> may comprise one or more of a processor, a programmable processor, a general-purpose processor, an integrated circuit, an ASIC, a FPGA, or any type of hardware unit capable of implementing the techniques described herein. Control unit <b>82</b> may further include one or more processors which execute software instructions stored on a computer readable storage medium, such as random access memory (RAM), read only memory (ROM), programmable read only memory (PROM), erasable programmable read only memory (EPROM), electronically erasable programmable read only memory (EEPROM), non-volatile random access memory (NVRAM), flash memory, a hard disk, a CD-ROM, a floppy disk, a cassette, magnetic media, optical media, or other computer-readable storage media. In some instances, the computer-readable storage medium may include instructions that cause a programmable processor to perform the techniques described herein.</div>
<div class="description-paragraph" id="p-0078" num="0077"> <figref idrefs="DRAWINGS">FIG. 5</figref> is a block diagram illustrating an example network device <b>130</b> configured to execute one or more TWAMP logical roles, in accordance with the techniques of this disclosure. Network device <b>130</b> may be described within the context of service provider network <b>2</b> of <figref idrefs="DRAWINGS">FIG. 1</figref>, and may represent any of router <b>8</b>, router <b>18</b>, service nodes <b>10</b>, or data center <b>9</b>, for example. In other examples, network device <b>130</b> may comprise any network device, such as a router, a switch or a server, within service provider network <b>2</b>.</div>
<div class="description-paragraph" id="p-0079" num="0078">In the example of <figref idrefs="DRAWINGS">FIG. 5</figref>, network device <b>130</b> includes a microprocessor <b>142</b> executing hypervisor <b>140</b> to provide an execution environment for one or more service node virtual machines (VMs) <b>132</b>A-<b>132</b>N (collectively “service node VMs <b>132</b>”). Each of service node VMs <b>132</b> executes network services applications <b>133</b>A-<b>133</b>N (collectively “network service applications <b>133</b>”), such as stateful firewall <b>134</b> and deep packet inspection (DPI) <b>136</b>, to apply stateful network services to packet flows.</div>
<div class="description-paragraph" id="p-0080" num="0079">As illustrated in <figref idrefs="DRAWINGS">FIG. 5</figref>, network device <b>130</b> also provides an operating environment for TWAMP <b>138</b>, which may execute as a separate process or VM or may be integrated within VM <b>132</b> or hypervisor <b>140</b>. For example, TWAMP <b>138</b> may execute one or more TWAMP logical roles, such as a TWAMP control client, a TWAMP server, a TWAMP sessions sender, and a TWAMP session reflector. In other examples, the one or more TWAMP logical roles may be executed on a physical chassis of network device <b>130</b>. According to the techniques described in this disclosure, TWAMP <b>138</b> may be extended to enable subscriber-aware TWAMP data session provisioning between two endpoints in a computer network. For purposes of illustration, TWAMP <b>138</b> is described herein as a second endpoint configured to execute a TWAMP server and/or an associated TWAMP session reflector.</div>
<div class="description-paragraph" id="p-0081" num="0080">The disclosed techniques include extending control messaging of TWAMP <b>138</b> to include a communication mode for the subscriber-aware TWAMP data session provisioning. In this way, when operating as the TWAMP server, TWAMP <b>138</b> is configured to negotiate support for SUB-ID-based data sessions during establishment of the control connection with a TWAMP control client executed on another endpoint, e.g., router <b>8</b> from <figref idrefs="DRAWINGS">FIG. 1</figref>.</div>
<div class="description-paragraph" id="p-0082" num="0081">During negotiation of a particular data session, TWAMP <b>138</b> receives a request from the TWAMP control client, wherein the request specifies a unique subscriber identifier (SUB-ID) for the particular data session. In addition, the request may specify particular network services to apply to traffic flows associated with the subscriber and/or particular KPIs to measure for the subscriber traffic. TWAMP <b>138</b> may then store the SUB-ID of the particular data session in a SID table <b>150</b> and any other optional parameters, e.g., services and or KPIs. As such, SID table <b>150</b> may include a plurality of SUB-ID corresponding to a plurality of different subscribers. In some examples, each of the entries within SUB-ID table <b>150</b> may specify a subscriber identifier and, optionally, particular subscriber network service supported at the TWAMP server and/or one or more particular KPIs to be monitored.</div>
<div class="description-paragraph" id="p-0083" num="0082">TWAMP <b>138</b>, operating as the TWAMP server, may also communicate the SUB-ID and other parameters, such as particular services or KPIs, directly to the associated TWAMP session reflector over a communication link. In some examples, service node VM <b>132</b>A may execute both the TWAMP server and the TWAMP session reflector such that the communication is an internal control communication between the TWAMP logical roles on service node VM <b>132</b>A. In this case, either the TWAMP server or the TWAMP session reflector may be responsible for maintaining SUB-ID table <b>150</b>.</div>
<div class="description-paragraph" id="p-0084" num="0083">The disclosed techniques further include extending data messaging of TWAMP <b>138</b> to include a SUB-ID assigned in each test packet for the data session. For example, the data messages may include a field specifying the SUB-ID and may also encapsulate subscriber traffic. When operating as the TWAMP session reflector, TWAMP <b>138</b> is configured to identify the subscriber and, optically, particular services and/or KPIs corresponding to the received TWAMP test packets based on the SUB-ID included in the received test packets. Based on the determination, TWAMP <b>138</b> directs subscriber traffic encapsulated therein to the appropriate network service(s) <b>133</b>. In addition, when operating as the TWAMP session reflector, service node VM <b>132</b>A is configured to include the SUB-ID of the particular data session in each TWAMP test packet for the particular data session that is reflected back to a TWAMP session sender executed on another endpoint, e.g., subscriber device <b>16</b> or test device <b>21</b> from <figref idrefs="DRAWINGS">FIG. 1</figref>.</div>
<div class="description-paragraph" id="p-0085" num="0084">In the example illustrated in <figref idrefs="DRAWINGS">FIG. 5</figref>, network device <b>130</b> includes a network interface <b>144</b> to receive tunnel packets <b>148</b> over a plurality of tunnels <b>146</b>A-<b>146</b>N (“tunnels <b>146</b>”). Each of the tunnels <b>146</b> corresponds to a different one of a plurality of service chains, where each of the service chains comprises a different ordered set of one or more stateful network services to be applied to packet flows associated with subscribers. Each of the tunnel packets <b>148</b> encapsulates a subscriber packet. In some cases, the subscriber packet may be a TWAMP test packet injected by a TWAMP session sender associated with a TWAMP control client. The architecture of network device <b>130</b> illustrated in <figref idrefs="DRAWINGS">FIG. 5</figref> is shown for example purposes only. This disclosure is not limited to this architecture. In other examples, network device <b>130</b> may be configured in a variety of ways.</div>
<div class="description-paragraph" id="p-0086" num="0085"> <figref idrefs="DRAWINGS">FIGS. 6-11</figref> are conceptual diagrams illustrating example formats of TWAMP control messages between a TWAMP control client and a TWAMP server, in accordance with the techniques of this disclosure. The set of control messages (sometimes referred to as a service block) may be exchanged between the TWAMP control client and the TWAMP server to negotiate one or more TWAMP data sessions for specific subscriber traffic and, optionally, one or more services, and to monitor the particular KPIs to be measured for each of the subscribers and services. The format of each of the messages is shown by way of examples, and the structure and formal, including the octet numbers specified for the various fields are merely examples. Moreover, in other examples the functionality of a give message may be split across multiple messages. Similarly, the example messages may be combined into a reduced number of messages.</div>
<div class="description-paragraph" id="p-0087" num="0086"> <figref idrefs="DRAWINGS">FIG. 6</figref> illustrates an example format of a server greeting message <b>160</b> sent by the TWAMP server to the TWAMP control client in response to a control connection initiated by the TWAMP control client. The TWAMP control client may initiate the control connection with the TWAMP server using, e.g., TCP. The server greeting message illustrated in <figref idrefs="DRAWINGS">FIG. 6</figref> includes several fields, including a modes field <b>164</b>, a challenge field, a salt field, a count field, and a must be zero (MBZ) field, and in some cases an associated number of octets for each field.</div>
<div class="description-paragraph" id="p-0088" num="0087">Modes field <b>164</b> included in the server greeting message may be used to indicate which modes are supported by the TWAMP server. For example, modes field <b>164</b> may be used to identify and select specific communication capabilities. In accordance with the disclosed techniques, at least one bit position within the modes field of the server greeting message may be used to indicate whether the TWAMP server or a session reflector associated with the TWAMP server supports subscriber-aware monitoring of KPIs.</div>
<div class="description-paragraph" id="p-0089" num="0088">In one example, a 26<sup>th </sup>bit in modes field <b>164</b> of service greeting message <b>66</b> may be used to indicate whether TWAMP server <b>62</b> supports SID-based data sessions. Conventionally, the modes field may have any of the following values: 1: unauthenticated, 3: unauthenticated+authenticated, or 7: unauthenticated+authenticated+encrypted. With TWAMP extensions to support subscriber-aware data session provisioning for service latency measurements, the modes field may have the following example values:
</div> <ul> <li id="ul0001-0001" num="0000"> <ul> <li id="ul0002-0001" num="0089">0x09:unauthenticated+supports Active Service Latency Measurements</li> <li id="ul0002-0002" num="0090">0x0b:unauthenticated+authenticated+supports Active Service Latency Measurements</li> <li id="ul0002-0003" num="0091">0x0F:unauthenticated+authenticated+encrypted)+supports Active Service Latency Measurements</li> <li id="ul0002-0004" num="0092">0x21:unauthenticated+supports Active Service Latency Measurements+Subscriber aware</li> <li id="ul0002-0005" num="0093">0x23:unauthenticated+authenticated+supports Active Service Latency Measurements+Subscriber aware</li> <li id="ul0002-0006" num="0094">0x27:unauthenticated+authenticated+encrypted)+supports Active Service Latency Measurements+Subscriber aware</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0090" num="0095">In a set up response message sent by the TWAMP control client to the TWAMP server in response to server greeting message, the TWAMP control client may select any of the modes indicated in the server greeting message, and reply back to the TWAMP server with the selected mode.</div>
<div class="description-paragraph" id="p-0091" num="0096">Upon establishment of the control connection between the TWAMP control client and the TWAMP server, the TWAMP control client may request monitoring of KPIs for a particular subscriber and, optionally, for one or more particular services with the TWAMP server. To do so, the TWAMP control client may need to determine which services are supported at the TWAMP server and which service KPIs are supported for those services, as described herein.</div>
<div class="description-paragraph" id="p-0092" num="0097"> <figref idrefs="DRAWINGS">FIG. 7</figref> illustrates an example format of a request service-supported message <b>170</b> that may be sent by the TWAMP control client to the TWAMP server to determine the network services supported by the TWAMP server or other device reachable by the TWAMP server. In this example, message <b>170</b> includes a command <b>174</b> (e.g., a value of 0x7) to request a description of the supported services.</div>
<div class="description-paragraph" id="p-0093" num="0098"> <figref idrefs="DRAWINGS">FIG. 8</figref> illustrates an example format of a response service-supported message <b>180</b> sent by the TWAMP server to the TWAMP client control in response to request service-supported message <b>170</b>. In this example, message <b>180</b> includes a command <b>182</b> (e.g., a value of 0x8) and a number of services supported <b>184</b>. The TWAMP server then sends one or more messages <b>190</b> of <figref idrefs="DRAWINGS">FIG. 9</figref> that specify pairs of service identifiers <b>192</b> and service description strings <b>194</b>. After sending one or more messages <b>190</b>, the TWAMP server sends message <b>200</b> of <figref idrefs="DRAWINGS">FIG. 10</figref> specifying a hash-based message authentication code (HMAC).</div>
<div class="description-paragraph" id="p-0094" num="0099"> <figref idrefs="DRAWINGS">FIG. 11</figref> illustrates an example format of a request session message <b>210</b> sent by the TWAMP control client to the TWAMP server to request a data session for a given subscriber and, optionally, for a specific service supported at the TWAMP server. As illustrated in <figref idrefs="DRAWINGS">FIG. 11</figref>, in accordance with the extension described herein, request session message <b>210</b> includes several fields, including, among others, a subscriber identifier type (SUB-ID TYPE) field <b>212</b>, a size of the subscriber identifier (SIZE OF SUB-ID) field <b>214</b>, and a subscriber identifier (SUB-ID) field <b>216</b> to carry the SUB ID of the particular subscriber for which the data session is being established. The type of subscriber identifier and size are specified by a SUB-ID TYPE field <b>212</b> and SIZE OF SUB-ID field <b>214</b>, respectively. For example, the type of subscriber identifier may be an IMSI, an IMEI, an accounting identifier, an IP address, a proprietary identifier or the like.</div>
<div class="description-paragraph" id="p-0095" num="0100">In one example, request session message may further include a service ID field <b>218</b> for specifying a particular service or combination of services that the TWAMP server is to apply, or direct application to, subscriber-specific test packets to subsequently be transmitted over the TWAMP data session being requested. This service ID field may comprise two octets. If monitoring of service KPIs is not requested as a part of the requested data session, then the service ID field has a value of 0. If the service ID field has a non-zero value, then the padding length field will not have any significance because the TWAMP test packets will be of different sizes depending on which types of service KPIs are being monitored over the data session.</div>
<div class="description-paragraph" id="p-0096" num="0101">In response to request session message <b>210</b>, the TWAMP server may reply back with an accept session message accepting the data session for the given subscriber, and including a non-zero error message in the event an error arises or the session requested is denied. In some examples, the accept session message may include an accept field having a value of 0-6, with 0 meaning success and a non-zero value meaning the control connection will be closed, and a port field indicating a port number at the TWAMP server for the accepted data session. For example, the TWAMP server may include a value of 0x6 as an error code in the event the specified subscriber identifier does not match an authorized, authenticated subscriber identifier. The TWAMP control client may then send a start sessions message to the TWAMP server, and the TWAMP server may reply with a start ACK message including an accept field having a value of 0-5, with 0 meaning success and the control connection being closed if the accept field has a non-zero value.</div>
<div class="description-paragraph" id="p-0097" num="0102">Upon receiving the accept session message, either the TWAMP control client or the TWAMP session initiator may start sending TWAMP test packets to the TWAMP server to measure selected service KPIs associated with the data session for the given subscriber traffic flow. At some point, the TWAMP control client or TWAMP session initiator may send a stop session message to the TWAMP server including an accept field having a value of 0 meaning normal but possibly premature completion of the data session, or having a nonzero value indicating some failure. As a result of the stop sessions message, the control connection between the TWAMP control client and the TWAMP server will be closed and all data sessions spawned over the control connection will be considered invalid. The stop session message may also include a number of sessions field. If the number of sessions field in the stop session message does not match the number of data sessions in progress, then the stop session message may be considered invalid.</div>
<div class="description-paragraph" id="p-0098" num="0103"> <figref idrefs="DRAWINGS">FIGS. 12-13</figref> are conceptual diagrams illustrating example formats of TWAMP test packets for a subscriber aware TWAMP data session between a TWAMP session sender and a TWAMP session reflector, in accordance with the techniques of this disclosure. The TWAMP test packets may be exchanged to collect metrics used to measure network performance between a first network device executing the TWAMP session sender and a second network device executing the TWAMP session reflector. The techniques described in this disclosure include extensions to the TWAMP test packets and response packets to include a SUB-ID used to identify a particular subscriber associated with the traffic flow being injected into the TWAMP data session.</div>
<div class="description-paragraph" id="p-0099" num="0104"> <figref idrefs="DRAWINGS">FIG. 12</figref> illustrates an example format of a TWAMP test packet <b>220</b> for a data session in an unauthenticated mode. In one example of the TWAMP extensions described herein, as illustrated in <figref idrefs="DRAWINGS">FIG. 12</figref>, test packet <b>220</b> includes several fields, including a sequence number field, a timestamp field, an error estimate field, a must-be-zero (MBZ) field, a SUB-ID TYPE field <b>222</b>, a SIZE OF SUB-ID field <b>224</b>, a SUB-ID field <b>226</b> and packet padding for carrying encapsulated subscriber traffic. 20-octet SUB-ID field <b>226</b>, as illustrated in <figref idrefs="DRAWINGS">FIG. 12</figref>, carries the SUB ID of the particular subscriber associated with the test packet is being transmitted. The type of subscriber identifier and size are specified by a SUB-ID TYPE field <b>222</b>, a SIZE OF SUB-ID field <b>224</b>, thereby aiding correct processing of the subscriber identifier by the TWAMP server upon receiving test packet <b>220</b>. For example, the type of subscriber identifier may be an IMSI, an IMEI, an accounting identifier, an IP address, a proprietary identifier or the like.</div>
<div class="description-paragraph" id="p-0100" num="0105"> <figref idrefs="DRAWINGS">FIG. 13</figref> illustrates an example format of a TWAMP test packet <b>230</b> for a data session in authenticated and encrypted modes. In one example of the TWAMP extensions described herein, as illustrated in <figref idrefs="DRAWINGS">FIG. 13</figref>, test packet <b>230</b> includes several fields, including a sequence number field, a must-be-zero (MBZ) field, a timestamp field, an error estimate field, a second MBZ field, an HMAC field, a second error estimate field, a third MBZ field, a SUB-ID TYPE field <b>234</b>, a SIZE OF SUB-ID field <b>226</b>, a SUB-ID field <b>238</b> and packet padding for encapsulating subscriber traffic. 20-octet SUB-ID field <b>238</b> carries the SUB ID of the particular subscriber associated with the test packet is being transmitted. The type of subscriber identifier and size are specified by a SUB-ID TYPE field <b>234</b>, a SIZE OF SUB-ID field <b>236</b>, thereby aiding correct processing of the subscriber identifier by the TWAMP server upon receiving test packet <b>230</b>. For example, the type of subscriber identifier may be an IMSI, an IMEI, an accounting identifier, an IP address, a proprietary identifier or the like.</div>
<div class="description-paragraph" id="p-0101" num="0106"> <figref idrefs="DRAWINGS">FIG. 14</figref> illustrates an example format of a TWAMP reply message <b>240</b> for the unauthenticated mode as sent by the session reflector associated with the TWAMP server to the session sender associated with either the TWAMP control client or the TWAMP session initiator over an established data session.</div>
<div class="description-paragraph" id="p-0102" num="0107">As illustrated in <figref idrefs="DRAWINGS">FIG. 14</figref>, the example session TWAMP reply message <b>240</b> includes several fields, including a sequence number field, a timestamp field <b>242</b>, an error estimate field, an MBZ field, a receive timestamp field <b>244</b>, a send sequence number field, a sender timestamp field <b>246</b>, a send error estimate field, an MBZ field, a sender time to live (TTL) field, an MBZ field, a SUB-ID TYPE field <b>248</b>, a SIZE OF SUB-ID field <b>250</b>, a SUB-ID field <b>252</b>, a service latency sender timestamp <b>254</b>, a service latency receiver timestamp <b>256</b> and packet padding that may include one or more service PDUs such as subscriber traffic as processed by the TWAMP server.</div>
<div class="description-paragraph" id="p-0103" num="0108"> <figref idrefs="DRAWINGS">FIG. 15</figref> illustrates an example format of a TWAMP reply message <b>260</b> for the authenticated and encrypted modes as sent by the session reflector associated with the TWAMP server to the session sender associated with either the TWAMP control client or the TWAMP session initiator over an established data session.</div>
<div class="description-paragraph" id="p-0104" num="0109">As illustrated in <figref idrefs="DRAWINGS">FIG. 15</figref>, the example session TWAMP reply message <b>240</b> includes several fields, including a sequence number field, an MBZ field, timestamp field <b>262</b>, an error estimate field, an MBZ field, a receive timestamp field <b>264</b>, an MBZ field, a send sequence number field, an MBZ field, a sender timestamp field <b>265</b>, a send error estimate field, an MBZ field, a sender time to live (TTL) field, an MBZ field, a HMAC field, a SUB-ID TYPE field <b>266</b>, a SIZE OF SUB-ID field <b>268</b>, a SUB-ID field <b>270</b>, a service latency sender timestamp <b>272</b>, a service latency receiver timestamp <b>274</b> and packet padding that may include one or more service PDUs such as subscriber traffic as processed by the TWAMP server.</div>
<div class="description-paragraph" id="p-0105" num="0110"> <figref idrefs="DRAWINGS">FIG. 16</figref> is a flowchart illustrating an example operation of negotiating a subscriber-aware TWAMP data session, in accordance with the techniques of this disclosure. The example operation of <figref idrefs="DRAWINGS">FIG. 16</figref> is described with respect to TWAMP control client <b>32</b> and TWAMP session sender <b>34</b> executed on first network device <b>28</b> (such as a client device or a test device), and TWAMP server <b>38</b> and TWAMP session reflector <b>40</b> executed on second network device <b>30</b> (such as a router or service node) from <figref idrefs="DRAWINGS">FIG. 2</figref>. In other examples, the operation illustrated in <figref idrefs="DRAWINGS">FIG. 16</figref> may be performed by a TWAMP control client, a TWAMP session sender, a TWAMP server, and a TWAMP session reflector that are each executed on separate hosts.</div>
<div class="description-paragraph" id="p-0106" num="0111">TWAMP control client <b>32</b> on first network device <b>28</b> and TWAMP server <b>38</b> on second network device <b>30</b> establish control connection <b>42</b> (<b>300</b>). When establishing control connection <b>42</b>, TWAMP control client <b>32</b> and TWAMP server <b>36</b> may negotiate communication and security options for future data sessions established by TWAMP control client <b>32</b> and TWAMP server <b>36</b>. According to the techniques of this disclosure, TWAMP server <b>38</b> identifies a plurality of supported communication modes, one or more of which indicates that subscriber-aware TWAMP data sessions are supported by TWAMP server <b>38</b>. TWAMP control client <b>32</b> then determines which of the plurality of supported communication modes are also supported by TWAMP control client <b>32</b>, and selects at least one of the communication modes for the future data sessions. According to the disclosed techniques, the selected one of the communication modes indicates that subscriber-aware TWAMP data sessions are supported by both TWAMP control client <b>32</b> and TWAMP server <b>38</b>.</div>
<div class="description-paragraph" id="p-0107" num="0112">TWAMP control client <b>32</b> and TWAMP server <b>38</b> then use control connection <b>42</b> to negotiate a data session, e.g., data session <b>50</b>, between TWAMP session sender <b>34</b> and TWAMP session reflector <b>40</b> for specific subscriber traffic (<b>302</b>). As part of the negotiation process for data session <b>50</b>, TWAMP control client <b>32</b> and TWAMP server <b>38</b> perform an exchange <b>44</b> of a subscriber identifier (SUB-ID) that uniquely identifies a subscriber associated with first network device <b>28</b>. In addition, TWAMP control client <b>32</b> may specify a SERVICE-ID that corresponds to a particular one of services <b>52</b> or combination of services <b>52</b> provided by second network device <b>30</b>.</div>
<div class="description-paragraph" id="p-0108" num="0113">Once TWAMP control client <b>32</b> starts data session <b>50</b>, TWAMP session sender <b>34</b> and TWAMP session reflector <b>40</b> exchange one or more TWAMP test packets for data session <b>50</b> with each of the one or more TWAMP test packets including the SUB-ID of subscriber associated with the data session <b>50</b> (<b>304</b>). According to the disclosed techniques, TWAMP session sender <b>34</b> and TWAMP session reflector <b>40</b> use the SUB-ID included in the TWAMP test packets to identify the particular subscriber associated with the TWAMP test packets, and the TWAMP server may determine one or more services to apply to the test packets before returning TWAMP test packets to the TWAMP control client.</div>
<div class="description-paragraph" id="p-0109" num="0114"> <figref idrefs="DRAWINGS">FIG. 17</figref> is a flowchart illustrating an example operation of exchanging TWAMP test packets for the subscriber-aware TWAMP data session between a TWAMP session sender executed on a first network device and a TWAMP session reflector executed on a second network device, in accordance with the techniques of this disclosure. The example operation is described with respect to TWAMP session sender <b>34</b> executed on first network device <b>28</b>, and TWAMP session reflector <b>40</b> executed on second network device <b>30</b> from <figref idrefs="DRAWINGS">FIG. 2</figref>.</div>
<div class="description-paragraph" id="p-0110" num="0115">As described in detail above, TWAMP control client <b>32</b> and TWAMP server <b>38</b> may establish control connection <b>42</b>, and negotiate data session <b>50</b> including exchange <b>44</b> of the SID of data session <b>50</b>. Once TWAMP control client <b>32</b> starts data session <b>50</b>, TWAMP session sender <b>34</b> determines the SUB-ID of the subscriber associated with the TWAMP data session <b>50</b>, i.e., the identity of the subscriber associated with the subscriber traffic to be monitored by the TWAMP session (<b>310</b>). TWAMP session sender <b>34</b> then constructs and outputs one or more TWAMP test packets for data session <b>50</b> to TWAMP session reflector <b>40</b> with each of the TWAMP test packets including the SUB-ID of the subscriber and where the payload encapsulates subscriber traffic (<b>312</b>).</div>
<div class="description-paragraph" id="p-0111" num="0116">TWAMP session reflector <b>40</b> receives the TWAMP test packets from TWAMP session sender <b>34</b> with each of the TWAMP test packets including the SUB-ID for the subscriber (<b>314</b>). In response to receiving the TWAMP test packets, TWAMP session reflector <b>40</b> identifies the subscriber associated with of the received TWAMP test packets based on the SUB ID included in the TWAMP test packets and determines any services to be applied to the subscriber packets encapsulated therein (<b>316</b>). In one example, TWAMP session reflector <b>40</b> may identify the subscriber using a SUB ID table maintained by either TWAMP server <b>38</b> or TWAMP session reflector <b>40</b>, e.g., SUB ID table <b>91</b> of <figref idrefs="DRAWINGS">FIG. 4</figref> or SUB ID table <b>150</b> from <figref idrefs="DRAWINGS">FIG. 5</figref>. For example, TWAMP session reflector <b>40</b> may compare the SUB ID included in the received TWAMP test packets to the plurality of SUB IDs recorded in the SUB ID table in order to identify the subscriber and, optionally, identify any services to be applied to the subscriber traffic.</div>
<div class="description-paragraph" id="p-0112" num="0117">The TWAMP session reflector within router <b>8</b> or service node <b>10</b> removes the data packets from the test packets and forwards the data packets to the service element, e.g., any of service units <b>132</b> of router <b>80</b> or service nodes <b>132</b> of network device <b>130</b> for application of one or more network services (<b>318</b>). The service element receives the subscriber packet (<b>320</b>), applies network services to the subscriber packet (<b>324</b>) and returns the subscriber packet to the TWAMP session reflector (<b>326</b>).</div>
<div class="description-paragraph" id="p-0113" num="0118">TWAMP session reflector <b>40</b> correlates the subscriber packet with the original inbound TWAMP packet, constructs an outbound TWAMP packet to include any metrics and/or timestamps originally recorded in the inbound TWAMP packet, and then sends the TWAMP test packets for data session <b>50</b> back to TWAMP session sender <b>34</b> with each of the TWAMP test packets including the SUB ID of the subscriber and one or more metrics for data session <b>50</b> used to measure network performance between first network device <b>28</b> and second network device <b>30</b> for the given subscriber (<b>320</b>). For example, the metrics may include timestamps for sending or receiving a test packet, error estimates for sending or receiving the test packet, a sequence number for sending the test packet, a TTL value for the test packet, a keepalive PDU, and/or a count of serviced packets, bytes, or subscribers. In one example, TWAMP session reflector <b>40</b> may correlate packets received from the service element with the original inbound TWAMP packet using cookies. For example, the TWAMP session reflector may attach a cookie to each subscriber packet forwarded to the service element, which the service element returns along with the subscriber packet after application of network services. In this way, the TWAMP session provider may utilize the cookies to correlate the subscriber traffic processed by the service elements with the original TWAMP packets received from the client.</div>
<div class="description-paragraph" id="p-0114" num="0119">TWAMP session sender <b>34</b> receives the TWAMP test packets from TWAMP session reflector <b>40</b> with each of the TWAMP test packets including the SID and the metrics (<b>322</b>). Upon receiving the TWAMP test packets from TWAMP session reflector <b>40</b>, TWAMP session sender <b>32</b> associates the received TWAMP test packets with the corresponding subscriber based on the SUB ID included in the TWAMP test packets (<b>324</b>). For example, TWAMP session sender <b>34</b> may compare the SUB ID included in the received TWAMP test packets to the plurality of SUB IDs in order to identify the subscriber.</div>
<div class="description-paragraph" id="p-0115" num="0120">TWAMP control client <b>32</b>, or some other module executed by first network device <b>28</b> or by a centralized controller such as the SDN controller or orchestration engine, may then compute network performance measurements between first network device <b>28</b> and second network device <b>30</b> for the given subscriber based on the received metrics for data session <b>50</b> (<b>194</b>). For example, TWAMP control client <b>32</b> may compute one or more of keepalive or path connectivity measurements, RTT measurements, path delay measurements, packet jitter measurements, packet re-ordering measurements, packet loss measurements, service latency measurements, or service load measurements based on the received metrics.</div>
<heading id="h-0006">EXAMPLE</heading>
<div class="description-paragraph" id="p-0116" num="0121">The following illustrates an example in which the techniques described herein are used to measure latency for application of network service(s) to data packets for a given subscriber. For purposes of illustration the following example is described in reference to the example format of TWAMP data packets shown in <figref idrefs="DRAWINGS">FIGS. 12-15</figref>.
</div> <ul> <li id="ul0003-0001" num="0000"> <ul> <li id="ul0004-0001" num="0122">1. Initially, the TWAMP client/session sender constructs the TWAMP data packet <b>220</b> or <b>230</b>, depending on the mode, (step <b>312</b> of <figref idrefs="DRAWINGS">FIG. 17</figref>) by embedding a subscriber packet in the packet padding of the TWAMP data packet, setting the values within the various fields including SUB ID TYPE, SIZE OF SUB ID and SUB ID field, and setting the timestamp <b>225</b>, <b>235</b> (T<b>3</b>) to record the time the TWAMP data packet is sent it to the TWAMP reflector.</li> <li id="ul0004-0002" num="0123">2. Upon receiving the TWAMP test packet (step <b>314</b> of <figref idrefs="DRAWINGS">FIG. 17</figref>), the TWAMP server/reflector records the receipt time in timestamp <b>244</b> of a TWAMP reply message <b>240</b> or <b>250</b> depending upon the mode (T<b>2</b>). In addition, the TWAMP server/reflector sets timestamp <b>242</b> (T<b>3</b>) to contain the value of timestamp <b>225</b>, <b>235</b> at which the original TWAMP packet was sent by the TWAMP client.</li> <li id="ul0004-0003" num="0124">3. Next, the TWAMP server updates service latency measurement timestamp <b>254</b> (T<b>5</b>) of the TWAMP reply message to record the time the inner subscriber packet was extracted and sent to the selected service(s) (step <b>318</b> of <figref idrefs="DRAWINGS">FIG. 17</figref>). In one example, the TWAMP server maintains the context of the data packet by attaching a cookie to the subscriber packet which is returned by the service element.</li> <li id="ul0004-0004" num="0125">4. Upon receiving the subscriber packet back from the service element, including the cookie, the TWAMP server updates service latency receiver timestamp <b>256</b> (T<b>6</b>) in the TWAMP reply packet to record the time the subscriber packet was received back from the service element (step <b>320</b> of <figref idrefs="DRAWINGS">FIG. 17</figref>).</li> <li id="ul0004-0005" num="0126">5. At this time, the TWAMP server embeds the service PDU in the TWAMP reply message, sets the timestamp (T<b>3</b>) <b>242</b> to record the time the TWAMP reply message is sent back the TWAMP reflector and outputs the TWAMP data packet.</li> <li id="ul0004-0006" num="0127">6. The TWAMP client, upon receiving the TWAMP packet for a particular subscriber, records the current timestamp, represented herein as T<b>4</b>.</li> <li id="ul0004-0007" num="0128">7. With all the timestamps available, TWAMP client or a centralized controller can compute the following example metrics:
<br/>
Round Trip Time (RTT)=((<i>T</i>4−<i>T</i>1)−(<i>T</i>3−<i>T</i>2))  a.
<br/>
Service latency per subscriber=(<i>T</i>6−<i>T</i>5)  b.
</li> </ul> </li> </ul>
<div class="description-paragraph" id="p-0117" num="0129">The techniques described in this disclosure may be implemented, at least in part, in hardware, software, firmware or any combination thereof. For example, various aspects of the described techniques may be implemented within one or more processors, including one or more microprocessors, DSPs, ASICs, FPGAs, or any other equivalent integrated or discrete logic circuitry, as well as any combinations of such components. The term “processor” or “processing circuitry” may generally refer to any of the foregoing logic circuitry, alone or in combination with other logic circuitry, or any other equivalent circuitry. A control unit comprising hardware may also perform one or more of the techniques of this disclosure.</div>
<div class="description-paragraph" id="p-0118" num="0130">Such hardware, software, and firmware may be implemented within the same device or within separate devices to support the various operations and functions described in this disclosure. In addition, any of the described units, modules or components may be implemented together or separately as discrete but interoperable logic devices. Depiction of different features as modules or units is intended to highlight different functional aspects and does not necessarily imply that such modules or units must be realized by separate hardware or software components. Rather, functionality associated with one or more modules or units may be performed by separate hardware or software components, or integrated within common or separate hardware or software components.</div>
<div class="description-paragraph" id="p-0119" num="0131">The techniques described in this disclosure may also be embodied or encoded in a computer-readable medium, such as a computer-readable storage medium, containing instructions. Instructions embedded or encoded in a computer-readable medium may cause a programmable processor, or other processor, to perform the method, e.g., when the instructions are executed. Computer-readable media may include non-transitory computer-readable storage media and transient communication media. Computer readable storage media, which is tangible and non-transitory, may include RAM, ROM, PROM, EPROM, EEPROM, flash memory, a hard disk, a CD-ROM, a floppy disk, a cassette, magnetic media, optical media, or another computer-readable storage media. It should be understood that the term “computer-readable storage media” refers to physical storage media, and not signals, carrier waves, or other transient media.</div>
<div class="description-paragraph" id="p-0120" num="0132">Various aspects of this disclosure have been described. These and other aspects are within the scope of the following claims.</div>
</div>
</div>
</section><section itemprop="claims" itemscope="">
<h2>Claims (<span itemprop="count">14</span>)</h2>
<div html="" itemprop="content"><div class="claims" lang="EN" load-source="patent-office" mxw-id="PCLM234782581">
<claim-statement>What is claimed is:</claim-statement>
<div class="claim"> <div class="claim" id="CLM-00001" num="00001">
<div class="claim-text">1. A computer-readable medium comprising instructions that configure a processor to:
<div class="claim-text">establish a control connection between a two-way active measurement protocol (TWAMP) control client and a TWAMP server;</div>
<div class="claim-text">negotiate, by the TWAMP control client and the TWAMP server over the control connection, a data session between a TWAMP session sender executed on a first network device and a TWAMP session reflector executed on a second network device, wherein negotiating the data session includes specifying a subscriber identifier to an individual subscriber of a service provider network; and</div>
<div class="claim-text">exchange one or more TWAMP test packets for the data session between the TWAMP session sender and the TWAMP session reflector, each of the one or more TWAMP test packets including the subscriber identifier of the subscriber.</div>
</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00002" num="00002">
<div class="claim-text">2. The computer-readable medium of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the instruction configure the processor to negotiate the data session by receiving, with the TWAMP server and from the TWAMP control client, a TWAMP session request that specifies the subscriber identifier for the individual subscriber.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00003" num="00003">
<div class="claim-text">3. The computer-readable medium of <claim-ref idref="CLM-00002">claim 2</claim-ref>, wherein the TWAMP session request includes a subscriber identifier type field that specifies the subscriber identifier for the individual subscriber.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00004" num="00004">
<div class="claim-text">4. The computer-readable medium of <claim-ref idref="CLM-00003">claim 3</claim-ref>, wherein the subscriber identifier type field specifies one of an (IMSI), an International Mobile Equipment Identity (IMEI), an accounting identifier or an IP address for the individual subscriber.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00005" num="00005">
<div class="claim-text">5. The computer-readable medium of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the instruction configure the processor to establish the control connection by:
<div class="claim-text">sending, by the TWAMP server and to the TWAMP control client, a greeting message that identifies a plurality of communication modes that are supported by the TWAMP server, wherein one of the plurality of communication modes indicates that subscriber-aware data sessions are supported by the TWAMP server; and</div>
<div class="claim-text">receiving, by the TWAMP server and from the TWAMP control client, a set up message that identifies at least one of the plurality of communication modes that is also supported by the TWAMP control client, wherein the at least one of the plurality of communication modes indicates that subscriber-aware data sessions are supported by the TWAMP control client.</div>
</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00006" num="00006">
<div class="claim-text">6. The computer-readable medium of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the instruction configure the processor to establish the control connection by:
<div class="claim-text">receiving, by the TWAMP control client and from the TWAMP server, a greeting message that identifies a plurality of communication modes that are supported by the TWAMP server, wherein one of the plurality of communication modes indicates that subscriber-aware data sessions are supported by the TWAMP server;</div>
<div class="claim-text">selecting, by the TWAMP control client, at least one of the plurality of communication modes that is also supported by the TWAMP control client; and</div>
<div class="claim-text">sending, by the TWAMP control client and to the TWAMP server, a set up message that identifies the at least one of the plurality of communication modes, wherein the at least one of the plurality of communication modes indicates that subscriber-aware data sessions are supported by the TWAMP control client.</div>
</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00007" num="00007">
<div class="claim-text">7. The computer-readable medium of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the instruction configure the processor to exchange the one or more TWAMP test packets for the data session by:
<div class="claim-text">receiving, by the TWAMP session reflector, the one or more TWAMP test packets for the data session from the TWAMP session sender, each of the one or more TWAMP test packets including the subscriber identifier associated with the data session; and</div>
<div class="claim-text">sending, by the TWAMP session reflector, the one or more TWAMP test packets back to the TWAMP session sender, each of the one or more TWAMP test packets including the subscriber identifier associated with the data session and at least one metric for the data session used to measure network performance between the first network device and the second network device.</div>
</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00008" num="00008">
<div class="claim-text">8. The computer-readable medium of <claim-ref idref="CLM-00007">claim 7</claim-ref>, further comprising instructions that configure the processor to, for each of the one or more TWAMP test packets and prior to sending the one or more TWAMP test packets back to the TWAMP session sender:
<div class="claim-text">extract, by the TWAMP session reflector, a subscriber packet embedded within a payload of the respective TWAMP test packet;</div>
<div class="claim-text">select, based on the subscriber identifier associated with the data session, a network service;</div>
<div class="claim-text">direct the subscriber packet to be processed by the selected network service;</div>
<div class="claim-text">receive a processed subscriber packet from the network service after processing by the network service; and</div>
<div class="claim-text">send, by the TWAMP session reflector, the respective TWAMP test packet back to the TWAMP session sender in response to receive the processed subscriber packet from the network service.</div>
</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00009" num="00009">
<div class="claim-text">9. The computer-readable medium of <claim-ref idref="CLM-00008">claim 8</claim-ref>, further comprising instructions that configure the processor to, for each of the one or more TWAMP test packets and prior to sending the one or more TWAMP test packets back to the TWAMP session sender:
<div class="claim-text">set a timestamp within the TWAMP test packet indicating when the TWAMP test packet was received by the TWAMP session reflector;</div>
<div class="claim-text">set a timestamp within the TWAMP test packet indicating when the subscriber packet of the TWAMP test packet was directed by the TWAMP session reflector to the selected network service;</div>
<div class="claim-text">set a timestamp within the TWAMP test packet indicating when the processed subscriber packet was received back from the network service by the TWAMP session reflector; and</div>
<div class="claim-text">set a timestamp within the TWAMP test packet indicating when the TWAMP test packet was send by the TWAMP session reflector to the TWAMP session sender.</div>
</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00010" num="00010">
<div class="claim-text">10. The computer-readable medium of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the instruction configure the processor to exchange the one or more TWAMP test packets for the data session by:
<div class="claim-text">sending, by the TWAMP session sender, the one or more TWAMP test packets for the data session to the TWAMP session reflector, each of the one or more TWAMP test packets including the subscriber identifier;</div>
<div class="claim-text">receiving, by the TWAMP session sender, the one or more TWAMP test packets back from the TWAMP session reflector, each of the one or more TWAMP test packets including the subscriber identifier and at least one metric for the data session used to measure network performance between the first network device and the second network device; and</div>
<div class="claim-text">associating, by the TWAMP session sender, the one or more TWAMP test packets with the subscriber of the service provider network based on the subscriber identifier included in the one or more TWAMP test packets.</div>
</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00011" num="00011">
<div class="claim-text">11. The computer-readable medium of <claim-ref idref="CLM-00010">claim 10</claim-ref>,
<div class="claim-text">wherein each of the one or more TWAMP test packets sent by the TWAMP session sender to the TWAMP session reflector includes a subscriber packet embedded within a payload of the respective TWAMP test packet,</div>
<div class="claim-text">wherein each of the TWAMP test packets received by the TWAMP session sender from the TWAMP session reflector includes:
<div class="claim-text">a timestamp within the TWAMP test packet indicating when the TWAMP test packet was received by the TWAMP session reflector,</div>
<div class="claim-text">a timestamp within the TWAMP test packet indicating when the subscriber packet embedded of the TWAMP test packet was extracted and directed by the TWAMP session reflector to a network service for processing,</div>
<div class="claim-text">a timestamp within the TWAMP test packet indicating when a processed subscriber packet was received back from the network service by the TWAMP session reflector, and</div>
<div class="claim-text">a timestamp within the TWAMP test packet indicating when the TWAMP test packet was sent by the TWAMP session reflector back to the TWAMP session sender.</div>
</div>
</div>
</div>
</div> <div class="claim"> <div class="claim" id="CLM-00012" num="00012">
<div class="claim-text">12. A mobile device comprising:
<div class="claim-text">a memory; and</div>
<div class="claim-text">one or more processors in communication with the memory and executing a two-way active measurement protocol (TWAMP) control client, the one or more processors configured to:
<div class="claim-text">establish a control connection between the TWAMP control client and a TWAMP server,</div>
<div class="claim-text">negotiate a data session with a TWAMP session reflector executed on a second network device, wherein negotiating the data session includes specifying a subscriber identifier for an individual subscriber of a service provider network,</div>
<div class="claim-text">send the one or more TWAMP test packets for the data session to the TWAMP session reflector, each of the one or more TWAMP test packets including the subscriber identifier, and</div>
<div class="claim-text">receive the one or more TWAMP test packets back from the TWAMP session reflector, each of the one or more TWAMP test packets including the subscriber identifier and at least one metric for the data session used to measure network performance between the network device and the second network device.</div>
</div>
</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00013" num="00013">
<div class="claim-text">13. The mobile device of <claim-ref idref="CLM-00012">claim 12</claim-ref>,
<div class="claim-text">wherein each of the one or more TWAMP test packets sent to the TWAMP session reflector includes a subscriber packet embedded within a payload of the respective TWAMP test packet,</div>
<div class="claim-text">wherein each of the TWAMP test packets received from the TWAMP session reflector includes:
<div class="claim-text">a timestamp within the TWAMP test packet indicating when the TWAMP test packet was received by the TWAMP session reflector,</div>
<div class="claim-text">a timestamp within the TWAMP test packet indicating when the subscriber packet of the TWAMP test packet was directed by the TWAMP session reflector to a network service for processing,</div>
<div class="claim-text">a timestamp within the TWAMP test packet indicating when the processed subscriber packet was received back from the network service by the TWAMP session reflector, and</div>
<div class="claim-text">a timestamp within the TWAMP test packet indicating when the TWAMP test packet was sent by the TWAMP session reflector.</div>
</div>
</div>
</div>
</div> <div class="claim"> <div class="claim" id="CLM-00014" num="00014">
<div class="claim-text">14. A router comprising:
<div class="claim-text">a plurality of forwarding units, each of the forwarding executing a two-way active measurement protocol (TWAMP) session reflector; and</div>
<div class="claim-text">a control unit having one or more processors executing a TWAMP server, the one or more processors configured to:
<div class="claim-text">establish a control connection between the TWAMP server and a TWAMP control client,</div>
<div class="claim-text">receive, with the TWAMP server and from the TWAMP control client, a TWAMP session request for a data session with a TWAMP session sender associated with the TWAMP control client, wherein the TWAMP session request specifies a subscriber identifier to an individual subscriber of a service provider network,</div>
<div class="claim-text">receive one or more TWAMP test packets for the data session from the TWAMP session sender by one or more of the TWAMP session reflectors, each of the one or more TWAMP test packets including the subscriber identifier associated with the data session, and</div>
<div class="claim-text">send, by the respective one of the TWAMP session reflectors that received the packets, the one or more TWAMP test packets back to the TWAMP session sender, each of the one or more TWAMP test packets including the subscriber identifier associated with the data session and at least one metric for the data session used to measure network performance between the router and the TWAMP session sender.</div>
</div>
</div>
</div>
</div> </div>
</div>
</section>
                </article>
            </search-app>
        </body>
    </html>
    