
    <html>
        <body>
            <search-app>
                <article class="result" itemscope="" itemtype="http://schema.org/ScholarlyArticle">
    <h1 itemprop="pageTitle">US10771259B2 - Achieving consensus among network nodes in a distributed system 
        - Google Patents</h1><section itemprop="abstract" itemscope="">
<h2>Abstract</h2>
<div html="" itemprop="content"><abstract lang="EN" load-source="patent-office" mxw-id="PA411644536">
<div class="abstract" id="p-0001" num="0000">Implementations of the present specification include a computer-implemented method for achieving a consensus among a number of network nodes of a blockchain network. The blockchain network includes a primary node and one or more backup nodes. The method includes receiving a transaction request by the primary node, sending a number of first messages to the backup nodes by the primary node, receiving second messages from the backup nodes by the primary node, reconstructing the transaction request based on data in the second messages by the primary node, sending a third message to the backup nodes by the primary node, and executing the transaction request in response to receiving a predetermined number of third messages.</div>
</abstract>
</div>
</section><section itemprop="description" itemscope="">
<h2>Description</h2>
<div html="" itemprop="content"><div class="description" lang="EN" load-source="patent-office" mxw-id="PDES273236953">
<heading id="h-0001">CROSS-REFERENCE TO RELATED APPLICATIONS</heading>
<div class="description-paragraph" id="p-0002" num="0001">This application is a continuation of U.S. patent application Ser. No. 16/422,333, filed on May 24, 2019, which is a continuation of PCT Application No. PCT/CN2018/120858, filed on Dec. 13, 2018, which is hereby incorporated by reference in its entirety.</div>
<heading id="h-0002">BACKGROUND</heading>
<div class="description-paragraph" id="p-0003" num="0002">Distributed ledger systems (DLSs), which can also be referred to as consensus networks, and/or blockchain networks, enable participating entities to securely, and immutably store data. DLSs are commonly referred to as blockchain networks without referencing any particular user case. Examples of blockchain networks can include: public blockchain networks, private blockchain networks, and consortium blockchain networks. A public blockchain network is open for all entities to use the DLS, and participate in the consensus process. A private blockchain network is provided for particular entity, which centrally controls read and write permissions. A consortium blockchain network is provided for a select group of entities, which control the consensus process, and includes an access control layer.</div>
<div class="description-paragraph" id="p-0004" num="0003">Consensus mechanisms are a primary component of distributed blockchain systems. A consensus mechanism is a process in computer science that is used to achieve agreement on a single data value among distributed processes or systems. Consensus mechanisms are designed to achieve reliability in a network involving multiple unreliable nodes. Solving that issue—known as consensus problem—is important in distributed computing and multi-agent systems.</div>
<div class="description-paragraph" id="p-0005" num="0004">Blockchain relies on consensus mechanisms to reach agreement among nodes. A blockchain is a decentralized database that is managed by distributed computers on a peer-to-peer (P2P) network. Each peer maintains a copy of the ledger to prevent a single point of failure (SPOF). Updates and validations are reflected in all copies simultaneously.</div>
<div class="description-paragraph" id="p-0006" num="0005">Although a number of existing techniques can be used for performing consensus among the network nodes of a blockchain system, a more efficient solution to performing the consensus would be advantageous.</div>
<heading id="h-0003">SUMMARY</heading>
<div class="description-paragraph" id="p-0007" num="0006">Implementations of the present specification include computer-implemented methods for addressing consensus issues in a distributed system (e.g., a blockchain network). More particularly, implementations of the present specification are directed to achieving consensus among network nodes in a distributed system.</div>
<div class="description-paragraph" id="p-0008" num="0007">In some implementations, actions include: receiving a transaction request by a primary node of a blockchain network; generating a number of erasure code (EC) blocks according to an EC code by the primary node using the transaction request; sending a number of first messages to one or more backup nodes of the blockchain network by the primary node, wherein each of the number of first messages includes a composite hash value associated with the number of EC blocks; receiving at least one second message by the primary node from at least one of the backup nodes, wherein the at least one second message includes one of the number of first messages and a signature of the at least one of the backup nodes associated with the one of the number of first messages; verifying by the primary node whether the at least one second message is valid in response to receiving the at least one second message from the at least one of the backup node; determining by the primary node whether a number of valid second messages exceeds a pre-determined threshold; reconstructing the transaction request by the primary node based on a subset of the number of valid second messages according to the EC code in response to determining that the number of valid second messages exceeds the pre-determined threshold; sending a third message to the other network nodes by the primary node in response to determining that the transaction request has been successfully reconstructed, wherein the third message includes a set of signatures that are in the valid second messages; receiving at least one third message by the primary node from at least one of the backup nodes; and executing the transaction request by the primary node in response to receiving a pre-determined number of third messages that are identical.</div>
<div class="description-paragraph" id="p-0009" num="0008">Other implementations include corresponding systems, apparatus, and computer programs, configured to perform the actions of the methods, encoded on computer storage devices.</div>
<div class="description-paragraph" id="p-0010" num="0009">These and other implementations may each optionally include one or more of the following features:</div>
<div class="description-paragraph" id="p-0011" num="0010">A first feature, combinable with any of the following features, wherein the transaction request is associated with a sequence number.</div>
<div class="description-paragraph" id="p-0012" num="0011">A second feature, combinable with any of the following features, wherein the primary node transforms the transaction request into an EC message using the EC code and divides the EC message into the number of EC block.</div>
<div class="description-paragraph" id="p-0013" num="0012">A third feature, combinable with any of the following features, wherein the composite hash value of the number of EC block is generated using a hash tree.</div>
<div class="description-paragraph" id="p-0014" num="0013">A fourth feature, combinable with any of the following features, wherein the hash tree includes a Merkle tree.</div>
<div class="description-paragraph" id="p-0015" num="0014">A fifth feature, combinable with any of the following features, wherein the composite hash value is a root hash value of the Merkle tree.</div>
<div class="description-paragraph" id="p-0016" num="0015">A sixth feature, combinable with any of the following features, wherein the signature of the at least one of the backup nodes associated with the one of the number of first messages includes a private key signature of the at least one of the backup nodes associated with the one of the number of first messages.</div>
<div class="description-paragraph" id="p-0017" num="0016">A seventh feature, combinable with any of the following features, wherein the at least one second message further includes at least one of the number of EC blocks.</div>
<div class="description-paragraph" id="p-0018" num="0017">An eighth feature, combinable with any of the following features, wherein the primary node further generates a reconstructed hash tree using the at least one of the number of EC blocks in the at least one second message, determines a reconstructed composite hash value of the reconstructed hash tree, compares the reconstructed composite hash value to a composite hash value in the at least one second message, and determines whether the reconstructed composite hash value matches the composite hash values in the at least one second message.</div>
<div class="description-paragraph" id="p-0019" num="0018">A ninth feature, combinable with any of the following features, wherein the primary node further determines that the at least one second message is valid in response to determining that the reconstructed composite hash value matches the composite hash values in the second messages.</div>
<div class="description-paragraph" id="p-0020" num="0019">A tenth feature, combinable with any of the following features, wherein the pre-determined number of third messages that are identical include the pre-determined number of the third messages having an identical set of signatures.</div>
<div class="description-paragraph" id="p-0021" num="0020">In some implementations, actions includes: receiving, by a backup node, a first message from the primary node, wherein the first message comprises a composite hash value associated with a plurality of EC blocks, wherein the plurality of EC blocks are generated by the primary node according to an EC code using a transaction request; in response to receiving the first message, sending, by the backup node, a second message to the other network nodes, wherein the second message comprises the first message and a signature of the backup node associated with the first message; receiving, by the backup node, at least one second message from at least one backup node other than the backup node; in response to receiving the at least one second message from the at least one backup node, verifying, by the backup node, whether the at least one second message is valid; determining, by the backup node, whether a number of valid second messages exceeds a pre-determined threshold; in response to determining that the number of valid second messages exceeds the pre-determined threshold, reconstructing, by the backup node, the transaction request based on a subset of the number of valid second messages according to the EC code; in response to determining that the transaction request has been successfully reconstructed, sending, by the backup node, a third message, to the other network nodes, wherein the third message comprises a set of signatures that are in the valid second messages; receiving, by the backup node, at least one third message from at least one of the backup nodes; and in response to receiving a pre-determined number of third messages that are identical, executing, by the backup node, the transaction request.</div>
<div class="description-paragraph" id="p-0022" num="0021">Other implementations include corresponding systems, apparatus, and computer programs, configured to perform the actions of the methods, encoded on computer storage devices.</div>
<div class="description-paragraph" id="p-0023" num="0022">These and other implementations may each optionally include one or more of the following features:</div>
<div class="description-paragraph" id="p-0024" num="0023">A first feature, combinable with any of the following features, wherein the generating the plurality of EC blocks according to an EC code includes transforming the transaction request into an EC message using the EC code dividing the EC message into the plurality of EC block.</div>
<div class="description-paragraph" id="p-0025" num="0024">A second feature, combinable with any of the following features, wherein the composite hash value of the plurality of EC block is generated using a hash tree.</div>
<div class="description-paragraph" id="p-0026" num="0025">A third feature, combinable with any of the following features, wherein the hash tree comprises a Merkle tree, and wherein the composite hash value is a root hash value of the Merkle tree.</div>
<div class="description-paragraph" id="p-0027" num="0026">A fourth feature, combinable with any of the following features, wherein the signature of the backup node associated with the first message includes a private key signature of the backup node associated with the first message.</div>
<div class="description-paragraph" id="p-0028" num="0027">A fifth feature, combinable with any of the following features, wherein the at least one second message further includes at least one of the plurality of EC blocks.</div>
<div class="description-paragraph" id="p-0029" num="0028">A sixth feature, combinable with any of the following features, wherein the verifying, by the backup node, whether the at least one second message is valid includes generating, by the backup node, a reconstructed hash tree using the at least one of the plurality of EC blocks in the at least one second message, determining, by the backup node, a reconstructed composite hash value of the reconstructed hash tree, comparing, by the backup node, the reconstructed composite hash value to a composite hash value in the at least one second message, and determining, by the backup node, whether the reconstructed composite hash value matches the composite hash values in the at least one second message.</div>
<div class="description-paragraph" id="p-0030" num="0029">A seventh feature, combinable with any of the following features, further includes in response to determining that the reconstructed composite hash value matches the composite hash values in the second messages, determining, by the backup node, that the at least one second message is valid.</div>
<div class="description-paragraph" id="p-0031" num="0030">An eighth feature, combinable with any of the following features, wherein the pre-determined number of third messages that are identical include the pre-determined number of the third messages having an identical set of signatures.</div>
<div class="description-paragraph" id="p-0032" num="0031">The present specification also provides one or more non-transitory computer-readable storage media coupled to one or more processors and having instructions stored thereon which, when executed by the one or more processors, cause the one or more processors to perform operations in accordance with implementations of the methods provided herein.</div>
<div class="description-paragraph" id="p-0033" num="0032">The present specification further provides a system for implementing the methods provided herein. The system includes one or more processors, and a computer-readable storage medium coupled to the one or more processors having instructions stored thereon which, when executed by the one or more processors, cause the one or more processors to perform operations in accordance with implementations of the methods provided herein.</div>
<div class="description-paragraph" id="p-0034" num="0033">The present specification discloses improved consensus mechanisms including techniques for achieving consensus among network nodes in a distributed system, performing a change of primary node in a distributed system, and performing a recovery process for a network node in a distributed system. The described consensus mechanisms can achieve various advantages in different applications.</div>
<div class="description-paragraph" id="p-0035" num="0034">For example, the consensus process as discussed below includes many features that improve the operations of the blockchain system and help alleviate the network bottleneck. For example, the described consensus process includes converting a transaction request into a number of erasure code (EC) blocks according to an EC code and sending one of the EC blocks to each of the network nodes. The EC block is smaller in size than the original transaction request. Accordingly, sending the EC block instead of the full transaction request to the network nodes reduces the size of data blocks that are transmitted among the network nodes of the blockchain network, thereby conserving the network bandwidth and reducing the network load. This further reduces the size of data that are written to and read from the memory space of the network nodes, thereby reducing a burden on the memory space of the network nodes and improving the efficiency of the overall blockchain system.</div>
<div class="description-paragraph" id="p-0036" num="0035">Furthermore, the present specification describes an epoch change process that includes assigning respective weights to multiple phases of the consensus process, determining a weight sum based on the respective weights of the multiple phases, and determining a new primary node based on the weight sum. The epoch change process based on the weigh sum instead of a round robin method can facilitate choosing a new primary node that is non-faulty in a timely manner. Unlike the round robin method, the epoch change process in the present specification relies on the weight sum to select the new primary node, which can reduce latency or delay in finding the new primary node that is not faulty. This can further improve the efficiency of the overall blockchain system in providing the blockchain services.</div>
<div class="description-paragraph" id="p-0037" num="0036">Moreover, the present specification discusses a recovery process that includes operations such as sending a state request message by a network node that applies to be a new primary node and receiving state reply messages from the other network nodes. These operations are performed such that the recovery process of the faulty network node does not interfere with the normal operation of the consensus process among the other non-faulty network nodes. This facilitates conserving computing and network resources for recovering the faulty network node by reducing the complexity of the recovery process.</div>
<div class="description-paragraph" id="p-0038" num="0037">It is acknowledged that methods in accordance with the present specification may include any combination of the aspects and features described herein. That is, methods in accordance with the present specification are not limited to the combinations of aspects and features specifically described herein, but also include any combination of the aspects and features provided.</div>
<div class="description-paragraph" id="p-0039" num="0038">The details of one or more implementations of the present specification are set forth in the accompanying drawings and the description below. Other features and advantages of the present specification will be apparent from the description and drawings, and from the claims.</div>
<description-of-drawings>
<heading id="h-0004">DESCRIPTION OF DRAWINGS</heading>
<div class="description-paragraph" id="p-0040" num="0039"> <figref idrefs="DRAWINGS">FIG. 1</figref> depicts an example of an environment that can be used to execute implementations of the present specification.</div>
<div class="description-paragraph" id="p-0041" num="0040"> <figref idrefs="DRAWINGS">FIG. 2</figref> depicts an example of a conceptual architecture in accordance with implementations of the present specification.</div>
<div class="description-paragraph" id="p-0042" num="0041"> <figref idrefs="DRAWINGS">FIG. 3</figref> depicts an example of a consensus process that can be executed in accordance with implementations of the present specification.</div>
<div class="description-paragraph" id="p-0043" num="0042"> <figref idrefs="DRAWINGS">FIG. 4</figref> depicts an example of a consensus process that can be executed in accordance with implementations of the present specification.</div>
<div class="description-paragraph" id="p-0044" num="0043"> <figref idrefs="DRAWINGS">FIG. 5</figref> depicts an example of a hash tree in accordance with implementations of the present specification.</div>
<div class="description-paragraph" id="p-0045" num="0044"> <figref idrefs="DRAWINGS">FIG. 6</figref> depicts an example of messages that are communicated among network nodes of a distributed system in accordance with implementations of the present specification.</div>
<div class="description-paragraph" id="p-0046" num="0045"> <figref idrefs="DRAWINGS">FIG. 7</figref> depicts an example of a process of performing a change of a primary node in a distributed system in accordance with implementations of the present specification.</div>
<div class="description-paragraph" id="p-0047" num="0046"> <figref idrefs="DRAWINGS">FIG. 8</figref> depicts an example of a process of performing a change of a primary node in a distributed system in accordance with implementations of the present specification.</div>
<div class="description-paragraph" id="p-0048" num="0047"> <figref idrefs="DRAWINGS">FIG. 9</figref> depicts an example of messages that are communicated among network nodes of a distributed system in accordance with implementations of the present specification.</div>
<div class="description-paragraph" id="p-0049" num="0048"> <figref idrefs="DRAWINGS">FIG. 10</figref> depicts an example of a process of performing a recovery process of a network node in a distributed system in accordance with implementations of the present specification.</div>
<div class="description-paragraph" id="p-0050" num="0049"> <figref idrefs="DRAWINGS">FIG. 11</figref> depicts an example of a process of performing a recovery process of a network node in a distributed system in accordance with implementations of the present specification.</div>
<div class="description-paragraph" id="p-0051" num="0050"> <figref idrefs="DRAWINGS">FIG. 12</figref> depicts an example of messages that are communicated among network nodes of a distributed system in accordance with implementations of the present specification.</div>
<div class="description-paragraph" id="p-0052" num="0051"> <figref idrefs="DRAWINGS">FIG. 13</figref> depicts an example of a diagram illustrating modules of a consensus apparatus, according to an implementation of the present specification.</div>
<div class="description-paragraph" id="p-0053" num="0052"> <figref idrefs="DRAWINGS">FIG. 14</figref> depicts an example of a diagram illustrating modules of a consensus apparatus, according to an implementation of the present specification.</div>
<div class="description-paragraph" id="p-0054" num="0053"> <figref idrefs="DRAWINGS">FIG. 15</figref> depicts an example of a diagram illustrating modules of a primary node changing apparatus, according to an implementation of the present specification.</div>
<div class="description-paragraph" id="p-0055" num="0054"> <figref idrefs="DRAWINGS">FIG. 16</figref> depicts an example of a diagram illustrating modules of a primary node changing apparatus, according to an implementation of the present specification.</div>
<div class="description-paragraph" id="p-0056" num="0055"> <figref idrefs="DRAWINGS">FIG. 17</figref> depicts an example of a diagram illustrating modules of a recovery apparatus, according to an implementation of the present specification.</div>
</description-of-drawings>
<div class="description-paragraph" id="p-0057" num="0056">Like reference symbols in the various drawings indicate like elements.</div>
<heading id="h-0005">DETAILED DESCRIPTION</heading>
<div class="description-paragraph" id="p-0058" num="0057">Implementations of the present specification include computer-implemented methods for addressing consensus issues in a distributed system (e.g., a blockchain network). More particularly, implementations of the present specification are directed to achieving consensus among network nodes in a distributed system.</div>
<div class="description-paragraph" id="p-0059" num="0058">In some implementations, actions include: receiving a transaction request by a primary node of a blockchain network; generating a number of erasure code (EC) blocks according to an EC code by the primary node using the transaction request; sending a number of first messages to one or more backup nodes of the blockchain network by the primary node, wherein each of the number of first messages includes a composite hash value associated with the number of EC blocks; receiving at least one second message by the primary node from at least one of the backup nodes, wherein the at least one second message includes one of the number of first messages and a signature of the at least one of the backup nodes associated with the one of the number of first messages; verifying by the primary node whether the at least one second message is valid in response to receiving the at least one second message from the at least one of the backup node; determining by the primary node whether a number of valid second messages exceeds a pre-determined threshold; reconstructing the transaction request by the primary node based on a subset of the number of valid second messages according to the EC code in response to determining that the number of valid second messages exceeds the pre-determined threshold; sending an third message to the other network nodes by the primary node in response to determining that the transaction request has been successfully reconstructed, wherein the third message includes a set of signatures that are in the valid second messages; receiving at least one third message by the primary node from at least one of the backup nodes; and executing the transaction request by the primary node in response to receiving a pre-determined number of third messages that are identical.</div>
<div class="description-paragraph" id="p-0060" num="0059">In some implementations, actions includes: receiving, by a backup node, a first message from the primary node, wherein the first message comprises a composite hash value associated with a plurality of EC blocks, wherein the plurality of EC blocks are generated by the primary node according to an EC code using a transaction request; in response to receiving the first message, sending, by the backup node, a second message to the other network nodes, wherein the second message comprises the first message and a signature of the backup node associated with the first message; receiving, by the backup node, at least one second message from at least one backup node other than the backup node; in response to receiving the at least one second message from the at least one backup node, verifying, by the backup node, whether the at least one second message is valid; determining, by the backup node, whether a number of valid second messages exceeds a pre-determined threshold; in response to determining that the number of valid second messages exceeds the pre-determined threshold, reconstructing, by the backup node, the transaction request based on a subset of the number of valid second messages according to the EC code; in response to determining that the transaction request has been successfully reconstructed, sending, by the backup node, a third message, to the other network nodes, wherein the third message comprises a set of signatures that are in the valid second messages; receiving, by the backup node, at least one third message from at least one of the backup nodes; and in response to receiving a pre-determined number of third messages that are identical, executing, by the backup node, the transaction request.</div>
<div class="description-paragraph" id="p-0061" num="0060">To provide further context for implementations of the present specification, and as introduced above, distributed ledger systems (DLSs), which can also be referred to as consensus networks (e.g., made up of peer-to-peer nodes) or blockchain networks, enable participating entities to securely, and immutably conduct transactions, and store data. The term blockchain is used herein to generally refer to a DLS without reference to any particular use case. As introduced above, a blockchain network can be provided as a public blockchain network, a private blockchain network, or a consortium blockchain network.</div>
<div class="description-paragraph" id="p-0062" num="0061">A blockchain is a data structure that stores transactions in a way that allows future transactions to be verified for consistency with all prior transactions stored in the chain. A blockchain includes one or more blocks. Each block in the chain is linked to a previous block immediately before it in the chain by including a cryptographic hash of the previous block. Each block also includes a timestamp, its own cryptographic hash, and one or more transactions. The transactions, which have already been verified by the nodes of the blockchain network, are hashed and encoded into a Merkle tree. A Merkle tree is a data structure in which data at the leaf nodes of the tree is hashed, and all hashes in each branch of the tree are concatenated at the root of the branch. This process continues up the tree to the root of the entire tree, which stores a hash that is representative of all data in the tree. A hash purporting to be of a transaction stored in the tree can be quickly verified by determining if it is consistent with the structure of the tree.</div>
<div class="description-paragraph" id="p-0063" num="0062">Whereas a blockchain is a data structure for storing transactions, a blockchain network is a network of computing nodes that manage, update, and maintain one or more blockchain structures. As introduced above, a blockchain network can be provided as a public blockchain network, a private blockchain network, or a consortium blockchain network.</div>
<div class="description-paragraph" id="p-0064" num="0063">In a public blockchain network, the consensus process is controlled by nodes of the consensus network. For example, hundreds, thousands, even millions of entities can cooperate in a public blockchain network, each of which operates at least one node in the public blockchain network. Accordingly, the public blockchain network can be considered a public network with respect to the participating entities. In some examples, a majority of entities (nodes) must sign every block in order for the block to be valid, and added to the blockchain (distributed ledger) of the blockchain network. Example public blockchain networks include particular peer-to-peer payment networks that leverage a distributed ledger, referred to as blockchain. As noted above, the term blockchain, however, is used to generally refer to distributed ledgers without particular reference to any particular blockchain network.</div>
<div class="description-paragraph" id="p-0065" num="0064">In general, a public blockchain network supports public transactions. A public transaction is shared with all of the nodes within the public blockchain network, and are stored in a global blockchain. A global blockchain is a blockchain that is replicated across all nodes. That is, all nodes are in perfect state consensus with respect to the global blockchain. To achieve consensus (e.g., agreement to the addition of a block to a blockchain), a consensus protocol is implemented within the public blockchain network. Examples of consensus protocols include, without limitation, proof-of-work (POW), proof-of-stake (POS), and proof-of-authority (POA). POW is referenced further herein as a non-limiting example.</div>
<div class="description-paragraph" id="p-0066" num="0065">In general, a private blockchain network is provided for a particular entity, which centrally controls read and write permissions. The entity controls which nodes are able to participate in the blockchain network, thus, private blockchain networks are generally referred to as permissioned networks that place restrictions on who is allowed to participate in the network, and on their level of participation (e.g., only in certain transactions). Various types of access control mechanisms can be used (e.g., existing participants vote on adding new entities, a regulatory authority can control admission).</div>
<div class="description-paragraph" id="p-0067" num="0066">In general, a consortium blockchain network is private among the participating entities. In a consortium blockchain network, the consensus process is controlled by an authorized set of nodes, one or more nodes being operated by a respective entity (e.g., a financial institution, insurance company). For example, a consortium of ten (10) entities (e.g., financial institutions, insurance companies) can operate a consortium blockchain network, each of which operates at least one node in the consortium blockchain network. Accordingly, the consortium blockchain network can be considered a private network with respect to the participating entities. In some examples, each entity (node) must sign every block in order for the block to be valid, and added to the blockchain. In some examples, at least a sub-set of entities (nodes) (e.g., at least 7 entities) must sign every block in order for the block to be valid, and added to the blockchain.</div>
<div class="description-paragraph" id="p-0068" num="0067">Implementations of the present specification are described in further detail herein with reference to a consortium blockchain network. It is contemplated, however, that implementations of the present specification can be realized in any appropriate type of blockchain network.</div>
<div class="description-paragraph" id="p-0069" num="0068">Implementations of the present specification are described in further detail herein in view of the above context. More particularly, and as introduced above, implementations of the present specification are directed to performing a recovery process for a network node in a distributed system.</div>
<div class="description-paragraph" id="p-0070" num="0069">A blockchain is a tamper-proof, shared digital ledger that records transactions in a public or private peer-to-peer network. The ledger is distributed to all member nodes in the network, and the history of asset transactions occurring in the network is permanently recorded in the block.</div>
<div class="description-paragraph" id="p-0071" num="0070">Consensus mechanisms ensure that all network nodes in a distributed blockchain network execute transactions in the same order and then write into the same ledgers. One issue that the consensus models aim to address is to overcome Byzantine failures. In a Byzantine failure, a component such as a server or a network node of a distributed blockchain network can inconsistently appear both failed and functioning to failure-detection systems, presenting different symptoms to different observers. It is difficult for the other network nodes to declare it failed and shut it out of the network, because they need to first reach a consensus regarding which network node has failed in the first place.</div>
<div class="description-paragraph" id="p-0072" num="0071">In the context of distributed systems, Byzantine fault tolerance (BFT) is the ability of a distributed computer network to function as desired and correctly reach a sufficient consensus despite malicious components (i.e., network nodes of a blockchain network) of the system failing or propagating incorrect information to other peers. The objective is to defend against catastrophic system failures by mitigating the influence these malicious nodes have on the correct function of the network and the right consensus that is reached by the honest nodes in the system.</div>
<div class="description-paragraph" id="p-0073" num="0072">However, the existing BFT mechanisms have proven inefficient in many aspects. For example, the existing BFT mechanisms have added complexity of implementation to the distributed blockchain network when attempting to overcome the Byzantine failures such that latency is increased for the communication among the network nodes of the distributed blockchain network. Practical Byzantine Fault Tolerance (PBFT) is one of the optimizations that aims to improve upon the existing BFT consensus mechanisms. The PBFT model focuses on providing a practical Byzantine state machine replication that tolerates Byzantine faults (malicious nodes) through an assumption that there are independent node failures and manipulated messages that are propagated by specific, independent nodes.</div>
<div class="description-paragraph" id="p-0074" num="0073">In the PBFT model, all of the nodes are ordered in a sequence with one node being the primary node (leader) and the others referred to as the backup nodes. All of the nodes within the system communicate with each other and the goal is for a majority of the honest nodes to come to an agreement of the state of the system. Nodes communicate with each other, and not only have to prove that messages came from a specific peer node, but also need to verify that the message was not modified during transmission.</div>
<div class="description-paragraph" id="p-0075" num="0074">For the PBFT model to work, the assumption is made that the amount of malicious nodes in the network cannot simultaneously equal or exceed ⅓ of the overall nodes in the system in a given window of vulnerability. The more nodes in the system, then the more mathematically unlikely it is for a number approaching ⅓ of the overall nodes to be malicious. The algorithm effectively provides both liveness and safety as long as at most (n−1)/3 nodes are malicious or faulty at the same time, where n represents total nodes.</div>
<div class="description-paragraph" id="p-0076" num="0075">Each round of PBFT consensus (called views) includes 4 phases:</div>
<div class="description-paragraph" id="p-0077" num="0076">(1) A client sends a request to the leader node to invoke a service operation;</div>
<div class="description-paragraph" id="p-0078" num="0077">(2) The leader node multicasts the request to the backup nodes;</div>
<div class="description-paragraph" id="p-0079" num="0078">(3) The nodes execute the request and then send a reply to the client; and</div>
<div class="description-paragraph" id="p-0080" num="0079">(4) The client awaits for f+1 (f represents the maximum number of nodes that may be faulty) replies from different nodes with the same result.</div>
<div class="description-paragraph" id="p-0081" num="0080">The final result is that all honest nodes come to an agreement on the order of the record and they either accept or reject it. The leader node is changed in a round robin scheme during every view and can even be replaced with a protocol called view change if a specific amount of time has passed without the leader node multicasting the request. A majority of honest nodes can also decide whether a leader is faulty and remove them with the next leader in line as the replacement.</div>
<div class="description-paragraph" id="p-0082" num="0081">However, there are some limitations to the PBFT consensus mechanism. For example, the PBFT model may work well in its classical form with relatively small consensus group sizes due to cumbersome amount of communication that is required between the nodes. The bulky block data that are transmitted between the network nodes cause a network load issue and lead to a network bottleneck. Furthermore, using method authentication codes (MAC) as the format for authentication messages in the PBFT model can be inefficient with the amount of communication needed between the nodes in large consensus groups such as cryptocurrency networks and with MACs. There could be an inherent inability to prove the authenticity of messages to a third party.</div>
<div class="description-paragraph" id="p-0083" num="0082">Moreover, encountering consecutive malicious nodes when changing the leader node using a round robin method used by PBFT affects the blockchain service by introducing latency or delay in finding a leader node that is honest. For example, when selecting a first network node as the new leader node, the first network node may be a malicious node therefore cannot be selected as the new leader node. In a round robin method, a second network node in line may be selected as the new leader node. However, if the second network node is also a malicious node, another network node in line will be verified as whether it is suitable to be the leader node. This process continues until a new leader node that is honest is identified. Such frequent change of the leader node introduces significant latency in blockchain services.</div>
<div class="description-paragraph" id="p-0084" num="0083">Furthermore, the network nodes in a blockchain network may experience Byzantine fault or crash fault at any time. For example, a network node may be compromised by a malicious cyber attacker and behave improperly. If the network nodes that are compromised are not recovered promptly, the malicious cyber attacker may compromise the blockchain network and services by corrupting more than ⅓ of the network nodes without being detected.</div>
<div class="description-paragraph" id="p-0085" num="0084">To address the above-described issues and concerns associated with the existing BFT consensus mechanisms and the PBFT consensus mechanism, the present specification discloses improved consensus mechanisms including techniques for achieving consensus among network nodes in a distributed system, performing a change of primary node in a distributed system, and performing a recovery process for a network node in a distributed system. The described consensus mechanisms can achieve various advantages in different applications.</div>
<div class="description-paragraph" id="p-0086" num="0085">For example, the consensus process as discussed below includes many features that improve the operations of the blockchain system and help alleviate the network bottleneck. For example, the described consensus process includes converting a transaction request into a number of erasure code (EC) blocks according to an EC code and sending one of the EC blocks to each of the network nodes. The EC block is smaller in size than the original transaction request. Accordingly, sending the EC block instead of the full transaction request to the network nodes reduces the size of data blocks that are transmitted among the network nodes of the blockchain network, thereby conserving the network bandwidth and reducing the network load. This further reduces the size of data that are written to and read from the memory space of the network nodes, thereby reducing a burden on the memory space of the network nodes and improving the efficiency of the overall blockchain system.</div>
<div class="description-paragraph" id="p-0087" num="0086">Furthermore, the present specification describes an epoch change process that includes assigning respective weights to multiple phases of the consensus process, determining a weight sum based on the respective weights of the multiple phases, and determining a new primary node based on the weight sum. The epoch change process based on the weigh sum instead of a round robin method can facilitate choosing a new primary node that is non-faulty in a timely manner. A primary node may be a leader node that has the authority to initiate a round of consensus process among a number of network nodes including the primary node. The other network nodes of the blockchain network can be referred to as backup nodes. The epoch change process can help address the issue of the round robin method that cause a frequent change of primary node when multiple network nodes in line for the new primary node are faulty. Unlike the round robin method, the epoch change process in the present specification relies on the weight sum to select the new primary node, which can reduce latency or delay in finding the new primary node that is not faulty. This can further improve the efficiency of the overall blockchain system in providing the blockchain services.</div>
<div class="description-paragraph" id="p-0088" num="0087">Moreover, the present specification discusses a recovery process that includes operations such as sending a state request message by a network node that applies to be a new primary node and receiving state reply messages from the other network nodes. These operations are performed such that the recovery process of the faulty network node does not interfere with the normal operation of the consensus process among the other non-faulty network nodes. This facilitates conserving computing and network resources for recovering the faulty network node by reducing the complexity of the recovery process.</div>
<div class="description-paragraph" id="p-0089" num="0088"> <figref idrefs="DRAWINGS">FIG. 1</figref> depicts an example of an environment <b>100</b> that can be used to execute implementations of the present specification. In some examples, the environment <b>100</b> enables entities to participate in a consortium blockchain network <b>102</b>. The environment <b>100</b> includes computing devices or systems <b>106</b>, <b>108</b>, and a network <b>110</b>. In some examples, the network <b>110</b> includes a local area network (LAN), wide area network (WAN), the Internet, or a combination thereof, and connects web sites, user devices (e.g., computing devices), and back-end systems. In some examples, the network <b>110</b> can be accessed over a wired and/or a wireless communications link. In some examples, the network <b>110</b> enables communication with, and within the consortium blockchain network <b>102</b>. In general the network <b>110</b> represents one or more communication networks. In some cases, the computing devices <b>106</b>, <b>108</b> can be nodes of a cloud computing system (not shown), or can each computing device <b>106</b>, <b>108</b> be a separate cloud computing system including a plurality of computers interconnected by a network and functioning as a distributed processing system.</div>
<div class="description-paragraph" id="p-0090" num="0089">In the depicted example, the computing systems <b>106</b>, <b>108</b> can each include any appropriate computing system that enables participation as a node in the consortium blockchain network <b>102</b>. Example computing devices include, without limitation, a server, a desktop computer, a laptop computer, a tablet computing device, and a smartphone. In some examples, the computing systems <b>106</b>, <b>108</b> hosts one or more computer-implemented services for interacting with the consortium blockchain network <b>102</b>. For example, the computing system <b>106</b> can host computer-implemented services of a first entity (e.g., user A), such as transaction management system that the first entity uses to manage its transactions with one or more other entities (e.g., other users). The computing system <b>108</b> can host computer-implemented services of a second entity (e.g., user B), such as transaction management system that the second entity uses to manage its transactions with one or more other entities (e.g., other users). In the example of <figref idrefs="DRAWINGS">FIG. 1</figref>, the consortium blockchain network <b>102</b> is represented as a peer-to-peer network of nodes, and the computing systems <b>106</b>, <b>108</b> provide nodes of the first entity, and second entity respectively, which participate in the consortium blockchain network <b>102</b>.</div>
<div class="description-paragraph" id="p-0091" num="0090"> <figref idrefs="DRAWINGS">FIG. 2</figref> depicts an example of a conceptual architecture <b>200</b> in accordance with implementations of the present specification. The example of a conceptual architecture <b>200</b> includes participant systems <b>202</b>, <b>204</b>, <b>206</b> that correspond to Participant A, Participant B, and Participant C, respectively. Each participant (e.g., user, enterprise) participates in a blockchain network <b>212</b> provided as a peer-to-peer network including a plurality of nodes <b>214</b>, at least some of which immutably record information in a blockchain <b>216</b>. Although a single blockchain <b>216</b> is schematically depicted within the blockchain network <b>212</b>, multiple copies of the blockchain <b>216</b> are provided, and are maintained across the blockchain network <b>212</b>, as described in further detail herein.</div>
<div class="description-paragraph" id="p-0092" num="0091">In the depicted example, each participant system <b>202</b>, <b>204</b>, <b>206</b> is provided by, or on behalf of Participant A, Participant B, and Participant C, respectively, and functions as a respective node <b>214</b> within the blockchain network. As used herein, a node generally refers to an individual system (e.g., computer, server) that is connected to the blockchain network <b>212</b>, and enables a respective participant to participate in the blockchain network. In the example of <figref idrefs="DRAWINGS">FIG. 2</figref>, a participant corresponds to each node <b>214</b>. It is contemplated, however, that a participant can operate multiple nodes <b>214</b> within the blockchain network <b>212</b>, and/or multiple participants can share a node <b>214</b>. In some examples, the participant systems <b>202</b>, <b>204</b>, <b>206</b> communicate with, or through the blockchain network <b>212</b> using a protocol (e.g., hypertext transfer protocol secure (HTTPS)), and/or using remote procedure calls (RPCs).</div>
<div class="description-paragraph" id="p-0093" num="0092">Nodes <b>214</b> can have varying degrees of participation within the blockchain network <b>212</b>. For example, some nodes <b>214</b> can participate in the consensus process (e.g., as minder nodes that add blocks to the blockchain <b>216</b>), while other nodes <b>214</b> do not participate in the consensus process. As another example, some nodes <b>214</b> store a complete copy of the blockchain <b>216</b>, while other nodes <b>214</b> only store copies of portions of the blockchain <b>216</b>. For example, data access privileges can limit the blockchain data that a respective participant stores within its respective system. In the example of <figref idrefs="DRAWINGS">FIG. 2</figref>, the participant systems <b>202</b>, <b>204</b>, <b>206</b> store respective, complete copies <b>216</b>′, <b>216</b>″, <b>216</b>′″ of the blockchain <b>216</b>.</div>
<div class="description-paragraph" id="p-0094" num="0093">A blockchain (e.g., the blockchain <b>216</b> of <figref idrefs="DRAWINGS">FIG. 2</figref>) is made up of a chain of blocks, each block storing data. Examples of data include transaction data representative of a transaction between two or more participants. While transactions are used herein by way of non-limiting example, it is contemplated that any appropriate data can be stored in a blockchain (e.g., documents, images, videos, audio). Examples of transactions can include, without limitation, exchanges of something of value (e.g., assets, products, services, and currency). The transaction data is immutably stored within the blockchain. That is, the transaction data cannot be changed.</div>
<div class="description-paragraph" id="p-0095" num="0094">Before storing in a block, the transaction data is hashed. Hashing is a process of transforming the transaction data (provided as string data) into a fixed-length hash value (also provided as string data). It is not possible to un-hash the hash value to obtain the transaction data. Hashing ensures that even a slight change in the transaction data results in a completely different hash value. Further, and as noted above, the hash value is of fixed length. That is, no matter the size of the transaction data the length of the hash value is fixed. Hashing includes processing the transaction data through a hash function to generate the hash value. An example of hash function includes, without limitation, the secure hash algorithm (SHA)-256, which outputs 256-bit hash values.</div>
<div class="description-paragraph" id="p-0096" num="0095">Transaction data of multiple transactions are hashed and stored in a block. For example, hash values of two transactions are provided, and are themselves hashed to provide another hash. This process is repeated until, for all transactions to be stored in a block, a single hash value is provided. This hash value is referred to as a Merkle root hash, and is stored in a header of the block. A change in any of the transactions will result in change in its hash value, and ultimately, a change in the Merkle root hash.</div>
<div class="description-paragraph" id="p-0097" num="0096">Blocks are added to the blockchain through a consensus protocol. Multiple nodes within the blockchain network participate in the consensus protocol, and compete to have a block added to the blockchain. Such nodes are referred to as miners (or minder nodes). POW, introduced above, is used as a non-limiting example.</div>
<div class="description-paragraph" id="p-0098" num="0097">The miner nodes execute the consensus process to add transactions to the blockchain. Although multiple miner nodes participate in the consensus process, only one miner node can write the block to the blockchain. That is, the miner nodes compete in the consensus process to have their block added to the blockchain. In further detail, a miner node periodically collects pending transactions from a transaction pool (e.g., up to a predefined limit on the number of transactions that can be included in a block, if any). The transaction pool includes transaction messages from participants in the blockchain network. The miner node constructs a block, and adds the transactions to the block. Before adding the transactions to the block, the miner node checks whether any of the transactions are already included in a block of the blockchain. If a transaction is already included in another block, the transaction is discarded.</div>
<div class="description-paragraph" id="p-0099" num="0098">The miner node generates a block header, hashes all of the transactions in the block, and combines the hash value in pairs to generate further hash values until a single hash value is provided for all transactions in the block (the Merkle root hash). This hash is added to the block header. The miner also determines the hash value of the most recent block in the blockchain (i.e., the last block added to the blockchain). The miner node also adds a nonce value, and a timestamp to the block header. In a mining process, the miner node attempts to find a hash value that meets required parameters. The miner node keeps changing the nonce value until finding a hash value that meets the required parameters.</div>
<div class="description-paragraph" id="p-0100" num="0099">Every miner in the blockchain network attempts to find a hash value that meets the required parameters, and, in this way, compete with one another. Eventually, one of the miner nodes finds a hash value that meets the required parameters, and advertises this to all other miner nodes in the blockchain network. The other miner nodes verify the hash value, and if determined to be correct, verifies each transaction in the block, accepts the block, and appends the block to their copy of the blockchain. In this manner, a global state of the blockchain is consistent across all miner nodes within the blockchain network. The above-described process is the POW consensus protocol.</div>
<div class="description-paragraph" id="p-0101" num="0100">A non-limiting example is provided with reference to <figref idrefs="DRAWINGS">FIG. 2</figref>. In this example, Participant A wants to send an amount of fund to Participant B. Participant A generates a transaction message (e.g., including From, To, and Value fields), and sends the transaction message to the blockchain network, which adds the transaction message to a transaction pool. Each miner node in the blockchain network creates a block, and takes all transactions from the transaction pool (e.g., up to a predefined limit on the number of transaction that can be added to a block, if any), and adds the transactions to the block. In this manner the transaction published by Participant A is added to the blocks of the miner nodes.</div>
<div class="description-paragraph" id="p-0102" num="0101">In some blockchain networks, cryptography is implemented to maintain privacy of transactions. For example, if two nodes want to keep a transaction private, such that other nodes in the blockchain network cannot discern details of the transaction, the nodes can encrypt the transaction data. Examples of cryptographic methods include, without limitation, symmetric encryption, and asymmetric encryption. Symmetric encryption refers to an encryption process that uses a single key for both encryption (generating ciphertext from plaintext), and decryption (generating plaintext from ciphertext). In symmetric encryption, the same key is available to multiple nodes, so each node can en-/de-crypt transaction data.</div>
<div class="description-paragraph" id="p-0103" num="0102">Asymmetric encryption uses keys pairs that each include a private key, and a public key, the private key being known only to a respective node, and the public key being known to any or all other nodes in the blockchain network. A node can use the public key of another node to encrypt data, and the encrypted data can be decrypted using other node's private key. For example, and referring again to <figref idrefs="DRAWINGS">FIG. 2</figref>, Participant A can use Participant B's public key to encrypt data, and send the encrypted data to Participant B. Participant B can use its private key to decrypt the encrypted data (ciphertext) and extract the original data (plaintext). Messages encrypted with a node's public key can only be decrypted using the node's private key.</div>
<div class="description-paragraph" id="p-0104" num="0103">Asymmetric encryption is used to provide digital signatures, which enables participants in a transaction to confirm other participants in the transaction, as well as the validity of the transaction. For example, a node can digitally sign a message, and another node can confirm that the message was sent by the node based on the digital signature of Participant A. Digital signatures can also be used to ensure that messages are not tampered with in transit. For example, and again referencing <figref idrefs="DRAWINGS">FIG. 2</figref>, Participant A is to send a message to Participant B. Participant A generates a hash of the message, and then, using its private key, encrypts the hash to provide a digital signature as the encrypted hash. Participant A appends the digital signature to the message, and sends the message with digital signature to Participant B. Participant B decrypts the digital signature using the public key of Participant A, and extracts the hash. Participant B hashes the message and compares the hashes. If the hashes are same, Participant B can confirm that the message was indeed from Participant A, and was not tampered with.</div>
<div class="description-paragraph" id="p-0105" num="0104"> <figref idrefs="DRAWINGS">FIG. 3</figref> depicts an example of a process <b>300</b> for achieving consensus among network nodes (e.g., node <b>214</b>) of a distributed system (e.g., blockchain network <b>102</b> and <b>212</b>) that can be executed in accordance with implementations of the present specification. Specifically, <figref idrefs="DRAWINGS">FIG. 3</figref> illustrates a diagram presenting an exemplary embodiment of a method <b>300</b> of achieving consensus in a normal case, according to the present specification. As illustrated in <figref idrefs="DRAWINGS">FIG. 3</figref>, the consensus process <b>300</b> includes three phases or stages <b>310</b>, <b>320</b>, and <b>330</b> as discussed below.</div>
<div class="description-paragraph" id="p-0106" num="0105">In a first phase <b>310</b> of the consensus process <b>300</b>, a primary node (or a leader node) of the blockchain network sends a first message to the other network nodes (i.e., the backup nodes). The first message indicates that the primary node is initiating a consensus process. For example, as illustrated in <figref idrefs="DRAWINGS">FIG. 3</figref>, the primary node R<sub>0 </sub>sends an INITIAL message to other networks nodes R<sub>1</sub>, R<sub>2</sub>, and R<sub>3 </sub>in the blockchain network. Note that process <b>300</b> is illustrated as including four network nodes R<sub>0</sub>, R<sub>1</sub>, R<sub>2</sub>, and R<sub>3 </sub>for illustrative purposes only, process <b>300</b> may include any suitable number of network nodes. The first phase and a format of the INITIAL message will be discussed below in greater detail with reference to <figref idrefs="DRAWINGS">FIGS. 4-6</figref>.</div>
<div class="description-paragraph" id="p-0107" num="0106">In a second phase <b>320</b> of the consensus process <b>300</b>, each of the backup nodes receives the first message that is sent by the primary node, prepares a second message in response to the first message, and multicasts the second message to the other network node. The second message indicates that the backup node has received the first message from the primary node and is sending a reply in response to the first message. For example, as illustrated in <figref idrefs="DRAWINGS">FIG. 3</figref>, the backup node R<sub>1 </sub>receives the INITIAL message that is sent by the primary node R<sub>0</sub>, and replies to the primary node R<sub>0 </sub>with an ECHO message as an example of the second message. Meanwhile, the backup node R<sub>1 </sub>also multicasts the ECHO message to the other backup nodes, such as, backup nodes R<sub>2 </sub>and R<sub>3</sub>. Similarly, backup node R<sub>2 </sub>and R<sub>3 </sub>each multicasts an ECHO message to the other network nodes including the primary node R<sub>0</sub>.</div>
<div class="description-paragraph" id="p-0108" num="0107">When a network node, for example such as a primary node or a backup node, receives the ECHO messages from the other network nodes, the network node may verify the information in the ECHO messages. The second phase and a format of the ECHO message will be discussed below in greater detail with reference to <figref idrefs="DRAWINGS">FIGS. 4-6</figref>.</div>
<div class="description-paragraph" id="p-0109" num="0108">In a third phase <b>330</b> of the consensus process <b>300</b>, each of the network nodes multicasts a third message to the other network nodes. The third message indicates that a network node has accepted a predetermined number of the second messages. In some implementations, the third message can indicate that the network node is ready to execute the transaction. In some implementations, the third message can indicate that the transaction has been successfully reconstructed at the network node. For example, as illustrated in <figref idrefs="DRAWINGS">FIG. 3</figref>, the primary node R<sub>0 </sub>multicasts an ACCEPT message to the backup nodes R<sub>1</sub>, R<sub>2</sub>, and R<sub>3</sub>. Similarly, the backup nodes R<sub>1</sub>, R<sub>2</sub>, and R<sub>2 </sub>each multicasts an ACCEPT message to the other network nodes. In some implementations of the present specification, before multicasting the ACCEPT message, a network node determines whether the ACCEPT is sent according to an erasure code (EC) and the information in the ECHO messages are that received in the second phase. The third phase, the EC code, and a format of the ACCEPT message will be discussed below in greater detail with reference to <figref idrefs="DRAWINGS">FIGS. 4-6</figref>.</div>
<div class="description-paragraph" id="p-0110" num="0109">When a network node receives enough ACCEPT messages from the other network nodes, the network node determines that a consensus has been achieved. For example, if the primary node R<sub>0 </sub>or the backup nodes R<sub>1</sub>, R<sub>2</sub>, or R<sub>3 </sub>receives a quorum (e.g., 2f+1, where f represents a number of faulty network nodes) number of ACCEPT messages, a consensus is achieved automatically among the network nodes.</div>
<div class="description-paragraph" id="p-0111" num="0110"> <figref idrefs="DRAWINGS">FIG. 4</figref> depicts an example of a process <b>400</b> for achieving consensus among network nodes (e.g., node <b>214</b> or nodes R<sub>0</sub>, R<sub>1</sub>, R<sub>2</sub>, and R<sub>3</sub>) of a distribute system (e.g., blockchain network <b>102</b> or <b>212</b>) that can be executed in accordance with implementations of the present specification. In some implementations, the process <b>400</b> may be performed using one or more computer-executable programs executed using one or more computing devices. For clarity of presentation, the description that follows generally describes method <b>400</b> in the context of the other figures in this description. It will be understood that method <b>400</b> may be performed, for example, by any suitable system, environment, software, and hardware, or a combination of systems, environments, software, and hardware, as appropriate. In some implementations, various steps of method <b>400</b> can be run in parallel, in combination, in loops, or in any order.</div>
<div class="description-paragraph" id="p-0112" num="0111">At the outset, the process <b>400</b> may be implemented in conjunction with the system <b>100</b>-<b>300</b> as illustrated in <figref idrefs="DRAWINGS">FIGS. 1-3</figref>. In some implementations of the present specification, the blockchain network <b>102</b> and/or <b>212</b> includes a primary node <b>404</b> and one or more backup nodes <b>406</b>. The blockchain network <b>102</b> and/or <b>212</b> communicates with the computing system <b>106</b> and/or <b>108</b>, such as, client nodes <b>402</b> via network <b>110</b> to provide blockchain services. Each of the client node <b>402</b>, primary node <b>404</b>, and backup node <b>406</b> can be a special purpose computer or other data processing apparatus configured to perform the processes discussed herein. For example, the client node <b>402</b> can also referred to as a client terminal or a client device that interacts with a blockchain network. The client node <b>402</b> can install, for example, a client application or a client software development kit (SDK) in connection with the blockchain network for accessing and communicating with the blockchain network. The primary node <b>404</b> and one or more backup nodes <b>406</b> can also be referred to as consensus nodes or network nodes that achieve consensus and immutably record information in the blockchain network.</div>
<div class="description-paragraph" id="p-0113" num="0112">Process <b>400</b> starts at <b>408</b> where the client node <b>402</b> generates a transaction request. In some implementations of the present specification, the transaction request can include a request requesting a blockchain service from the blockchain network <b>102</b> and/or <b>212</b>.</div>
<div class="description-paragraph" id="p-0114" num="0113">At <b>410</b>, the client node <b>402</b> multicasts the transaction request to the primary node <b>404</b> of the blockchain network <b>102</b> and/or <b>212</b>. In some implementations of the present specification, the primary node <b>404</b> assigns a sequence number to the transaction request to keep track of transaction requests after receiving the transaction request from the client node <b>402</b>.</div>
<div class="description-paragraph" id="p-0115" num="0114">At <b>412</b>, the primary node <b>404</b> generates a number of EC blocks after receiving the transaction request from the client node <b>402</b>. In some implementations of the present specification, the primary node <b>404</b> generates the number of EC blocks according to an EC code using the transaction request. For example, referring to <figref idrefs="DRAWINGS">FIG. 5</figref>, the primary node <b>404</b> applies an EC code <b>504</b> on a transaction request <b>502</b> and transforms the transaction request <b>502</b> into an EC message <b>506</b> using the EC code <b>504</b>. The EC code <b>504</b> is a forward error correction (FEC) code under the assumption of bit erasures. The EC code <b>504</b> transforms the original transaction request <b>502</b> into a longer EC message <b>506</b> such that the original transaction request <b>502</b> can be recovered from a portion or a fragment of the EC message <b>506</b>.</div>
<div class="description-paragraph" id="p-0116" num="0115">In some implementations of the present specification, the EC code <b>504</b> is a near-optimal erasure code, such as, a Tornado code or a low-density parity-check code. In alternative implementations of the present specification, the EC code <b>504</b> is a near optimal fountain code, such as, a fountain code, an online code, a Luby transform (LT) code, or a raptor code. In alternative implementations of the present specification, the EC code <b>504</b> is an optimal erasure code, such as, a parity code, a Parchive code, a Reed-Solomon code, or a regenerating code. In some implementations of the present specification, the EC code <b>504</b> can be any suitable type of erasure code.</div>
<div class="description-paragraph" id="p-0117" num="0116">After transforming the transaction request <b>502</b> into the EC message <b>506</b>, the primary node <b>404</b> generates a number of EC blocks <b>508</b> using the EC message <b>506</b>. For example, as illustrated in <figref idrefs="DRAWINGS">FIG. 5</figref>, the primary node <b>404</b> generates four EC blocks <b>508</b>, EC block A, EC block B, EC block C, and EC block D by dividing the EC message <b>506</b>. Note that the EC blocks <b>508</b> are illustrated in <figref idrefs="DRAWINGS">FIG. 5</figref> as including four blocks for illustrative purpose, the EC blocks <b>508</b> may be generated as including any suitable number of EC blocks <b>508</b>. The EC blocks <b>508</b> will be sent to the respective backup nodes <b>406</b> within the INITIAL messages.</div>
<div class="description-paragraph" id="p-0118" num="0117">In some implementations of the present specification, the EC blocks <b>508</b> have a same size. However, in alternative implementations, the EC blocks <b>508</b> may have sizes that are different from each other.</div>
<div class="description-paragraph" id="p-0119" num="0118">In some implementations of the present specification, the primary node <b>404</b> generates a hash tree <b>500</b> (e.g., a Merkle tree) using the EC blocks <b>508</b>. The hash tree <b>500</b> includes a number of leaf node that are labeled with the hash of data blocks and a number of non-leaf nodes that are labeled with the cryptographic hash of the labels of its child nodes. For example, as illustrated in <figref idrefs="DRAWINGS">FIG. 5</figref>, the hash tree <b>500</b> is configured as including four leaf nodes <b>510</b>, hash A, hash B, hash C, and hash D that are generated as a cryptographic hash of their respective EC blocks <b>508</b>, four non-leaf nodes <b>512</b> that are generated as a hash of the concatenation of their respective child nodes <b>510</b>, and a non-leaf node <b>514</b> that is generated as a hash of its child nodes <b>512</b> and is a root hash of the hash tree <b>500</b>.</div>
<div class="description-paragraph" id="p-0120" num="0119">Hash trees <b>500</b> allow efficient and secure verification of the contents of large data structures. Hash trees <b>500</b> can be used to verify any kind of data stored, handled, and transferred in and between computers. They can help ensure that data blocks received from other peers in a P2P network are received undamaged and unaltered, and even to check that the other peers do not send fake blocks. Verification of data blocks using the hash tree <b>500</b> will be discussed below in greater detail with reference to the following steps of the consensus process <b>400</b>.</div>
<div class="description-paragraph" id="p-0121" num="0120">Referring back to <figref idrefs="DRAWINGS">FIG. 4</figref>, the primary node <b>404</b> generate a first message (e.g., an INITIAL message) after generating the EC blocks <b>508</b> and the hash tree <b>500</b>. The first message indicates that the primary node is initiating a consensus process. In some implementations, the INITIAL message, as an example of the first message, is generated using the information in the EC blocks <b>508</b> and the hash tree <b>500</b>. In some implementations of the present specification, referring to <figref idrefs="DRAWINGS">FIG. 6</figref>, the INITIAL message has a format of &lt;epoch, tx_root_hash, ec_block_hash, ec_block, seq, j&gt;, where “epoch” represents a round of consensus in which the message is being sent, “tx_root_hash” represents the root hash <b>514</b> in the hash tree <b>500</b>, “ec_block_hash” represents the hashes <b>510</b> and/or <b>512</b> in the hash tree <b>500</b>, “ec_block” represents the EC blocks <b>508</b> in the hash tree <b>500</b>, “seq” represents the sequence number associated with the transaction request <b>502</b>, and “j” represents the network node that generates and sends the INITIAL message. In some implementations, the INITIAL message can have a different format, for example, by including additional or different fields.</div>
<div class="description-paragraph" id="p-0122" num="0121">Referring back to <figref idrefs="DRAWINGS">FIG. 4</figref>, at <b>416</b>, in the first phase of the consensus process, the primary node <b>404</b> multicasts the INITIAL message to the other network nodes (e.g., backup nodes <b>406</b>). In some implementations, the INITIAL messages that are sent to the backup nodes <b>406</b> have a format of &lt;epoch, tx_root_hash, ec_block_hash, ec_block, seq, j&gt;. For example, the primary node <b>404</b> may send a first INITIAL message &lt;epoch 1, Hash ABCD, {Hash B, Hash C, Hash D}, EC block A, 1, 0&gt; to a first backup node <b>406</b>, and a second INITIAL message &lt;epoch 1, Hash ABCD, {Hash A, Hash C, Hash D}, EC block B, 1, 0&gt; to a second backup node <b>406</b>, and so on. Note that the information in the INITIAL message, such as “ec_block” can be used with “ec_block_hash” to reconstructing the hash tree <b>500</b>. For example, in the first INITIAL message &lt;epoch 1, Hash ABCD, {Hash B, Hash C, Hash D}, EC block A, 1, 0&gt;, the EC block <b>508</b> “EC block A” can be hashed to generate a cryptographic hash <b>510</b> “Hash A,” which is further used with the other hashes <b>510</b> “{Hash B, Hash C, Hash D}” to reconstruct the hash tree <b>500</b>. The reconstructed hash tree <b>500</b> will be used to verify the ECHO messages as discussed below in greater details with reference to the following steps of the consensus process.</div>
<div class="description-paragraph" id="p-0123" num="0122">At <b>418</b>, each of the backup nodes <b>406</b> generates a second message (e.g., an ECHO message) in the second phase of the consensus process after receiving the INITIAL message from the primary node <b>404</b>. The second message indicates that the backup node has received the first message from the primary node. The second message is sent as a reply in response to the first message. In some implementations of the present specification, the ECHO message is generated by a backup node <b>406</b> as including the INITIAL message or a part of the INITIAL message and a signature of the backup node <b>406</b> associated with the INITIAL message. For example, the backup node <b>406</b> may generate the signature by signing the INITIAL message or a digest of the INITIAL message using a private key. The private-key signature may be used by other network nodes using a public key paired with the private key to authenticate the ECHO message that includes the private-key signature.</div>
<div class="description-paragraph" id="p-0124" num="0123">In some implementations of the present specification, referring to <figref idrefs="DRAWINGS">FIG. 6</figref>, the ECHO message has a format of &lt;epoch, tx_root_hash, ec_block_hash, ec_block, seq, sign_proof, j&gt;, where “epoch” represents a round of consensus in which the message is being sent, “tx_root_hash” represents the root hash <b>514</b> in the hash tree <b>500</b>, “ec_block_hash” represents the hashes <b>510</b> and/or <b>512</b> in the hash tree <b>500</b>, “ec_block” represents the EC blocks <b>508</b> in the hash tree <b>500</b> that are received by the respective backup nodes <b>406</b>, “seq” represents the sequence number associated with the transaction request <b>502</b>, “sign-proof” represents the signature of the backup nodes <b>406</b> associated with the INITIAL messages, and “j” represents the network node that generates and sends the ECHO message. In some implementations, the ECHO message can have a different format, for example, by including additional or different fields.</div>
<div class="description-paragraph" id="p-0125" num="0124">Referring back to <figref idrefs="DRAWINGS">FIG. 4</figref>, at <b>420</b>, the backup nodes <b>406</b> send the ECHO messages to the primary node <b>404</b>. At <b>421</b>, each of the backup nodes <b>406</b> sends the ECHO messages to the other backup nodes <b>406</b>. At <b>423</b>, each of the backup nodes <b>406</b> may receive the ECHO messages from the other backup nodes <b>406</b>.</div>
<div class="description-paragraph" id="p-0126" num="0125">At <b>422</b>, the primary node <b>404</b> verifies the ECHO messages that are sent by the backup nodes <b>406</b>. In some implementations of the present specification, the primary node <b>404</b> verifies whether the ECHO messages are valid according to the hash tree <b>500</b>. For example, the primary node <b>404</b> may receive a first ECHO message &lt;epoch 1, Hash ABCD, {Hash B, Hash C, Hash D}, EC block A, 1, 1&gt; from a first backup node <b>406</b>. The primary node <b>404</b> can retrieve EC block <b>508</b> “EC block A” from the message and hash it to generate a cryptographic hash <b>510</b> “Hash A.” The primary node <b>404</b> further use the generated hash <b>510</b> “Hash A” with the other hashes <b>510</b> “{Hash B, Hash C, Hash D}” in the message to reconstruct the hash tree <b>500</b>. Then, the primary node <b>404</b> determines the root hash <b>514</b> of the reconstructed hash tree <b>500</b> and compares it with the root hash <b>514</b> in the ECHO message, such as, “Hash ABCD.” If the two root hashes <b>514</b> match, the primary node <b>404</b> determines that the ECHO message is valid. The primary node <b>404</b> may store the valid ECHO messages and discard the ECHO messages that are determined to be invalid.</div>
<div class="description-paragraph" id="p-0127" num="0126">At <b>424</b>, the primary node <b>404</b> determines whether a number of the valid ECHO messages exceeds a pre-determined threshold. In some implementations of the present specification, the primary node <b>404</b> determine whether the number of the valid ECHO messages reaches a quorum number n−f or 2f+1, where n is the total number of the network nodes and f is the maximum number of the faulty nodes that the network can tolerate.</div>
<div class="description-paragraph" id="p-0128" num="0127">At <b>426</b>, the primary node <b>404</b> reconstructs the transaction request <b>502</b> in response to determining that the number of the valid ECHO messages reaches the quorum number. In some implementations of the present specification, the primary node <b>404</b> reconstructs the transaction request <b>502</b> based on at least a subset of valid ECHO messages according the EC code. For example, the primary node <b>404</b> may retrieve a number of n−2f or f+1 of the EC blocks <b>508</b> that are in the quorum number (e.g., n−f or 2f+1) of valid ECHO messages, and use the retrieved EC blocks <b>508</b> to reconstructed the transaction request <b>502</b> according to the EC code <b>504</b>.</div>
<div class="description-paragraph" id="p-0129" num="0128">At <b>428</b>, in the third phase of the consensus process, the primary node <b>404</b> generates a third message (e.g., an ACCPET message) in response to determining that the transaction request <b>502</b> has been successfully reconstructed. The third message indicates that a network node has accepted a predetermined number of the second messages. In some implementations, the third message can indicate the network node is ready to execute the transaction. In some implementations, the third message can indicate that the transaction has been successfully reconstructed at the network node. For example, the ACCPET message can be used to indicate to other network nodes that the transaction request <b>502</b> has been successfully reconstructed. If the primary node <b>404</b> fails to reconstructed the transaction request <b>502</b>, the primary node <b>404</b> may not generate the ACCEPT message.</div>
<div class="description-paragraph" id="p-0130" num="0129">In some implementations of the present specification, referring to <figref idrefs="DRAWINGS">FIG. 6</figref>, the ACCEPT message has a format of &lt;epoch, tx_root_hash, seq, sign_proofs, j&gt;, where “epoch” represents a round of consensus in which the message is being sent, “tx_root_hash” represents the root hash <b>514</b> in the hash tree <b>500</b>, “seq” represents the sequence number associated with the transaction request <b>502</b>, “sign-proofs” represents a set of the signatures in the valid ECHO messages, and “j” represents the network node that generates and sends the ACCEPT message. In some implementations, the ACCEPT message can have a different format, for example, by including additional or different fields.</div>
<div class="description-paragraph" id="p-0131" num="0130">Referring back to <figref idrefs="DRAWINGS">FIG. 4</figref>, at <b>430</b>, the primary node <b>404</b> sends the ACCPET message to the backup nodes <b>406</b>.</div>
<div class="description-paragraph" id="p-0132" num="0131">Similar to the primary node <b>404</b>, each of the backup nodes <b>406</b> can reconstruct the transaction request, for example, by performing similar steps to the steps <b>422</b>-<b>428</b> as the primary node <b>404</b>. At <b>432</b>, each of the backup nodes <b>406</b> generates an ACCEPT message in response to determining that the transaction request <b>502</b> has been successfully reconstructed by the backup node <b>406</b>. In some implementations, the primary node <b>404</b> and the backup node <b>406</b> may perform steps <b>422</b>-<b>428</b> in a parallel manner, for example, as indicated in <figref idrefs="DRAWINGS">FIG. 3</figref>.</div>
<div class="description-paragraph" id="p-0133" num="0132">At <b>434</b>, the backup nodes <b>406</b> send the ACCEPT messages to the primary node <b>404</b>. Meanwhile each of the backup nodes <b>406</b> may send the ACCEPT messages to the other backup nodes <b>406</b>.</div>
<div class="description-paragraph" id="p-0134" num="0133">At <b>436</b>, the primary node <b>404</b> executes the transaction request <b>502</b> in response to determining that a number of the ACCEPT messages exceeds a pre-determined threshold. In some implementations of the present specification, the primary node <b>404</b> determines whether the received ACCEPT messages are identical and whether a number of the ACCEPT messages that are identical reaches a quorum number (e.g., 2f+1). If the number of the identical ACCEPT messages reaches the quorum number, the primary node <b>404</b> determines that a consensus has been achieved among all the network nodes and then executes the transaction request <b>502</b> locally. In some implementations of the present specification, if the primary node <b>404</b> determines the number of the ACCEPT messages that are identical does not reach the quorum number, the primary node <b>404</b> determines that a consensus has not been achieved among all the network nodes, and then refrains from executing the transaction request <b>502</b>.</div>
<div class="description-paragraph" id="p-0135" num="0134">In some implementations of the present specification, each of the backup nodes <b>406</b> may perform the same operations that is performed by the primary node <b>404</b> as described above at <b>436</b> before executing the transaction request <b>502</b>. If a backup node <b>406</b> determines that the ACCEPT messages it receives exceeds a pre-determined threshold, the backup node <b>406</b> determines a consensus has been achieved among the network nodes and executes the transaction request <b>502</b> locally. In some implementations of the present specification, if the backup node <b>406</b> determines the number of the ACCEPT messages that are identical does not reach the quorum number, the backup node <b>406</b> determines that a consensus has not been achieved among all the network nodes, and then refrains from executing the transaction request <b>502</b>.</div>
<div class="description-paragraph" id="p-0136" num="0135">At <b>438</b>, the primary node <b>404</b> sends a transaction result to the client node <b>402</b> after executing the transaction request <b>502</b>. The backup nodes <b>406</b> that have successfully executed the transaction request <b>502</b> locally may also send their respective transaction results to the client node <b>402</b>.</div>
<div class="description-paragraph" id="p-0137" num="0136">The consensus process as discussed above includes many features that improve the operation of the entire blockchain system and help alleviate the network bottleneck. For example, the consensus process in the present specification includes generating a number of EC blocks according to an EC code using a transaction request and send one of the EC blocks to each of the network nodes. The EC block is smaller in size than the original transaction request. Therefore, sending the EC block instead of the transaction request to the network nodes reduces the size of data blocks that are transmitted among the network nodes of the blockchain network, thereby conserving the network bandwidth and reducing the network load. This further reduces the size of data that are written to and read from the memory space of the network nodes, thereby reducing a burden on the memory space of the network nodes and improving the efficiency of the overall blockchain system.</div>
<div class="description-paragraph" id="p-0138" num="0137">During the consensus process, the backup nodes are waiting for a request from the primary node. However, the primary node may encounter a Byzantine failure or a crash failure so that the primary node cannot broadcast the request within a predetermined time window. When a specific amount of time has passed without the primary node multicasting the request, a new primary node may need to be chosen to prevent the backup nodes from waiting indefinitely for requests to execute.</div>
<div class="description-paragraph" id="p-0139" num="0138"> <figref idrefs="DRAWINGS">FIG. 7</figref> depicts an example of a process <b>700</b> for performing a change of a primary node (e.g., node <b>214</b> or <b>404</b>) of a distributed system (e.g., blockchain network <b>102</b> and <b>212</b>) that can be executed in accordance with implementations of the present specification. Specifically, <figref idrefs="DRAWINGS">FIG. 7</figref> illustrates a diagram presenting an exemplary embodiment of a method <b>700</b> of performing a change of a primary node, according to the present specification. In some implementations, a primary node is associated with an epoch that includes a consensus process with the primary node being the leader. A change of a primary node can result in a change of epoch.</div>
<div class="description-paragraph" id="p-0140" num="0139">In some implementations, in response to determining that a primary node of a current epoch needs to be changes, a backup node of the blockchain network sends a first message to the other network nodes. The first message indicates that the backup node would like to be a new primary node in a new epoch. For example, as illustrated in <figref idrefs="DRAWINGS">FIG. 7</figref>, the backup node R<sub>0 </sub>sends an EPOCH_CHANGE message to the other networks nodes R<sub>1</sub>, R<sub>2</sub>, and R<sub>3 </sub>in the blockchain network in response to that the backup node R<sub>0 </sub>determines that a current primary node is faulty and that an epoch change needs to be performed. The EPOCH_CHANGE message is an example of the first message indicating that the backup node R<sub>0 </sub>applies to be the new primary node. The epoch change can cause a change from a current epoch with a current primary node to a new epoch with a new primary node. Note that process <b>700</b> is illustrated as implemented in conjunction with four network nodes for illustrative purposes only. Process <b>700</b> may be implemented in conjunction with any suitable number of network nodes.</div>
<div class="description-paragraph" id="p-0141" num="0140">Then, each of the network nodes receives the first message that is sent by the backup node, prepares a second message in response to the first message, and multicasts the second message to the other network nodes. For example, as illustrated in <figref idrefs="DRAWINGS">FIG. 7</figref>, the network node R<sub>1 </sub>receives the EPOCH_CHANGE message that is sent by the backup node R<sub>0</sub>, and replies to the backup node R<sub>0 </sub>with a NEW_EPOCH message indicating an acknowledgement that the backup node R<sub>0 </sub>may become the new primary node. Meanwhile, the network node R<sub>1 </sub>also multicasts the NEW_EPOCH message to the other network nodes, such as, network nodes R<sub>2 </sub>and R<sub>3</sub>. Similarly, network node R<sub>2 </sub>and R<sub>3 </sub>each multicasts a NEW_EPOCH message to the other network nodes.</div>
<div class="description-paragraph" id="p-0142" num="0141">The epoch change process as discussed above, a format of the EPOCH_CHANGE message, and a format of the NEW_EPOCH message will be discussed below in greater detail with reference to <figref idrefs="DRAWINGS">FIGS. 8-9</figref>.</div>
<div class="description-paragraph" id="p-0143" num="0142"> <figref idrefs="DRAWINGS">FIG. 8</figref> depicts an example of a process <b>800</b> for performing a change of a primary node in a distribute system (e.g., blockchain network <b>102</b> or <b>212</b>) that can be executed in accordance with implementations of the present specification. In some implementations, the example process <b>800</b> may be performed using one or more computer-executable programs executed using one or more computing devices. For clarity of presentation, the description that follows generally describes method <b>800</b> in the context of the other figures in this description. It will be understood that method <b>800</b> may be performed, for example, by any suitable system, environment, software, and hardware, or a combination of systems, environments, software, and hardware, as appropriate. In some implementations, various steps of method <b>800</b> can be run in parallel, in combination, in loops, or in any order.</div>
<div class="description-paragraph" id="p-0144" num="0143">Process <b>800</b> starts at <b>806</b> where a backup node <b>802</b> determines that an epoch change needs to be performed. The epoch change discussed herein causes a change from a current epoch with a current primary node to a new epoch with a new primary node. An example epoch can includes a consensus process (e.g., consensus process <b>300</b> or <b>400</b>) for achieving consensus among a number of network nodes using a primary node as discussed above with reference to <figref idrefs="DRAWINGS">FIGS. 3-6</figref>.</div>
<div class="description-paragraph" id="p-0145" num="0144">In some implementations of the present specification, the backup node <b>802</b> determines that an epoch change needs to be performed in response to determining that the backup node <b>802</b> is still waiting for a request from the current primary node after a specific amount of time has passed without receiving the request from the current primary node. For example, the current primary node may encounter a Byzantine failure or a crash failure so that the current primary node cannot multicast the request within a predetermined time window. Therefore, the epoch change is triggered by timeouts that prevent backup nodes from waiting indefinitely for requests to execute. The epoch change process discussed herein provides liveness and reduces network latency by allowing the system to make progress when the primary node fails.</div>
<div class="description-paragraph" id="p-0146" num="0145">At <b>808</b>, the backup node <b>802</b> determines a respective weight of the backup node <b>802</b> associated with each of phases of the consensus process in the current epoch. In some implementations, the consensus process includes three phases as described above with reference to <figref idrefs="DRAWINGS">FIGS. 3-6</figref>. The weight is a metric of a qualification of the backup node <b>802</b> to be the new primary node in a new epoch.</div>
<div class="description-paragraph" id="p-0147" num="0146">In some implementations of the present specification, the backup node <b>802</b> determines a weight of the backup node <b>802</b> for a first phase of the consensus process in the current epoch to be a first value. For example, the backup node <b>802</b> may be assigned an initial weight of 10% if the backup node <b>802</b> has entered a first phase of the consensus process (e.g., the first phase <b>310</b> of the consensus process <b>300</b>). In alternative implementations of the present specification, the backup node <b>802</b> may assign any suitable weight value to the backup node <b>802</b> for the first phase of the current consensus process.</div>
<div class="description-paragraph" id="p-0148" num="0147">In some implementations of the present specification, the backup node <b>802</b> determines a weight of the backup node <b>802</b> for a second phase of the consensus process (e.g., the second phase <b>320</b> of the consensus process <b>300</b>) in the current epoch based on a quorum verification process. The quorum verification process is performed by determining whether the backup node <b>802</b> receives a predetermined number (e.g., 2f+1) of ECHO messages from the other network nodes in the second phase of the consensus process.</div>
<div class="description-paragraph" id="p-0149" num="0148">In some implementations of the present specification, if the backup node <b>802</b> fails the quorum verification (e.g., the backup node <b>802</b> receives a number of ECHO messages that is lower than a predetermined threshold), the backup node <b>802</b> may determine the weight of the backup node <b>802</b> for the second phase of the consensus process to be a first value. If the backup node <b>802</b> passes the quorum verification (e.g., the backup node <b>802</b> receives a number of ECHO messages that equals to or exceeds a predetermined threshold), the backup node <b>802</b> may determine the weight of the backup node <b>802</b> for the second phase of the consensus process to be a second value. In some implementations of the present specification, the second value is determines as larger than the first value. For example, if the backup node <b>802</b> fails the quorum verification, the backup node <b>802</b> can be assigned a weight value of zero for the second phase of the consensus process. If the backup node <b>802</b> passes the quorum verification, the backup node <b>802</b> can be assigned a weight value of 45% to the backup node <b>802</b> for the second phase of the consensus process. However, in alternative implementations of the present specification, the backup node <b>802</b> may assign any suitable value to the backup node <b>802</b> for the second phase of the consensus process in the current epoch.</div>
<div class="description-paragraph" id="p-0150" num="0149">In some implementations of the present specification, the quorum verification further includes verifying whether the ECHO messages that the backup node <b>802</b> receives from the other network nodes during the second phase of the consensus process are valid. For example, the backup node <b>802</b> may authenticate the private key signatures in the ECHO messages using a public key to determine whether the ECHO messages are valid.</div>
<div class="description-paragraph" id="p-0151" num="0150">Similar to determining the weight for the second phase, in some implementations, the backup node <b>802</b> determines a weight of the backup node <b>802</b> for a third phase of the consensus process (e.g., the third phase <b>330</b> of the consensus process <b>300</b>) in the current epoch based on a quorum verification process. The quorum verification process is performed by determining whether the backup node <b>802</b> receives a predetermined number (e.g., 2f+1) of accept messages from the other network nodes in the third phase of the consensus process in the current epoch. Each of the accept messages from other network nodes indicates that each of the other network nodes has accepted a predetermined number of ECHO messages. The accept message can be, for example, the ACCEPT messages described above with reference to the third phase <b>330</b> of the consensus process <b>300</b>.</div>
<div class="description-paragraph" id="p-0152" num="0151">In some implementations of the present specification, if the backup node <b>802</b> fails the quorum verification (e.g., the backup node <b>802</b> receives a number of ACCEPT messages that is lower than a predetermined threshold), the backup node <b>802</b> may determine the weight of the backup node <b>802</b> for the third phase of the consensus process to be a first value. If the backup node <b>802</b> passes the quorum verification (e.g., the backup node <b>802</b> receives a number of ACCEPT messages that equals to or exceeds a predetermined threshold), the backup node <b>802</b> may determine the weight of the backup node <b>802</b> for the third phase of the consensus process to be a second value. In some implementations, the second value is determines as larger than the first value. For example, if the backup node <b>802</b> fails the quorum verification, the backup node <b>802</b> can be assigned a weight value of zero to the backup node <b>802</b> for the third phase of the consensus process. If the backup node <b>802</b> passes the quorum verification, the backup node <b>802</b> can be assigned a weight value of 45% to the backup node <b>802</b> for the third phase of the consensus process. However, in alternative implementations of the present specification, the backup node <b>802</b> may assign any suitable value to the backup node <b>802</b> for the third phase of the consensus process in the current epoch.</div>
<div class="description-paragraph" id="p-0153" num="0152">At <b>810</b>, after determining the respective weights of the backup node <b>802</b> for the phases of the consensus process in the current epoch, the backup node <b>802</b> determines a weight sum of the backup node <b>802</b> for the consensus process based on the respective weights. In some implementations of the present specification, the weight sum is a sum of the respective sums of the backup nodes associated with each of the phases of the consensus process in the current epoch. For example, if the backup node <b>802</b> has determined a first weight value of the backup node <b>802</b> for the first phase to be 10%, a second weight value of the backup node <b>802</b> for the second phase to be 45%, and a third weight value of the backup node <b>802</b> for the third phase to be 45%, the backup node <b>802</b> determines the weight sum to be 100%. As another example, if the backup node <b>802</b> has determined a first weight value of the backup node <b>802</b> for the first phase to be 10%, a second weight value of the backup node <b>802</b> for the second phase to be 45%, and a third weight value of the backup node <b>802</b> for the third phase to be 0, the backup node <b>802</b> determines the weight sum to be 55%.</div>
<div class="description-paragraph" id="p-0154" num="0153">At <b>812</b>, the backup node <b>802</b> sends an EPOCH_CHANGE message to the other network nodes <b>804</b> if the backup node <b>802</b> determines that the weight sum that was determined at <b>810</b> reaches or exceeds a predetermined threshold. For example, the backup node <b>802</b> may send an EPOCH_CHANGE message to the other network nodes <b>804</b> if the weight sum as determined at <b>810</b> reaches 100%. The EPOCH_CHANGE message indicates a request for a change from the current epoch with the current primary node to the new epoch with the backup node being the new primary node.</div>
<div class="description-paragraph" id="p-0155" num="0154">In some implementations of the present specification, referring to <figref idrefs="DRAWINGS">FIG. 9</figref>, the EPOCH_CHANGE message has a format of &lt;weight, epoch+1, ECHO{ }, ACCEPT{ }, j&gt;, where “weight” represents the weight sum of the backup node <b>802</b> as determined previously at <b>810</b> for the consensus process, “epoch+1” represents a round of new consensus (i.e., a new epoch) associated with a new primary node, “ECHO{ }” represents a set of ECHO messages the backup node <b>802</b> receives during the second phase of the consensus process, “ACCEPT{ }” represents a set of ACCEPT messages the backup node <b>802</b> receives during the third phase of the consensus process, and “j” represents the network node (e.g., backup node <b>802</b>) that generates and sends the EPOCH_CHANGE message. In some implementations, the EPOCH_CHANGE message can have a different format, for example, by including additional or different fields.</div>
<div class="description-paragraph" id="p-0156" num="0155">Referring back to <figref idrefs="DRAWINGS">FIG. 8</figref>, at <b>814</b>, the network nodes <b>804</b> other than the backup node <b>802</b> verify the EPOCH_CHANGE message that is sent by the backup node <b>802</b>. In some implementations, each of the network nodes <b>804</b> verifies whether the EPOCH_CHANGE message is valid by verifying whether the weight sum in the EPOCH_CHANGE message is valid. In some implementations, verifying whether the weight sum in the EPOCH_CHANGE message is valid includes verifying whether the set of signatures in the ECHO messages included in the EPOCH_CHANGE message are valid. For example, each of the network nodes <b>804</b> may authenticate the set of private key signatures in the ECHO messages included the EPOCH_CHANGE message using a public key.</div>
<div class="description-paragraph" id="p-0157" num="0156">At <b>816</b>, each of the network nodes <b>804</b> sends a NEW_EPOCH message to the backup node <b>802</b> in response to verifying that the EPOCH_CHANGE message sent by the backup node <b>802</b> is valid. The NEW_EPOCH message indicates an acknowledgement of the backup node to be the new primary node. For example, the NEW_EPOCH message sent by a network node <b>804</b> includes an indication that the network node <b>804</b> acknowledges that the backup node <b>802</b> will become the new primary node in the new epoch. Meanwhile, each of the network nodes <b>804</b> also sends the NEW_EPOCH message to the other network nodes <b>804</b>.</div>
<div class="description-paragraph" id="p-0158" num="0157">Referring to <figref idrefs="DRAWINGS">FIG. 9</figref>, the NEW_EPOCH message is generating as having a format of &lt;epoch+1, i, j, seq, ec_digest&gt;, where ““epoch+1” represents a round of new consensus (i.e., a new epoch) associated with a new primary node, “i” represents the new primary node in the new epoch, “j” represents a network node <b>804</b> that sends the NEW_EPOCH message, and “ec_digest” represents a digest of the EPOCH_CHANGE message. In some implementations, the digest of the EPOCH_CHANGE message includes a hash value of the EPOCH_CHANGE message. In some implementations, the NEW_EPOCH message can have a different format, for example, by including additional or different fields.</div>
<div class="description-paragraph" id="p-0159" num="0158">Referring back to <figref idrefs="DRAWINGS">FIG. 8</figref>, at <b>818</b>, the backup node <b>802</b> verifies that whether the NEW_EPOCH messages that are sent by the network nodes <b>804</b> are valid. In some implementations, the backup node <b>802</b> verifies the NEW_EPOCH messages by verifying whether the digest of the EPOCH_CHANGE message in the NEW_EPOCH messages is valid. Because the digest includes information of the EPOCH_CHANGE message, the digest also includes the signatures in the EPOCH_CHANGE message. The backup node <b>802</b> can verify the digest of the EPOCH_CHANGE message by verifying whether the set of signatures in the EPOCH_CHANGE message are valid.</div>
<div class="description-paragraph" id="p-0160" num="0159">At <b>820</b>, the backup node <b>802</b> determines whether a number of valid NEW_EPOCH message as determined at <b>818</b> exceeds a predetermined threshold. In some implementations, the predetermined threshold is a quorum number (e.g., 2f+1).</div>
<div class="description-paragraph" id="p-0161" num="0160">At <b>822</b>, the backup node <b>802</b> determines the backup node <b>802</b> to be the new primary node in the new epoch in response to determining that the number of valid NEW_EPOCH message as determined exceeds the predetermined threshold. Note that each of the network nodes <b>804</b> performs the same steps <b>818</b>-<b>822</b> as the backup node <b>802</b> does, and the network nodes <b>804</b> and the backup node <b>802</b> may perform steps <b>818</b>-<b>822</b> in a parallel manner. For example, each of the network nodes <b>804</b> may verify a set of NEW_EPOCH message that are sent from the other network nodes <b>804</b>, determine whether a number of valid NEW_EPOCH messages exceeds a predetermined threshold, and determines a new primary node.</div>
<div class="description-paragraph" id="p-0162" num="0161">The epoch change process (e.g., process <b>700</b> or <b>800</b>) as discussed above includes many features that improve the operation of the entire blockchain system and help alleviate the network bottleneck. For example, the epoch change process in the present specification includes assigning respective weights to the three phases of the consensus process, determining a weight sum based on the respective weights of the three phases, and determines a new primary node based on the weight sum. The epoch change process based on the weigh sum instead of a round robin method can facilitate choosing a new primary node that is non-faulty in a timely manner. A round robin method may cause a frequent change of primary node when multiple network nodes in line for the new primary node are faulty. This significantly affects the blockchain service by introducing latency or delay in finding a primary node that is non-faulty. Unlike the round robin method, the epoch change process in the present specification relies on the weight sum to select the new primary node, which can reduce the time in finding the new primary node that is not faulty. This can further improve the efficiency of the overall blockchain system in providing the blockchain services.</div>
<div class="description-paragraph" id="p-0163" num="0162">During the operation of a blockchain network, the execution speed of some network nodes may lag behind that of most network nodes due to network jittering, sudden power failure, disc failure and the like. In this scenario, more than ⅓ of the network nodes in the system may fail. BFT provides safety and liveness if less than ⅓ of the network nodes fail during the life time of the system. However, these guarantees are insufficient for long-lived systems because the upper bound is likely to be exceeded in the scenario as described above. Therefore, a recovery process is desirable that makes faulty network nodes behave correctly again and continues to participate in subsequent consensus processes to allow the system to tolerate more than f faults over its lifetime. Moreover, the described recovery process can recover one or more networks nodes that are still performing a consensus process (e.g., the consensus process <b>300</b> or <b>400</b>), and do not need to wait until the consensus is reached among all the network nodes. As such, the described recovery process can further reduce the system latency and improve efficiency of the blockchain network.</div>
<div class="description-paragraph" id="p-0164" num="0163"> <figref idrefs="DRAWINGS">FIG. 10</figref> depicts an example of a process <b>1000</b> for performing a recovery process of a network node (e.g., node <b>214</b> or <b>404</b>) of a distributed system (e.g., blockchain network <b>102</b> and <b>212</b>) that can be executed in accordance with implementations of the present specification. Specifically, <figref idrefs="DRAWINGS">FIG. 10</figref> illustrates a diagram presenting an exemplary embodiment of a method <b>1000</b> of performing a recovery process of a network node, according to the present specification. As illustrated in <figref idrefs="DRAWINGS">FIG. 10</figref>, the process <b>1000</b> includes a few phases and stages.</div>
<div class="description-paragraph" id="p-0165" num="0164">In a first phase <b>1010</b>, a network node (e.g., network node R<sub>0</sub>) that would like to recover a target transaction with a target sequence number R<sub>0 </sub>multicasts a state request message (e.g., QUERY_STATE message) to the other network nodes indicating that the network node is to be recovered. The state request message can includes the target sequence number that the network node R<sub>0 </sub>would like to recover. In a second phase <b>1020</b>, the other network nodes receive the state request message and send a state reply message (e.g., REPLY_STATE message) to the network node R<sub>0</sub>. In a third phase <b>1030</b>, the network node R<sub>0 </sub>sends a requesting message (e.g., FETCH_ECHO message) to the other network nodes requesting an ECHO message from each of the other network nodes. The ECHO message can be the same ECHO message sent by the respective other network nodes in the second phase <b>320</b> of the consensus process <b>300</b> as described above with reference to <figref idrefs="DRAWINGS">FIGS. 3-6</figref>. In a fourth phase <b>1040</b>, each of the other network nodes sends an ECHO message to the network node R<sub>0 </sub>in response to the FETCH_ECHO message. In a fifth phase <b>1050</b>, the network node R<sub>0 </sub>verifies the ECHO messages and recovers the target transaction according to an EC code, for example, according to the example reconstruction techniques as described above with reference to <figref idrefs="DRAWINGS">FIG. 4</figref>. In a sixth phase <b>1060</b>, the network node R<sub>0 </sub>sends an ACCEPT message to the other network nodes indicating that the network node has been recovered.</div>
<div class="description-paragraph" id="p-0166" num="0165">Note that process <b>1000</b> is illustrated as implemented in conjunction with four network nodes for illustrative purposes only. The process <b>1000</b> may be implemented in conjunction with any suitable number of network nodes. The process <b>1000</b>, a format of the QUERY_STATE message, and a format of the REPLY_STATE message will be discussed below in greater detail with reference to <figref idrefs="DRAWINGS">FIGS. 11-12</figref>.</div>
<div class="description-paragraph" id="p-0167" num="0166"> <figref idrefs="DRAWINGS">FIG. 11</figref> depicts an example of a process <b>1100</b> for performing a recovery process of a network node in a distribute system (e.g., blockchain network <b>102</b> or <b>212</b>) that can be executed in accordance with implementations of the present specification. In some implementations, the process <b>1100</b> may be performed using one or more computer-executable programs executed using one or more computing devices. For clarity of presentation, the description that follows generally describes method <b>1100</b> in the context of the other figures in this description. It will be understood that method <b>1100</b> may be performed, for example, by any suitable system, environment, software, and hardware, or a combination of systems, environments, software, and hardware, as appropriate. In some implementations, various steps of method <b>1100</b> can be run in parallel, in combination, in loops, or in any order.</div>
<div class="description-paragraph" id="p-0168" num="0167">Process <b>1100</b> starts at <b>1106</b> where a network node <b>1102</b> multicasts a state request message to the other network nodes <b>1104</b>. The state request message includes an indication that the network node <b>1102</b> is to recover a target transaction with a target sequence number. The network node <b>1102</b> may be a primary node or a backup node.</div>
<div class="description-paragraph" id="p-0169" num="0168">In some implementations of the present specification, referring to <figref idrefs="DRAWINGS">FIG. 12</figref>, the QUERY_STATE message, as an example of the state request message, has a format of &lt;j, seq&gt;, where “j” represents a network node <b>1102</b> that sends the QUERY_STATE message, and “seq” represents a largest sequence number or a most recent sequence number for the network node <b>1102</b> in the current consensus process. In some implementations, the QUERY_STATE message can have a different format, for example, by including additional or different fields.</div>
<div class="description-paragraph" id="p-0170" num="0169">By broadcasting the QUERY_STATE message to the other network nodes <b>1104</b>, the network node <b>1102</b> is requesting the other network nodes <b>1104</b> to send their most recent sequence number to the network node <b>1102</b>, thereby obtaining the latest block information of the blockchain system. And by obtaining the latest block information of the entire blockchain system, the network node <b>1102</b> may be able to synchronize to the latest status of the entire system, thereby recovering itself and continuing to participate in the consensus process.</div>
<div class="description-paragraph" id="p-0171" num="0170">Referring back to <figref idrefs="DRAWINGS">FIG. 11</figref>, at <b>1108</b>, each of the other network nodes <b>1104</b> sends a state reply message (e.g., REPLY_STATE message) to the network node <b>1102</b> in response to receiving the state request message. In some implementations, the state reply message includes a previous sequence number associated with the network nodes <b>1104</b>.</div>
<div class="description-paragraph" id="p-0172" num="0171">In some implementations, referring to <figref idrefs="DRAWINGS">FIG. 12</figref>, the REPLY_STATE message, as an example of the state replay message, has a format of &lt;j, last_seq&gt;, where “j” represents a network node <b>1104</b> that sends the REPLY_STATE message, and “last_seq” represents a previous sequence number for the network node <b>1104</b> in the current consensus process. In some implementations, the REPLY_STATE message can have a different format, for example, by including additional or different fields.</div>
<div class="description-paragraph" id="p-0173" num="0172">Referring back to <figref idrefs="DRAWINGS">FIG. 11</figref>, at <b>1110</b>, the network node <b>1102</b> determines whether a number of the received state reply messages exceeds a predetermined threshold. For example, the network node <b>1102</b> may determine whether a number of the received REPLY_STATE messages exceeds a quorum number (e.g., 2f+1 or n−f). In some implementations, the network node <b>1102</b> further determines whether the quorum number of the received REPLY_STATE messages include an identical sequence number. The quorum number of the received REPLY_STATE messages include an identical sequence number means that a majority of the network nodes <b>1104</b> agree on a common state of the entire system.</div>
<div class="description-paragraph" id="p-0174" num="0173">At <b>1112</b>, the network node <b>1102</b> determines the target sequence number based on the identical sequence number if the network node <b>1102</b> determines that the number of the state reply messages including the identical sequence number received from the network nodes <b>1104</b> exceeds the predetermined threshold. For example, the network node <b>1102</b> may determine the target sequence number to be an increment (e.g., “last_seq+1”) of the identical sequence number (e.g., “last_seq”).</div>
<div class="description-paragraph" id="p-0175" num="0174">At <b>1114</b>, the network node <b>1102</b> sends a requesting message (e.g., FETCH_ECHO message) to the other network nodes <b>1104</b>. The FETCH_ECHO message is sent by the network node <b>1102</b> to request an ECHO message from each of the other network nodes <b>1104</b>. As discussed above with reference to <figref idrefs="DRAWINGS">FIGS. 3-6</figref>, the ECHO message is a message transmitted by the network nodes <b>1104</b> for achieving a consensus among the network nodes <b>1104</b> on a target transaction. The ECHO message includes a part of the target transaction (e.g., an EC block) and a signature of the network node <b>1104</b> that sends the ECHO message.</div>
<div class="description-paragraph" id="p-0176" num="0175">In some implementations, referring to <figref idrefs="DRAWINGS">FIG. 12</figref>, the FETCH_ECHO message, as an example of the requesting message, has a format of &lt;j, last_seq+1&gt;, where “j” represents a network node <b>1102</b> that sends the FETCH_ECHO message, and “last_seq+1” represents a target sequence number associated with the ECHO messages that the network node <b>1102</b> is requesting from the other network nodes <b>1104</b>. In some implementations, the FETCH_ECHO message can have a different format, for example, by including additional or different fields.</div>
<div class="description-paragraph" id="p-0177" num="0176">The FETCH_ECHO message as discussed herein is sent by the network node <b>1102</b> to request the ECHO messages including a most recent sequence number or a largest sequence number from the other network nodes <b>1104</b>. By collecting the ECHO messages including a most recent sequence number or a largest sequence number from the other network nodes <b>1104</b>, the network node <b>1102</b> may be able to recover to the most recent state associated with the most recent sequence number.</div>
<div class="description-paragraph" id="p-0178" num="0177">Referring back to <figref idrefs="DRAWINGS">FIG. 11</figref>, at <b>1116</b>, each of the network nodes <b>1104</b> sends an ECHO message to the network node <b>1102</b> in response to receiving the FETCH_ECHO message. In some implementations, each of the network nodes <b>1104</b> verifies the FETCH_ECHO message before sending the ECHO message to the network node <b>1102</b>. In some implementations, each of the network nodes <b>1104</b> verifies the FETCH_ECHO message by determining whether the sequence number included in the FETCH_ECHO messages exceeds a most recent sequence number associated with the network node <b>1104</b>. If the sequence number included in the FETCH_ECHO messages is equal to the most recent sequence number associated with the network node <b>1104</b>, the network node <b>1104</b> determines that the FETCH_ECHO message is valid and that an ECHO message will be sent to the network node <b>1102</b>. If the sequence number included in the FETCH_ECHO messages exceeds the most recent sequence number associated with the network node <b>1104</b>, the network node <b>1104</b> determines that the FETCH_ECHO message is invalid and that an ECHO message will not be sent to the network node <b>1102</b>.</div>
<div class="description-paragraph" id="p-0179" num="0178">At <b>1118</b>, the network node <b>1102</b> verifies whether the ECHO messages sent by the network nodes <b>1104</b> are valid. In some implementations, the network node <b>1102</b> verifies the ECHO messages using a Merkel tree. For example, the network node <b>1102</b> may use the data included in the ECHO message to reconstruct a Merkel tree and determine a reconstructed root hash value of the reconstructed Merkel tree. The network node <b>1102</b> may then compare the reconstructed root hash value to a root hash value included in the ECHO message. If the reconstructed root hash value matches the root hash value included in the ECHO message, the network node <b>1102</b> determines that the ECHO message is valid. If the reconstructed root hash value does not match the root hash value included in the ECHO message, the network node <b>1102</b> determines that the ECHO message is invalid and may discard the invalid ECHO message.</div>
<div class="description-paragraph" id="p-0180" num="0179">In some implementations, the network node <b>1102</b> verifies whether the ECHO message is valid by further verifying whether the signature in the ECHO message is valid. For example, the network node <b>1102</b> may authenticate the private key signature in the ECHO message using a public key paired with the private key to verify the signature.</div>
<div class="description-paragraph" id="p-0181" num="0180">At <b>1120</b>, the network node <b>1102</b> determine whether a number of the valid ECHO messages received from the other network nodes <b>1104</b> exceeds a predetermined threshold. For example, the network node <b>1102</b> may determine whether a number of the valid ECHO messages received from the other network nodes <b>1104</b> exceeds a quorum number (e.g., 2f+1).</div>
<div class="description-paragraph" id="p-0182" num="0181">At <b>1122</b>, the network node <b>1102</b> recovers the target transaction with the target sequence number in response to determining that the number of valid ECHO messages exceeds the predetermined threshold. In some implementations, the network node <b>1102</b> recovers the target transaction using the data included in the number of valid ECHO messages. For example, the network node <b>1102</b> may retrieve a subset of EC blocks included in the ECHO messages to reconstruct the target transaction according to an EC code.</div>
<div class="description-paragraph" id="p-0183" num="0182">At <b>1124</b>, the network node <b>1102</b> multicasts an ACCEPT message to the other network nodes <b>1104</b> after recovering the target transaction. For example, the network node <b>1102</b> may multicasts an ACCEPT message to the other network nodes <b>1104</b> after successfully reconstructing the target transaction. In some implementations, the ACCEPT message includes a set of signatures in the ECHO messages and the target sequence number. By sending the ACCEPT message including the signatures and the target sequence number to the other network nodes <b>1104</b>, the network node <b>1102</b> indicates to the other network nodes <b>1104</b> that the network node <b>1102</b> has recovered and synchronized to the latest state of the system.</div>
<div class="description-paragraph" id="p-0184" num="0183">The recovery process as discussed above in the present specification includes many features that improve the operation of the computers that implements the recovery process and helps alleviate the network bottleneck. For example, the recover process in the present specification includes operations including sending a state request message by a network node that applies to be a new primary node, receiving state reply messages from the other network nodes, and sending a FETCH_ECHO message by the network node to request ECHO messages from the other network nodes. These operations are performed such that the recovery process of the faulty network node does not interfere with the normal operation of the consensus process among the other non-faulty network nodes. This facilitates conserving computing and network resources for recovering the faulty network node by reducing the complexity of the recovery process.</div>
<div class="description-paragraph" id="p-0185" num="0184">Referring to <figref idrefs="DRAWINGS">FIG. 13</figref>, <figref idrefs="DRAWINGS">FIG. 13</figref> is a diagram illustrating modules of a consensus apparatus <b>1300</b>, according to an implementation of the present specification. The apparatus <b>1300</b> for achieving consensus can be applied to a consensus system based on a blockchain technology. For example, the apparatus <b>1300</b> can correspond to the implementations shown in <figref idrefs="DRAWINGS">FIGS. 1-6</figref>. The apparatus <b>1300</b> can be implemented in a primary node in blockchain network. The apparatus <b>1300</b> includes the following: a receiver or receiving unit <b>1302</b>, configured to receive a transaction request; a generating unit <b>1304</b>, configured to generate a number of erasure code (EC) blocks according to an EC code using the transaction request; a transmitter or transmitting unit <b>1306</b>, configured to send a number of first messages to the one or more backup nodes, respectively, wherein each of the number of first messages includes a composite hash value associated with the number of EC blocks; the receiver or receiving unit <b>1302</b>, further configured to receive at least one second message from at least one of the backup nodes, wherein the at least one second message includes one of the number of first messages and a signature of the at least one of the backup nodes associated with the one of the number of first messages; a verifying unit <b>1308</b>, configured to verify whether the at least one second message is valid in response to receiving the at least one second message from the at least one of the backup node; a determining unit <b>1310</b>, configured to determine whether a number of valid second messages exceeds a pre-determined threshold; a reconstructing unit <b>1312</b>, configured to reconstruct the transaction request based on a subset of the number of valid second messages according to the EC code in response to determining that the number of valid second messages exceeds the pre-determined threshold; the transmitter or the transmitting unit <b>1306</b>, further configured to send a third message, to the other network nodes in response to determining that the transaction request has been successfully reconstructed, wherein the third message includes a set of signatures that are in the valid second messages; the receiver or the receiving unit <b>1302</b>, further configured to receive at least one third message from at least one of the backup nodes; and an executing unit <b>1314</b>, configured to execute the transaction request in response to receiving a pre-determined number of third messages that are identical.</div>
<div class="description-paragraph" id="p-0186" num="0185">In an optional implementation, the transaction request is associated with a sequence number.</div>
<div class="description-paragraph" id="p-0187" num="0186">In an optional implementation, the generating the plurality of EC blocks according to an EC code includes the following: transforming the transaction request into an EC message using the EC code and dividing the EC message into the number of EC block.</div>
<div class="description-paragraph" id="p-0188" num="0187">In an optional implementation, the composite hash value of the number of EC block is generated using a hash tree.</div>
<div class="description-paragraph" id="p-0189" num="0188">In an optional implementation, the hash tree includes a Merkle tree, and wherein the composite hash value is a root hash value of the Merkle tree.</div>
<div class="description-paragraph" id="p-0190" num="0189">In an optional implementation, the signature of the at least one of the backup nodes associated with the one of the number of first messages includes a private key signature of the at least one of the backup nodes associated with the one of the number of first messages.</div>
<div class="description-paragraph" id="p-0191" num="0190">In an optional implementation, the at least one second message further includes at least one of the number of EC blocks.</div>
<div class="description-paragraph" id="p-0192" num="0191">In an optional implementation, the verifying whether the at least one second message is valid includes the following: generating a reconstructed hash tree using the at least one of the number of EC blocks in the at least one second message; determining a reconstructed composite hash value of the reconstructed hash tree; and determining whether the reconstructed composite hash value matches the composite hash values in the at least one second message.</div>
<div class="description-paragraph" id="p-0193" num="0192">In an optional implementation, the determining unit <b>1310</b> is further configured to determine that the at least one second message is valid in response to determining that the reconstructed composite hash value matches the composite hash values in the second messages.</div>
<div class="description-paragraph" id="p-0194" num="0193">In an optional implementation, the pre-determined number of third messages that are identical include the pre-determined number of the third messages having an identical set of signatures.</div>
<div class="description-paragraph" id="p-0195" num="0194"> <figref idrefs="DRAWINGS">FIG. 13</figref> is a schematic diagram illustrating an internal functional module and a structure of a consensus apparatus <b>1300</b>. An execution body in essence can be an electronic device, and the electronic device includes the following: at least one processor; and a memory configured to store an executable instruction of the at least one processor.</div>
<div class="description-paragraph" id="p-0196" num="0195">The at least one processor is configured to receive a transaction request; generate a number of erasure code (EC) blocks according to an EC code using the transaction request; send a number of first messages to the one or more backup nodes, respectively, wherein each of the number of first messages includes a composite hash value associated with the number of EC blocks; receive at least one second message from at least one of the backup nodes, wherein the at least one second message includes one of the number of first messages and a signature of the at least one of the backup nodes associated with the one of the number of first messages; verify whether the at least one second message is valid in response to receiving the at least one second message from the at least one of the backup node; determine whether a number of valid second messages exceeds a pre-determined threshold; reconstruct the transaction request based on a subset of the number of valid second messages according to the EC code in response to determining that the number of valid second messages exceeds the pre-determined threshold; send a third message, to the other network nodes in response to determining that the transaction request has been successfully reconstructed, wherein the third message includes a set of signatures that are in the valid second messages; receive at least one third message from at least one of the backup nodes; and execute the transaction request in response to receiving a pre-determined number of third messages that are identical.</div>
<div class="description-paragraph" id="p-0197" num="0196">Optionally, the transaction request is associated with a sequence number.</div>
<div class="description-paragraph" id="p-0198" num="0197">Optionally, the generating the plurality of EC blocks according to an EC code includes the following: transforming the transaction request into an EC message using the EC code and dividing the EC message into the number of EC block.</div>
<div class="description-paragraph" id="p-0199" num="0198">Optionally, the composite hash value of the number of EC block is generated using a hash tree.</div>
<div class="description-paragraph" id="p-0200" num="0199">Optionally, the hash tree includes a Merkle tree, and wherein the composite hash value is a root hash value of the Merkle tree.</div>
<div class="description-paragraph" id="p-0201" num="0200">Optionally, the signature of the at least one of the backup nodes associated with the one of the number of first messages includes a private key signature of the at least one of the backup nodes associated with the one of the number of first messages.</div>
<div class="description-paragraph" id="p-0202" num="0201">Optionally, the at least one second message further includes at least one of the number of EC blocks.</div>
<div class="description-paragraph" id="p-0203" num="0202">Optionally, the verifying whether the at least one second message is valid includes the following: generating a reconstructed hash tree using the at least one of the number of EC blocks in the at least one second message; determining a reconstructed composite hash value of the reconstructed hash tree; and determining whether the reconstructed composite hash value matches the composite hash values in the at least one second message.</div>
<div class="description-paragraph" id="p-0204" num="0203">Optionally, the at least one processor is further configured to determine that the at least one second message is valid in response to determining that the reconstructed composite hash value matches the composite hash values in the second messages.</div>
<div class="description-paragraph" id="p-0205" num="0204">Optionally, the pre-determined number of third messages that are identical include the pre-determined number of the third messages having an identical set of signatures.</div>
<div class="description-paragraph" id="p-0206" num="0205">Referring to <figref idrefs="DRAWINGS">FIG. 14</figref>, <figref idrefs="DRAWINGS">FIG. 14</figref> is a diagram illustrating modules of a consensus apparatus <b>1400</b>, according to an implementation of the present specification. The apparatus <b>1400</b> for achieving consensus can be applied to a consensus system based on a blockchain technology. The apparatus <b>1400</b> can correspond to the implementations shown in <figref idrefs="DRAWINGS">FIGS. 1-6</figref>. For example, the apparatus <b>1400</b> can be implemented in a backup node of a blockchain network. The apparatus <b>1400</b> includes the following: a receiver or receiving unit <b>1402</b>, configured to receive a first message from the primary node, wherein the first message includes a composite hash value associated with a number of EC blocks, wherein the number of EC blocks are generated by the primary node according to an EC code using a transaction request; a transmitter or transmitting unit <b>1404</b>, configured to send, by the backup node, a second message to the other network nodes in response to receiving the first message, wherein the second message includes the first message and a signature of the backup node associated with the first message; the receiver or receiving unit <b>1402</b>, further configured to receive at least one second message from at least one backup node other than the backup node; a verifying unit <b>1406</b>, configured to verify whether the at least one second message is valid in response to receiving the at least one second message from the at least one backup node; a determining unit <b>1408</b>, configured to determine whether a number of valid second messages exceeds a pre-determined threshold; a reconstructing unit <b>1410</b>, configured to reconstruct the transaction request based on a subset of the number of valid second messages according to the EC code in response to determining that the number of valid second messages exceeds the pre-determined threshold; the transmitter or transmitting unit <b>1404</b>, configured to send a third message to the other network nodes in response to determining that the transaction request has been successfully reconstructed, wherein the third message includes a set of signatures that are in the valid second messages; the receiver or receiving unit <b>1402</b>, further configured to receive at least one third message from at least one of the backup nodes; and an executing unit <b>1412</b>, configured to execute the transaction request in response to receiving a pre-determined number of third messages that are identical.</div>
<div class="description-paragraph" id="p-0207" num="0206">In an optional implementation, the generating the plurality of EC blocks according to an EC code includes the following: transforming the transaction request into an EC message using the EC code; and dividing the EC message into the number of EC block.</div>
<div class="description-paragraph" id="p-0208" num="0207">In an optional implementation, the composite hash value of the plurality of EC block is generated using a hash tree.</div>
<div class="description-paragraph" id="p-0209" num="0208">In an optional implementation, the hash tree includes a Merkle tree, and the composite hash value is a root hash value of the Merkle tree.</div>
<div class="description-paragraph" id="p-0210" num="0209">In an optional implementation, the signature of the backup node associated with the first message includes a private key signature of the backup node associated with the first message.</div>
<div class="description-paragraph" id="p-0211" num="0210">In an optional implementation, the at least one second message further includes at least one of the number of EC blocks.</div>
<div class="description-paragraph" id="p-0212" num="0211">In an optional implementation, the verifying whether the at least one second message is valid includes the following: generating a reconstructed hash tree using the at least one of the number of EC blocks in the at least one second message; determining a reconstructed composite hash value of the reconstructed hash tree; comparing the reconstructed composite hash value to a composite hash value in the at least one second message; and determining whether the reconstructed composite hash value matches the composite hash values in the at least one second message.</div>
<div class="description-paragraph" id="p-0213" num="0212">In an optional implementation, the determining unit <b>1408</b> is further configured to determine that the at least one second message is valid in response to determining that the reconstructed composite hash value matches the composite hash values in the second messages.</div>
<div class="description-paragraph" id="p-0214" num="0213">In an optional implementation, the pre-determined number of third messages that are identical include the pre-determined number of the third messages having an identical set of signatures.</div>
<div class="description-paragraph" id="p-0215" num="0214"> <figref idrefs="DRAWINGS">FIG. 14</figref> is a schematic diagram illustrating an internal functional module and a structure of a consensus apparatus <b>1400</b>. An execution body in essence can be an electronic device, and the electronic device includes the following: at least one processor; and a memory configured to store an executable instruction of the at least one processor.</div>
<div class="description-paragraph" id="p-0216" num="0215">The at least one processor is configured to receive a first message from the primary node, wherein the first message includes a composite hash value associated with a number of EC blocks, wherein the number of EC blocks are generated by the primary node according to an EC code using a transaction request; send, by the backup node, a second message to the other network nodes in response to receiving the first message, wherein the second message includes the first message and a signature of the backup node associated with the first message; receive at least one second message from at least one backup node other than the backup node; verify whether the at least one second message is valid in response to receiving the at least one second message from the at least one backup node; determine whether a number of valid second messages exceeds a pre-determined threshold; reconstruct the transaction request based on a subset of the number of valid second messages according to the EC code in response to determining that the number of valid second messages exceeds the pre-determined threshold; send a third message to the other network nodes in response to determining that the transaction request has been successfully reconstructed, wherein the third message includes a set of signatures that are in the valid second messages; receive at least one third message from at least one of the backup nodes; and execute the transaction request in response to receiving a pre-determined number of third messages that are identical.</div>
<div class="description-paragraph" id="p-0217" num="0216">Optionally, the generating the plurality of EC blocks according to an EC code includes the following: transforming the transaction request into an EC message using the EC code; and dividing the EC message into the number of EC block.</div>
<div class="description-paragraph" id="p-0218" num="0217">Optionally, the composite hash value of the plurality of EC block is generated using a hash tree.</div>
<div class="description-paragraph" id="p-0219" num="0218">Optionally, the hash tree includes a Merkle tree, and the composite hash value is a root hash value of the Merkle tree.</div>
<div class="description-paragraph" id="p-0220" num="0219">Optionally, the signature of the backup node associated with the first message includes a private key signature of the backup node associated with the first message.</div>
<div class="description-paragraph" id="p-0221" num="0220">Optionally, the at least one second message further includes at least one of the number of EC blocks.</div>
<div class="description-paragraph" id="p-0222" num="0221">Optionally, the verifying whether the at least one second message is valid includes the following: generating a reconstructed hash tree using the at least one of the number of EC blocks in the at least one second message; determining a reconstructed composite hash value of the reconstructed hash tree; comparing the reconstructed composite hash value to a composite hash value in the at least one second message; and determining whether the reconstructed composite hash value matches the composite hash values in the at least one second message.</div>
<div class="description-paragraph" id="p-0223" num="0222">Optionally, the at least one processor is further configured to determine that the at least one second message is valid in response to determining that the reconstructed composite hash value matches the composite hash values in the second messages.</div>
<div class="description-paragraph" id="p-0224" num="0223">Optionally, the pre-determined number of third messages that are identical include the pre-determined number of the third messages having an identical set of signatures.</div>
<div class="description-paragraph" id="p-0225" num="0224">Referring to <figref idrefs="DRAWINGS">FIG. 15</figref>, <figref idrefs="DRAWINGS">FIG. 15</figref> is a diagram illustrating modules of a primary node changing apparatus <b>1500</b>, according to an implementation of the present specification. The apparatus <b>1500</b> for changing a primary node can be applied to a consensus system based on a blockchain technology. The apparatus <b>1500</b> can correspond to the implementations shown in <figref idrefs="DRAWINGS">FIGS. 7-9</figref>. For example, the apparatus <b>1500</b> can be implemented in a backup node of a blockchain network. The apparatus <b>1500</b> includes the following: a determining unit <b>1502</b>, configured to determine that an epoch change needs to be performed, wherein the epoch change causes a change from a current epoch with a current primary node to a new epoch with a new primary node, wherein the current epoch comprises a consensus process for achieving consensus among the number of network nodes using the primary node, the consensus process including three phases; the determining unit <b>1502</b>, further configured to determine a respective weight of the backup node associated with each of the three phases of the consensus process in the current epoch, wherein the weight is a metric of a qualification of the backup node to be the new primary node; the determining unit <b>1502</b>, further configured to determine a weight sum for the backup node based on the respective weight of the backup node associated with each of the three phases in the current epoch; a transmitter or transmitting unit <b>1504</b>, configured to send an EPOCH_CHANGE message to the number of network nodes other than the network node in response to determining that the weight sum reaches a first predetermined threshold, wherein the EPOCH_CHANGE message indicates a request for a change from the current epoch with the current primary node to the new epoch with the backup node being the new primary node, and the EPOCH_CHANGE message includes the weight sum of the backup node; a receiver or receiving unit <b>1506</b>, configured to receive at least one NEW_EPOCH message from at least one of the number of network nodes other than the backup node, wherein the NEW_EPOCH message indicates an acknowledgement of the backup node to be the new primary node; a verifying unit <b>1508</b>, configured to verify whether the at least one NEW_EPOCH message is valid; the determining unit <b>1502</b>, further configured to determine whether a number of valid NEW_EPOCH messages out of the at least one NEW_EPOCH message exceeds a second predetermined threshold; and the determining unit <b>1502</b>, further configured to determine the backup node to be the new primary node in the new epoch in response to determining that the number of valid NEW_EPOCH messages exceeds the second predetermined threshold.</div>
<div class="description-paragraph" id="p-0226" num="0225">In an optional implementation, the determining a respective weight of the backup node associated with each of the three phases of the consensus process in the current epoch includes determining a weight of the backup node for a first phase of the consensus process to be a first value.</div>
<div class="description-paragraph" id="p-0227" num="0226">In an optional implementation, the determining a respective weight of the backup node associated with each of the three phases of the consensus process in the current epoch includes the following: in response to determining a failure of a quorum verification in a second phase of the consensus process in the current epoch, determining a weight of the backup node for the second phase of the consensus process to be a first value; and in response to determining a success of a quorum verification in the second phase of the consensus process in the current epoch, determining the weight of the backup node for the second phase of the consensus process to be a second value, wherein the first value is smaller than the second value.</div>
<div class="description-paragraph" id="p-0228" num="0227">In an optional implementation, the quorum verification in the second phase for the network node includes receiving a predetermined number of ECHO messages from other network nodes.</div>
<div class="description-paragraph" id="p-0229" num="0228">In an optional implementation, the determining a respective weight of the backup node associated with each of the three phases of the consensus process in the current epoch includes the following: in response to determining a failure of a quorum verification in a third phase of the consensus process in the current epoch, determining a weight of the backup node for the third phase of the consensus process to be a third value; and in response to determining a success of a quorum verification in the third phase of the consensus process in the current epoch, determining the weight of the backup node for the third phase of the consensus process to be a fourth value, wherein the third value is smaller than the fourth value.</div>
<div class="description-paragraph" id="p-0230" num="0229">In an optional implementation, the quorum verification in the third phase for the network node includes receiving a pre-determined number of accept messages from other network nodes, wherein each of the accept messages from other network nodes indicates each of the other network nodes has accepted a predetermined number of ECHO messages.</div>
<div class="description-paragraph" id="p-0231" num="0230">In an optional implementation, the EPOCH_CHANGE message further includes a set of signatures associated with a set of network nodes out of the number of network nodes, and wherein the NEW_EPOCH message comprises a digest of the EPOCH_CHANGE message.</div>
<div class="description-paragraph" id="p-0232" num="0231">In an optional implementation, the verifying whether the at least one valid NEW_EPOCH message is valid includes verifying whether the digest of the EPOCH_CHANGE message in the at least one NEW_EPOCH message is valid, and the verifying whether the digest of the EPOCH_CHANGE message in the at least one NEW_EPOCH message is valid includes verifying whether the set of signatures in the EPOCH_CHANGE message are valid.</div>
<div class="description-paragraph" id="p-0233" num="0232">In an optional implementation, the determining that an epoch change needs to be performed includes determining that an epoch change needs to be performed in response to determining that the consensus has not been achieved in the old epoch within a predetermined time period.</div>
<div class="description-paragraph" id="p-0234" num="0233">In an optional implementation, the primary node changing apparatus <b>1500</b> further includes the following: an operating unit <b>1510</b>, configured to operate in the new epoch with the new primary node, wherein the new epoch comprises a consensus process for achieving consensus among the plurality of network nodes using the new primary node.</div>
<div class="description-paragraph" id="p-0235" num="0234"> <figref idrefs="DRAWINGS">FIG. 15</figref> is a schematic diagram illustrating an internal functional module and a structure of a primary node changing apparatus <b>1500</b>. An execution body in essence can be an electronic device, and the electronic device includes the following: at least one processor; and a memory configured to store an executable instruction of the at least one processor.</div>
<div class="description-paragraph" id="p-0236" num="0235">The at least one processor is configured to determine that an epoch change needs to be performed, wherein the epoch change causes a change from a current epoch with a current primary node to a new epoch with a new primary node, wherein the current epoch comprises a consensus process for achieving consensus among the number of network nodes using the primary node, the consensus process including three phases; determine a respective weight of the backup node associated with each of the three phases of the consensus process in the current epoch, wherein the weight is a metric of a qualification of the backup node to be the new primary node; determine a weight sum for the backup node based on the respective weight of the backup node associated with each of the three phases in the current epoch; send an EPOCH_CHANGE message to the number of network nodes other than the network node in response to determining that the weight sum reaches a first predetermined threshold, wherein the EPOCH_CHANGE message indicates a request for a change from the current epoch with the current primary node to the new epoch with the backup node being the new primary node, and the EPOCH_CHANGE message includes the weight sum of the backup node; receive at least one NEW_EPOCH message from at least one of the number of network nodes other than the backup node, wherein the NEW_EPOCH message indicates an acknowledgement of the backup node to be the new primary node; verify whether the at least one NEW_EPOCH message is valid; determine whether a number of valid NEW_EPOCH messages out of the at least one NEW_EPOCH message exceeds a second predetermined threshold; and determine the backup node to be the new primary node in the new epoch in response to determining that the number of valid NEW_EPOCH messages exceeds the second predetermined threshold.</div>
<div class="description-paragraph" id="p-0237" num="0236">Optionally, the determining a respective weight of the backup node associated with each of the three phases of the consensus process in the current epoch includes determining a weight of the backup node for a first phase of the consensus process to be a first value.</div>
<div class="description-paragraph" id="p-0238" num="0237">Optionally, the determining a respective weight of the backup node associated with each of the three phases of the consensus process in the current epoch includes the following: in response to determining a failure of a quorum verification in a second phase of the consensus process in the current epoch, determining a weight of the backup node for the second phase of the consensus process to be a first value; and in response to determining a success of a quorum verification in the second phase of the consensus process in the current epoch, determining the weight of the backup node for the second phase of the consensus process to be a second value, wherein the first value is smaller than the second value.</div>
<div class="description-paragraph" id="p-0239" num="0238">Optionally, the quorum verification in the second phase for the network node includes receiving a predetermined number of ECHO messages from other network nodes.</div>
<div class="description-paragraph" id="p-0240" num="0239">Optionally, the determining a respective weight of the backup node associated with each of the three phases of the consensus process in the current epoch includes the following: in response to determining a failure of a quorum verification in a third phase of the consensus process in the current epoch, determining a weight of the backup node for the third phase of the consensus process to be a third value; and in response to determining a success of a quorum verification in the third phase of the consensus process in the current epoch, determining the weight of the backup node for the third phase of the consensus process to be a fourth value, wherein the third value is smaller than the fourth value.</div>
<div class="description-paragraph" id="p-0241" num="0240">Optionally, the quorum verification in the third phase for the network node includes receiving a pre-determined number of accept messages from other network nodes, wherein each of the accept messages from other network nodes indicates each of the other network nodes has accepted a predetermined number of ECHO messages.</div>
<div class="description-paragraph" id="p-0242" num="0241">Optionally, the EPOCH_CHANGE message further includes a set of signatures associated with a set of network nodes out of the number of network nodes, and wherein the NEW_EPOCH message comprises a digest of the EPOCH_CHANGE message.</div>
<div class="description-paragraph" id="p-0243" num="0242">Optionally, the verifying whether the at least one valid NEW_EPOCH message is valid includes verifying whether the digest of the EPOCH_CHANGE message in the at least one NEW_EPOCH message is valid, and the verifying whether the digest of the EPOCH_CHANGE message in the at least one NEW_EPOCH message is valid includes verifying whether the set of signatures in the EPOCH_CHANGE message are valid.</div>
<div class="description-paragraph" id="p-0244" num="0243">Optionally, the determining that an epoch change needs to be performed includes determining that an epoch change needs to be performed in response to determining that the consensus has not been achieved in the old epoch within a predetermined time period.</div>
<div class="description-paragraph" id="p-0245" num="0244">Optionally, the at least one processor is further configured to operate in the new epoch with the new primary node, wherein the new epoch comprises a consensus process for achieving consensus among the plurality of network nodes using the new primary node.</div>
<div class="description-paragraph" id="p-0246" num="0245">Referring to <figref idrefs="DRAWINGS">FIG. 16</figref>, <figref idrefs="DRAWINGS">FIG. 16</figref> is a diagram illustrating modules of a primary node changing apparatus <b>1600</b>, according to an implementation of the present specification. The apparatus <b>1600</b> for changing a primary node can be applied to a consensus system based on a blockchain technology. The apparatus <b>1600</b> corresponds to the implementations shown in <figref idrefs="DRAWINGS">FIGS. 7-9</figref>. For example, the apparatus <b>1400</b> can be implemented in a network node of a blockchain network. The apparatus <b>1600</b> includes the following: a receiver or receiving unit <b>1602</b>, configured to receive an EPCOH_CHANGE message from a backup node other than the network node, wherein the EPOCH_CHANGE message includes an indication that an epoch change needs to be performed, wherein the epoch change causes an change from a current epoch with a current primary node to a new epoch with a new primary node; a verifying unit <b>1604</b>, configured to verify whether the EPOCH_CHANGE message is valid; a transmitter or transmitting unit <b>1606</b>, configured to send a NEW_EPOCH message to the other network nodes in response to verifying that the EPOCH_CHANGE message is valid, wherein the NEW_EPOCH message comprises a digest of the EPOCH_CHANGE message; the receiver or receiving unit <b>1602</b>, further configured to receive at least one NEW_EPOCH message from at least one of the number of network nodes other than the network node; the verifying unit <b>1604</b>, further configured to verify whether the at least one NEW_EPOCH message is valid; a determining unit <b>1608</b>, configured to determine whether a number of valid NEW_EPOCH messages out of the at least one NEW_EPOCH message exceeds a predetermined threshold; and the determining unit <b>1608</b>, further configured to determine the backup node to be the new primary node in the new epoch in response to determining that the number of valid NEW_EPOCH messages exceeds the predetermined threshold.</div>
<div class="description-paragraph" id="p-0247" num="0246">In an optional implementation, the EPOCH_CHANGE message includes a weight sum associated with the backup node and a set of signatures associated with a set of network nodes out of the number of network nodes.</div>
<div class="description-paragraph" id="p-0248" num="0247">In an optional implementation, the verifying whether the EPOCH_CHANGE message is valid includes verifying whether the weight sum in the EPOCH_CHANGE message is valid, and the verifying whether the weight sum in the EPOCH_CHANGE message is valid includes verifying whether the set of signatures are valid.</div>
<div class="description-paragraph" id="p-0249" num="0248">In an optional implementation, the verifying whether the at least one NEW_EPOCH message is valid includes verifying whether the digest of the EPOCH_CHANGE message in the at least one NEW_EPOCH message is valid, and the verifying whether the digest of the EPOCH_CHANGE message in the at least one NEW_EPOCH message is valid includes verifying whether the set of signatures in the EPOCH_CHANGE message are valid.</div>
<div class="description-paragraph" id="p-0250" num="0249"> <figref idrefs="DRAWINGS">FIG. 16</figref> is a schematic diagram illustrating an internal functional module and a structure of a primary node changing apparatus <b>1600</b>. An execution body in essence can be an electronic device, and the electronic device includes the following: a at least one processor; and a memory configured to store an executable instruction of the at least one processor.</div>
<div class="description-paragraph" id="p-0251" num="0250">The at least one processor is configured to receive an EPCOH_CHANGE message from a backup node other than the network node, wherein the EPOCH_CHANGE message includes an indication that an epoch change needs to be performed, wherein the epoch change causes an change from a current epoch with a current primary node to a new epoch with a new primary node; verify whether the EPOCH_CHANGE message is valid; send a NEW_EPOCH message to the other network nodes in response to verifying that the EPOCH_CHANGE message is valid, wherein the NEW_EPOCH message comprises a digest of the EPOCH_CHANGE message; receive at least one NEW_EPOCH message from at least one of the number of network nodes other than the network node; verify whether the at least one NEW_EPOCH message is valid; determine whether a number of valid NEW_EPOCH messages out of the at least one NEW_EPOCH message exceeds a predetermined threshold; and determine the backup node to be the new primary node in the new epoch in response to determining that the number of valid NEW_EPOCH messages exceeds the predetermined threshold.</div>
<div class="description-paragraph" id="p-0252" num="0251">Optionally, the EPOCH_CHANGE message includes a weight sum associated with the backup node and a set of signatures associated with a set of network nodes out of the number of network nodes.</div>
<div class="description-paragraph" id="p-0253" num="0252">Optionally, the verifying whether the EPOCH_CHANGE message is valid includes verifying whether the weight sum in the EPOCH_CHANGE message is valid, and the verifying whether the weight sum in the EPOCH_CHANGE message is valid includes verifying whether the set of signatures are valid.</div>
<div class="description-paragraph" id="p-0254" num="0253">Optionally, the verifying whether the at least one NEW_EPOCH message is valid includes verifying whether the digest of the EPOCH_CHANGE message in the at least one NEW_EPOCH message is valid, and the verifying whether the digest of the EPOCH_CHANGE message in the at least one NEW_EPOCH message is valid includes verifying whether the set of signatures in the EPOCH_CHANGE message are valid.</div>
<div class="description-paragraph" id="p-0255" num="0254">Referring to <figref idrefs="DRAWINGS">FIG. 17</figref>, <figref idrefs="DRAWINGS">FIG. 17</figref> is a diagram illustrating modules of a recovery apparatus <b>1700</b>, according to an implementation of the present specification. The apparatus <b>1700</b> for recovery can be applied to a consensus system based on a blockchain technology. The apparatus <b>1700</b> can correspond to the implementations shown in <figref idrefs="DRAWINGS">FIGS. 10-12</figref>. For example, the apparatus <b>1700</b> can be implemented in a network node of a blockchain network. The apparatus <b>1700</b> includes the following: a broadcasting unit <b>1702</b>, configured to broadcast, by a network node of a blockchain network, a state request message to a number of other network nodes of the blockchain network, wherein the network node is to recover a target transaction of a target sequence number; a receiver <b>1704</b> or a receiving unit <b>1704</b>, configured to receive a number of state reply messages from the number of other network nodes, wherein each of the number of state reply messages includes a sequence number; an identifying unit <b>1706</b>, configured to identify the target sequence number based on the same sequence number in response to determining that a number of state reply messages exceeds a pre-determined threshold, wherein each of the number of the state reply messages comprises a same sequence number; a transmitter <b>1708</b> or a transmitting unit <b>1708</b>, configured to send a requesting message to the number of other network nodes, wherein the requesting message requests an ECHO message from each of the number of other network nodes, wherein the ECHO message is a message transmitted by the each of the number of other network nodes for achieving a consensus among the number of other network nodes on the target transaction having the target sequence number, and the ECHO message includes a part of the target transaction and a signature of the each of the number of other network nodes; the receiver <b>1704</b> or the receiving unit <b>1704</b>, further configured to receive a number of ECHO messages from the number of other network nodes; a determining unit <b>1710</b>, configured to determine a number of valid ECHO messages out of the number of ECHO messages, wherein each of the number of valid ECHO messages includes the target sequence number; a recovering unit <b>1712</b>, configured to recover the target transaction having the target sequence number at the network node based on the number of valid ECHO messages in response to determining that the number of valid ECHO messages exceeds a pre-determined threshold; and the transmitter <b>1708</b>, further configured to send a message to the number of other network nodes indicating the network node has been recovered.</div>
<div class="description-paragraph" id="p-0256" num="0255">In an optional implementation, the number of network nodes includes a primary node and one or more backup nodes.</div>
<div class="description-paragraph" id="p-0257" num="0256">In an optional implementation, the network node is a primary node or a backup node.</div>
<div class="description-paragraph" id="p-0258" num="0257">In an optional implementation, the requesting message includes the target sequence number.</div>
<div class="description-paragraph" id="p-0259" num="0258">In an optional implementation, the recovery apparatus <b>1700</b> further includes the following: a verifying unit <b>1714</b>, configured to verify, by each of the number of other network nodes other than the network node, the requesting message before sending the ECHO messages to the network node.</div>
<div class="description-paragraph" id="p-0260" num="0259">In an optional implementation, the verifying unit <b>1714</b>, is further configured to verify whether each of the ECHO messages is valid, wherein the verifying whether each of the ECHO messages is valid includes verifying whether each of the ECHO messages is valid using a Merkel tree.</div>
<div class="description-paragraph" id="p-0261" num="0260">In an optional implementation, the verifying whether each of the ECHO message is valid further includes verifying whether the signature in the ECHO message is valid.</div>
<div class="description-paragraph" id="p-0262" num="0261">In an optional implementation, each of the ECHO messages further includes at least one of a number of erasure code (EC) blocks associated with the target transaction, wherein the number of EC blocks are generated according to an EC code using the target transaction.</div>
<div class="description-paragraph" id="p-0263" num="0262">In an optional implementation, the recovering the target transaction having the target sequence number at the network node based on the number of valid ECHO messages comprises reconstructing the target transaction using a subset of the plurality of EC blocks that are in the number of valid ECHO messages.</div>
<div class="description-paragraph" id="p-0264" num="0263">In an optional implementation, the message to the number of other network nodes indicating the network node has been recovered include a set of signatures in the number of valid ECHO messages and the target sequence number.</div>
<div class="description-paragraph" id="p-0265" num="0264">The system, apparatus, module, or unit illustrated in the previous implementations can be implemented by using a computer chip or an entity, or can be implemented by using a product having a certain function. A typical implementation device is a computer, and the computer can be a personal computer, a laptop computer, a cellular phone, a camera phone, a smartphone, a personal digital assistant, a media player, a navigation device, an email receiving and sending device, a game console, a tablet computer, a wearable device, or any combination of these devices.</div>
<div class="description-paragraph" id="p-0266" num="0265">For an implementation process of functions and roles of each unit in the apparatus, references can be made to an implementation process of corresponding steps in the previous method. Details are omitted here for simplicity.</div>
<div class="description-paragraph" id="p-0267" num="0266">Because an apparatus implementation basically corresponds to a method implementation, for related parts, references can be made to related descriptions in the method implementation. The previously described apparatus implementation is merely an example. The units described as separate parts may or may not be physically separate, and parts displayed as units may or may not be physical units, may be located in one position, or may be distributed on a plurality of network units. Some or all of the modules can be selected based on actual demands to achieve the objectives of the solutions of the present specification. A person of ordinary skill in the art can understand and implement the implementations of the present application without creative efforts.</div>
<div class="description-paragraph" id="p-0268" num="0267"> <figref idrefs="DRAWINGS">FIG. 17</figref> is a schematic diagram illustrating an internal functional module and a structure of a recovery apparatus <b>1700</b>. An execution body in essence can be an electronic device, and the electronic device includes the following: at least one processor; and a memory configured to store an executable instruction of the at least one processor.</div>
<div class="description-paragraph" id="p-0269" num="0268">The at least one processor is configured to broadcast, by a network node of a blockchain network, a state request message to a number of other network nodes of the blockchain network, wherein the network node is to recover a target transaction of a target sequence number; receive a number of state reply messages from the number of other network nodes, wherein each of the number of state reply messages includes a sequence number; identify the target sequence number based on the same sequence number in response to determining that a number of state reply messages exceeds a pre-determined threshold, wherein each of the number of the state reply messages comprises a same sequence number; send a requesting message to the number of other network nodes, wherein the requesting message requests an ECHO message from each of the number of other network nodes, wherein the ECHO message is a message transmitted by the each of the number of other network nodes for achieving a consensus among the number of other network nodes on the target transaction having the target sequence number, and the ECHO message includes a part of the target transaction and a signature of the each of the number of other network nodes; receive a number of ECHO messages from the plurality of other network nodes; determine a number of valid ECHO messages out of the number of ECHO messages, wherein each of the number of valid ECHO messages includes the target sequence number; recover the target transaction having the target sequence number at the network node based on the number of valid ECHO messages in response to determining that the number of valid ECHO messages exceeds a pre-determined threshold; and send a message to the number of other network nodes indicating the network node has been recovered.</div>
<div class="description-paragraph" id="p-0270" num="0269">Optionally, the number of network nodes include a primary node and one or more backup nodes.</div>
<div class="description-paragraph" id="p-0271" num="0270">Optionally, the network node is a primary node or a backup node.</div>
<div class="description-paragraph" id="p-0272" num="0271">Optionally, the requesting message includes the target sequence number.</div>
<div class="description-paragraph" id="p-0273" num="0272">Optionally, the at least one processor is further configured to verify, by each of the number of other network nodes other than the network node, the requesting message before sending the ECHO messages to the network node.</div>
<div class="description-paragraph" id="p-0274" num="0273">Optionally, the at least one processor is further configured to verify whether each of the ECHO messages is valid, wherein the verifying whether each of the ECHO messages is valid includes verifying whether each of the ECHO messages is valid using a Merkel tree.</div>
<div class="description-paragraph" id="p-0275" num="0274">Optionally, the verifying whether each of the ECHO message is valid further includes verifying whether the signature in the ECHO message is valid.</div>
<div class="description-paragraph" id="p-0276" num="0275">Optionally, each of the ECHO messages further includes at least one of a number of erasure code (EC) blocks associated with the target transaction, wherein the number of EC blocks are generated according to an EC code using the target transaction.</div>
<div class="description-paragraph" id="p-0277" num="0276">Optionally, recovering the target transaction having the target sequence number at the network node based on the number of valid ECHO messages includes reconstructing the target transaction using a subset of the number of EC blocks that are in the number of valid ECHO messages.</div>
<div class="description-paragraph" id="p-0278" num="0277">Optionally, the message to the number of other network nodes indicating the network node has been recovered includes a set of signatures in the number of valid ECHO messages and the target sequence number.</div>
<div class="description-paragraph" id="p-0279" num="0278">Implementations of the subject matter and the actions and operations described in this specification can be implemented in digital electronic circuitry, in tangibly-embodied computer software or firmware, in computer hardware, including the structures disclosed in this specification and their structural equivalents, or in combinations of one or more of them. Implementations of the subject matter described in this specification can be implemented as one or more computer programs, e.g., one or more modules of computer program instructions, encoded on a computer program carrier, for execution by, or to control the operation of, data processing apparatus. The carrier may be a tangible non-transitory computer storage medium. Alternatively, or in addition, the carrier may be an artificially-generated propagated signal, e.g., a machine-generated electrical, optical, or electromagnetic signal that is generated to encode information for transmission to suitable receiver apparatus for execution by a data processing apparatus. The computer storage medium can be or be part of a machine-readable storage device, a machine-readable storage substrate, a random or serial access memory device, or a combination of one or more of them. A computer storage medium is not a propagated signal.</div>
<div class="description-paragraph" id="p-0280" num="0279">The term “data processing apparatus” encompasses all kinds of apparatus, devices, and machines for processing data, including by way of example a programmable processor, a computer, or multiple processors or computers. Data processing apparatus can include special-purpose logic circuitry, e.g., an FPGA (field programmable gate array), an ASIC (application-specific integrated circuit), or a GPU (graphics processing unit). The apparatus can also include, in addition to hardware, code that creates an execution environment for computer programs, e.g., code that constitutes processor firmware, a protocol stack, a database management system, an operating system, or a combination of one or more of them.</div>
<div class="description-paragraph" id="p-0281" num="0280">A computer program, which may also be referred to or described as a program, software, a software application, an app, a module, a software module, an engine, a script, or code, can be written in any form of programming language, including compiled or interpreted languages, or declarative or procedural languages; and it can be deployed in any form, including as a stand-alone program or as a module, component, engine, subroutine, or other unit suitable for executing in a computing environment, which environment may include one or more computers interconnected by a data communication network in one or more locations.</div>
<div class="description-paragraph" id="p-0282" num="0281">A computer program may, but need not, correspond to a file in a file system. A computer program can be stored in a portion of a file that holds other programs or data, e.g., one or more scripts stored in a markup language document, in a single file dedicated to the program in question, or in multiple coordinated files, e.g., files that store one or more modules, sub-programs, or portions of code.</div>
<div class="description-paragraph" id="p-0283" num="0282">The processes and logic flows described in this specification can be performed by one or more computers executing one or more computer programs to perform operations by operating on input data and generating output. The processes and logic flows can also be performed by special-purpose logic circuitry, e.g., an FPGA, an ASIC, or a GPU, or by a combination of special-purpose logic circuitry and one or more programmed computers.</div>
<div class="description-paragraph" id="p-0284" num="0283">Computers suitable for the execution of a computer program can be based on general or special-purpose microprocessors or both, or any other kind of central processing unit. Generally, a central processing unit will receive instructions and data from a read-only memory or a random access memory or both. Elements of a computer can include a central processing unit for executing instructions and one or more memory devices for storing instructions and data. The central processing unit and the memory can be supplemented by, or incorporated in, special-purpose logic circuitry.</div>
<div class="description-paragraph" id="p-0285" num="0284">Generally, a computer will be coupled to at least one non-transitory computer-readable storage medium (also referred to as a computer-readable memory). The storage medium coupled to the computer can be an internal component of the computer (e.g., an integrated hard drive) or an external component (e.g., universal serial bus (USB) hard drive or a storage system accessed over a network). Examples of storage media can include, for example, magnetic, magneto-optical, or optical disks, solid state drives, network storage resources such as cloud storage systems, or other types of storage media. However, a computer need not have such devices. Moreover, a computer can be embedded in another device, e.g., a mobile telephone, a personal digital assistant (PDA), a mobile audio or video player, a game console, a Global Positioning System (GPS) receiver, or a portable storage device, e.g., a universal serial bus (USB) flash drive, to name just a few.</div>
<div class="description-paragraph" id="p-0286" num="0285">To provide for interaction with a user, implementations of the subject matter described in this specification can be implemented on, or configured to communicate with, a computer having a display device, e.g., a LCD (liquid crystal display) monitor, for displaying information to the user, and an input device by which the user can provide input to the computer, e.g., a keyboard and a pointing device, e.g., a mouse, a trackball or touchpad. Other kinds of devices can be used to provide for interaction with a user as well; for example, feedback provided to the user can be any form of sensory feedback, e.g., visual feedback, auditory feedback, or tactile feedback; and input from the user can be received in any form, including acoustic, speech, or tactile input. In addition, a computer can interact with a user by sending documents to and receiving documents from a device that is used by the user; for example, by sending web pages to a web browser on a user's device in response to requests received from the web browser, or by interacting with an app running on a user device, e.g., a smartphone or electronic tablet. Also, a computer can interact with a user by sending text messages or other forms of message to a personal device, e.g., a smartphone that is running a messaging application, and receiving responsive messages from the user in return.</div>
<div class="description-paragraph" id="p-0287" num="0286">This specification uses the term “configured to” in connection with systems, apparatus, and computer program components. For a system of one or more computers to be configured to perform particular operations or actions means that the system has installed on it software, firmware, hardware, or a combination of them that in operation cause the system to perform the operations or actions. For one or more computer programs to be configured to perform particular operations or actions means that the one or more programs include instructions that, when executed by data processing apparatus, cause the apparatus to perform the operations or actions. For special-purpose logic circuitry to be configured to perform particular operations or actions means that the circuitry has electronic logic that performs the operations or actions.</div>
<div class="description-paragraph" id="p-0288" num="0287">While this specification contains many specific implementation details, these should not be construed as limitations on the scope of what is being claimed, which is defined by the claims themselves, but rather as descriptions of features that may be specific to particular implementations. Certain features that are described in this specification in the context of separate implementations can also be realized in combination in a single implementation. Conversely, various features that are described in the context of a single implementations can also be realized in multiple implementations separately or in any suitable subcombination. Moreover, although features may be described above as acting in certain combinations and even initially be claimed as such, one or more features from a claimed combination can in some cases be excised from the combination, and the claim may be directed to a subcombination or variation of a subcombination.</div>
<div class="description-paragraph" id="p-0289" num="0288">Similarly, while operations are depicted in the drawings and recited in the claims in a particular order, this should not be understood as requiring that such operations be performed in the particular order shown or in sequential order, or that all illustrated operations be performed, to achieve desirable results. In certain circumstances, multitasking and parallel processing may be advantageous. Moreover, the separation of various system modules and components in the implementations described above should not be understood as requiring such separation in all implementations, and it should be understood that the described program components and systems can generally be integrated together in a single software product or packaged into multiple software products.</div>
<div class="description-paragraph" id="p-0290" num="0289">Particular implementations of the subject matter have been described. Other implementations are within the scope of the following claims. For example, the actions recited in the claims can be performed in a different order and still achieve desirable results. As one example, the processes depicted in the accompanying figures do not necessarily require the particular order shown, or sequential order, to achieve desirable results. In some cases, multitasking and parallel processing may be advantageous.</div>
</div>
</div>
</section><section itemprop="claims" itemscope="">
<h2>Claims (<span itemprop="count">27</span>)</h2>
<div html="" itemprop="content"><div class="claims" lang="EN" load-source="patent-office" mxw-id="PCLM268367442">
<claim-statement>The invention claimed is:</claim-statement>
<div class="claim"> <div class="claim" id="CLM-00001" num="00001">
<div class="claim-text">1. A computer-implemented method for achieving a consensus among a plurality of network nodes of a blockchain network comprising at least a primary node and one or more backup nodes, the method comprising:
<div class="claim-text">receiving, by the primary node, a transaction request;</div>
<div class="claim-text">generating, by the primary node, a plurality of erasure code (EC) blocks according to an EC code using the transaction request, wherein the generating the plurality of EC blocks according to an EC code comprises:
<div class="claim-text">transforming the transaction request into an EC message using the EC code; and</div>
<div class="claim-text">dividing the EC message into the plurality of EC block;</div>
</div>
<div class="claim-text">sending, by the primary node, a plurality of first messages to the one or more backup nodes, respectively, wherein each of the plurality of first messages comprises a composite hash value associated with the plurality of EC blocks;</div>
<div class="claim-text">receiving, by the primary node, at least one second message from at least one of the backup nodes, wherein the at least one second message comprises one of the plurality of first messages and a signature of the at least one of the backup nodes associated with the one of the plurality of first messages;</div>
<div class="claim-text">in response to receiving the at least one second message from the at least one of the backup node, verifying, by the primary node, whether the at least one second message is valid;</div>
<div class="claim-text">determining, by the primary node, whether a number of valid second messages exceeds a pre-determined threshold;</div>
<div class="claim-text">in response to determining that the number of valid second messages exceeds the pre-determined threshold, reconstructing, by the primary node, the transaction request based on a subset of the number of valid second messages according to the EC code;</div>
<div class="claim-text">in response to determining that the transaction request has been successfully reconstructed, sending, by the primary node, a third message, to the other network nodes, wherein the third message comprises a set of signatures that are in the valid second messages;</div>
<div class="claim-text">receiving, by the primary node, at least one third message from at least one of the backup nodes; and</div>
<div class="claim-text">in response to receiving a pre-determined number of third messages that are identical, executing, by the primary node, the transaction request.</div>
</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00002" num="00002">
<div class="claim-text">2. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the transaction request is associated with a sequence number.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00003" num="00003">
<div class="claim-text">3. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the composite hash value of the plurality of EC block is generated using a hash tree.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00004" num="00004">
<div class="claim-text">4. The method of <claim-ref idref="CLM-00003">claim 3</claim-ref>, wherein the hash tree comprises a Merkle tree, and wherein the composite hash value is a root hash value of the Merkle tree.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00005" num="00005">
<div class="claim-text">5. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the signature of the at least one of the backup nodes associated with the one of the plurality of first messages comprises a private key signature of the at least one of the backup nodes associated with the one of the plurality of first messages.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00006" num="00006">
<div class="claim-text">6. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the at least one second message further comprises at least one of the plurality of EC blocks.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00007" num="00007">
<div class="claim-text">7. The method of <claim-ref idref="CLM-00006">claim 6</claim-ref>, wherein the verifying, by the primary node, whether the at least one second message is valid comprises:
<div class="claim-text">generating, by the primary node, a reconstructed hash tree using the at least one of the plurality of EC blocks in the at least one second message;</div>
<div class="claim-text">determining, by the primary node, a reconstructed composite hash value of the reconstructed hash tree;</div>
<div class="claim-text">comparing, by the primary node, the reconstructed composite hash value to a composite hash value in the at least one second message; and</div>
<div class="claim-text">determining, by the primary node, whether the reconstructed composite hash value matches the composite hash values in the at least one second message.</div>
</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00008" num="00008">
<div class="claim-text">8. The method of <claim-ref idref="CLM-00007">claim 7</claim-ref>, wherein the method further comprises:
<div class="claim-text">in response to determining that the reconstructed composite hash value matches the composite hash values in the second messages, determining, by the primary node, that the at least one second message is valid.</div>
</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00009" num="00009">
<div class="claim-text">9. The method of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the pre-determined number of third messages that are identical comprise the pre-determined number of the third messages having an identical set of signatures.</div>
</div>
</div> <div class="claim"> <div class="claim" id="CLM-00010" num="00010">
<div class="claim-text">10. A non-transitory computer-readable storage medium storing one or more instructions executable by a computer system to perform operations comprising:
<div class="claim-text">receiving, by a primary node of a blockchain network, a transaction request, wherein the blockchain network further comprises one or more backup nodes;
<div class="claim-text">generating, by the primary node, a plurality of erasure code (EC) blocks according to an EC code using the transaction request, wherein the generating the plurality of EC blocks according to an EC code comprises:</div>
<div class="claim-text">transforming the transaction request into an EC message using the EC code; and</div>
</div>
<div class="claim-text">dividing the EC message into the plurality of EC block;</div>
<div class="claim-text">sending, by the primary node, a plurality of first messages to the one or more backup nodes, respectively, wherein each of the plurality of first messages comprises a composite hash value associated with the plurality of EC blocks;</div>
<div class="claim-text">receiving, by the primary node, at least one second message from at least one of the backup nodes, wherein the at least one second message comprises one of the plurality of first messages and a signature of the at least one of the backup nodes associated with the one of the plurality of first messages;</div>
<div class="claim-text">in response to receiving the at least one second message from the at least one of the backup node, verifying, by the primary node, whether the at least one second message is valid;</div>
<div class="claim-text">determining, by the primary node, whether a number of valid second messages exceeds a pre-determined threshold;</div>
<div class="claim-text">in response to determining that the number of valid second messages exceeds the pre-determined threshold, reconstructing, by the primary node, the transaction request based on a subset of the number of valid second messages according to the EC code;</div>
<div class="claim-text">in response to determining that the transaction request has been successfully reconstructed, send, by the primary node, a third message, to the other network nodes, wherein the third message comprises a set of signatures that are in the valid second messages;</div>
<div class="claim-text">receiving, by the primary node, at least one third message from at least one of the backup nodes; and</div>
<div class="claim-text">in response to receiving a pre-determined number of third messages that are identical, executing, by the primary node, the transaction request.</div>
</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00011" num="00011">
<div class="claim-text">11. The non-transitory computer-readable storage medium of <claim-ref idref="CLM-00010">claim 10</claim-ref>, wherein the transaction request is associated with a sequence number.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00012" num="00012">
<div class="claim-text">12. The non-transitory computer-readable storage medium of <claim-ref idref="CLM-00010">claim 10</claim-ref>, wherein the composite hash value of the plurality of EC block is generated using a hash tree.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00013" num="00013">
<div class="claim-text">13. The non-transitory computer-readable storage medium of <claim-ref idref="CLM-00012">claim 12</claim-ref>, wherein the hash tree comprises a Merkle tree, and wherein the composite hash value is a root hash value of the Merkle tree.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00014" num="00014">
<div class="claim-text">14. The non-transitory computer-readable storage medium of <claim-ref idref="CLM-00010">claim 10</claim-ref>, wherein the signature of the at least one of the backup nodes associated with the one of the plurality of first messages comprises a private key signature of the at least one of the backup nodes associated with the one of the plurality of first messages.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00015" num="00015">
<div class="claim-text">15. The non-transitory computer-readable storage medium of <claim-ref idref="CLM-00010">claim 10</claim-ref>, wherein the at least one second message further comprises at least one of the plurality of EC blocks.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00016" num="00016">
<div class="claim-text">16. The non-transitory computer-readable storage medium of <claim-ref idref="CLM-00015">claim 15</claim-ref>, wherein the verifying, by the primary node, whether the at least one second message is valid comprises:
<div class="claim-text">generating, by the primary node, a reconstructed hash tree using the at least one of the plurality of EC blocks in the at least one second message;</div>
<div class="claim-text">determining, by the primary node, a reconstructed composite hash value of the reconstructed hash tree;</div>
<div class="claim-text">comparing, by the primary node, the reconstructed composite hash value to a composite hash value in the at least one second message; and</div>
<div class="claim-text">determining, by the primary node, whether the reconstructed composite hash value matches the composite hash values in the at least one second message.</div>
</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00017" num="00017">
<div class="claim-text">17. The non-transitory computer-readable storage medium of <claim-ref idref="CLM-00016">claim 16</claim-ref>, the operations further comprising:
<div class="claim-text">in response to determining that the reconstructed composite hash value matches the composite hash values in the second messages, determine, by the primary node, that the at least one second message is valid.</div>
</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00018" num="00018">
<div class="claim-text">18. The non-transitory computer-readable storage medium of <claim-ref idref="CLM-00010">claim 10</claim-ref>, wherein the pre-determined number of third messages that are identical comprise the pre-determined number of the third messages having an identical set of signatures.</div>
</div>
</div> <div class="claim"> <div class="claim" id="CLM-00019" num="00019">
<div class="claim-text">19. A computer-implemented system, including:
<div class="claim-text">one or more computers; and</div>
<div class="claim-text">one or more computer memory devices interoperably coupled with the one or more computers and having tangible, non-transitory, machine-readable media storing one or more instructions that, when executed by the one or more computers, perform one or more operations comprising:
<div class="claim-text">receiving, by a primary node of a blockchain network, a transaction request, wherein the blockchain network further comprises one or more backup nodes;</div>
<div class="claim-text">generating, by the primary node, a plurality of erasure code (EC) blocks according to an EC code using the transaction request, wherein the generating the plurality of EC blocks according to an EC code comprises:</div>
<div class="claim-text">transforming the transaction request into an EC message using the EC code; and</div>
<div class="claim-text">dividing the EC message into the plurality of EC block;</div>
<div class="claim-text">sending, by the primary node, a plurality of first messages to the one or more backup nodes, respectively, wherein each of the plurality of first messages comprises a composite hash value associated with the plurality of EC blocks;</div>
<div class="claim-text">receiving, by the primary node, at least one second message from at least one of the backup nodes, wherein the at least one second message comprises one of the plurality of first messages and a signature of the at least one of the backup nodes associated with the one of the plurality of first messages;</div>
<div class="claim-text">in response to receiving the at least one second message from the at least one of the backup node, verifying, by the primary node, whether the at least one second message is valid;</div>
<div class="claim-text">determining, by the primary node, whether a number of valid second messages exceeds a pre-determined threshold;</div>
<div class="claim-text">in response to determining that the number of valid second messages exceeds the pre-determined threshold, reconstructing, by the primary node, the transaction request based on a subset of the number of valid second messages according to the EC code;</div>
<div class="claim-text">in response to determining that the transaction request has been successfully reconstructed, sending, by the primary node, a third message, to the other network nodes, wherein the third message comprises a set of signatures that are in the valid second messages;</div>
<div class="claim-text">receiving, by the primary node, at least one third message from at least one of the backup nodes; and</div>
<div class="claim-text">in response to receiving a pre-determined number of third messages that are identical, executing, by the primary node, the transaction request.</div>
</div>
</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00020" num="00020">
<div class="claim-text">20. The system of <claim-ref idref="CLM-00019">claim 19</claim-ref>, wherein the transaction request is associated with a sequence number.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00021" num="00021">
<div class="claim-text">21. The system of <claim-ref idref="CLM-00019">claim 19</claim-ref>, wherein the composite hash value of the plurality of EC block is generated using a hash tree.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00022" num="00022">
<div class="claim-text">22. The system of <claim-ref idref="CLM-00021">claim 21</claim-ref>, wherein the hash tree comprises a Merkle tree, and wherein the composite hash value is a root hash value of the Merkle tree.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00023" num="00023">
<div class="claim-text">23. The system of <claim-ref idref="CLM-00019">claim 19</claim-ref>, wherein the signature of the at least one of the backup nodes associated with the one of the plurality of first messages comprises a private key signature of the at least one of the backup nodes associated with the one of the plurality of first messages.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00024" num="00024">
<div class="claim-text">24. The system of <claim-ref idref="CLM-00019">claim 19</claim-ref>, wherein the at least one second message further comprises at least one of the plurality of EC blocks.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00025" num="00025">
<div class="claim-text">25. The system of <claim-ref idref="CLM-00024">claim 24</claim-ref>, wherein the verifying, by the primary node, whether the at least one second message is valid comprises:
<div class="claim-text">generating, by the primary node, a reconstructed hash tree using the at least one of the plurality of EC blocks in the at least one second message;</div>
<div class="claim-text">determining, by the primary node, a reconstructed composite hash value of the reconstructed hash tree;</div>
<div class="claim-text">comparing, by the primary node, the reconstructed composite hash value to a composite hash value in the at least one second message; and</div>
<div class="claim-text">determining, by the primary node, whether the reconstructed composite hash value matches the composite hash values in the at least one second message.</div>
</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00026" num="00026">
<div class="claim-text">26. The system of <claim-ref idref="CLM-00025">claim 25</claim-ref>, wherein the operations further comprise:
<div class="claim-text">in response to determining that the reconstructed composite hash value matches the composite hash values in the second messages, determine, by the primary node, that the at least one second message is valid.</div>
</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00027" num="00027">
<div class="claim-text">27. The system of <claim-ref idref="CLM-00019">claim 19</claim-ref>, wherein the pre-determined number of third messages that are identical comprise the pre-determined number of the third messages having an identical set of signatures.</div>
</div>
</div> </div>
</div>
</section>
                </article>
            </search-app>
        </body>
    </html>
    