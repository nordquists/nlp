
    <html>
        <body>
            <search-app>
                <article class="result" itemscope="" itemtype="http://schema.org/ScholarlyArticle">
    <h1 itemprop="pageTitle">US9549198B2 - Apparatus for decoding a moving picture 
        - Google Patents</h1><section itemprop="abstract" itemscope="">
<h2>Abstract</h2>
<div html="" itemprop="content"><abstract lang="EN" load-source="patent-office" mxw-id="PA187530006">
<div class="abstract" id="p-0001" num="0000">Provided is an apparatus for decoding a moving picture. An inverse quantization/transformation unit generates a quantized block by inversely scanning a quantized coefficient sequence, generates a transform unit by inversely quantizing the quantized block using a quantization step size, and generates a residual block by inversely transforming the transform block. An inter prediction unit generates a prediction block of a current prediction unit based on motion vector information. An adding unit generates a restored block using the residual block and the prediction block. When a motion information coding mode is a skip mode, the inter prediction unit restores motion information of the current prediction block using an available spatial or temporal skip candidate. The temporal skip candidate includes a reference picture index and a motion vector, the reference picture index of the temporal skip candidate is set to 0, and a motion vector of the temporal skip candidate is a motion vector of the temporal skip candidate in a temporal skip candidate picture. A size of the prediction unit is same with a size of a coding unit and the prediction block is set as the restored block.</div>
</abstract>
</div>
</section><section itemprop="description" itemscope="">
<h2>Description</h2>
<div html="" itemprop="content"><div class="description" lang="EN" load-source="patent-office" mxw-id="PDES110661373">
<heading id="h-0001">CROSS-REFERENCE TO RELATED APPLICATIONS</heading>
<div class="description-paragraph" id="p-0002" num="0001">This application is a continuation application of U.S. application Ser. No. 14/812,157 filed on Jul. 29, 2015, which is a continuation application of U.S. application Ser. No. 13/624,814 filed on Sep. 21, 2012, which is a continuation application of International Application No. PCT/KR2011/009562 filed on Dec. 13, 2011, which claims priority to Korean Application No. 10-2010-0127663 filed on Dec. 14, 2010 and Korean Application No. 10-2011-0064312 filed Jun. 30, 2011. The applications are incorporated herein by reference.</div>
<heading id="h-0002">TECHNICAL FIELD</heading>
<div class="description-paragraph" id="p-0003" num="0002">The present invention relates to an apparatus for decoding a moving picture, and more particularly, to an apparatus for constructing a motion vector list by using a candidate of a spatial motion vector and a candidate of a temporal motion vector, decoding a motion vector of a current prediction unit by using a received motion vector index, and decoding the moving picture encoded in inter prediction mode.</div>
<heading id="h-0003">BACKGROUND ART</heading>
<div class="description-paragraph" id="p-0004" num="0003">In image compression methods such as Motion Picture Experts Group (MPEG)-1, MPEG-2, MPEG-4 and H.264/MPEG-4 Advanced Video Coding (AVC), one picture is divided into macroblocks to encode an image. And, the respective macroblocks are encoded using inter prediction or intra prediction. Then, an optimal coding mode is selected in the bases of a data size of a macroblock to be encoded and distortion of an original macroblock, and the macroblock is encoded.</div>
<div class="description-paragraph" id="p-0005" num="0004">In the inter prediction, a motion estimation is used to eliminate temporal redundancy between consecutive pictures. The motion estimation coding is a method which encodes an image by estimating and compensating a motion of the current picture in the unit of block using one or more reference pictures.</div>
<div class="description-paragraph" id="p-0006" num="0005">In the motion estimation coding, the block most similar to the current block is searched within a predetermined search range for a reference picture using a predetermined estimation function. If the most similar block is searched, only residue between the current block and the most similar block in the reference picture is transmitted to raise a data compression ratio.</div>
<div class="description-paragraph" id="p-0007" num="0006">At this time, to decode the motion estimation coded current block, information for the motion vector indicating a position difference between the current block and the similar block in the reference picture. Therefore, it is required to insert encoded information for the motion vector into a bitstream when the current block is encoded. In this process, if the information for the motion vector is encoded and inserted as it is, a compression ratio of an image data is decreased because overhead is increased.</div>
<div class="description-paragraph" id="p-0008" num="0007">Therefore, in the inter prediction encoding, a motion vector of the current block is predicted using blocks adjacent to the current block, only a difference value between the generated motion vector predictor and the original motion vector is encoded and transmitted, and the information of the motion vector is also compressed.</div>
<div class="description-paragraph" id="p-0009" num="0008">In H.264, the motion vector predictor, which is a predictor of a motion vector of the current block, is determined as a median of mvA, mvB and mvC. As neighboring blocks are inclined to be similar each other, the motion vector of the current block is determined as a median of the motion vectors of the neighboring blocks.</div>
<div class="description-paragraph" id="p-0010" num="0009">But, if one or more motion vectors of the neighboring blocks are different from the motion of the current block, the median of the motion vectors of the neighboring blocks may be not an effective motion vector predictor for the current block. Also, a method of selecting a candidate for predicting a motion vector and of encoding or decoding the motion vector more effectively compared to the known motion prediction method is required when the motion of image is little or steady.</div>
<heading id="h-0004">SUMMARY OF THE DISCLOSURE</heading>
<div class="description-paragraph" id="p-0011" num="0010">The present invention is directed to provide an apparatus for decoding a motion vector of a current prediction unit using one of motion vectors of a prediction unit adjacent to a current prediction unit and motion vectors located at a predetermined position in a different picture timely.</div>
<div class="description-paragraph" id="p-0012" num="0011">One aspect of the present invention provides an apparatus for decoding a moving picture, comprising: an inverse quantization/transformation unit configured to generate a quantized block by inversely scanning a quantized coefficient sequence, generate a transform block by inversely quantizing the quantized block using a quantization step size, and generate a residual block by inversely transforming the transform block; an inter prediction unit configured to generate a prediction block of a current block based on motion vector information; and an adding unit configured to generate a restored block using the residual block and the prediction block, wherein, when the prediction block is encoded in merge mode, the inter prediction unit restores motion information of the current block using an available spatial or temporal skip candidate and generates the prediction block of the current block using the motion information, wherein the temporal merge candidate includes a reference picture index and a motion vector, the reference picture index of the temporal merge candidate is set to 0, and a motion vector of the temporal merge candidate is a motion vector of the temporal merge candidate in a temporal merge candidate picture, wherein, when the quantized block is larger than a predetermined size, the quantization coefficient sequence is generated by scanning a plurality of subsets obtained by dividing the quantized block, and wherein a scan pattern for scanning the plurality of subsets is the same as a scan pattern for scanning quantized coefficients of each subset.</div>
<div class="description-paragraph" id="p-0013" num="0012">Preferably, the quantization step size is generated by adding a quantization step size predictor and a remaining quantization step size predictor, and when a quantization step sizes of a left coding unit and an above coding unit of the current block are unavailable, a quantization step size of a previous coding unit in a scan order is determined as the quantization step size of the current block.</div>
<div class="description-paragraph" id="p-0014" num="0013">Preferably, when the spatial skip candidate and the current prediction unit refer to different reference pictures and temporal distances between the reference pictures are different, a motion vector of the spatial skip candidate is scaled.</div>
<div class="description-paragraph" id="p-0015" num="0014">An apparatus according to the present invention accurately decodes the motion vector of the current prediction unit, by which the motion information of the current prediction unit is effectively encoded, by using available spatial motion vector candidates of prediction units located at predetermined positions adjacent to the current prediction unit and one of temporal motion vector candidates of a prediction unit located at a position corresponding to the current prediction unit in a reference picture encoded previously and located at a position adjacent to the position corresponding to the current prediction unit in the reference picture encoded previously. Therefore, computational complexity and bandwidth of the decoder is reduced and the motion information is rapidly and accurately decoded.</div>
<description-of-drawings>
<heading id="h-0005">BRIEF DESCRIPTION OF DRAWINGS</heading>
<div class="description-paragraph" id="p-0016" num="0015"> <figref idrefs="DRAWINGS">FIG. 1</figref> is a conceptual diagram illustrating a method of scanning coding units in a largest coding unit according to the present invention.</div>
<div class="description-paragraph" id="p-0017" num="0016"> <figref idrefs="DRAWINGS">FIG. 2</figref> is a block diagram of a moving picture coding apparatus according to the present invention.</div>
<div class="description-paragraph" id="p-0018" num="0017"> <figref idrefs="DRAWINGS">FIG. 3</figref> is a block diagram of a moving picture decoding apparatus according to the present invention.</div>
<div class="description-paragraph" id="p-0019" num="0018"> <figref idrefs="DRAWINGS">FIG. 4</figref> is a conceptual diagram illustrating positions of spatial skip candidate blocks according to the present invention.</div>
<div class="description-paragraph" id="p-0020" num="0019"> <figref idrefs="DRAWINGS">FIG. 5</figref> is a conceptual diagram illustrating positions of blocks in a temporal skip candidate picture corresponding to a current prediction unit according to the present invention.</div>
<div class="description-paragraph" id="p-0021" num="0020"> <figref idrefs="DRAWINGS">FIG. 6</figref> is a conceptual diagram showing positions of neighboring prediction units used to generate motion vector candidates according to the present invention.</div>
</description-of-drawings>
<heading id="h-0006">DETAILED DESCRIPTION OF THE DISCLOSURE</heading>
<div class="description-paragraph" id="p-0022" num="0021">Hereinafter, various embodiments of the present invention will be described in detail with reference to the accompanying drawings. However, the present invention is not limited to the exemplary embodiments disclosed below, but can be implemented in various types. Therefore, many other modifications and variations of the present invention are possible, and it is to be understood that within the scope of the disclosed concept, the present invention may be practiced otherwise than as has been specifically described.</div>
<div class="description-paragraph" id="p-0023" num="0022">A picture is divided into a plurality of slices, and each slice is divided into a plurality of largest coding units (LCUs). The position of each LCU is designated by an address indicator. The LCU may be a coding unit itself or may be divided into a plurality of coding units. The LCU contains information indicating structure of coding units in the LCU. One or more split flags are used to indicate the structure of coding units in the LCU.</div>
<div class="description-paragraph" id="p-0024" num="0023">Each coding unit (CU) consists of one or more prediction units. The prediction unit is a basic unit for intra prediction or inter prediction.</div>
<div class="description-paragraph" id="p-0025" num="0024">Each coding unit is composed of one or more prediction unit (PU). A transform unit (TU) is a basic block for transform coding. In intra prediction, the prediction unit contains one or more transform units. In inter prediction, a transform unit may be comprised of one or more prediction units. The maximum size of the prediction unit is defined in a sequence parameter set (SPS), and the transform unit may be divided into a form of a recursive quad tree. The maximum size of the prediction unit in intra prediction may be different from that of the prediction unit in inter prediction. The maximum sizes of the prediction unit in intra prediction and inter prediction are contained the SPS.</div>
<div class="description-paragraph" id="p-0026" num="0025">A prediction unit structure of a coding unit for luminance component is the same as that for chrominance components. But, a transform unit structure of a coding unit for luminance component may be different from that for chrominance components. That is, the transform unit size of the chrominance component may be determined regardless of the transform unit size of the luminance component. For example, the transform unit size of the chrominance component may be determined by the size of the coding unit. The transform unit size of the chrominance component may be adaptively adjusted by determining the maximum depth information of the chrominance component in advance. For example, if the depth information of the luminance component is equal to or smaller than the depth information of the chrominance component, the transform unit of the chrominance component is divided according to division information of the transform unit of the luminance component. On the contrary, if the depth information of the luminance component is larger than the depth information of the chrominance component, the transform unit of the chrominance component may be set not to have smaller size of the maximum depth information of the transform unit of the chrominance component. The maximum depth information of the transform unit of the chrominance component can be previously set or determined by the encoder and transmitted to the decoder.</div>
<div class="description-paragraph" id="p-0027" num="0026">A procedure of scanning coding unit for decoding is as follows. First, an address of a LCU is parsed from the bit stream. A LCU size is also parsed. The LCU size may be a predetermined value between an encoder and a decoder, or may be inserted into a sequence header or a picture header of a bit stream. A position of an upper left pixel of the LCU is obtained using the address and/or size of the LCU.</div>
<div class="description-paragraph" id="p-0028" num="0027"> <figref idrefs="DRAWINGS">FIG. 1</figref> is a conceptual diagram illustrating a method of scanning coding units in a largest coding unit according to the present invention. As shown in <figref idrefs="DRAWINGS">FIG. 1</figref>, the coding units in the LCU are scanned recursively in raster order.</div>
<div class="description-paragraph" id="p-0029" num="0028">If there are a plurality of prediction units in a coding unit, the prediction units are also scanned in raster order. The position of the prediction unit is specified by prediction unit index. Therefore the upper left pixel of the prediction unit is obtained using the prediction unit index.</div>
<div class="description-paragraph" id="p-0030" num="0029">If there are a plurality of transform units in a coding unit, the prediction units are also scanned recursively in raster order. The upper left pixel of the transform unit is obtained using the transform unit index.</div>
<div class="description-paragraph" id="p-0031" num="0030">Parameters transmitted by the encoder will be described. A sequence parameter set (SPS) is transmitted through sequence header. The sequence parameter set includes a smallest size of coding unit and maximum split depth information. The sequence parameter set also includes a smallest size of transform unit and maximum transform depth information. The transform depth information may be different in intra prediction and in inter prediction.</div>
<div class="description-paragraph" id="p-0032" num="0031">A slice header includes a slice type. If the slice type is P or B, information indicating a method used to generate a prediction block is included. The slice header may include a flag indicating whether a temporal candidate is used or not when encoding motion information. The temporal candidate is a motion vector of the prediction unit which exists at a position or nearby the position corresponding to the position of the current prediction unit. It is possible that a plurality of motion vectors exist at the position corresponding to the position of the current prediction unit or nearby or nearby the position corresponding to the position of the current prediction unit. In this case, one motion vector predetermined according to the position of the current prediction unit is selected as a temporal motion vector. The position of the candidate may be changed according to a position of the current prediction unit in LCU. The slice header may include a flag indicating whether a temporal candidate picture belongs to a reference picture list <b>0</b> or a reference picture list <b>1</b>. If there is not the flag indicating a reference picture list, a value of the flag is considered <b>1</b> (that, the reference picture list <b>0</b>).</div>
<div class="description-paragraph" id="p-0033" num="0032">The slice header includes information for managing memory to store reference pictures in case that the slice type is P or B.</div>
<div class="description-paragraph" id="p-0034" num="0033">The slice header includes a flag indicating whether adaptive loop filtering is applied to the current slice. If the adaptive loop filtering is applied, the slice header further includes adaptive loop filter (ALF) parameter information. The ALF parameter information includes information indicating a horizontal filter length and/or a vertical filter length of luminance components. The ALF parameter information may include information indicating the number of filters. If the number of filters is 2 or more, the coefficients of the filter may be encoded using prediction method. Furthermore, information whether prediction method is used may be included in the slice header.</div>
<div class="description-paragraph" id="p-0035" num="0034">Chrominance components may also be filtered adaptively. The ALF parameter information may include information whether each chrominance component is filtered or not. To reduce the amount of bits, the information indicating whether the Cr component is filtered and information indicating whether the Cb component is filtered may be coded jointly or multiplexed. An entropy coding is performed by assigning a lowest index in case that both of Cr and Cb components are not filtered, because the probability that both of Cr and Cb components are not filtered is high. And the information may include information indicating a horizontal filter length and/or a vertical filter length of chrominance components and filter information.</div>
<div class="description-paragraph" id="p-0036" num="0035">The ALF parameter may be transmitted in a picture header or another parameter set. In this case, the slice header does not include the ALF parameter and the ALF parameter may include index information indicating the ALF parameter.</div>
<div class="description-paragraph" id="p-0037" num="0036">The ALF process may be performed on the basis of coding unit or on the basis of coding unit equal to or larger than a predetermined size. And the slice header may include information indicating whether the adaptive loop filter process is applied to each coding unit. In this case, the information indicating the size of CU may be the predetermined size and may be included in the slice header.</div>
<div class="description-paragraph" id="p-0038" num="0037">A slice includes a slice header and a plurality of LCUs. The LCU includes information indicating the CU structure in the LCU. The CU structure is a recursive quad tree structure. The CU structure may include information (split_coding_unit_flag) which indicates whether a predetermined size of CU is split into smaller size of CUs. A coding unit of minimum size does not contain the split_coding_unit_flag. A coding unit may include information (alf_flag) indicating whether the ALF is applied or not. If the alf_flag is not included, it is considered that the ALF is not applied. Therefore, the decoder determines whether the alf_flag is included and applies the loop filter adaptively according to the value of the alf_flag, if the alf_flag is included.</div>
<div class="description-paragraph" id="p-0039" num="0038">In H.264, a median value of a horizontal component and a vertical component using motion vector of left neighboring block (A), an above neighboring block (B) and an above right neighboring block (C). But, in HEVC, because a prediction unit of adaptive size is used for motion compensation, there is a high possibility that the size of the current prediction unit is different from that of neighboring prediction unit. Therefore, the motion vector is predicted as follows.</div>
<div class="description-paragraph" id="p-0040" num="0039">A left motion vector which is located at and an above motion vector are used as spatial motion vector candidates. The left motion vector is a motion vector of one of a plurality of left neighboring prediction units and the above motion vector is a motion vector of one of a plurality of above neighboring prediction units. The neighboring prediction units may be located at predetermined positions. For example, the left motion vector is an available motion vector encountered first when retrieving the plurality of left neighboring prediction units in a first predetermined order, and the above motion vector is an available motion vector encountered first when retrieving the plurality of above neighboring prediction units in a second predetermined order. If a current prediction unit is located at the upper boundary of a picture or a slice, only the left motion vector is used as the spatial motion vector candidate. Also, if the current prediction unit is located at the left boundary of a picture or slice, only the above motion vector is used as the spatial motion vector candidate.</div>
<div class="description-paragraph" id="p-0041" num="0040">A motion vector of a predetermined block is used as a temporal motion vector candidate. The predetermined block exists at or nearby a position of a temporal candidate picture corresponding to a position of the current prediction unit. A plurality of blocks may exist at or nearby the position of a temporal reference picture candidate. Thus, the predetermined block may be a block determined by a position of the current prediction unit, or may be one of a plurality of blocks in a predetermined order. The predetermined block may be determined depending on a position of the current prediction unit in a LCU of the current prediction unit. In case that a slice including the current prediction unit is B slice, it is determined whether the temporal candidate picture containing the temporal motion vector candidate belongs to a reference picture list <b>0</b> or <b>1</b>. A list indicator indicating one reference picture list is inserted in a slice header and transmitted to the decoder. If the slice header does not contain the list indicator, the list indicator is considered as 1 (that is, indicating reference picture list <b>0</b>).</div>
<div class="description-paragraph" id="p-0042" num="0041">A procedure of encoding a motion vector of a current prediction unit is as follows.</div>
<div class="description-paragraph" id="p-0043" num="0042">First, a motion vector of the current prediction unit is obtained.</div>
<div class="description-paragraph" id="p-0044" num="0043">Next, an available left motion vector candidate and an available above motion vector candidate of the current prediction unit and neighboring the current prediction unit are derived. If the motion vector of neighboring prediction unit does not exist or the neighboring block of the current prediction unit exists outside of the boundary of the current slice, the motion vector of the neighboring block is determined as unavailable.</div>
<div class="description-paragraph" id="p-0045" num="0044">Next, the spatial motion vector candidate may be scaled adaptively. If the current prediction unit and the neighboring prediction unit have same reference picture, the motion vector candidate is not scaled. But, if the current prediction unit and the neighboring prediction unit have different reference pictures and the temporal distances of the reference pictures are not same, the motion vector candidate may be scaled using the temporal distances. The motion vector may not be scaled for a still image or background image. In this case, information (flag) indicating whether scaling is applied or not may be transmitted to the decoder. The number of scaling of the spatial motion vector candidate may be limited to a predetermined number. For example, the number of scaling may be 1. In this case, if scaling is performed once, the second spatial motion vector candidate to be scaled is set as unavailable.</div>
<div class="description-paragraph" id="p-0046" num="0045">Next, an available temporal motion vector candidate is derived. The available temporal motion vector candidate is the same as mentioned above.</div>
<div class="description-paragraph" id="p-0047" num="0046">Next, a candidate list is constructed using the available spatial and temporal motion vector candidates. The available temporal motion vector candidate is listed after the available spatial motion vector candidate. If a plurality of motion vector candidates are same, motion vector candidate of lower priority is deleted from the candidate list.</div>
<div class="description-paragraph" id="p-0048" num="0047">Next, a motion vector predictor of the current prediction unit is selected among the available spatial and temporal motion vector candidates. The number of motion vector candidate of the current prediction unit may be predetermined. If the number of available motion vector candidates is larger than the predetermined number, the motion vector predictor of the current prediction unit is selected among the predetermined number of motion vector candidates. If the number of available motion vector candidates is smaller than the predetermined number, one or more additional motion vector candidates may be added. The additional motion vector candidate may be a zero vector.</div>
<div class="description-paragraph" id="p-0049" num="0048">Next, a motion vector difference is obtained and encoded. Information indicating motion vector predictor is also encoded. The motion vector difference is a difference between the motion vector of the current prediction unit and the motion vector predictor of the current prediction unit.</div>
<div class="description-paragraph" id="p-0050" num="0049">A procedure of decoding a motion vector of a current prediction unit is as follows.</div>
<div class="description-paragraph" id="p-0051" num="0050">A motion vector difference of the current prediction unit is decoded.</div>
<div class="description-paragraph" id="p-0052" num="0051">Information indicating a motion vector predictor of the current prediction unit is restored.</div>
<div class="description-paragraph" id="p-0053" num="0052">Motion vector candidates for obtaining the motion vector predictor of the current prediction unit are determined through the following procedure.</div>
<div class="description-paragraph" id="p-0054" num="0053">First, an available left motion vector candidate and an available above motion vector candidate of the neighboring prediction unit of the current prediction unit are derived. If the motion vector of the neighboring prediction unit does not exist or the neighboring block of the current prediction unit exists outside of the boundary of the current slice, the motion vector of the neighboring block is determined as unavailable.</div>
<div class="description-paragraph" id="p-0055" num="0054">Next, the spatial motion vector candidate may be scaled adaptively. If the current prediction unit and the neighboring prediction unit have same reference picture, the motion vector candidate is not scaled. But, if the current prediction unit and the neighboring prediction unit have different reference pictures or the temporal distances of the reference pictures are not same, the motion vector candidate may be scaled using the temporal distances. The motion vector may not be scaled for a still image or background image. The number of scaling of the spatial motion vector candidate may be limited to a predetermined number. For example, the number of scaling may be 1. In this case, if scaling is performed once, the second spatial motion vector candidate to be scaled is set as unavailable.</div>
<div class="description-paragraph" id="p-0056" num="0055">Next, an available temporal motion vector candidate is derived. The available temporal motion vector candidate is the same as mentioned above.</div>
<div class="description-paragraph" id="p-0057" num="0056">Next, a candidate list is constructed using the available spatial motion vector candidate and the available temporal motion vector candidate. The available temporal motion vector candidate is listed after the available spatial motion vector candidate. If a plurality of motion vector candidates are same, motion vector candidate of lower priority is deleted from the candidate list.</div>
<div class="description-paragraph" id="p-0058" num="0057">Next, a motion vector predictor is selected among the available spatial motion vector candidate and the available temporal motion vector candidate. The number of motion vector candidate may be predetermined. If the number of available motion vector candidates is larger than the predetermined number, the motion vector predictor is selected among the predetermined number of motion vector candidates. If the number of available motion vector candidates is smaller than the predetermined number, one or more additional motion vector candidates may be added. The additional motion vector candidate is a zero vector.</div>
<div class="description-paragraph" id="p-0059" num="0058">When the motion vector candidates of the current prediction unit are derived, one motion vector candidate corresponding to information indicating the motion vector predictor of the current prediction unit is determined as the motion vector predictor of the current prediction unit.</div>
<div class="description-paragraph" id="p-0060" num="0059">A motion vector of the current prediction unit is obtained using the motion vector difference and the motion vector predictor.</div>
<div class="description-paragraph" id="p-0061" num="0060">A reference picture index of the temporal candidate picture may be 0.</div>
<div class="description-paragraph" id="p-0062" num="0061"> <figref idrefs="DRAWINGS">FIG. 2</figref> is a block diagram of a moving picture coding apparatus <b>100</b> according to the present invention.</div>
<div class="description-paragraph" id="p-0063" num="0062">Referring to <figref idrefs="DRAWINGS">FIG. 2</figref>, a moving picture coding apparatus <b>100</b> according to the present invention includes a picture division unit <b>110</b>, a transform unit <b>120</b>, a quantization unit <b>130</b>, a scanning unit <b>131</b>, an entropy coding unit <b>140</b>, an intra prediction unit <b>150</b>, an inter prediction unit <b>160</b>, an inverse quantization unit <b>135</b>, an inverse transform unit <b>125</b>, a post-processing unit <b>170</b>, a picture storing unit <b>180</b>, a subtracter <b>190</b> and an adder <b>195</b>.</div>
<div class="description-paragraph" id="p-0064" num="0063">The picture division unit <b>110</b> divides analyzes an input video signal to divide each LCU of a picture into one or more coding units each of which has a predetermined size, determine prediction mode of each coding unit, and determines size of prediction unit per each coding unit. The picture division unit <b>110</b> sends the prediction unit to be encoded to the intra prediction unit <b>150</b> or the inter prediction unit <b>160</b> according to the prediction mode. Also, the picture division unit <b>110</b> sends the prediction units to be encoded to the subtracter <b>190</b>.</div>
<div class="description-paragraph" id="p-0065" num="0064">The transform unit <b>120</b> transforms residual blocks which are residual signals between an original block of a prediction unit and a prediction block generated by the intra prediction unit <b>150</b> or the inter prediction unit <b>160</b>. A size of a transform unit of the residual block is equal to or smaller than a size of coding unit. In intra prediction, the size of the transform unit is equal to or smaller than the size of the prediction unit. In inter prediction, the size of the transform unit is also equal to or smaller than the size of the prediction unit, although the size of the transform unit may be larger than the size of the prediction unit. A transform matrix may be adaptively determined according to a prediction mode (intra or inter) and an intra prediction mode. The transform unit may be transformed by horizontal and vertical one-dimensional (1D) transform matrices.</div>
<div class="description-paragraph" id="p-0066" num="0065">In inter prediction, one predetermined transform matrix per each transform direction is applied.</div>
<div class="description-paragraph" id="p-0067" num="0066">If the prediction mode is intra prediction of luminance component and the size of the transform unit is equal to or smaller than a predetermined size, the vertical and horizontal 1D transform matrices are adaptively determined. For example, if the intra prediction mode is horizontal, there is a high possibility that the residual block will have vertical directivity. Thus, a discrete cosine transform (DCT)-based integer matrix is applied to the vertical direction and a discrete sine transform (DST) or Karhunen Loeve transform (KLT)-based integer matrix is applied to the horizontal direction. If the intra prediction mode is vertical, a DST or KLT-based integer matrix is applied to the vertical direction and a DCT-based integer matrix is applied to the horizontal direction. Also, in DC mode, a DCT-based integer matrix is applied to the horizontal and vertical directions. That is, in intra prediction of luminance component, the transform matrix may be adaptively determined according to a size of the transform unit and the intra prediction mode. Meanwhile, in intra prediction mode of chrominance component, the transform matrix is a predetermined matrix regardless of the prediction mode and the intra prediction mode.</div>
<div class="description-paragraph" id="p-0068" num="0067">Meanwhile, a transform pattern may adaptively be selected per transform unit among a plurality of transform patterns, and the selected transform pattern may be transmitted to a decoder. The plurality of transform patterns may include a two-dimensional transform, a vertical transform and a horizontal transform. A scan pattern of the scanning unit <b>131</b> may be determined by the transform pattern. For example, a first scan pattern (diagonal scan) is selected if the transform pattern is the two-dimensional transform, a second scan pattern (horizontal scan) is selected if the transform pattern is the vertical transform, a third scan pattern (vertical scan) is selected if the transform pattern is the horizontal transform, and the first scan pattern is selected if the transform pattern is the pattern where no transform is applied.</div>
<div class="description-paragraph" id="p-0069" num="0068">The quantization unit <b>130</b> determines a quantization step size for quantizing transform coefficients of the residual block transformed by the transform matrix. The quantization step size is determined on a coding unit having a size equal to or larger than a predetermined size. For coding unit having a size smaller than the predetermined size, the quantization step size is determined on the predetermined size. Using the determined quantization step size and a quantization matrix determined according to a prediction mode, the transform coefficients of the transform block are quantized. When the size of the current coding unit is equal to or larger than the predetermined size, the quantization unit <b>130</b> may determine a quantization step size predictor of the current coding unit using quantization step sizes of neighboring coding units or a quantization step size of a previous coding unit in scan order.</div>
<div class="description-paragraph" id="p-0070" num="0069">For example, the quantization unit <b>130</b> may determine a quantization step size of a left coding unit, a quantization step size of a above coding unit or average of the quantization step sizes of the left and above coding units as a quantization step size predictor according to an intra prediction mode of the current coding unit. If the above coding unit does not exist, the quantization step size of the left coding unit or the previous coding unit may be determined as the quantization step size predictor. If the left coding unit is unavailable, the quantization step size of the above coding unit or the previous coding unit may be determined as the quantization step size predictor. When the average of the quantization step sizes of the left and the above coding units is used, if only one quantization step size is available, the available one or the quantization step size of the previous coding unit may be determined as the quantization step size predictor. The above-mentioned method may be applied only to the coding unit within a LCU. That is, if the left or the above coding unit exists outside of the boundary of the LCU, the coding unit may be considered as a unavailable coding unit.</div>
<div class="description-paragraph" id="p-0071" num="0070">The quantized transform block is provided to the inverse quantization unit <b>135</b> and the scanning unit <b>131</b>.</div>
<div class="description-paragraph" id="p-0072" num="0071">The scanning unit <b>131</b> scans the coefficients of the quantized transform block or information indicating whether the quantized transform coefficients exists or not and transforms the coefficients and the information into 1D coefficients. A scan pattern is determined according to the prediction mode and the intra prediction mode. The scan pattern may also be determined according to the size of the transform unit.</div>
<div class="description-paragraph" id="p-0073" num="0072">The scanning unit <b>131</b> determines whether or not to divide the quantized transform block into a plurality of subsets according to the size of the current transform unit. If the size of the transform unit is larger than a first reference size, the quantized transform block is divided into the plurality of subsets. The first reference size is 4×4 or 8×8.</div>
<div class="description-paragraph" id="p-0074" num="0073">The scanning unit <b>131</b> determines a scan pattern to be applied to the quantized transform block. In inter prediction, a predetermined scan pattern (for example, zigzag scan) is used. In intra prediction, the scan pattern is selected based on the intra prediction mode and may be varied according to a directional intra prediction mode. The first scan pattern is used for non-directional intra prediction modes. The non-directional intra prediction modes are a DC mode and a planar mode. The scan is performed in a forward direction or in a reverse direction. When the quantized coefficients are divided into a plurality of subsets, same scan pattern is applied to all the subsets. The plurality of subsets consist of one main subset and one or more residual subsets. The main subset is located at an upper left side and includes a DC coefficient. The one or more residual subsets cover region other than the main subset.</div>
<div class="description-paragraph" id="p-0075" num="0074">The first scan pattern may be applied to scan the subsets. The subsets may be scanned beginning with the main subset to the residual subsets in a forward direction, or can be scanned in a reverse direction. A scan pattern for scanning the subsets may be set the same as a scan pattern for scanning the quantized transform coefficients in the subsets. In this case, the scan pattern for scanning the subsets is determined according to intra prediction mode.</div>
<div class="description-paragraph" id="p-0076" num="0075">An encoder transmits information capable of indicating a position of the last non-zero quantized coefficient of the transform unit to a decoder. The encoder also transmits information capable of indicating a position of the last non-zero quantized coefficient of each subset to the decoder or information indicating whether each subset includes non-zero coefficient or not.</div>
<div class="description-paragraph" id="p-0077" num="0076">The inverse quantization unit <b>135</b> inversely quantizes the quantized transform coefficients. The inverse transform unit <b>125</b> restores residual blocks of the spatial domain from the inversely quantized transform coefficients. The adder generates a reconstructed block by adding the residual block reconstructed by the inverse transform unit <b>125</b> and the prediction block from the intra prediction unit <b>150</b> or the inter prediction unit <b>160</b>.</div>
<div class="description-paragraph" id="p-0078" num="0077">The post-processing unit <b>170</b> performs a deblocking filtering process for removing blocking artifact generated in a reconstructed picture, an adaptive offset application process for complementing a difference between the reconstructed picture and the original image per pixel, and an adaptive loop filter process for complementing a difference between the reconstructed picture and the original image in a coding unit.</div>
<div class="description-paragraph" id="p-0079" num="0078">The deblocking filtering process may be applied to a boundary between prediction units having a predetermined size or more and a boundary between transform units. The predetermined size may be 8×8. The de-blocking filtering process includes a step of determining a boundary to be filtered, a step of determining boundary filtering strength to be applied to the boundary, a step of determining whether or not to apply a deblocking filter, and a step of selecting a filter to be applied to the boundary when it is determined to apply the de-blocking filter.</div>
<div class="description-paragraph" id="p-0080" num="0079">Whether or not to apply the deblocking filter is determined according to i) whether or not the boundary filtering strength is greater than 0 and ii) whether or not a value indicating the difference between boundary pixels of P block and Q block is smaller than a first reference value determined according to a quantization parameter.</div>
<div class="description-paragraph" id="p-0081" num="0080">Two or more filters may exist. When an absolute value of a difference between two pixels adjacent to the block boundary is equal to or larger than a second reference value, a weak filter is selected. The second reference value is determined by the quantization parameter and the boundary filtering strength.</div>
<div class="description-paragraph" id="p-0082" num="0081">The adaptive loop filter process may be performed on the basis of a value obtained by comparing an original image and a reconstructed image to which the de-blocking filtering process or the adaptive offset application process is applied. An adaptive loop filter (ALF) is detected through one Laplacian activity value on the basis of a 4×4 block. The determined ALF can be applied to all pixels included in a 4×4 block or an 8×8 block. Whether or not to apply an ALF may be determined according to coding units. A size and coefficients of a loop filter may vary according to each coding unit. A slice header may include information indicating whether or not to apply the ALF to each coding unit, filter coefficient information and filter shape information, and so on. In the case of chrominance components, whether or not to apply the ALF may be determined in picture units. Unlike luminance, the loop filter may have a rectangular shape.</div>
<div class="description-paragraph" id="p-0083" num="0082">The picture storing unit <b>180</b> receives post-processed image data from the post-processing unit <b>160</b>, and stores the image in picture units. A picture may be an image in a frame or a field. The picture storing unit <b>180</b> has a buffer (not shown) capable of storing a plurality of pictures.</div>
<div class="description-paragraph" id="p-0084" num="0083">The inter prediction unit <b>150</b> performs motion estimation using one or more reference pictures stored in the picture storing unit <b>180</b>, and determines reference picture indexes indicating the reference pictures and motion vectors. According to the reference picture index and the motion vector, the inter prediction unit <b>150</b> extracts a prediction block corresponding to a prediction unit to be encoded from a reference picture selected among a plurality of reference pictures stored in the picture storing unit <b>150</b> and outputs the extracted prediction block.</div>
<div class="description-paragraph" id="p-0085" num="0084">The intra prediction unit <b>140</b> performs intra prediction using reconstructed pixel values within a current picture. The intra prediction unit <b>140</b> receives the current prediction unit to be predictively encoded, selects one of a predetermined number of intra prediction modes, and performs intra prediction. The predetermined number of intra prediction modes may depend on the size of the current prediction unit. The intra prediction unit adaptively filters the reference pixels to generate the intra prediction block. When some of reference pixels are not available, it is possible to generate the reference pixels at the unavailable positions using one or more available reference pixels.</div>
<div class="description-paragraph" id="p-0086" num="0085">The entropy coding unit <b>130</b> entropy-codes the quantized coefficients quantized by the quantization unit <b>130</b>, intra prediction information received from the intra prediction unit <b>140</b>, motion information received from the inter prediction unit <b>150</b>, and so on.</div>
<div class="description-paragraph" id="p-0087" num="0086"> <figref idrefs="DRAWINGS">FIG. 3</figref> is a block diagram of a moving picture decoding apparatus according to the present invention.</div>
<div class="description-paragraph" id="p-0088" num="0087">Referring to <figref idrefs="DRAWINGS">FIG. 3</figref>, the moving picture decoding apparatus according to the present invention includes an entropy decoding unit <b>210</b> (alternatively referred to herein as “entropy decoder”), an inverse quantization/transform unit <b>220</b>, an adder <b>270</b>, a post-processing unit <b>250</b>, a picture storing unit <b>260</b>, an intra prediction unit <b>230</b>, an inter prediction unit <b>240</b> (alternatively referred to herein as “inter predictor”) and a switch <b>280</b>.</div>
<div class="description-paragraph" id="p-0089" num="0088">The entropy decoding unit <b>210</b> extracts intra prediction mode indexes, motion vectors, quantized coefficients sequences (residual block signal), and so on from a received bit stream transmitted from a moving picture coding apparatus. The entropy decoding unit <b>210</b> transmits the decoded motion information to the inter prediction unit <b>240</b>, the intra prediction mode indexes to the intra prediction unit <b>230</b> and the inverse quantization/transform unit <b>220</b>, and the quantized coefficients sequence to the inverse quantization/transform unit <b>220</b>.</div>
<div class="description-paragraph" id="p-0090" num="0089">The inverse quantization/transform unit <b>220</b> includes an inverse scanning unit <b>221</b> (alternatively referred to herein as “inverse scanner”), an inverse quantization unit <b>222</b> (alternatively referred to herein as “inverse quantizer”) and an inverse transform unit <b>223</b> (alternatively referred to herein as “inverse transformer”).</div>
<div class="description-paragraph" id="p-0091" num="0090">The inverse scanning unit <b>221</b> converts the quantized coefficients sequence into two dimensional inverse quantized coefficients. One of a plurality of inverse scan patterns is selected for the conversion. The inverse scan pattern is selected based on at least one of the prediction mode (intra prediction mode or inter prediction mode) and the intra prediction mode of a current block.</div>
<div class="description-paragraph" id="p-0092" num="0091">For example, in inter prediction, a first scan pattern (for example, zigzag scan or diagonal scan) is used. In intra prediction, a second scan pattern is selected based on the intra prediction mode. The second scan pattern may be varied according to directional intra prediction modes. For non-directional intra prediction modes, the first scan pattern may be applied.</div>
<div class="description-paragraph" id="p-0093" num="0092">If the size of a current transform unit to be decoded is larger than a first predetermined reference size and the current transform unit is encoded in the unit of subsets, a quantized transform block is restored by inversely scanning each subset. In this case, same scan pattern is applied to all the subsets. The plurality of subsets consist of one main subset and one or more residual subsets. The main subset is located at an upper left side and includes a DC coefficient. The one or more residual subsets cover region other than the main subset.</div>
<div class="description-paragraph" id="p-0094" num="0093">The first scan pattern may be applied to inversely scan the subsets. The subsets may be scanned beginning with the main subset to the residual subsets in a forward direction, or can be scanned in a reverse direction. A scan pattern for scanning the subsets may be set the same as a scan pattern for scanning the quantized transform coefficients in the subsets. In this case, the scan pattern for inversely scanning the subsets is selected according to the intra prediction mode.</div>
<div class="description-paragraph" id="p-0095" num="0094">When the size of the transform unit is equal to or larger than a predetermined size, inverse scan may be performed by decoding information indicating whether each subset includes non-zero coefficients. That is, the quantized transform block can be restored by inversely scanning coefficients in the subsets including non-zero coefficients are inversely scanned using the information and by setting all the subsets including 0 as 0.</div>
<div class="description-paragraph" id="p-0096" num="0095">The inverse quantization unit <b>222</b> generates a quantization step size predictor of a current coding unit. The quantization step size is determined on a coding unit having a size equal to or larger than a predetermined size. If a plurality of coding units are included in the predetermined size, the quantization step size is determined on the predetermined size. The inverse quantization unit <b>222</b> may determine a quantization step size predictor using one or more quantization step sizes of neighboring coding unit or a quantization step size of the previous coding unit in scan order.</div>
<div class="description-paragraph" id="p-0097" num="0096">The inverse quantization unit <b>222</b> restores a quantization step size to inversely quantize the 2D inverse quantized coefficients. The quantization step size is determined on a coding unit having a size equal to or larger than a predetermined size. If the size of coding units is smaller than the predetermined size, the predetermined quantization step size which is determined per each coding unit in the unit of the predetermined size is determined as the quantization step size. The inverse quantization unit <b>222</b> may use quantization step sizes of one or more neighboring coding units of the current prediction unit or a quantization step size of the previous coding unit in scan order as a quantization step size predictor of the current coding unit.</div>
<div class="description-paragraph" id="p-0098" num="0097">For example, the inverse quantization unit <b>222</b> may adaptively select a quantization step size of a left coding unit, a quantization step size of an above coding unit, or a rounded up average of quantization step sized of the left and the above quantization step sizes as the quantization step size predictor of the current coding unit according to the intra prediction mode of the current coding unit.</div>
<div class="description-paragraph" id="p-0099" num="0098">If the above coding unit does not exist, the quantization step size of the left coding unit or the previous coding unit may be determined as the quantization step size predictor. If the left coding unit is unavailable, the quantization step size of the above coding unit or the previous coding unit may be determined as the quantization step size predictor. When the rounded up average of the quantization step sizes of the left and the above coding units is used, if only one quantization step size is available, the available one or the quantization step size of the previous coding unit may be determined as the quantization step size predictor. In inter prediction, the quantization step size predictor is the rounded up average of the quantization step sizes of the left and the above coding units or the quantization step size of the previous coding unit. Meanwhile, the above-mentioned method may be applied only to the coding unit within a LCU. That is, if the left or the above coding unit exists outside of the boundary of the LCU, the coding unit may be considered as a unavailable coding unit.</div>
<div class="description-paragraph" id="p-0100" num="0099">When the quantization step size predictor is determined, the quantization step size of the current coding unit is generated by adding a received residual quantization step size and the quantization step size predictor. Then, the quantized transform coefficients are inversely quantized using an inverse quantization matrix determined by the quantization step size and the prediction mode.</div>
<div class="description-paragraph" id="p-0101" num="0100">The inverse transform unit <b>223</b> determines an inverse transform matrix according to the size of the transform unit if the inverse quantized block is a luminance block and the prediction mode is intra. For example, if the size of the transform unit is equal to or smaller than a predetermined size, the vertical and the horizontal one-dimensional inverse transform matrixes are determined according to the intra prediction mode. For example, if the intra prediction mode is horizontal, there is a high possibility that the residual block will have vertical directivity. Thus, a DCT-based integer matrix is applied to the vertical direction, and a DST or KLT-based integer matrix is applied to the horizontal direction. If the intra prediction mode is vertical, a DST or KLT-based integer matrix is applied to the vertical direction, and a DCT-based integer matrix is applied to the horizontal direction. Also, in DC mode, a DCT-based integer matrix is applied to the horizontal and the vertical directions. That is, in intra prediction of luminance component, the inverse transform matrix may be adaptively determined according to the size of the transform unit and the intra prediction mode. Meanwhile, in intra prediction mode of chrominance component, the inverse transform matrix is a predetermined matrix regardless of the prediction mode (intra prediction mode or inter prediction mode) and the intra prediction mode.</div>
<div class="description-paragraph" id="p-0102" num="0101">The adder <b>270</b> adds the restored residual block restored by the inverse quantization/transform unit <b>220</b> and a prediction block generated by the intra prediction unit <b>230</b> or the inter prediction unit <b>240</b> to generate a reconstructed block.</div>
<div class="description-paragraph" id="p-0103" num="0102">The post-processing unit <b>250</b> performs a deblocking filtering process for removing blocking artifact generated in a reconstructed picture, an adaptive offset application process for complementing a difference between the reconstructed picture and the original image per pixel, and an adaptive loop filter process for complementing a difference between the reconstructed picture and the original image in a coding unit.</div>
<div class="description-paragraph" id="p-0104" num="0103">The deblocking filtering process may be applied to boundaries of prediction units and transform units having a predetermined size or more. The deblocking filtering process may be applied to block edge having the size of 8×8 in case that the horizontal length or the vertical length of the prediction unit or the transform unit is smaller than 8. The vertical edge is filtered first, and then the horizontal edge is filtered. The deblocking filtering process includes a step of determining a boundary to be filtered, a step of determining boundary filtering strength to be applied to the boundary, a step of determining whether or not to apply a deblocking filter, and a step of selecting a filter to be applied to the boundary when it is determined to apply the deblocking filter.</div>
<div class="description-paragraph" id="p-0105" num="0104">Whether or not to apply the deblocking filter is determined according to i) whether or not the boundary filtering strength is greater than 0 and ii) whether or not a value indicating the difference between boundary pixels of P block and Q block is smaller than a first reference value determined according to a quantization parameter.</div>
<div class="description-paragraph" id="p-0106" num="0105">Two or more filters may exist. When an absolute value of a difference between two pixels adjacent to the block boundary is equal to or larger than a second reference value, a weak filter is selected. The second reference value is determined by the quantization parameter and the boundary filtering strength.</div>
<div class="description-paragraph" id="p-0107" num="0106">The adaptive loop filter process may be performed on the basis of a value obtained by comparing an original image and a reconstructed image to which the de-blocking filtering process or the adaptive offset application process is applied. An adaptive loop filter (ALF) is detected through one Laplacian activity value on the basis of a 4×4 block. The determined ALF can be applied to all pixels included in a 4×4 block or an 8×8 block. Whether or not to apply an ALF may be determined according to coding units. A size and coefficients of a loop filter may vary according to each coding unit. A slice header may include information indicating whether or not to apply the ALF to each coding unit, filter coefficient information and filter shape information, and so on. In the case of chrominance components, whether or not to apply the ALF may be determined in picture units. Unlike luminance, the loop filter may have a rectangular shape.</div>
<div class="description-paragraph" id="p-0108" num="0107">The picture storing unit <b>260</b> is a frame memory storing a local reconstructed picture filtered by the post-processing unit <b>250</b>.</div>
<div class="description-paragraph" id="p-0109" num="0108">The intra prediction unit <b>230</b> restores the intra prediction mode of the current block based on the received intra prediction mode index, and generates a prediction block according to the restored intra prediction mode.</div>
<div class="description-paragraph" id="p-0110" num="0109">The switch <b>280</b> provides a prediction unit generated by the intra prediction unit <b>230</b> or the inter prediction unit <b>240</b> to the adder <b>270</b> according to the prediction mode.</div>
<div class="description-paragraph" id="p-0111" num="0110">The inter prediction unit <b>240</b> restores motion information of the current prediction unit based on the received motion information, and generates a prediction block from the picture stored in the picture storing unit <b>260</b> based on the restored motion information. When motion compensation of decimal precision is applied, the inter prediction unit <b>240</b> generates the prediction block by applying a selected interpolation filter.</div>
<div class="description-paragraph" id="p-0112" num="0111">Now, a method of decoding a moving image in inter prediction mode is described. The method comprises a procedure of generating a prediction block of the current prediction unit, a procedure of restoring a residual block of the current prediction unit and a procedure of generating a reconstructed block using the prediction block and the residual block. The procedure of generating a prediction block is performed by the inter prediction unit <b>240</b> of <figref idrefs="DRAWINGS">FIG. 3</figref>.</div>
<div class="description-paragraph" id="p-0113" num="0112">The procedure of generating a prediction block of a current prediction unit is as follows. The procedure includes 1) a step for deriving motion information of a prediction unit and 2) a step for generating a prediction block of the prediction unit. The motion information includes motion vector, prediction direction and reference picture index.</div>
<div class="description-paragraph" id="p-0114" num="0113">When the prediction unit is encoded in skip mode, the procedure of generating a prediction block is as follows. If a skip_flag in a received coding unit is 1, the prediction unit is the coding unit.</div>
<div class="description-paragraph" id="p-0115" num="0114"> <figref idrefs="DRAWINGS">FIG. 4</figref> is a conceptual diagram showing positions of spatial skip candidates according to the present invention. As shown in <figref idrefs="DRAWINGS">FIG. 4</figref>, a left prediction unit (block A), an above prediction unit (block B), an above right prediction unit (block C) and a left below prediction unit (block D) may be the spatial skip candidates. When a plurality of left prediction units exist, an uppermost left prediction unit or a lowest left prediction unit may be determined as the left prediction unit. When a plurality of above prediction units exist, a leftmost above prediction unit or a rightmost above prediction unit may be determined as the above prediction unit.</div>
<div class="description-paragraph" id="p-0116" num="0115">First, the availability of each spatial skip candidate (A, B, C, D) is checked. If the prediction unit does not exist or the prediction mode of the prediction unit is intra, the candidate block is determined as unavailable.</div>
<div class="description-paragraph" id="p-0117" num="0116">The above left prediction unit (block E) of the current prediction unit can be a spatial skip candidate if one or more than a predetermined number of the candidate blocks A, B, C and D are unavailable. The predetermined number may be decided according to the number of skip candidates transmitted from an encoder.</div>
<div class="description-paragraph" id="p-0118" num="0117">A temporal skip candidate is derived. The procedure of deriving the temporal skip candidate includes a step for deriving a reference picture index of the temporal skip candidate and a step for deriving a motion vector of the temporal skip candidate. The reference picture index of temporal skip candidate may be set to 0 or may be derived using reference picture indexes of spatially neighboring prediction units. The neighboring prediction units are predetermined.</div>
<div class="description-paragraph" id="p-0119" num="0118">The motion vector for the temporal skip candidate is derived as follows.</div>
<div class="description-paragraph" id="p-0120" num="0119">First, a picture (hereinafter, ‘a temporal skip candidate picture’) which a temporal skip candidate block belongs to is determined. A reference picture of index <b>0</b> may be determined as the temporal skip candidate picture. For example, a first reference picture of the reference picture list <b>0</b> is determined as the temporal skip candidate picture when the slice type is P. When the slice type is B, one reference picture list is selected using a flag of slice header indicating the temporal skip candidate picture and a first reference picture of the selected reference picture list is determined as the temporal skip candidate picture. For example, the temporal skip candidate picture is derived from the selected reference picture list <b>0</b> when the flag is 1, whereas, the temporal skip candidate picture is derived from the selected reference picture list <b>1</b> when the flag is 0.</div>
<div class="description-paragraph" id="p-0121" num="0120">Alternatively, a reference picture indicated by a reference picture index for temporal skip candidate is determined as the temporal skip candidate picture which the temporal skip candidate block belongs to.</div>
<div class="description-paragraph" id="p-0122" num="0121">Next, a temporal skip candidate block is derived. One of a plurality of blocks corresponding to the current prediction unit is selected as the temporal skip candidate block. The plurality of blocks are included in the temporal skip candidate picture. In this case, one of a plurality of blocks is selected based on a position of the current prediction unit or one of a plurality of blocks located at a predetermined position is selected. When one of a plurality of blocks is selected, a first available block determined based on the priorities assigned to the plurality of blocks is selected as the temporal skip candidate block. If the motion vectors of the blocks corresponding to the current prediction unit are not available, the temporal skip candidate is considered as unavailable.</div>
<div class="description-paragraph" id="p-0123" num="0122"> <figref idrefs="DRAWINGS">FIG. 5</figref> is a conceptual diagram illustrating positions of blocks in a temporal skip candidate picture corresponding to a current prediction unit according to the present invention.</div>
<div class="description-paragraph" id="p-0124" num="0123">In a case of selecting one of the candidate blocks, a below right corner block (block BR_C) or a lower right block (block BR) may be a first skip candidate block. And a block (block C<b>1</b>) including an upper left pixel or a block (block C<b>2</b>) including an upper left pixel of the center position of a block which is included in the temporal skip candidate picture and corresponds to the current prediction unit may be a second skip candidate block. If the first candidate block is available, the first candidate block is determined as the temporal skip candidate block. If the first candidate block is not available and the second candidate block is available, the second candidate block is determined as the temporal skip candidate block.</div>
<div class="description-paragraph" id="p-0125" num="0124">When the current prediction unit is located at the lower boundary or right boundary of a picture, the second candidate block is determined as the temporal skip candidate block if the second skip candidate block is available. When the current prediction unit is located at the lower boundary of a slice or a LCU, the second candidate block is determined as the temporal skip candidate block if the second candidate block is available.</div>
<div class="description-paragraph" id="p-0126" num="0125">Next, a skip candidate list is generated.</div>
<div class="description-paragraph" id="p-0127" num="0126">The skip candidate list is generated using available spatial and temporal skip candidates. The skip candidates may be listed in a predetermined order. The predetermined order may be an order of a spatial left skip candidate (block A), a spatial above skip candidate (block B), a temporal skip candidate, a spatial above right skip candidate (block C) and a spatial below left skip candidate (block D).</div>
<div class="description-paragraph" id="p-0128" num="0127">The predetermined order may be changed according to the number of skip candidates transmitted from an encoder. In this case, the order of spatial skip candidates is not changed (that is, A, B, C, D, E, and available spatial skip candidates are allowed), but the priority of the temporal skip candidate may be changed.</div>
<div class="description-paragraph" id="p-0129" num="0128">For example, if the number of skip candidates is 5, the temporal skip candidate is listed after available spatial skip candidates. If the number of skip candidates is 3, the order of a temporal skip candidate may be adjusted so that the temporal candidate is listed in top 3. The skip candidates may be listed in an order of the spatial left skip candidate (block A), the spatial above skip candidate (block B) and the temporal skip candidate. If two or more available spatial skip candidates exist, the temporal skip candidate is listed after two of available spatial skip candidates. When the number of skip candidates is 2 or 4, the same method is applied.</div>
<div class="description-paragraph" id="p-0130" num="0129">Meanwhile, if the number of the available skip candidates in the skip candidate list is smaller than a received candidate number from the encoder, one or more skip candidate are generated. The generated skip candidate is listed after the last available skip candidate. When a plurality of skip candidates are generated, the candidates are added in a predetermined order.</div>
<div class="description-paragraph" id="p-0131" num="0130">The skip candidates are generated using a plurality of methods in a predetermined order. The method used to generate the skip candidate depends on the type of slice to which the current prediction unit belongs.</div>
<div class="description-paragraph" id="p-0132" num="0131">When a current slice type is B and the number of available skip candidates is two or more, a first method may be used. When the reference list of the first available skip candidate is different from the reference list of the second available skip candidate, the motion information of the first available skip candidate and the motion information of the first available skip candidate may be combined to generate one or more skip candidates. The generated skip candidate is bi-directional motion information. If a plurality of skip candidates are generated, the generated skip candidates are added according to a predetermined order. The predetermined order is determined based on indexes of the available skip candidates. The number of the skip candidates generated by the first method may be limited to a predetermined number.</div>
<div class="description-paragraph" id="p-0133" num="0132">In a second method, a skip candidate having zero motion vector is added. The skip candidate having zero motion vector is one of a uni-directional L<b>0</b> skip candidate, a uni-directional L<b>1</b> skip candidate and a bi-directional skip candidate. The uni-directional L<b>0</b> skip candidate has zero motion vector, reference picture list <b>0</b> and reference picture index of 0. The uni-directional L<b>1</b> skip candidate has zero motion vector, reference picture list <b>1</b> and reference picture index of 0. The bi-directional skip candidate is a combination of the uni-directional L<b>0</b> skip candidate and the uni-directional L<b>1</b> skip candidate.</div>
<div class="description-paragraph" id="p-0134" num="0133">When the current slice type is P, the uni-directional L<b>0</b> skip candidate is added. When the current slice type is B, one or more skip candidates having zero motion vector may be added. For the slice type B, the bi-direction skip candidate may be added first or skip candidates having zero motion vector may be added in a predetermined order (for example, in an order of the bi-directional skip candidate and the uni-directional skip candidate) until the number of skip candidate is reached.</div>
<div class="description-paragraph" id="p-0135" num="0134">Next, the motion vector and the reference picture index of the current prediction unit are derived.</div>
<div class="description-paragraph" id="p-0136" num="0135">When there is a skip index in the received prediction unit, the motion vector and the reference picture index of the skip candidate indicated by the skip index are determined as the motion vector and the reference index of the current prediction unit. When there is not a skip index in the received prediction unit and there exists a skip candidate, the motion vector and the reference picture index of the skip candidate are determined as the motion vector and the reference index of the current prediction unit.</div>
<div class="description-paragraph" id="p-0137" num="0136">When the skip index indicates the temporal skip candidate, the motion vector of the temporal skip candidate is determined as the motion vector of the current prediction unit and the reference picture index for the temporal skip candidate is determined as the reference picture index of the current prediction unit.</div>
<div class="description-paragraph" id="p-0138" num="0137">If the motion vector and the reference picture index of the current prediction unit are derived, a prediction block is generated using motion vector in the picture indicated by the reference picture index. The prediction block is output as a reconstructed block of the current prediction unit.</div>
<div class="description-paragraph" id="p-0139" num="0138">Next, merge mode is described.</div>
<div class="description-paragraph" id="p-0140" num="0139">When the skip_flag in the coding unit is 0 and merge_flag in the received prediction unit is 1, a procedure of generating a prediction block is almost same as the procedure of generating a prediction block of the skip mode.</div>
<div class="description-paragraph" id="p-0141" num="0140">Available spatial merge candidates are derived from neighboring prediction units. The procedure for obtaining the spatial merge candidates is the same as the spatial skip candidates. But, when the current prediction unit is 2N×N, N×2N, 2N×nU, 2N×nD, nL×2N or nR×2N and the current prediction unit is a partition <b>1</b>, the merge candidate corresponding partition <b>0</b> is deleted.</div>
<div class="description-paragraph" id="p-0142" num="0141">The procedure for obtaining the temporal merge candidate is the same as the temporal skip candidate.</div>
<div class="description-paragraph" id="p-0143" num="0142">A procedure of constructing a merge candidate list and a procedure of generating merge candidate are the same as the procedures in the skip mode.</div>
<div class="description-paragraph" id="p-0144" num="0143">When there is a merge index in the received prediction unit, the motion vector and the reference picture index of the merge candidate indicated by the merge index in the merge candidate list are determined as the motion vector and the reference index of the current prediction unit. When there is not a merge index in the received prediction unit, the motion vector and the reference picture index of the first available merge candidate are determined as the motion vector and the reference index of the current prediction unit.</div>
<div class="description-paragraph" id="p-0145" num="0144">If the motion vector and the reference picture index of the current prediction unit are derived, a prediction block is generated using the motion vector in the picture indicated by the reference picture index.</div>
<div class="description-paragraph" id="p-0146" num="0145">Next, a residual block is restored from a received residual signal through entropy decoding, inverse scan, inverse quantization and inverse transform. The procedures are performed by the entropy decoding unit <b>210</b>, the inverse scanning unit <b>221</b>, the inverse quantization unit <b>222</b> and the inverse transform unit <b>223</b> of the decoding apparatus of <figref idrefs="DRAWINGS">FIG. 3</figref>, respectively.</div>
<div class="description-paragraph" id="p-0147" num="0146">Finally, a reconstructed block of the current prediction unit is generated using the prediction block and the residual block.</div>
<div class="description-paragraph" id="p-0148" num="0147">Next, AMVP mode will be described. When the skip_flag in a coding unit is 0 and the merge_flag in a received prediction unit is 0, AMVP mode is applied. The procedure of generating the prediction block is as follows.</div>
<div class="description-paragraph" id="p-0149" num="0148">First, a reference picture index and a motion vector difference of a current prediction unit are obtained from the received bit stream. If slice type is B, inter prediction information (inter_pred_flag) is checked. If the inter prediction information indicates a uni-directional prediction using combined reference picture list (Pred_LC), a reference picture among the reference pictures of the combined reference picture list (list_c) is selected using the reference picture index, and the motion vector difference is restored. If the inter prediction information indicates a uni-directional prediction using a reference picture list <b>0</b>, a reference picture is selected using the reference picture index of the reference picture list <b>0</b>, and the motion vector difference is restored. If the inter prediction information indicates an bi-directional prediction, each reference picture is selected using each reference picture index of the reference picture lists <b>0</b> and <b>1</b>, and each motion vector difference for each reference picture is restored.</div>
<div class="description-paragraph" id="p-0150" num="0149">Next, a motion vector prediction is determined. The motion vector predictor is selected among the spatial motion vector candidates and the temporal motion vector candidate.</div>
<div class="description-paragraph" id="p-0151" num="0150"> <figref idrefs="DRAWINGS">FIG. 6</figref> is a conceptual diagram showing positions of neighboring prediction units used to generate motion vector candidates according to the present invention.</div>
<div class="description-paragraph" id="p-0152" num="0151">A spatial left motion vector candidate may be one of left prediction units (one of blocks A<sub>0 </sub>and A<sub>1</sub>) of a current prediction unit. A spatial above motion vector candidate may be one of above prediction units (blocks B<sub>0</sub>, B<sub>1 </sub>and B<sub>2</sub>) of the current prediction unit.</div>
<div class="description-paragraph" id="p-0153" num="0152">First, a procedure for deriving the spatial left motion vector candidate will be described.</div>
<div class="description-paragraph" id="p-0154" num="0153">It is checked whether there is a prediction unit satisfying first conditions or second conditions by retrieving the left blocks of the current prediction unit in the order of blocks A<sub>0 </sub>and A<sub>1</sub>. The first conditions are 1) there exists a prediction unit, 2) the prediction unit is an inter prediction coded unit, 3) the prediction unit has same reference picture as that of the current prediction unit and 4) the prediction unit has same reference picture list as that of the current prediction unit. If there is a prediction unit satisfying the first conditions, the motion vector of the prediction unit is determined as the spatial left motion vector candidate. The second conditions are 1) there exists a prediction unit, 2) the prediction unit is an inter prediction coded unit, 3) the prediction unit has same reference picture as that of the current prediction unit and 4) the prediction unit has different reference picture list from that of the current prediction unit. If there is a prediction unit satisfying the second conditions, the motion vector of the prediction unit is determined as the spatial left motion vector candidate. If there is a prediction unit satisfying the first conditions or the second conditions, the motion vector of the prediction unit is determined as the spatial left motion vector candidate.</div>
<div class="description-paragraph" id="p-0155" num="0154">If there does not exist a prediction unit satisfying any one of the first conditions and the second conditions, it is checked whether there is a prediction unit satisfying third conditions or fourth conditions when retrieving the left blocks in the order of blocks A<sub>0 </sub>and A<sub>1</sub>. The third conditions are 1) there exists a prediction unit, 2) the prediction unit is an inter prediction coded unit, 3) the prediction unit has same reference picture list as that of the current prediction unit and 4) the prediction unit has different reference picture from that of the current prediction unit. If there is a prediction unit satisfying the third conditions, the motion vector of the prediction unit is determined as the spatial left motion vector candidate. The fourth conditions are 1) there exists a prediction unit, 2) the prediction unit is an inter prediction coded unit, 3) the prediction unit has different reference picture list from that of the current prediction unit and 4) the prediction unit has different reference picture from that of the current prediction unit. If there is a prediction unit satisfying the third conditions or the forth conditions, the motion vector of the prediction unit is determined as the spatial left motion vector candidate.</div>
<div class="description-paragraph" id="p-0156" num="0155">The motion vector of the prediction unit satisfying the first conditions or the second conditions is not scaled. But, the motion vector of the prediction unit satisfying the third conditions or the forth conditions is scaled.</div>
<div class="description-paragraph" id="p-0157" num="0156">If there is not a prediction unit satisfying any one conditions, the spatial left motion vector candidate is unavailable.</div>
<div class="description-paragraph" id="p-0158" num="0157">A procedure for deriving a spatial above motion vector candidate is as follows.</div>
<div class="description-paragraph" id="p-0159" num="0158">It is checked whether there is a prediction unit satisfying the first conditions or the second conditions when retrieving the above blocks in the order of blocks B<sub>0</sub>, B<sub>1 </sub>and B<sub>2</sub>. If there is a prediction unit satisfying the first conditions or the second conditions, the motion vector of the prediction unit is determined as the spatial above motion vector candidate.</div>
<div class="description-paragraph" id="p-0160" num="0159">If there does not exist a prediction unit satisfying any one of the first conditions and the second conditions, it is checked whether there is a prediction unit satisfying third conditions or fourth conditions. If there is a prediction unit satisfying the third conditions or the forth conditions, the motion vector of the prediction unit is determined as the spatial left motion vector candidate. But, If the spatial left motion vector candidate is satisfying the third conditions or the forth conditions, the spatial above motion vector candidate may be set to be unavailable.</div>
<div class="description-paragraph" id="p-0161" num="0160">The procedure of deriving a temporal motion vector candidate is the same as that of the motion vector of the temporal skip candidate.</div>
<div class="description-paragraph" id="p-0162" num="0161">Next, a motion vector candidate list is constructed.</div>
<div class="description-paragraph" id="p-0163" num="0162">The motion vector candidate list is constructed using available spatial and temporal motion vector candidates. The motion vector candidate list may be constructed in a predetermined order. The predetermined order is the order of a spatial left motion vector candidate (block A), a spatial above motion vector candidate (block B) and a temporal motion vector candidate, or the order of a temporal motion vector candidate, a spatial left motion vector candidate (block A) and a spatial above motion vector candidate (block B).</div>
<div class="description-paragraph" id="p-0164" num="0163">The predetermined order may be changed according to a prediction mode of the prediction unit.</div>
<div class="description-paragraph" id="p-0165" num="0164">Next, if a plurality of candidates have same motion vector, the candidate having lower priority is deleted in the motion vector candidate list. If the number of motion vector candidates in the list is smaller than a predetermined number, a zero vector is added.</div>
<div class="description-paragraph" id="p-0166" num="0165">Next, a motion vector predictor of the current prediction unit is obtained. The motion vector candidate indicated by the motion vector index is determined as the motion vector predictor of the current prediction unit.</div>
<div class="description-paragraph" id="p-0167" num="0166">Next, a motion vector of the current prediction unit is generated by adding the motion vector difference received from an encoder and the motion vector predictor. And a prediction block is generated using the reference picture index received from the encoder and the restored motion vector</div>
<div class="description-paragraph" id="p-0168" num="0167">Also, a residual block is restored from a residual signal received from the encoder through entropy decoding, inverse scan, inverse quantization and inverse transform. The procedures are performed by the entropy decoding unit <b>210</b>, the inverse scanning unit <b>221</b>, the inverse quantization unit <b>222</b> and the inverse transform unit <b>223</b> of the decoding apparatus of <figref idrefs="DRAWINGS">FIG. 3</figref>, respectively.</div>
<div class="description-paragraph" id="p-0169" num="0168">Finally, a reconstructed block is generated using the prediction block and the residual block</div>
<div class="description-paragraph" id="p-0170" num="0169">While the invention has been shown and described with reference to certain exemplary embodiments thereof, it will be understood by those skilled in the art that various changes in form and details may be made therein without departing from the spirit and scope of the invention as defined by the appended claims.</div>
</div>
</div>
</section><section itemprop="claims" itemscope="">
<h2>Claims (<span itemprop="count">2</span>)</h2>
<div html="" itemprop="content"><div class="claims" lang="EN" load-source="patent-office" mxw-id="PCLM103641587">
<claim-statement>The invention claimed is:</claim-statement>
<div class="claim"> <div class="claim" id="CLM-00001" num="00001">
<div class="claim-text">1. An apparatus for decoding a moving picture, the apparatus comprising:
<div class="claim-text">an entropy decoder configured to extract motion information and a quantized coefficients sequence from a received bit stream;</div>
<div class="claim-text">an inverse scanner configured to restore a quantized transform block by inversely scanning the quantized coefficients sequence;</div>
<div class="claim-text">an inverse quantizer configured to generate a transform block by inversely quantizing the quantized transform block using a quantization step size;</div>
<div class="claim-text">an inverse transformer configured to generate a restored residual block by inversely transforming the transform block;</div>
<div class="claim-text">an inter predictor configured to generate a prediction block of a current prediction block based on the motion information; and</div>
<div class="claim-text">an adder configured to generate a restored block by adding together the restored residual block and the prediction block,</div>
<div class="claim-text">wherein, when the current prediction block is encoded in a merge mode, the inter predictor generates a merge candidate list using an available spatial and available temporal merge candidate, determines a motion vector and a reference picture index of a merge candidate in the merge candidate list indicated by a merge index as a motion vector and a reference picture index of the current prediction block, and generates the prediction block of the current prediction block using the motion vector and the reference picture index of the current prediction block,</div>
<div class="claim-text">wherein the temporal skip candidate includes a reference picture index set to 0 and a motion vector,</div>
<div class="claim-text">wherein, when a size of the transform block is larger than a predetermined size, the quantized transform block is restored by inversely scanning the quantized coefficients sequence in the unit of subset, and</div>
<div class="claim-text">wherein a scan pattern for scanning the plurality of subsets is same as a scan pattern for scanning quantized coefficients of each subset.</div>
</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00002" num="00002">
<div class="claim-text">2. The apparatus of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein the quantization step size is generated by adding a quantization step size predictor of the current prediction block and a received residual quantization step size, and when quantization step sizes of a left coding unit and an above coding unit of the current prediction block are unavailable, a quantization step size of a previous coding unit in a scan order is determined as the quantization step size predictor of the current prediction block.</div>
</div>
</div> </div>
</div>
</section>
                </article>
            </search-app>
        </body>
    </html>
    