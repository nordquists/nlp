
    <html>
        <body>
            <search-app>
                <article class="result" itemscope="" itemtype="http://schema.org/ScholarlyArticle">
    <h1 itemprop="pageTitle">US10304877B2 - Circuit and method for controlling and selectively enabling photodiode cells 
        - Google Patents</h1><section itemprop="abstract" itemscope="">
<h2>Abstract</h2>
<div html="" itemprop="content"><abstract lang="EN" load-source="patent-office" mxw-id="PA296940420">
<div class="abstract" id="p-0001" num="0000">A circuit may include an array of single photon avalanche diode (SPAD) cells, each SPAD cell configured to be selectively enabled by an activation signal. The circuit may include a control circuit configured to selectively enable a subset of the array of SPAD cells based on a measured count rate of the array of SPAD cells.</div>
</abstract>
</div>
</section><section itemprop="description" itemscope="">
<h2>Description</h2>
<div html="" itemprop="content"><div class="description" lang="EN" load-source="patent-office" mxw-id="PDES192286100">
<heading id="h-0001">CROSS-REFERENCE TO RELATED APPLICATIONS</heading>
<div class="description-paragraph" id="p-0002" num="0001">This application is continuation of U.S. patent application Ser. No. 14/926,454, filed on Oct. 29, 2015, which claims priority to French Application No. 1552385, filed on Mar. 23, 2015, which applications are hereby incorporated herein by reference.</div>
<heading id="h-0002">TECHNICAL FIELD</heading>
<div class="description-paragraph" id="p-0003" num="0002">The present disclosure relates to the field of single photon avalanche diode (SPAD) arrays, and in particular to, a circuit and method for controlling a SPAD array.</div>
<heading id="h-0003">BACKGROUND</heading>
<div class="description-paragraph" id="p-0004" num="0003">SPAD arrays can be used for a variety of applications, including for ranging, for Z (i.e. depth) or three-dimensional (3D) gesture recognition, and for 3D imaging. A device for such applications generally comprises a light source for transmitting a light pulse into the image scene. The light reflected back from any object in the image scene is detected by the SPAD array, and is used to determine the time of flight of the light pulse. The distance from object to the device can then be deduced based on this time of flight.</div>
<div class="description-paragraph" id="p-0005" num="0004">The detection by the SPAD array of the returning light pulse is based on event detection in the cells of the SPAD array. In particular, each cell will provide an output pulse when a photon is detected, and by monitoring the events, the arrival time of the return pulse can be estimated.</div>
<div class="description-paragraph" id="p-0006" num="0005">The total number of events detected by the SPAD array within a given time period will vary as a function of factors, such as the ambient light, the target reflectance, the emitted power, the SPAD sensitivity, and the distance to the target object. A problem may be that, when the number of detected events is high, the measurement accuracy of the SPAD array can deteriorate.</div>
<heading id="h-0004">SUMMARY</heading>
<div class="description-paragraph" id="p-0007" num="0006">Generally speaking, a circuit may include an array of SPAD cells, each SPAD cell configured to be selectively enabled by an activation signal. The circuit may include a control circuit configured to selectively enable a subset of the array of SPAD cells based on a measured count rate of the array of SPAD cells.</div>
<description-of-drawings>
<heading id="h-0005">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<div class="description-paragraph" id="p-0008" num="0007"> <figref idrefs="DRAWINGS">FIG. 1</figref> is a schematic diagram of a SPAD device, according to an example embodiment of the present disclosure.</div>
<div class="description-paragraph" id="p-0009" num="0008"> <figref idrefs="DRAWINGS">FIG. 2</figref> is a schematic diagram of a delay detection circuit of <figref idrefs="DRAWINGS">FIG. 1</figref> in more detail, according to an example embodiment.</div>
<div class="description-paragraph" id="p-0010" num="0009"> <figref idrefs="DRAWINGS">FIG. 3</figref> is a timing diagram illustrating examples of signals in the circuit of <figref idrefs="DRAWINGS">FIG. 2</figref>.</div>
<div class="description-paragraph" id="p-0011" num="0010"> <figref idrefs="DRAWINGS">FIG. 4</figref> is a schematic diagram of a SPAD array comprising subsets of cells, according to an example embodiment.</div>
<div class="description-paragraph" id="p-0012" num="0011"> <figref idrefs="DRAWINGS">FIG. 5</figref> is a schematic diagram of the circuit of a SPAD cell, according to an example embodiment.</div>
<div class="description-paragraph" id="p-0013" num="0012"> <figref idrefs="DRAWINGS">FIG. 6A</figref> is a schematic diagram of a circuit for generating activation signals for the SPAD cells of a SPAD array, according to an example embodiment.</div>
<div class="description-paragraph" id="p-0014" num="0013"> <figref idrefs="DRAWINGS">FIG. 6B</figref> is a schematic diagram of a control circuit of <figref idrefs="DRAWINGS">FIG. 6A</figref> in more detail.</div>
<div class="description-paragraph" id="p-0015" num="0014"> <figref idrefs="DRAWINGS">FIG. 7A</figref> is a top plan view of a SPAD cell with an annular shield, according to an example embodiment.</div>
<div class="description-paragraph" id="p-0016" num="0015"> <figref idrefs="DRAWINGS">FIG. 7B</figref> is a cross-section view of the SPAD cell of <figref idrefs="DRAWINGS">FIG. 7A</figref> taken along a dashed line A-A in <figref idrefs="DRAWINGS">FIG. 7A</figref>.</div>
<div class="description-paragraph" id="p-0017" num="0016"> <figref idrefs="DRAWINGS">FIG. 8</figref> is a flowchart representing a method for determining a number of SPAD cells of a SPAD array to be enabled, according to an example embodiment of the present disclosure.</div>
</description-of-drawings>
<heading id="h-0006">DETAILED DESCRIPTION OF ILLUSTRATIVE EMBODIMENTS</heading>
<div class="description-paragraph" id="p-0018" num="0017">Throughout the present description, the term “connected” is used to designate a direct electrical connection between two elements, whereas the term “coupled” is used to designate an electrical connection between two elements that may be direct, or may be via one or more other components such as resistors, capacitors or transistors. Furthermore, as used herein, the term “substantially” is used to designate a range of +/−10 percent of the value in question. It is an aim of embodiments of the present description to at least partially address one or more problems in the prior art.</div>
<div class="description-paragraph" id="p-0019" num="0018">Generally speaking, a circuit may include an array of SPAD cells, each SPAD cell being selectively enabled by an activation signal, and a control circuit adapted to selectively enable only a subset of the SPAD cells of the array based on a measured count rate of the SPAD array. Also, at least one first cell of the SPAD array may have a photosensitive zone at least partially shielded by a shield such that the at least one first cell has a lower sensitivity than the other cells of the SPAD array.</div>
<div class="description-paragraph" id="p-0020" num="0019">Additionally, the shield may have an opening with an area equal to between 5% and 90% of the area of the photosensitive zone. The enabled subset of SPAD cells may comprise the at least one first cell. The measured count rate may be the highest of a plurality of measured count rates. The circuit may further comprise a light source, and the control circuit may comprise an adder for generating the measured count rate by adding an ambient rate measured while the light source is disabled to a further rate measured while the light source is enabled.</div>
<div class="description-paragraph" id="p-0021" num="0020">Moreover, the control circuit may be adapted to determine, based on the measured count rate, a first value indicating the number of SPAD cells of the array to form the first subset of enabled cells. The control circuit may be adapted to compare the first value with a threshold value and to selectively enable the at least one first cell of the SPAD array based on the comparison.</div>
<div class="description-paragraph" id="p-0022" num="0021">The circuit may further include a count circuit comprising one or more counters adapted to count events detected by each enabled cell of the SPAD array during a count window. The cells of the SPAD array may be disabled during a deadtime between detection phases, and the control circuit may be adapted to generate the threshold value based on the duration of the deadtime period.</div>
<div class="description-paragraph" id="p-0023" num="0022">The SPAD array may comprise at least first, second and third subsets of cells. The control circuit may be adapted to generate a first enable signal for selectively enabling the cells of the first subset and a second enable signal for selectively enabling the cells of the second subset. Each cell of the SPAD array may comprise a first transistor having main conducting nodes coupled between an output node of the cell and a first supply voltage rail, and a control node being controlled based on the activating signal.</div>
<div class="description-paragraph" id="p-0024" num="0023">Each cell of the SPAD array may comprise an avalanche diode, and a second transistor having main conducting nodes coupled between a node of the avalanche diode and a second supply voltage rail, and a control node being controlled based on the activating signal. A method may include selectively enabling, by a control circuit, only a subset of the cells of an array of SPAD (single photon avalanche diode) cells based on a measured count rate of the SPAD array.</div>
<div class="description-paragraph" id="p-0025" num="0024"> <figref idrefs="DRAWINGS">FIG. 1</figref> illustrates a SPAD device <b>100</b>, which is, for example, a ranging device, Z or 3D gesture recognition device, or 3D imaging device. The device <b>100</b> comprises a light source <b>102</b>, which is, for example, a laser, for generating a beam of light pulses transmitted into the image scene, for example, via a lens <b>104</b>. The return light pulses are, for example, received via a further lens <b>106</b>.</div>
<div class="description-paragraph" id="p-0026" num="0025">The SPAD device further comprises a detection circuit <b>108</b> for determining the distance between the device <b>100</b> and an object in the image scene, against which the light pulses reflect. The detection circuit <b>108</b>, for example, comprises a target SPAD array (TARGET SPAD) <b>110</b>, which receives the return light pulses via the lens <b>106</b>. The target SPAD array <b>110</b>, for example, comprises an array of between 4 and several hundred SPAD cells. In one example, the array is a 12 by 12 array comprising 144 SPAD cells.</div>
<div class="description-paragraph" id="p-0027" num="0026">The detection circuit <b>108</b> also, for example, comprises a reference SPAD array (REF SPAD) <b>112</b>, which is, for example, of the same dimensions as the target SPAD array <b>110</b>, and receives an internal reflection of the transmitted light pulses. A delay detection circuit (DELAY DETECTION) <b>114</b> is, for example, coupled to the target SPAD array no and to the reference SPAD array <b>112</b>, and estimates the delay between each transmitted light pulse and the return light pulse received by the target SPAD array <b>110</b>. The detection circuit <b>108</b> also, for example, comprises a frequency generation circuit (FREQUENCY GENERATION) <b>116</b>, which generates a voltage signal VCSEL provided to a laser modulation circuit (LASER MOD) <b>118</b> for generating a signal for driving the light source <b>102</b>.</div>
<div class="description-paragraph" id="p-0028" num="0027"> <figref idrefs="DRAWINGS">FIG. 2</figref> includes a circuit <b>200</b> forming part of the delay detection circuit <b>114</b> of <figref idrefs="DRAWINGS">FIG. 1</figref> according to an example embodiment. The circuit <b>200</b> receives signals from the cells of the target SPAD array <b>110</b>. A similar circuit is, for example, provided for receiving the signals from the cells of the reference SPAD array <b>112</b>.</div>
<div class="description-paragraph" id="p-0029" num="0028">The circuit <b>200</b>, for example, comprises an OR tree (OR TREE) <b>202</b> having inputs respectively coupled to each of the SPAD cells SPADi to SPADN of the array <b>110</b>, and providing, on its output line <b>204</b>, pulses generated each time an event is detected by one of the SPAD cells. The output line <b>204</b> is coupled to counters for counting the detected events. In the example of <figref idrefs="DRAWINGS">FIG. 2</figref>, the output line is coupled to the clock input of an up counter (UP) <b>206</b> and of a down counter (DN) <b>208</b>. The up counter <b>206</b> is enabled during an up count period, based on a signal UP received from a timing generation circuit (TIMING GEN) <b>210</b>, which receives a clock signal CLK. Similarly, the down counter <b>208</b> is enabled during a down count period, based on a signal DN received from the timing generation circuit <b>210</b>. The output of the counter <b>206</b> is, for example, clocked by a flip-flop <b>212</b> based on the clock signal CLK, and the output of the counter <b>208</b> is, for example, clocked by a flip-flop <b>214</b> based on the clock signal CLK. A difference between the outputs of the flip-flops <b>212</b> and <b>214</b> is generated by a subtraction unit <b>216</b> to provide a signal COUNT_SUM. This signal is analyzed by an analysis circuit <b>218</b> in order to determine the timing to be applied by the timing generation circuit <b>210</b>.</div>
<div class="description-paragraph" id="p-0030" num="0029">The circuit <b>200</b>, for example, further comprises a control circuit (CTRL) <b>220</b> adapted to enable only a subset of the SPAD cells of the SPAD array no based on a measured count rate of the array. For example, the count rate is determined by counting, during successive periods, events on the line <b>204</b> at the output of the OR tree.</div>
<div class="description-paragraph" id="p-0031" num="0030"> <figref idrefs="DRAWINGS">FIG. 3</figref> illustrates a count window (COUNT WINDOW) of the counters <b>206</b>, <b>208</b> of <figref idrefs="DRAWINGS">FIG. 2</figref>, and the signal UP and DN controlling the counters <b>206</b>, <b>208</b>, the signal COUNT_SUM and the signal VCSEL used to generate the optical pulses. The count window for each detection phase, for example, has a duration tCW, and the count windows are separated by deadtime periods of duration tDT during which the counters <b>206</b>, <b>208</b> are disabled. The signal UP is, for example, asserted during the first half of the count window, and the signal DN is, for example, asserted during the second half of the count window.</div>
<div class="description-paragraph" id="p-0032" num="0031">In particular, the signal VCSEL is, for example, the signal used to generate the transmitted light pulses, and thus a time difference between this pulse and the center of the count window, averaged over several detection phases, can be used to determine a first time delay between VCSEL and the return light pulse. In a similar fashion, a second time delay between VCSEL and the reference pulse is, for example, calculated. The difference between the first and second time delays is, for example, determined in order to estimate the time of flight.</div>
<div class="description-paragraph" id="p-0033" num="0032">The circuit of <figref idrefs="DRAWINGS">FIG. 2</figref> provides one particular example implementation of a detection circuit for a SPAD array. It will however be apparent to those skilled in the art that the principles of the SPAD array control method described herein after could be applied to different types of SPAD detection circuits.</div>
<div class="description-paragraph" id="p-0034" num="0033"> <figref idrefs="DRAWINGS">FIG. 4</figref> schematically illustrates the SPAD array no according to an example embodiment, in an example in which it comprises a <b>12</b> by <b>12</b> array of SPAD cells. The array <b>110</b> is, for example, divided into a plurality of subsets of SPAD cells. In the example of <figref idrefs="DRAWINGS">FIG. 4</figref>, the array is divided into a set of 64 cells <b>402</b> shown with a first type of hatching, a set of 31 cells <b>404</b> shown with a second type of hatching, a set of <b>14</b> cells <b>406</b> shown with a third type of hatching, a set of 7 cells <b>408</b> shown with a fourth type of hatching, a set of 4 cells <b>410</b> shown with a fifth type of hatching, a set of 12 cells <b>412</b> shown with a sixth type of hatching, a set of 6 cells <b>414</b> shown with a seventh type of hatching, and a set of 6 cells <b>416</b> shown with an eighth type of hatching.</div>
<div class="description-paragraph" id="p-0035" num="0034">In one example, the cells <b>412</b>, <b>414</b> and <b>416</b> all have reduced sensitivity compared to the other cells of the array. For example, these cells have a shield formed over them at least partially restricting the exposure of the photosensitive zone of the SPAD cells to the image scene. The shields are, for example, annular, or could have another form comprising an opening providing an aperture. In one embodiment, these cells have the area of their sensitive zone reduced by a factor of substantially 7.5 with respect to the other cells of the array. Some or all of the SPAD cells of the SPAD array no are capable of being selectively and individually enabled, as will now be described with reference to the example of <figref idrefs="DRAWINGS">FIG. 5</figref>.</div>
<div class="description-paragraph" id="p-0036" num="0035"> <figref idrefs="DRAWINGS">FIG. 5</figref> shows the circuit of a SPAD cell <b>500</b> according to an example embodiment. Each of the cells of the target SPAD array <b>110</b> is, for example, implemented by a similar circuit. A photodiode <b>502</b> has its anode coupled to ground via the main conducting nodes of an NMOS transistor <b>504</b>. The gate of transistor <b>504</b> is, for example, coupled to a node <b>506</b> at the output of an inverter formed by a PMOS transistor <b>508</b> and an NMOS transistor <b>510</b>. The PMOS transistor <b>508</b>, for example, has its source coupled to a supply voltage rail at a voltage level VQUENCH, which is, for example, equal to around 1.8 V. The gates of the transistors <b>508</b>, <b>510</b> are, for example, coupled to an output node <b>512</b> of a further inverter formed of a PMOS transistor <b>514</b> and an NMOS transistor <b>516</b>. The PMOS transistor <b>514</b>, for example, has its source coupled to a supply voltage rail at a voltage level VSPADOFF, which when activated is at around the same level as VQUENCH. The gates of transistors <b>514</b>, <b>516</b> are coupled to receive the SPAD activation signal ENSPAD.</div>
<div class="description-paragraph" id="p-0037" num="0036">The anode of the photodiode <b>502</b> is also, for example, coupled to the voltage level VSPADOFF via a PMOS transistor <b>518</b>, and to one input of a NAND gate. The other input of the NAND gate is coupled to receive the activation signal ENSPAD. The NAND gate, for example, comprises a pair of NMOS transistors <b>520</b>, <b>522</b> coupled in series via their main conducting nodes between an output node <b>524</b> of the SPAD cell and ground, and having their gates respectively coupled to the line receiving the activation signal ENSPAD and to the photodiode <b>502</b>. The NAND gate further comprises a pair of PMOS transistors <b>526</b>, <b>528</b> coupled in parallel with each other between the output node <b>524</b> and the supply voltage VDD, and having their gates respectively coupled to the line receiving the activation signal ENSPAD and to the photodiode <b>502</b>. Thus, if the activation signal ENSPAD is at a logic high level, the transistor <b>504</b> will receive the voltage signal VQUENCH at its gate, and the NAND gate will become an inverter amplifying the signal from the photodiode. Alternatively, if the activation signal ENSPAD is at a logic low level, then the output signal of the SPAD cell will be at the supply voltage VDD, and the photodiode <b>502</b> will have its anode coupled to the voltage rail VSPADOFF. Of course, <figref idrefs="DRAWINGS">FIG. 5</figref> is merely one example, and many different circuit arrangements would be possible for implementing each SPAD cell.</div>
<div class="description-paragraph" id="p-0038" num="0037"> <figref idrefs="DRAWINGS">FIG. 6A</figref> shows an example of a selection circuit <b>600</b> for selectively enabling one or more subsets of the SPAD cells forming the target SPAD array <b>110</b>. For example, the circuit <b>600</b> comprises a register <b>602</b> storing a binary value associated with each SPAD cell indicating whether this cell is correctly functioning. Any faulty cells are, for example, permanently disabled by the corresponding value stored in the register <b>602</b>. Furthermore, an AND gate <b>604</b> is provided for each SPAD cell of the array. The AND gates <b>604</b> respectively provide activation signals ENSPADo to ENSPADN. Each AND gate <b>604</b> has one of its inputs coupled to a corresponding output of the register <b>602</b>, and the other of its inputs coupled to one of a plurality of output lines <b>606</b> of the control circuit <b>220</b>. In particular, there are, for example, M output lines <b>606</b>, respectively providing block enable signals ENBLOCKi to ENBLOCKM. Each of these signals is, for example, coupled to the AND gates <b>604</b> corresponding to a different subset of the SPAD cells of the array. For example, referring to the example of <figref idrefs="DRAWINGS">FIG. 4</figref>, the line <b>606</b> with the signal ENBLOCK<b>1</b> is, for example, coupled to the cells <b>402</b>, the line <b>606</b> with the signal ENBLOCK<b>2</b> is coupled to the cells <b>404</b>, and so on and so forth, up to the line <b>606</b>, with the signal ENBLOCKM, which is, for example, coupled to the cells <b>416</b>. In operation, the control circuit <b>220</b>, for example, asserts one or more of the signals ENBLOCK<b>1</b> to ENBLOCKM based on a count rate value determined based on the events present on the line <b>204</b> at the output of the OR tree <b>202</b> of the SPAD array of <figref idrefs="DRAWINGS">FIG. 2</figref>.</div>
<div class="description-paragraph" id="p-0039" num="0038"> <figref idrefs="DRAWINGS">FIG. 6B</figref> schematically illustrates an example implementation of the control circuit <b>220</b> of <figref idrefs="DRAWINGS">FIG. 6A</figref> in more detail according to an example embodiment. The line <b>204</b> at the output of the OR tree <b>202</b> of the SPAD array no is, for example, coupled to the clock input of a counter <b>608</b>, which is enabled and reset by a further clock signal CLK. The output of the counter <b>608</b> is, for example, provided to a peak value extraction circuit <b>610</b>, which is, for example, clocked by the clock signal CLK, and determines the peak count rate by storing the highest count value provided by the counter <b>608</b> over several cycles of a detection phase. In some embodiments, the circuit <b>610</b> provides a rate VCSEL_RATE corresponding to the peak count value while the optical pulses are active, and also an ambient rate AMBIENT_RATE corresponding to the count rate while the light source <b>102</b> is disabled.</div>
<div class="description-paragraph" id="p-0040" num="0039">The measured count rates from the circuit <b>610</b> are, for example, provided to a processing circuit <b>612</b>, which generates the signals on the lines <b>606</b> based on the measured count rates. Rather than being provided by the elements <b>608</b> and <b>610</b>, the count rates could alternatively be provided by a counter placed in parallel with the UP and DN counters <b>206</b>, <b>208</b>, which accumulates the events on the line <b>204</b> over time. As yet a further example, the count rates could be calculated using a counter per SPAD.</div>
<div class="description-paragraph" id="p-0041" num="0040"> <figref idrefs="DRAWINGS">FIG. 7A</figref> is a SPAD cell <b>700</b> having an annular shield <b>702</b> for reducing its sensitivity. The annular shield <b>702</b> is, for example, in the form of a light blocking plate having an opening <b>704</b> forming an aperture. A photosensitive zone of the SPAD cell is represented by a dashed rectangle <b>706</b> in <figref idrefs="DRAWINGS">FIG. 7A</figref>, and the opening <b>704</b>, for example, exposes a sub-portion of the photosensitive zone such that the sensitivity of the SPAD cell is reduced. For example, the photosensitive area exposed by the opening <b>704</b> has an area corresponding to between 5% and 90% of the area of the photosensitive zone <b>706</b>.</div>
<div class="description-paragraph" id="p-0042" num="0041">As illustrated in <figref idrefs="DRAWINGS">FIG. 7B</figref>, the annular shield is, for example, formed in at least two metal layers <b>710</b>, <b>712</b> of the device, for example, separated by oxide layers. The aperture <b>704</b> is, for example, also filled with oxide. The photosensitive zone <b>706</b>, for example, comprises a heavily doped n-type layer (n+). A heavily doped p-type layer (p+) is, for example, formed underlying at least a portion of the n-type layer <b>706</b>. The doped layers <b>706</b> and <b>714</b> are, for example, formed in a p-type well <b>716</b>, which is in turn, for example, formed in an n-type substrate <b>718</b>. The silicon structure of <figref idrefs="DRAWINGS">FIG. 7B</figref> is merely one example, and it will be apparent to those skilled in the art that many variations to this structure would be possible.</div>
<div class="description-paragraph" id="p-0043" num="0042"> <figref idrefs="DRAWINGS">FIG. 8</figref> is a flowchart illustrating an example of a method implemented by the processing circuit <b>612</b> of <figref idrefs="DRAWINGS">FIG. 6</figref> for determining a number of SPAD cells to be enabled, and for optionally determining whether or not one or more shielded SPAD cells should be enabled. This method is, for example, implemented in hardware, or by software running on a processor.</div>
<div class="description-paragraph" id="p-0044" num="0043">The method of <figref idrefs="DRAWINGS">FIG. 8</figref> is, for example, based one or more count rate measurements for the SPAD array. For example, an ambient rate (AMBIENT_RATE) and a rate with the optical pulses activated (VCSEL_RATE) are both provided as inputs, and added together by an addition operation <b>802</b> to provide a total count rate (TOTAL_RATE). The rate VCSEL_RATE is, for example, a peak rate. The ambient rate AMBIENT_RATE is, for example, determined by counting events only occurring outside of the count window. The rate VCSEL_RATE is, for example, determined by counting events only occurring during the count window. In some embodiments, the total count rate is converted into a count rate per SPAD cell by dividing the value by the number of activated SPAD cells.</div>
<div class="description-paragraph" id="p-0045" num="0044">The total count rate value is, for example, then multiplied by one or more other parameters by a multiplication operation <b>804</b>. For example, the total rate is multiplied by a parameter labeled PILE_UP_SAFETY, which indicates a ratio between the maximum count rate of the SPAD array and the desired maximum count rate to prevent pile up in the detection circuit. For example, this parameter is chosen to be in the range of 10 to 40, and is, for example, substantially equal to 20. Additionally or alternatively, the total rate is, for example, multiplied by the width of the OR pulse, labeled OR_PULSE_WIDTH(O) in <figref idrefs="DRAWINGS">FIG. 8</figref>, which corresponds to the width of the digital pulse at the output of the OR tree provided to the counters that ensures that the counters will not miss the event. This parameter is, for example, in the range 1 to 10 ns, and, for example, substantially equal to 1.8 ns in one example.</div>
<div class="description-paragraph" id="p-0046" num="0045">The reciprocal of the output of the multiplication operation is, for example, calculated by an operation <b>806</b>, and the result, for example, indicates a number NSPAD of SPAD cells to be activated. As a typical example, taking the ambient rate to equal 1 Mcps (million counts per second) and the VCSEL rate to be equal to 2.5 Mcps, a pile up safety value of 20, and an OR pulse width of 1.8 ns, the value NSPAD would be determined as 7.93. One or more subsets of SPAD cells having a number of cells lower than NSPAD is, for example, selected. Therefore, taking the example of the SPAD array <b>110</b> of <figref idrefs="DRAWINGS">FIG. 4</figref>, the seven SPAD cells <b>408</b> are, for example, activated in this example. Additionally, six aperture SPAD cells may also be activated.</div>
<div class="description-paragraph" id="p-0047" num="0046">The method of <figref idrefs="DRAWINGS">FIG. 8</figref> also, for example, involves a determination of whether or not SPAD cells with restricted apertures should be employed. This is, for example, the case if the count rate per SPAD exceeds a certain limit. For example, a threshold D is determined by a division operation <b>808</b> based on the ratio between the SPAD deadtime and the OR pulse width. For example, in the case that the SPAD deadtime is equal to 10 ns and the OR pulse width is equal to 1.8 ns, the threshold D is equal to 5.5. The value NSPAD is compared to the threshold D in an operation <b>810</b>. Thus, if NSPAD is lower than 5.5, one or more SPAD cells with annular shields will, for example, be employed to prevent the individual cells from being overexposed.</div>
<div class="description-paragraph" id="p-0048" num="0047">As an example, assuming that the ambient rate is equal to 3 Mcps and the VCSEL rate is equal to 4 Mcps, NSPAD is, for example, determined to equal to 3.97. In such a case, the 24 cells <b>412</b>, <b>414</b> and <b>916</b> having a reduced aperture are, for example, enabled. Indeed, each of these cells, for example, has a sensitivity equal to 1/7.5 that of a normal cell, and thus the sensitivity of the 24 cells will correspond to 3.2 standard SPAD cells.</div>
<div class="description-paragraph" id="p-0049" num="0048">It will be apparent to those skilled in the art that the method of <figref idrefs="DRAWINGS">FIG. 8</figref> is merely one particular example, and that many variations to this method would be possible. For example, rather than calculating a total count rate equal to the sum of the ambient and VCSEL rates, the method could be based on only one of these rates. Furthermore, the value of NSPAD could simply be calculated by a single division operation of a fixed parameter divided by the count rate value. Furthermore, in some embodiments, the threshold D could be a fixed parameter in the system programmed by a user.</div>
<div class="description-paragraph" id="p-0050" num="0049">An advantage of the embodiments described herein is that, by selectively enabling only a subset of the SPAD cells of a SPAD array, the sensitivity of the SPAD array can be improved by preventing an overly high count rate that is likely to lead to events being missed, or photon arrival statistics being skewed. Furthermore, by providing one or more SPAD cells having a reduced aperture, and thus reduced sensitivity, it is possible to avoid a maximum count rate per cell being exceeded. Having thus described at least one illustrative embodiment, various alterations, modifications and improvements will readily occur to those skilled in the art.</div>
<div class="description-paragraph" id="p-0051" num="0050">For example, it will be apparent to those skilled in the art that embodiments have been described based on metal-oxide semiconductor (MOS) transistors, alternative embodiments could at least partially be based on other transistor technologies such as bipolar technology. Furthermore, it will be apparent to those skilled in the art how the positive supply rail and ground rail in the various embodiments could be exchanged with each other, and that rather than a ground voltage, a different supply voltage level could be used, such as a negative voltage. Furthermore, it will be apparent to those skilled in the art that the various features described in relation to the various embodiments could be combined, in alternative embodiments, in any combination.</div>
</div>
</div>
</section><section itemprop="claims" itemscope="">
<h2>Claims (<span itemprop="count">21</span>)</h2>
<div html="" itemprop="content"><div class="claims" lang="EN" load-source="patent-office" mxw-id="PCLM186136582">
<claim-statement>What is claimed is:</claim-statement>
<div class="claim"> <div class="claim" id="CLM-00001" num="00001">
<div class="claim-text">1. A circuit comprising:
<div class="claim-text">a plurality of photodiode cells, each photodiode cell having an enable input and an output;</div>
<div class="claim-text">a first circuit having a plurality of inputs, each input of the first circuit coupled to the respective output of each photodiode cell of the plurality of photodiode cells; and</div>
<div class="claim-text">a controller having an input coupled to the output of the first circuit and a plurality of outputs, each output of the controller coupled to the respective enable input of each photodiode cell of the plurality of photodiode cells, the controller configured to selectively enable a subset of the plurality of photodiode cells based on the output of the first circuit.</div>
</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00002" num="00002">
<div class="claim-text">2. The circuit of <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein each photodiode cell comprises an avalanche diode.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00003" num="00003">
<div class="claim-text">3. The circuit of <claim-ref idref="CLM-00002">claim 2</claim-ref>, wherein the first circuit comprises an OR gate.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00004" num="00004">
<div class="claim-text">4. The circuit of <claim-ref idref="CLM-00002">claim 2</claim-ref>, wherein each photodiode cell comprises a first, second, third and fourth transistors, the first transistor coupled between a ground terminal and an anode of the avalanche diode, the anode of the avalanche diode further coupled to a first supply terminal via the second transistor and to a gate of the third transistor, the third transistor coupled to the output of the photodiode cell via the fourth transistor.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00005" num="00005">
<div class="claim-text">5. The circuit of <claim-ref idref="CLM-00004">claim 4</claim-ref>, wherein the enable input of each photodiode cell of the plurality of photodiode cells is coupled to a gate of the respective fourth transistor and to a gate of the respective first transistor via a respective first inverter in series with a respective second inverter, wherein the first inverter is coupled to the first supply terminal and the second inverter is coupled to a second supply terminal.</div>
</div>
</div> <div class="claim"> <div class="claim" id="CLM-00006" num="00006">
<div class="claim-text">6. A method comprising:
<div class="claim-text">receiving outputs of each single photon avalanche diode (SPAD) cell of a plurality of SPAD cells;</div>
<div class="claim-text">generating an output signal based on the received outputs of each SPAD cell; and</div>
<div class="claim-text">selectively enabling a subset of the plurality of SPAD cells based on the generated output signal, wherein a first SPAD cell of the plurality of SPAD has lower sensitivity than a second SPAD cell of the plurality of SPAD cells.</div>
</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00007" num="00007">
<div class="claim-text">7. The method of <claim-ref idref="CLM-00006">claim 6</claim-ref>, further comprising permanently disabling faulty SPAD cells of the plurality of SPAD cells.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00008" num="00008">
<div class="claim-text">8. The method of <claim-ref idref="CLM-00006">claim 6</claim-ref>, further comprising:
<div class="claim-text">determining an ambient count rate count based on the generated output signal when a light source are is disabled; and</div>
<div class="claim-text">determining a peak count rate based on the generated output signal when optical pulses are produced by the light source.</div>
</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00009" num="00009">
<div class="claim-text">9. The method of <claim-ref idref="CLM-00008">claim 8</claim-ref>, wherein selectively enabling the subset of the plurality of SPAD cells is based on the ambient count rate and on the peak count rate.</div>
</div>
</div> <div class="claim"> <div class="claim" id="CLM-00010" num="00010">
<div class="claim-text">10. A single photon avalanche diode (SPAD) device comprising:
<div class="claim-text">a light source;</div>
<div class="claim-text">a target array of target SPAD cells, each target SPAD cell having an enable input and an output; and</div>
<div class="claim-text">a first circuit comprising
<div class="claim-text">a second circuit having a plurality of inputs, each input of the first circuit coupled to the respective output of each target SPAD cell, and</div>
<div class="claim-text">a first control circuit having an input coupled to the output of the second circuit and a plurality of outputs, each output of the first control circuit coupled to the respective enable input of each target SPAD cell, the first control circuit configured to selectively enable a subset of the target SPAD cells of the target array of target SPAD cells based on the output of the second circuit.</div>
</div>
</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00011" num="00011">
<div class="claim-text">11. The SPAD device of <claim-ref idref="CLM-00010">claim 10</claim-ref>, further comprising:
<div class="claim-text">a reference array of reference SPAD cells, each reference SPAD cell having an enable input and an output;</div>
<div class="claim-text">a third circuit having a plurality of inputs, each input of the third circuit coupled to the respective output of each reference SPAD cell; and
<div class="claim-text">a second control circuit having an input coupled to the output of the third circuit and a plurality of outputs, each output of the second control circuit coupled to the respective enable input of each reference SPAD cell, the second control circuit configured to selectively enable a subset of the reference SPAD cells of the reference array of reference SPAD cells based on the output of the third circuit.</div>
</div>
</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00012" num="00012">
<div class="claim-text">12. The SPAD device of <claim-ref idref="CLM-00010">claim 10</claim-ref>, wherein the light source comprises a laser.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00013" num="00013">
<div class="claim-text">13. The SPAD device of <claim-ref idref="CLM-00010">claim 10</claim-ref>, wherein the target array has the same size as the reference array.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00014" num="00014">
<div class="claim-text">14. The SPAD device of <claim-ref idref="CLM-00010">claim 10</claim-ref>, further comprising a first lens coupled between the light source and an image scene; and a second lens coupled between the image scene and the target array.</div>
</div>
</div> <div class="claim"> <div class="claim" id="CLM-00015" num="00015">
<div class="claim-text">15. A circuit comprising an array of single photon avalanche diode (SPAD) cells, each SPAD cell of the array of SPAD cells having an enable input and an output, the array of SPAD cells having a first subset of SPAD cells and a second subset of SPAD cells, the second subset of SPAD cells being non-overlapping with the first subset of SPAD cells, wherein each SPAD cell of the first subset of SPAD cells comprises a shield and a photosensitive zone at least partially covered by the shield, the SPAD cells of the first subset of SPAD cells having a lower sensitivity to light than SPAD cells of the second subset of SPAD cells.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00016" num="00016">
<div class="claim-text">16. The circuit of <claim-ref idref="CLM-00015">claim 15</claim-ref>, wherein each shield of the SPAD cells of the first subset of SPAD cells cover between 10% and 95% of the respective photosensitive zone.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00017" num="00017">
<div class="claim-text">17. The circuit of <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein each SPAD cell of the first subset of SPAD cells has a sensitivity to light equal to 1/7.5 of the sensitivity to light of a SPAD cell of the second subset of SPAD cells.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00018" num="00018">
<div class="claim-text">18. The circuit of <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein each shield of the SPAD cells of the first subset of SPAD cells has an annular form.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00019" num="00019">
<div class="claim-text">19. The circuit of <claim-ref idref="CLM-00016">claim 16</claim-ref>, wherein each shield of the SPAD cells of the first subset of SPAD cells comprises two metal layers separated by an oxide layer.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00020" num="00020">
<div class="claim-text">20. The circuit of <claim-ref idref="CLM-00015">claim 15</claim-ref>, further comprising a controller having a plurality of outputs, each output of the controller coupled to the respective enable input of each SPAD cell of the array of SPAD cells, the controller configured to selectively enable a subset of SPAD cells of the array of SPAD cells based on light intensity received by the array of SPAD cells.</div>
</div>
</div> <div class="claim-dependent"> <div class="claim" id="CLM-00021" num="00021">
<div class="claim-text">21. The circuit of <claim-ref idref="CLM-00020">claim 20</claim-ref>, further comprising a first circuit having a plurality of inputs and an output, each input of the first circuit coupled to the respective output of each SPAD cell of the array of SPAD cells, wherein the controller further comprises an input coupled to the output of the first circuit, and the controller is configured to determine the light intensity received by the array of SPAD cells based on the output of the first circuit.</div>
</div>
</div> </div>
</div>
</section>
                </article>
            </search-app>
        </body>
    </html>
    